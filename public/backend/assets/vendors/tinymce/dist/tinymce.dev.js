"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest();}function _iterableToArrayLimit(arr,i){if(!(Symbol.iterator in Object(arr)||Object.prototype.toString.call(arr)==="[object Arguments]")){return;}var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _toArray(arr){return _arrayWithHoles(arr)||_iterableToArray2(arr)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _toConsumableArray2(arr){return _arrayWithoutHoles2(arr)||_iterableToArray2(arr)||_nonIterableSpread2();}function _nonIterableSpread2(){throw new TypeError("Invalid attempt to spread non-iterable instance");}function _iterableToArray2(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter);}function _arrayWithoutHoles2(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _typeof2(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof2=function _typeof2(obj){return typeof obj;};}else{_typeof2=function _typeof2(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof2(obj);}/**
 * TinyMCE version 6.1.2 (2022-07-29)
 */(function(){'use strict';var typeOf$1=function typeOf$1(x){if(x===null){return'null';}if(x===undefined){return'undefined';}var t=_typeof2(x);if(t==='object'&&(Array.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='Array')){return'array';}if(t==='object'&&(String.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='String')){return'string';}return t;};var isEquatableType=function isEquatableType(x){return['undefined','boolean','number','string','function','xml','null'].indexOf(x)!==-1;};var sort$1=function sort$1(xs,compareFn){var clone=Array.prototype.slice.call(xs);return clone.sort(compareFn);};var contramap=function contramap(eqa,f){return eq$2(function(x,y){return eqa.eq(f(x),f(y));});};var eq$2=function eq$2(f){return{eq:f};};var tripleEq=eq$2(function(x,y){return x===y;});var eqString=tripleEq;var eqArray=function eqArray(eqa){return eq$2(function(x,y){if(x.length!==y.length){return false;}var len=x.length;for(var i=0;i<len;i++){if(!eqa.eq(x[i],y[i])){return false;}}return true;});};var eqSortedArray=function eqSortedArray(eqa,compareFn){return contramap(eqArray(eqa),function(xs){return sort$1(xs,compareFn);});};var eqRecord=function eqRecord(eqa){return eq$2(function(x,y){var kx=Object.keys(x);var ky=Object.keys(y);if(!eqSortedArray(eqString).eq(kx,ky)){return false;}var len=kx.length;for(var i=0;i<len;i++){var q=kx[i];if(!eqa.eq(x[q],y[q])){return false;}}return true;});};var eqAny=eq$2(function(x,y){if(x===y){return true;}var tx=typeOf$1(x);var ty=typeOf$1(y);if(tx!==ty){return false;}if(isEquatableType(tx)){return x===y;}else if(tx==='array'){return eqArray(eqAny).eq(x,y);}else if(tx==='object'){return eqRecord(eqAny).eq(x,y);}return false;});var getPrototypeOf$1=Object.getPrototypeOf;var hasProto=function hasProto(v,constructor,predicate){var _a;if(predicate(v,constructor.prototype)){return true;}else{return((_a=v.constructor)===null||_a===void 0?void 0:_a.name)===constructor.name;}};var typeOf=function typeOf(x){var t=_typeof2(x);if(x===null){return'null';}else if(t==='object'&&Array.isArray(x)){return'array';}else if(t==='object'&&hasProto(x,String,function(o,proto){return proto.isPrototypeOf(o);})){return'string';}else{return t;}};var isType$1=function isType$1(type){return function(value){return typeOf(value)===type;};};var isSimpleType=function isSimpleType(type){return function(value){return _typeof2(value)===type;};};var eq$1=function eq$1(t){return function(a){return t===a;};};var is$4=function is$4(value,constructor){return isObject(value)&&hasProto(value,constructor,function(o,proto){return getPrototypeOf$1(o)===proto;});};var isString=isType$1('string');var isObject=isType$1('object');var isPlainObject=function isPlainObject(value){return is$4(value,Object);};var isArray$1=isType$1('array');var isNull=eq$1(null);var isBoolean=isSimpleType('boolean');var isUndefined=eq$1(undefined);var isNullable=function isNullable(a){return a===null||a===undefined;};var isNonNullable=function isNonNullable(a){return!isNullable(a);};var isFunction=isSimpleType('function');var isNumber=isSimpleType('number');var isArrayOf=function isArrayOf(value,pred){if(isArray$1(value)){for(var i=0,len=value.length;i<len;++i){if(!pred(value[i])){return false;}}return true;}return false;};var noop=function noop(){};var compose=function compose(fa,fb){return function(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3];}return fa(fb.apply(null,args));};};var compose1=function compose1(fbc,fab){return function(a){return fbc(fab(a));};};var constant=function constant(value){return function(){return value;};};var identity=function identity(x){return x;};var tripleEquals=function tripleEquals(a,b){return a===b;};function curry(fn){for(var _len4=arguments.length,initialArgs=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++){initialArgs[_key4-1]=arguments[_key4];}return function(){for(var _len5=arguments.length,restArgs=new Array(_len5),_key5=0;_key5<_len5;_key5++){restArgs[_key5]=arguments[_key5];}var all=initialArgs.concat(restArgs);return fn.apply(null,all);};}var not=function not(f){return function(t){return!f(t);};};var die=function die(msg){return function(){throw new Error(msg);};};var apply$1=function apply$1(f){return f();};var call=function call(f){f();};var never=constant(false);var always=constant(true);var Optional=/*#__PURE__*/function(){function Optional(tag,value){_classCallCheck(this,Optional);this.tag=tag;this.value=value;}_createClass(Optional,[{key:"fold",value:function fold(onNone,onSome){if(this.tag){return onSome(this.value);}else{return onNone();}}},{key:"isSome",value:function isSome(){return this.tag;}},{key:"isNone",value:function isNone(){return!this.tag;}},{key:"map",value:function map(mapper){if(this.tag){return Optional.some(mapper(this.value));}else{return Optional.none();}}},{key:"bind",value:function bind(binder){if(this.tag){return binder(this.value);}else{return Optional.none();}}},{key:"exists",value:function exists(predicate){return this.tag&&predicate(this.value);}},{key:"forall",value:function forall(predicate){return!this.tag||predicate(this.value);}},{key:"filter",value:function filter(predicate){if(!this.tag||predicate(this.value)){return this;}else{return Optional.none();}}},{key:"getOr",value:function getOr(replacement){return this.tag?this.value:replacement;}},{key:"or",value:function or(replacement){return this.tag?this:replacement;}},{key:"getOrThunk",value:function getOrThunk(thunk){return this.tag?this.value:thunk();}},{key:"orThunk",value:function orThunk(thunk){return this.tag?this:thunk();}},{key:"getOrDie",value:function getOrDie(message){if(!this.tag){throw new Error(message!==null&&message!==void 0?message:'Called getOrDie on None');}else{return this.value;}}},{key:"getOrNull",value:function getOrNull(){return this.tag?this.value:null;}},{key:"getOrUndefined",value:function getOrUndefined(){return this.value;}},{key:"each",value:function each(worker){if(this.tag){worker(this.value);}}},{key:"toArray",value:function toArray(){return this.tag?[this.value]:[];}},{key:"toString",value:function toString(){return this.tag?"some(".concat(this.value,")"):'none()';}}],[{key:"some",value:function some(value){return new Optional(true,value);}},{key:"none",value:function none(){return Optional.singletonNone;}},{key:"from",value:function from(value){return isNonNullable(value)?Optional.some(value):Optional.none();}}]);return Optional;}();Optional.singletonNone=new Optional(false);var nativeSlice=Array.prototype.slice;var nativeIndexOf=Array.prototype.indexOf;var nativePush=Array.prototype.push;var rawIndexOf=function rawIndexOf(ts,t){return nativeIndexOf.call(ts,t);};var indexOf$1=function indexOf$1(xs,x){var r=rawIndexOf(xs,x);return r===-1?Optional.none():Optional.some(r);};var contains$2=function contains$2(xs,x){return rawIndexOf(xs,x)>-1;};var exists=function exists(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return true;}}return false;};var map$3=function map$3(xs,f){var len=xs.length;var r=new Array(len);for(var i=0;i<len;i++){var x=xs[i];r[i]=f(x,i);}return r;};var each$f=function each$f(xs,f){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];f(x,i);}};var eachr=function eachr(xs,f){for(var i=xs.length-1;i>=0;i--){var x=xs[i];f(x,i);}};var partition$2=function partition$2(xs,pred){var pass=[];var fail=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];var arr=pred(x,i)?pass:fail;arr.push(x);}return{pass:pass,fail:fail};};var filter$6=function filter$6(xs,pred){var r=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){r.push(x);}}return r;};var foldr=function foldr(xs,f,acc){eachr(xs,function(x,i){acc=f(acc,x,i);});return acc;};var foldl=function foldl(xs,f,acc){each$f(xs,function(x,i){acc=f(acc,x,i);});return acc;};var findUntil$1=function findUntil$1(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(x);}else if(until(x,i)){break;}}return Optional.none();};var find$2=function find$2(xs,pred){return findUntil$1(xs,pred,never);};var findIndex$2=function findIndex$2(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(i);}}return Optional.none();};var flatten=function flatten(xs){var r=[];for(var i=0,len=xs.length;i<len;++i){if(!isArray$1(xs[i])){throw new Error('Arr.flatten item '+i+' was not an array, input: '+xs);}nativePush.apply(r,xs[i]);}return r;};var bind$3=function bind$3(xs,f){return flatten(map$3(xs,f));};var forall=function forall(xs,pred){for(var i=0,len=xs.length;i<len;++i){var x=xs[i];if(pred(x,i)!==true){return false;}}return true;};var reverse=function reverse(xs){var r=nativeSlice.call(xs,0);r.reverse();return r;};var difference=function difference(a1,a2){return filter$6(a1,function(x){return!contains$2(a2,x);});};var mapToObject=function mapToObject(xs,f){var r={};for(var i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i);}return r;};var sort=function sort(xs,comparator){var copy=nativeSlice.call(xs,0);copy.sort(comparator);return copy;};var get$b=function get$b(xs,i){return i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none();};var head=function head(xs){return get$b(xs,0);};var last$3=function last$3(xs){return get$b(xs,xs.length-1);};var from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x);};var findMap=function findMap(arr,f){for(var i=0;i<arr.length;i++){var _r=f(arr[i],i);if(_r.isSome()){return _r;}}return Optional.none();};var unique$1=function unique$1(xs,comparator){var r=[];var isDuplicated=isFunction(comparator)?function(x){return exists(r,function(i){return comparator(i,x);});}:function(x){return contains$2(r,x);};for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(!isDuplicated(x)){r.push(x);}}return r;};var keys=Object.keys;var hasOwnProperty$2=Object.hasOwnProperty;var each$e=function each$e(obj,f){var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];f(x,i);}};var map$2=function map$2(obj,f){return tupleMap(obj,function(x,i){return{k:i,v:f(x,i)};});};var tupleMap=function tupleMap(obj,f){var r={};each$e(obj,function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v;});return r;};var objAcc=function objAcc(r){return function(x,i){r[i]=x;};};var internalFilter=function internalFilter(obj,pred,onTrue,onFalse){var r={};each$e(obj,function(x,i){(pred(x,i)?onTrue:onFalse)(x,i);});return r;};var bifilter=function bifilter(obj,pred){var t={};var f={};internalFilter(obj,pred,objAcc(t),objAcc(f));return{t:t,f:f};};var filter$5=function filter$5(obj,pred){var t={};internalFilter(obj,pred,objAcc(t),noop);return t;};var mapToArray=function mapToArray(obj,f){var r=[];each$e(obj,function(value,name){r.push(f(value,name));});return r;};var values=function values(obj){return mapToArray(obj,identity);};var get$a=function get$a(obj,key){return has$2(obj,key)?Optional.from(obj[key]):Optional.none();};var has$2=function has$2(obj,key){return hasOwnProperty$2.call(obj,key);};var hasNonNullableKey=function hasNonNullableKey(obj,key){return has$2(obj,key)&&obj[key]!==undefined&&obj[key]!==null;};var equal$1=function equal$1(a1,a2){var eq=arguments.length>2&&arguments[2]!==undefined?arguments[2]:eqAny;return eqRecord(eq).eq(a1,a2);};var stringArray=function stringArray(a){var all={};each$f(a,function(key){all[key]={};});return keys(all);};var isArray=Array.isArray;var toArray$1=function toArray$1(obj){if(!isArray(obj)){var array=[];for(var i=0,l=obj.length;i<l;i++){array[i]=obj[i];}return array;}else{return obj;}};var each$d=function each$d(o,cb,s){var n,l;if(!o){return false;}s=s||o;if(o.length!==undefined){for(n=0,l=o.length;n<l;n++){if(cb.call(s,o[n],n,o)===false){return false;}}}else{for(n in o){if(has$2(o,n)){if(cb.call(s,o[n],n,o)===false){return false;}}}}return true;};var map$1=function map$1(array,callback){var out=[];each$d(array,function(item,index){out.push(callback(item,index,array));});return out;};var filter$4=function filter$4(a,f){var o=[];each$d(a,function(v,index){if(!f||f(v,index,a)){o.push(v);}});return o;};var indexOf=function indexOf(a,v){if(a){for(var i=0,l=a.length;i<l;i++){if(a[i]===v){return i;}}}return-1;};var reduce=function reduce(collection,iteratee,accumulator,thisArg){var acc=isUndefined(accumulator)?collection[0]:accumulator;for(var i=0;i<collection.length;i++){acc=iteratee.call(thisArg,acc,collection[i],i);}return acc;};var findIndex$1=function findIndex$1(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++){if(predicate.call(thisArg,array[i],i,array)){return i;}}return-1;};var last$2=function last$2(collection){return collection[collection.length-1];};var cached=function cached(f){var called=false;var r;return function(){if(!called){called=true;for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6];}r=f.apply(null,args);}return r;};};var DeviceType=function DeviceType(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&/ipad/i.test(userAgent)===true;var isiPhone=os.isiOS()&&!isiPad;var isMobile=os.isiOS()||os.isAndroid();var isTouch=isMobile||mediaMatch('(pointer:coarse)');var isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch('(min-device-width:768px)');var isPhone=isiPhone||isMobile&&!isTablet;var iOSwebview=browser.isSafari()&&os.isiOS()&&/safari/i.test(userAgent)===false;var isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(isTablet),isPhone:constant(isPhone),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(iOSwebview),isDesktop:constant(isDesktop)};};var firstMatch=function firstMatch(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s)){return x;}}return undefined;};var find$1=function find$1(regexes,agent){var r=firstMatch(regexes,agent);if(!r){return{major:0,minor:0};}var group=function group(i){return Number(agent.replace(r,'$'+i));};return nu$3(group(1),group(2));};var detect$5=function detect$5(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();if(versionRegexes.length===0){return unknown$2();}return find$1(versionRegexes,cleanedAgent);};var unknown$2=function unknown$2(){return nu$3(0,0);};var nu$3=function nu$3(major,minor){return{major:major,minor:minor};};var Version={nu:nu$3,detect:detect$5,unknown:unknown$2};var detectBrowser$1=function detectBrowser$1(browsers,userAgentData){return findMap(userAgentData.brands,function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$2(browsers,function(browser){var _a;return lcBrand===((_a=browser.brand)===null||_a===void 0?void 0:_a.toLowerCase());}).map(function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)};});});};var detect$4=function detect$4(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$2(candidates,function(candidate){return candidate.search(agent);});};var detectBrowser=function detectBrowser(browsers,userAgent){return detect$4(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version};});};var detectOs=function detectOs(oses,userAgent){return detect$4(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version};});};var removeFromStart=function removeFromStart(str,numChars){return str.substring(numChars);};var checkRange=function checkRange(str,substr,start){return substr===''||str.length>=substr.length&&str.substr(start,start+substr.length)===substr;};var removeLeading=function removeLeading(str,prefix){return startsWith(str,prefix)?removeFromStart(str,prefix.length):str;};var contains$1=function contains$1(str,substr){return str.indexOf(substr)!==-1;};var startsWith=function startsWith(str,prefix){return checkRange(str,prefix,0);};var endsWith=function endsWith(str,suffix){return checkRange(str,suffix,str.length-suffix.length);};var blank=function blank(r){return function(s){return s.replace(r,'');};};var trim$3=blank(/^\s+|\s+$/g);var lTrim=blank(/^\s+/g);var rTrim=blank(/\s+$/g);var isNotEmpty=function isNotEmpty(s){return s.length>0;};var isEmpty$3=function isEmpty$3(s){return!isNotEmpty(s);};var repeat=function repeat(s,count){return count<=0?'':new Array(count+1).join(s);};var toInt=function toInt(value){var radix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;var num=parseInt(value,radix);return isNaN(num)?Optional.none():Optional.some(num);};var normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/;var checkContains=function checkContains(target){return function(uastring){return contains$1(uastring,target);};};var browsers=[{name:'Edge',versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function search(uastring){return contains$1(uastring,'edge/')&&contains$1(uastring,'chrome')&&contains$1(uastring,'safari')&&contains$1(uastring,'applewebkit');}},{name:'Chromium',brand:'Chromium',versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function search(uastring){return contains$1(uastring,'chrome')&&!contains$1(uastring,'chromeframe');}},{name:'IE',versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function search(uastring){return contains$1(uastring,'msie')||contains$1(uastring,'trident');}},{name:'Opera',versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains('opera')},{name:'Firefox',versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains('firefox')},{name:'Safari',versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function search(uastring){return(contains$1(uastring,'safari')||contains$1(uastring,'mobile/'))&&contains$1(uastring,'applewebkit');}}];var oses=[{name:'Windows',search:checkContains('win'),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:'iOS',search:function search(uastring){return contains$1(uastring,'iphone')||contains$1(uastring,'ipad');},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:'Android',search:checkContains('android'),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:'macOS',search:checkContains('mac os x'),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:'Linux',search:checkContains('linux'),versionRegexes:[]},{name:'Solaris',search:checkContains('sunos'),versionRegexes:[]},{name:'FreeBSD',search:checkContains('freebsd'),versionRegexes:[]},{name:'ChromeOS',search:checkContains('cros'),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}];var PlatformInfo={browsers:constant(browsers),oses:constant(oses)};var edge='Edge';var chromium='Chromium';var ie='IE';var opera='Opera';var firefox='Firefox';var safari='Safari';var unknown$1=function unknown$1(){return nu$2({current:undefined,version:Version.unknown()});};var nu$2=function nu$2(info){var current=info.current;var version=info.version;var isBrowser=function isBrowser(name){return function(){return current===name;};};return{current:current,version:version,isEdge:isBrowser(edge),isChromium:isBrowser(chromium),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)};};var Browser={unknown:unknown$1,nu:nu$2,edge:constant(edge),chromium:constant(chromium),ie:constant(ie),opera:constant(opera),firefox:constant(firefox),safari:constant(safari)};var windows='Windows';var ios='iOS';var android='Android';var linux='Linux';var macos='macOS';var solaris='Solaris';var freebsd='FreeBSD';var chromeos='ChromeOS';var unknown=function unknown(){return nu$1({current:undefined,version:Version.unknown()});};var nu$1=function nu$1(info){var current=info.current;var version=info.version;var isOS=function isOS(name){return function(){return current===name;};};return{current:current,version:version,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isMacOS:isOS(macos),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)};};var OperatingSystem={unknown:unknown,nu:nu$1,windows:constant(windows),ios:constant(ios),android:constant(android),linux:constant(linux),macos:constant(macos),solaris:constant(solaris),freebsd:constant(freebsd),chromeos:constant(chromeos)};var detect$3=function detect$3(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers();var oses=PlatformInfo.oses();var browser=userAgentDataOpt.bind(function(userAgentData){return detectBrowser$1(browsers,userAgentData);}).orThunk(function(){return detectBrowser(browsers,userAgent);}).fold(Browser.unknown,Browser.nu);var os=detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu);var deviceType=DeviceType(os,browser,userAgent,mediaMatch);return{browser:browser,os:os,deviceType:deviceType};};var PlatformDetection={detect:detect$3};var mediaMatch=function mediaMatch(query){return window.matchMedia(query).matches;};var platform$2=cached(function(){return PlatformDetection.detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch);});var detect$2=function detect$2(){return platform$2();};var userAgent=navigator.userAgent;var platform$1=detect$2();var browser$1=platform$1.browser;var os=platform$1.os;var deviceType=platform$1.deviceType;var windowsPhone=userAgent.indexOf('Windows Phone')!==-1;var Env={transparentSrc:'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',documentMode:browser$1.isIE()?document.documentMode||7:10,cacheSuffix:null,container:null,canHaveCSP:!browser$1.isIE(),windowsPhone:windowsPhone,browser:{current:browser$1.current,version:browser$1.version,isChromium:browser$1.isChromium,isEdge:browser$1.isEdge,isFirefox:browser$1.isFirefox,isIE:browser$1.isIE,isOpera:browser$1.isOpera,isSafari:browser$1.isSafari},os:{current:os.current,version:os.version,isAndroid:os.isAndroid,isChromeOS:os.isChromeOS,isFreeBSD:os.isFreeBSD,isiOS:os.isiOS,isLinux:os.isLinux,isMacOS:os.isMacOS,isSolaris:os.isSolaris,isWindows:os.isWindows},deviceType:{isDesktop:deviceType.isDesktop,isiPad:deviceType.isiPad,isiPhone:deviceType.isiPhone,isPhone:deviceType.isPhone,isTablet:deviceType.isTablet,isTouch:deviceType.isTouch,isWebView:deviceType.isWebView}};var whiteSpaceRegExp$1=/^\s*|\s*$/g;var trim$2=function trim$2(str){return str===null||str===undefined?'':(''+str).replace(whiteSpaceRegExp$1,'');};var is$3=function is$3(obj,type){if(!type){return obj!==undefined;}if(type==='array'&&isArray(obj)){return true;}return _typeof2(obj)===type;};var makeMap$4=function makeMap$4(items,delim,map){var i;items=items||[];delim=delim||',';if(typeof items==='string'){items=items.split(delim);}map=map||{};i=items.length;while(i--){map[items[i]]={};}return map;};var hasOwnProperty$1=has$2;var extend$3=function extend$3(obj){for(var i=0;i<(arguments.length<=1?0:arguments.length-1);i++){var ext=i+1<1||arguments.length<=i+1?undefined:arguments[i+1];for(var _name in ext){if(has$2(ext,_name)){var _value2=ext[_name];if(_value2!==undefined){obj[_name]=_value2;}}}}return obj;};var walk$4=function walk$4(o,f,n,s){s=s||this;if(o){if(n){o=o[n];}each$d(o,function(o,i){if(f.call(s,o,i,n)===false){return false;}walk$4(o,f,n,s);});}};var resolve$2=function resolve$2(n,o){var i,l;o=o||window;n=n.split('.');for(i=0,l=n.length;i<l;i++){o=o[n[i]];if(!o){break;}}return o;};var explode$3=function explode$3(s,d){if(!s||is$3(s,'array')){return s;}return map$1(s.split(d||','),trim$2);};var _addCacheSuffix=function _addCacheSuffix(url){var cacheSuffix=Env.cacheSuffix;if(cacheSuffix){url+=(url.indexOf('?')===-1?'?':'&')+cacheSuffix;}return url;};var Tools={trim:trim$2,isArray:isArray,is:is$3,toArray:toArray$1,makeMap:makeMap$4,each:each$d,map:map$1,grep:filter$4,inArray:indexOf,hasOwn:hasOwnProperty$1,extend:extend$3,walk:walk$4,resolve:resolve$2,explode:explode$3,_addCacheSuffix:_addCacheSuffix};var is$2=function is$2(lhs,rhs){var comparator=arguments.length>2&&arguments[2]!==undefined?arguments[2]:tripleEquals;return lhs.exists(function(left){return comparator(left,rhs);});};var cat=function cat(arr){var r=[];var push=function push(x){r.push(x);};for(var i=0;i<arr.length;i++){arr[i].each(push);}return r;};var lift2=function lift2(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none();};var lift3=function lift3(oa,ob,oc,f){return oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none();};var someIf=function someIf(b,a){return b?Optional.some(a):Optional.none();};typeof window!=='undefined'?window:Function('return this;')();var COMMENT=8;var DOCUMENT=9;var DOCUMENT_FRAGMENT=11;var ELEMENT=1;var TEXT=3;var name=function name(element){var r=element.dom.nodeName;return r.toLowerCase();};var type$1=function type$1(element){return element.dom.nodeType;};var isType=function isType(t){return function(element){return type$1(element)===t;};};var isComment$1=function isComment$1(element){return type$1(element)===COMMENT||name(element)==='#comment';};var isElement$7=isType(ELEMENT);var isText$a=isType(TEXT);var isDocument$2=isType(DOCUMENT);var isDocumentFragment$1=isType(DOCUMENT_FRAGMENT);var isTag=function isTag(tag){return function(e){return isElement$7(e)&&name(e)===tag;};};var rawSet=function rawSet(dom,key,value){if(isString(value)||isBoolean(value)||isNumber(value)){dom.setAttribute(key,value+'');}else{console.error('Invalid call to Attribute.set. Key ',key,':: Value ',value,':: Element ',dom);throw new Error('Attribute value was not simple');}};var set$2=function set$2(element,key,value){rawSet(element.dom,key,value);};var setAll$1=function setAll$1(element,attrs){var dom=element.dom;each$e(attrs,function(v,k){rawSet(dom,k,v);});};var get$9=function get$9(element,key){var v=element.dom.getAttribute(key);return v===null?undefined:v;};var getOpt=function getOpt(element,key){return Optional.from(get$9(element,key));};var has$1=function has$1(element,key){var dom=element.dom;return dom&&dom.hasAttribute?dom.hasAttribute(key):false;};var remove$b=function remove$b(element,key){element.dom.removeAttribute(key);};var hasNone=function hasNone(element){var attrs=element.dom.attributes;return attrs===undefined||attrs===null||attrs.length===0;};var clone$4=function clone$4(element){return foldl(element.dom.attributes,function(acc,attr){acc[attr.name]=attr.value;return acc;},{});};var read$4=function read$4(element,attr){var value=get$9(element,attr);return value===undefined||value===''?[]:value.split(' ');};var add$4=function add$4(element,attr,id){var old=read$4(element,attr);var nu=old.concat([id]);set$2(element,attr,nu.join(' '));return true;};var remove$a=function remove$a(element,attr,id){var nu=filter$6(read$4(element,attr),function(v){return v!==id;});if(nu.length>0){set$2(element,attr,nu.join(' '));}else{remove$b(element,attr);}return false;};var supports=function supports(element){return element.dom.classList!==undefined;};var get$8=function get$8(element){return read$4(element,'class');};var add$3=function add$3(element,clazz){return add$4(element,'class',clazz);};var remove$9=function remove$9(element,clazz){return remove$a(element,'class',clazz);};var toggle$2=function toggle$2(element,clazz){if(contains$2(get$8(element),clazz)){return remove$9(element,clazz);}else{return add$3(element,clazz);}};var add$2=function add$2(element,clazz){if(supports(element)){element.dom.classList.add(clazz);}else{add$3(element,clazz);}};var cleanClass=function cleanClass(element){var classList=supports(element)?element.dom.classList:get$8(element);if(classList.length===0){remove$b(element,'class');}};var remove$8=function remove$8(element,clazz){if(supports(element)){var classList=element.dom.classList;classList.remove(clazz);}else{remove$9(element,clazz);}cleanClass(element);};var toggle$1=function toggle$1(element,clazz){var result=supports(element)?element.dom.classList.toggle(clazz):toggle$2(element,clazz);cleanClass(element);return result;};var has=function has(element,clazz){return supports(element)&&element.dom.classList.contains(clazz);};var isSupported$1=function isSupported$1(dom){return dom.style!==undefined&&isFunction(dom.style.getPropertyValue);};var fromHtml$1=function fromHtml$1(html,scope){var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;if(!div.hasChildNodes()||div.childNodes.length>1){var message='HTML does not have a single root node';console.error(message,html);throw new Error(message);}return fromDom$2(div.childNodes[0]);};var fromTag=function fromTag(tag,scope){var doc=scope||document;var node=doc.createElement(tag);return fromDom$2(node);};var fromText=function fromText(text,scope){var doc=scope||document;var node=doc.createTextNode(text);return fromDom$2(node);};var fromDom$2=function fromDom$2(node){if(node===null||node===undefined){throw new Error('Node cannot be null or undefined');}return{dom:node};};var fromPoint$2=function fromPoint$2(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom$2);};var SugarElement={fromHtml:fromHtml$1,fromTag:fromTag,fromText:fromText,fromDom:fromDom$2,fromPoint:fromPoint$2};var toArray=function toArray(target,f){var r=[];var recurse=function recurse(e){r.push(e);return f(e);};var cur=f(target);do{cur=cur.bind(recurse);}while(cur.isSome());return r;};var is$1=function is$1(element,selector){var dom=element.dom;if(dom.nodeType!==ELEMENT){return false;}else{var elem=dom;if(elem.matches!==undefined){return elem.matches(selector);}else if(elem.msMatchesSelector!==undefined){return elem.msMatchesSelector(selector);}else if(elem.webkitMatchesSelector!==undefined){return elem.webkitMatchesSelector(selector);}else if(elem.mozMatchesSelector!==undefined){return elem.mozMatchesSelector(selector);}else{throw new Error('Browser lacks native selectors');}}};var bypassSelector=function bypassSelector(dom){return dom.nodeType!==ELEMENT&&dom.nodeType!==DOCUMENT&&dom.nodeType!==DOCUMENT_FRAGMENT||dom.childElementCount===0;};var all=function all(selector,scope){var base=scope===undefined?document:scope.dom;return bypassSelector(base)?[]:map$3(base.querySelectorAll(selector),SugarElement.fromDom);};var one=function one(selector,scope){var base=scope===undefined?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);};var eq=function eq(e1,e2){return e1.dom===e2.dom;};var contains=function contains(e1,e2){var d1=e1.dom;var d2=e2.dom;return d1===d2?false:d1.contains(d2);};var owner$1=function owner$1(element){return SugarElement.fromDom(element.dom.ownerDocument);};var documentOrOwner=function documentOrOwner(dos){return isDocument$2(dos)?dos:owner$1(dos);};var documentElement=function documentElement(element){return SugarElement.fromDom(documentOrOwner(element).dom.documentElement);};var defaultView=function defaultView(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);};var parent=function parent(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);};var parentElement=function parentElement(element){return Optional.from(element.dom.parentElement).map(SugarElement.fromDom);};var parents$1=function parents$1(element,isRoot){var stop=isFunction(isRoot)?isRoot:never;var dom=element.dom;var ret=[];while(dom.parentNode!==null&&dom.parentNode!==undefined){var rawParent=dom.parentNode;var p=SugarElement.fromDom(rawParent);ret.push(p);if(stop(p)===true){break;}else{dom=rawParent;}}return ret;};var siblings=function siblings(element){var filterSelf=function filterSelf(elements){return filter$6(elements,function(x){return!eq(element,x);});};return parent(element).map(children).map(filterSelf).getOr([]);};var prevSibling=function prevSibling(element){return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);};var nextSibling=function nextSibling(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);};var prevSiblings=function prevSiblings(element){return reverse(toArray(element,prevSibling));};var nextSiblings=function nextSiblings(element){return toArray(element,nextSibling);};var children=function children(element){return map$3(element.dom.childNodes,SugarElement.fromDom);};var child$1=function child$1(element,index){var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom);};var firstChild=function firstChild(element){return child$1(element,0);};var lastChild=function lastChild(element){return child$1(element,element.dom.childNodes.length-1);};var childNodesCount=function childNodesCount(element){return element.dom.childNodes.length;};var getHead=function getHead(doc){var b=doc.dom.head;if(b===null||b===undefined){throw new Error('Head is not available yet');}return SugarElement.fromDom(b);};var isShadowRoot=function isShadowRoot(dos){return isDocumentFragment$1(dos)&&isNonNullable(dos.dom.host);};var supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode);var isSupported=constant(supported);var getRootNode=supported?function(e){return SugarElement.fromDom(e.dom.getRootNode());}:documentOrOwner;var getStyleContainer=function getStyleContainer(dos){return isShadowRoot(dos)?dos:getHead(documentOrOwner(dos));};var getShadowRoot=function getShadowRoot(e){var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none();};var getShadowHost=function getShadowHost(e){return SugarElement.fromDom(e.dom.host);};var getOriginalEventTarget=function getOriginalEventTarget(event){if(isSupported()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$7(el)&&isOpenShadowHost(el)){if(event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath){return head(composedPath);}}}}return Optional.from(event.target);};var isOpenShadowHost=function isOpenShadowHost(element){return isNonNullable(element.dom.shadowRoot);};var inBody=function inBody(element){var dom=isText$a(element)?element.dom.parentNode:element.dom;if(dom===undefined||dom===null||dom.ownerDocument===null){return false;}var doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold(function(){return doc.body.contains(dom);},compose1(inBody,getShadowHost));};var internalSet=function internalSet(dom,property,value){if(!isString(value)){console.error('Invalid call to CSS.set. Property ',property,':: Value ',value,':: Element ',dom);throw new Error('CSS value must be a string: '+value);}if(isSupported$1(dom)){dom.style.setProperty(property,value);}};var internalRemove=function internalRemove(dom,property){if(isSupported$1(dom)){dom.style.removeProperty(property);}};var set$1=function set$1(element,property,value){var dom=element.dom;internalSet(dom,property,value);};var setAll=function setAll(element,css){var dom=element.dom;each$e(css,function(v,k){internalSet(dom,k,v);});};var get$7=function get$7(element,property){var dom=element.dom;var styles=window.getComputedStyle(dom);var r=styles.getPropertyValue(property);return r===''&&!inBody(element)?getUnsafeProperty(dom,property):r;};var getUnsafeProperty=function getUnsafeProperty(dom,property){return isSupported$1(dom)?dom.style.getPropertyValue(property):'';};var getRaw$1=function getRaw$1(element,property){var dom=element.dom;var raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter(function(r){return r.length>0;});};var getAllRaw=function getAllRaw(element){var css={};var dom=element.dom;if(isSupported$1(dom)){for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName];}}return css;};var remove$7=function remove$7(element,property){var dom=element.dom;internalRemove(dom,property);if(is$2(getOpt(element,'style').map(trim$3),'')){remove$b(element,'style');}};var reflow=function reflow(e){return e.dom.offsetWidth;};var before$3=function before$3(marker,element){var parent$1=parent(marker);parent$1.each(function(v){v.dom.insertBefore(element.dom,marker.dom);});};var after$4=function after$4(marker,element){var sibling=nextSibling(marker);sibling.fold(function(){var parent$1=parent(marker);parent$1.each(function(v){append$1(v,element);});},function(v){before$3(v,element);});};var prepend=function prepend(parent,element){var firstChild$1=firstChild(parent);firstChild$1.fold(function(){append$1(parent,element);},function(v){parent.dom.insertBefore(element.dom,v.dom);});};var append$1=function append$1(parent,element){parent.dom.appendChild(element.dom);};var wrap$2=function wrap$2(element,wrapper){before$3(element,wrapper);append$1(wrapper,element);};var after$3=function after$3(marker,elements){each$f(elements,function(x,i){var e=i===0?marker:elements[i-1];after$4(e,x);});};var append=function append(parent,elements){each$f(elements,function(x){append$1(parent,x);});};var empty=function empty(element){element.dom.textContent='';each$f(children(element),function(rogue){remove$6(rogue);});};var remove$6=function remove$6(element){var dom=element.dom;if(dom.parentNode!==null){dom.parentNode.removeChild(dom);}};var unwrap=function unwrap(wrapper){var children$1=children(wrapper);if(children$1.length>0){after$3(wrapper,children$1);}remove$6(wrapper);};var fromHtml=function fromHtml(html,scope){var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;return children(SugarElement.fromDom(div));};var fromDom$1=function fromDom$1(nodes){return map$3(nodes,SugarElement.fromDom);};var get$6=function get$6(element){return element.dom.innerHTML;};var set=function set(element,content){var owner=owner$1(element);var docDom=owner.dom;var fragment=SugarElement.fromDom(docDom.createDocumentFragment());var contentElements=fromHtml(content,docDom);append(fragment,contentElements);empty(element);append$1(element,fragment);};var getOuter=function getOuter(element){var container=SugarElement.fromTag('div');var clone=SugarElement.fromDom(element.dom.cloneNode(true));append$1(container,clone);return get$6(container);};var mkEvent=function mkEvent(target,x,y,stop,prevent,kill,raw){return{target:target,x:x,y:y,stop:stop,prevent:prevent,kill:kill,raw:raw};};var fromRawEvent=function fromRawEvent(rawEvent){var target=SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));var stop=function stop(){return rawEvent.stopPropagation();};var prevent=function prevent(){return rawEvent.preventDefault();};var kill=compose(prevent,stop);return mkEvent(target,rawEvent.clientX,rawEvent.clientY,stop,prevent,kill,rawEvent);};var handle$1=function handle$1(filter,handler){return function(rawEvent){if(filter(rawEvent)){handler(fromRawEvent(rawEvent));}};};var binder=function binder(element,event,filter,handler,useCapture){var wrapped=handle$1(filter,handler);element.dom.addEventListener(event,wrapped,useCapture);return{unbind:curry(unbind,element,event,wrapped,useCapture)};};var bind$2=function bind$2(element,event,filter,handler){return binder(element,event,filter,handler,false);};var unbind=function unbind(element,event,handler,useCapture){element.dom.removeEventListener(event,handler,useCapture);};var r=function r(left,top){var translate=function translate(x,y){return r(left+x,top+y);};return{left:left,top:top,translate:translate};};var SugarPosition=r;var boxPosition=function boxPosition(dom){var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top);};var firstDefinedOrZero=function firstDefinedOrZero(a,b){if(a!==undefined){return a;}else{return b!==undefined?b:0;}};var absolute=function absolute(element){var doc=element.dom.ownerDocument;var body=doc.body;var win=doc.defaultView;var html=doc.documentElement;if(body===element.dom){return SugarPosition(body.offsetLeft,body.offsetTop);}var scrollTop=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageYOffset,html.scrollTop);var scrollLeft=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageXOffset,html.scrollLeft);var clientTop=firstDefinedOrZero(html.clientTop,body.clientTop);var clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport(element).translate(scrollLeft-clientLeft,scrollTop-clientTop);};var viewport=function viewport(element){var dom=element.dom;var doc=dom.ownerDocument;var body=doc.body;if(body===dom){return SugarPosition(body.offsetLeft,body.offsetTop);}if(!inBody(element)){return SugarPosition(0,0);}return boxPosition(dom);};var get$5=function get$5(_DOC){var doc=_DOC!==undefined?_DOC.dom:document;var x=doc.body.scrollLeft||doc.documentElement.scrollLeft;var y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y);};var to=function to(x,y,_DOC){var doc=_DOC!==undefined?_DOC.dom:document;var win=doc.defaultView;if(win){win.scrollTo(x,y);}};var intoView=function intoView(element,alignToTop){var isSafari=detect$2().browser.isSafari();if(isSafari&&isFunction(element.dom.scrollIntoViewIfNeeded)){element.dom.scrollIntoViewIfNeeded(false);}else{element.dom.scrollIntoView(alignToTop);}};var get$4=function get$4(_win){var win=_win===undefined?window:_win;if(detect$2().browser.isFirefox()){return Optional.none();}else{return Optional.from(win.visualViewport);}};var bounds=function bounds(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height};};var getBounds=function getBounds(_win){var win=_win===undefined?window:_win;var doc=win.document;var scroll=get$5(SugarElement.fromDom(doc));return get$4(win).fold(function(){var html=win.document.documentElement;var width=html.clientWidth;var height=html.clientHeight;return bounds(scroll.left,scroll.top,width,height);},function(visualViewport){return bounds(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height);});};var isNodeType=function isNodeType(type){return function(node){return!!node&&node.nodeType===type;};};var isRestrictedNode=function isRestrictedNode(node){return!!node&&!Object.getPrototypeOf(node);};var isElement$6=isNodeType(1);var matchNodeNames=function matchNodeNames(names){var lowercasedNames=names.map(function(s){return s.toLowerCase();});return function(node){if(node&&node.nodeName){var nodeName=node.nodeName.toLowerCase();return contains$2(lowercasedNames,nodeName);}return false;};};var matchStyleValues=function matchStyleValues(name,values){var items=values.toLowerCase().split(' ');return function(node){if(isElement$6(node)){for(var i=0;i<items.length;i++){var computed=node.ownerDocument.defaultView.getComputedStyle(node,null);var cssValue=computed?computed.getPropertyValue(name):null;if(cssValue===items[i]){return true;}}}return false;};};var hasAttribute=function hasAttribute(attrName){return function(node){return isElement$6(node)&&node.hasAttribute(attrName);};};var hasAttributeValue=function hasAttributeValue(attrName,attrValue){return function(node){return isElement$6(node)&&node.getAttribute(attrName)===attrValue;};};var isBogus$2=function isBogus$2(node){return isElement$6(node)&&node.hasAttribute('data-mce-bogus');};var isBogusAll$1=function isBogusAll$1(node){return isElement$6(node)&&node.getAttribute('data-mce-bogus')==='all';};var isTable$3=function isTable$3(node){return isElement$6(node)&&node.tagName==='TABLE';};var hasContentEditableState=function hasContentEditableState(value){return function(node){if(isElement$6(node)){if(node.contentEditable===value){return true;}if(node.getAttribute('data-mce-contenteditable')===value){return true;}}return false;};};var isTextareaOrInput=matchNodeNames(['textarea','input']);var isText$9=isNodeType(3);var isCData=isNodeType(4);var isPi=isNodeType(7);var isComment=isNodeType(8);var isDocument$1=isNodeType(9);var isDocumentFragment=isNodeType(11);var isBr$6=matchNodeNames(['br']);var isImg=matchNodeNames(['img']);var isContentEditableTrue$5=hasContentEditableState('true');var isContentEditableFalse$b=hasContentEditableState('false');var isTableCell$5=matchNodeNames(['td','th']);var isMedia$2=matchNodeNames(['video','audio','object','embed']);var browser=detect$2().browser;var firstElement=function firstElement(nodes){return find$2(nodes,isElement$7);};var getTableCaptionDeltaY=function getTableCaptionDeltaY(elm){if(browser.isFirefox()&&name(elm)==='table'){return firstElement(children(elm)).filter(function(elm){return name(elm)==='caption';}).bind(function(caption){return firstElement(nextSiblings(caption)).map(function(body){var bodyTop=body.dom.offsetTop;var captionTop=caption.dom.offsetTop;var captionHeight=caption.dom.offsetHeight;return bodyTop<=captionTop?-captionHeight:0;});}).getOr(0);}else{return 0;}};var hasChild=function hasChild(elm,child){return elm.children&&contains$2(elm.children,child);};var getPos=function getPos(body,elm,rootElm){var x=0,y=0;var doc=body.ownerDocument;rootElm=rootElm?rootElm:body;if(elm){if(rootElm===body&&elm.getBoundingClientRect&&get$7(SugarElement.fromDom(body),'position')==='static'){var pos=elm.getBoundingClientRect();x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-doc.documentElement.clientLeft;y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-doc.documentElement.clientTop;return{x:x,y:y};}var offsetParent=elm;while(offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm)){var castOffsetParent=offsetParent;x+=castOffsetParent.offsetLeft||0;y+=castOffsetParent.offsetTop||0;offsetParent=castOffsetParent.offsetParent;}offsetParent=elm.parentNode;while(offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm)){x-=offsetParent.scrollLeft||0;y-=offsetParent.scrollTop||0;offsetParent=offsetParent.parentNode;}y+=getTableCaptionDeltaY(SugarElement.fromDom(elm));}return{x:x,y:y};};var ClosestOrAncestor=function ClosestOrAncestor(is,ancestor,scope,a,isRoot){if(is(scope,a)){return Optional.some(scope);}else if(isFunction(isRoot)&&isRoot(scope)){return Optional.none();}else{return ancestor(scope,a,isRoot);}};var ancestor$3=function ancestor$3(scope,predicate,isRoot){var element=scope.dom;var stop=isFunction(isRoot)?isRoot:never;while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el)){return Optional.some(el);}else if(stop(el)){break;}}return Optional.none();};var closest$4=function closest$4(scope,predicate,isRoot){var is=function is(s,test){return test(s);};return ClosestOrAncestor(is,ancestor$3,scope,predicate,isRoot);};var sibling$1=function sibling$1(scope,predicate){var element=scope.dom;if(!element.parentNode){return Optional.none();}return child(SugarElement.fromDom(element.parentNode),function(x){return!eq(scope,x)&&predicate(x);});};var child=function child(scope,predicate){var pred=function pred(node){return predicate(SugarElement.fromDom(node));};var result=find$2(scope.dom.childNodes,pred);return result.map(SugarElement.fromDom);};var descendant$1=function descendant$1(scope,predicate){var descend=function descend(node){for(var i=0;i<node.childNodes.length;i++){var _child=SugarElement.fromDom(node.childNodes[i]);if(predicate(_child)){return Optional.some(_child);}var res=descend(node.childNodes[i]);if(res.isSome()){return res;}}return Optional.none();};return descend(scope.dom);};var ancestor$2=function ancestor$2(scope,selector,isRoot){return ancestor$3(scope,function(e){return is$1(e,selector);},isRoot);};var descendant=function descendant(scope,selector){return one(selector,scope);};var closest$3=function closest$3(scope,selector,isRoot){var is=function is(element,selector){return is$1(element,selector);};return ClosestOrAncestor(is,ancestor$2,scope,selector,isRoot);};var StyleSheetLoader=function StyleSheetLoader(documentOrShadowRoot){var settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var idCount=0;var loadedStates={};var edos=SugarElement.fromDom(documentOrShadowRoot);var doc=documentOrOwner(edos);var maxLoadTime=settings.maxLoadTime||5000;var _setReferrerPolicy=function _setReferrerPolicy(referrerPolicy){settings.referrerPolicy=referrerPolicy;};var addStyle=function addStyle(element){append$1(getStyleContainer(edos),element);};var removeStyle=function removeStyle(id){var styleContainer=getStyleContainer(edos);descendant(styleContainer,'#'+id).each(remove$6);};var getOrCreateState=function getOrCreateState(url){return get$a(loadedStates,url).getOrThunk(function(){return{id:'mce-u'+idCount++,passed:[],failed:[],count:0};});};var load=function load(url){return new Promise(function(success,failure){var link;var urlWithSuffix=Tools._addCacheSuffix(url);var state=getOrCreateState(urlWithSuffix);loadedStates[urlWithSuffix]=state;state.count++;var resolve=function resolve(callbacks,status){each$f(callbacks,call);state.status=status;state.passed=[];state.failed=[];if(link){link.onload=null;link.onerror=null;link=null;}};var passed=function passed(){return resolve(state.passed,2);};var failed=function failed(){return resolve(state.failed,3);};var wait=function wait(testCallback,waitCallback){if(!testCallback()){if(Date.now()-startTime<maxLoadTime){setTimeout(waitCallback);}else{failed();}}};var waitForWebKitLinkLoaded=function waitForWebKitLinkLoaded(){wait(function(){var styleSheets=documentOrShadowRoot.styleSheets;var i=styleSheets.length;while(i--){var styleSheet=styleSheets[i];var _owner=styleSheet.ownerNode;if(_owner&&_owner.id===link.id){passed();return true;}}return false;},waitForWebKitLinkLoaded);};if(success){state.passed.push(success);}if(failure){state.failed.push(failure);}if(state.status===1){return;}if(state.status===2){passed();return;}if(state.status===3){failed();return;}state.status=1;var linkElem=SugarElement.fromTag('link',doc.dom);setAll$1(linkElem,{rel:'stylesheet',type:'text/css',id:state.id});var startTime=Date.now();if(settings.contentCssCors){set$2(linkElem,'crossOrigin','anonymous');}if(settings.referrerPolicy){set$2(linkElem,'referrerpolicy',settings.referrerPolicy);}link=linkElem.dom;link.onload=waitForWebKitLinkLoaded;link.onerror=failed;addStyle(linkElem);set$2(linkElem,'href',urlWithSuffix);});};var loadAll=function loadAll(urls){var loadedUrls=Promise.allSettled(map$3(urls,function(url){return load(url).then(constant(url));}));return loadedUrls.then(function(results){var parts=partition$2(results,function(r){return r.status==='fulfilled';});if(parts.fail.length>0){return Promise.reject(map$3(parts.fail,function(result){return result.reason;}));}else{return map$3(parts.pass,function(result){return result.value;});}});};var unload=function unload(url){var urlWithSuffix=Tools._addCacheSuffix(url);get$a(loadedStates,urlWithSuffix).each(function(state){var count=--state.count;if(count===0){delete loadedStates[urlWithSuffix];removeStyle(state.id);}});};var unloadAll=function unloadAll(urls){each$f(urls,function(url){unload(url);});};return{load:load,loadAll:loadAll,unload:unload,unloadAll:unloadAll,_setReferrerPolicy:_setReferrerPolicy};};var create$d=function create$d(){var map=new WeakMap();var forElement=function forElement(referenceElement,settings){var root=getRootNode(referenceElement);var rootDom=root.dom;return Optional.from(map.get(rootDom)).getOrThunk(function(){var sl=StyleSheetLoader(rootDom,settings);map.set(rootDom,sl);return sl;});};return{forElement:forElement};};var instance=create$d();var DomTreeWalker=/*#__PURE__*/function(){function DomTreeWalker(startNode,rootNode){_classCallCheck(this,DomTreeWalker);this.node=startNode;this.rootNode=rootNode;this.current=this.current.bind(this);this.next=this.next.bind(this);this.prev=this.prev.bind(this);this.prev2=this.prev2.bind(this);}_createClass(DomTreeWalker,[{key:"current",value:function current(){return this.node;}},{key:"next",value:function next(shallow){this.node=this.findSibling(this.node,'firstChild','nextSibling',shallow);return this.node;}},{key:"prev",value:function prev(shallow){this.node=this.findSibling(this.node,'lastChild','previousSibling',shallow);return this.node;}},{key:"prev2",value:function prev2(shallow){this.node=this.findPreviousNode(this.node,shallow);return this.node;}},{key:"findSibling",value:function findSibling(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName]){return node[startName];}if(node!==this.rootNode){sibling=node[siblingName];if(sibling){return sibling;}for(parent=node.parentNode;parent&&parent!==this.rootNode;parent=parent.parentNode){sibling=parent[siblingName];if(sibling){return sibling;}}}}}},{key:"findPreviousNode",value:function findPreviousNode(node,shallow){var sibling,parent,child;if(node){sibling=node.previousSibling;if(this.rootNode&&sibling===this.rootNode){return;}if(sibling){if(!shallow){for(child=sibling.lastChild;child;child=child.lastChild){if(!child.lastChild){return child;}}}return sibling;}parent=node.parentNode;if(parent&&parent!==this.rootNode){return parent;}}}}]);return DomTreeWalker;}();var blocks=['article','aside','details','div','dt','figcaption','footer','form','fieldset','header','hgroup','html','main','nav','section','summary','body','p','dl','multicol','dd','figure','address','center','blockquote','h1','h2','h3','h4','h5','h6','listing','xmp','pre','plaintext','menu','dir','ul','ol','li','hr','table','tbody','thead','tfoot','th','tr','td','caption'];var tableCells=['td','th'];var tableSections=['thead','tbody','tfoot'];var textBlocks=['h1','h2','h3','h4','h5','h6','p','div','address','pre','form','blockquote','center','dir','fieldset','header','footer','article','section','hgroup','aside','nav','figure'];var headings=['h1','h2','h3','h4','h5','h6'];var listItems$1=['li','dd','dt'];var lists=['ul','ol','dl'];var wsElements=['pre','script','textarea','style'];var wrapBlockElements=['pre'].concat(headings);var lazyLookup=function lazyLookup(items){var lookup;return function(node){lookup=lookup?lookup:mapToObject(items,always);return has$2(lookup,name(node));};};var isBlock$2=lazyLookup(blocks);var isTable$2=function isTable$2(node){return name(node)==='table';};var isInline$1=function isInline$1(node){return isElement$7(node)&&!isBlock$2(node);};var isBr$5=function isBr$5(node){return isElement$7(node)&&name(node)==='br';};var isTextBlock$2=lazyLookup(textBlocks);var isList=lazyLookup(lists);var isListItem=lazyLookup(listItems$1);var isTableSection=lazyLookup(tableSections);var isTableCell$4=lazyLookup(tableCells);var isWsPreserveElement=lazyLookup(wsElements);var isWrapBlockElement=lazyLookup(wrapBlockElements);var isWrapElement=function isWrapElement(node){return isWrapBlockElement(node)||isInline$1(node);};var ancestor$1=function ancestor$1(scope,selector,isRoot){return ancestor$2(scope,selector,isRoot).isSome();};var zeroWidth="\uFEFF";var nbsp='\xA0';var isZwsp$1=function isZwsp$1(_char){return _char===zeroWidth;};var removeZwsp=function removeZwsp(s){return s.replace(/\uFEFF/g,'');};var descendants$1=function descendants$1(scope,predicate){var result=[];each$f(children(scope),function(x){if(predicate(x)){result=result.concat([x]);}result=result.concat(descendants$1(x,predicate));});return result;};var descendants=function descendants(scope,selector){return all(selector,scope);};var NodeValue=function NodeValue(is,name){var get=function get(element){if(!is(element)){throw new Error('Can only get '+name+' value of a '+name+' node');}return getOption(element).getOr('');};var getOption=function getOption(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none();};var set=function set(element,value){if(!is(element)){throw new Error('Can only set raw '+name+' value of a '+name+' node');}element.dom.nodeValue=value;};return{get:get,getOption:getOption,set:set};};var api$1=NodeValue(isText$a,'text');var get$3=function get$3(element){return api$1.get(element);};var getOption=function getOption(element){return api$1.getOption(element);};var getLastChildren$1=function getLastChildren$1(elm){var children=[];var rawNode=elm.dom;while(rawNode){children.push(SugarElement.fromDom(rawNode));rawNode=rawNode.lastChild;}return children;};var removeTrailingBr=function removeTrailingBr(elm){var allBrs=descendants(elm,'br');var brs=filter$6(getLastChildren$1(elm).slice(-1),isBr$5);if(allBrs.length===brs.length){each$f(brs,remove$6);}};var createPaddingBr=function createPaddingBr(){var br=SugarElement.fromTag('br');set$2(br,'data-mce-bogus','1');return br;};var fillWithPaddingBr=function fillWithPaddingBr(elm){empty(elm);append$1(elm,createPaddingBr());};var trimBlockTrailingBr=function trimBlockTrailingBr(elm){lastChild(elm).each(function(lastChild){prevSibling(lastChild).each(function(lastChildPrevSibling){if(isBlock$2(elm)&&isBr$5(lastChild)&&isBlock$2(lastChildPrevSibling)){remove$6(lastChild);}});});};var ZWSP$1=zeroWidth;var isZwsp=isZwsp$1;var trim$1=removeZwsp;var isElement$5=isElement$6;var isText$8=isText$9;var isCaretContainerBlock$1=function isCaretContainerBlock$1(node){if(isText$8(node)){node=node.parentNode;}return isElement$5(node)&&node.hasAttribute('data-mce-caret');};var isCaretContainerInline=function isCaretContainerInline(node){return isText$8(node)&&isZwsp(node.data);};var isCaretContainer$2=function isCaretContainer$2(node){return isCaretContainerBlock$1(node)||isCaretContainerInline(node);};var hasContent=function hasContent(node){return node.firstChild!==node.lastChild||!isBr$6(node.firstChild);};var insertInline$1=function insertInline$1(node,before){var doc=node.ownerDocument;var textNode=doc.createTextNode(ZWSP$1);var parentNode=node.parentNode;if(!before){var _sibling=node.nextSibling;if(isText$8(_sibling)){if(isCaretContainer$2(_sibling)){return _sibling;}if(startsWithCaretContainer$1(_sibling)){_sibling.splitText(1);return _sibling;}}if(node.nextSibling){parentNode.insertBefore(textNode,node.nextSibling);}else{parentNode.appendChild(textNode);}}else{var _sibling2=node.previousSibling;if(isText$8(_sibling2)){if(isCaretContainer$2(_sibling2)){return _sibling2;}if(endsWithCaretContainer$1(_sibling2)){return _sibling2.splitText(_sibling2.data.length-1);}}parentNode.insertBefore(textNode,node);}return textNode;};var isBeforeInline=function isBeforeInline(pos){var container=pos.container();if(!isText$9(container)){return false;}return container.data.charAt(pos.offset())===ZWSP$1||pos.isAtStart()&&isCaretContainerInline(container.previousSibling);};var isAfterInline=function isAfterInline(pos){var container=pos.container();if(!isText$9(container)){return false;}return container.data.charAt(pos.offset()-1)===ZWSP$1||pos.isAtEnd()&&isCaretContainerInline(container.nextSibling);};var insertBlock=function insertBlock(blockName,node,before){var doc=node.ownerDocument;var blockNode=doc.createElement(blockName);blockNode.setAttribute('data-mce-caret',before?'before':'after');blockNode.setAttribute('data-mce-bogus','all');blockNode.appendChild(createPaddingBr().dom);var parentNode=node.parentNode;if(!before){if(node.nextSibling){parentNode.insertBefore(blockNode,node.nextSibling);}else{parentNode.appendChild(blockNode);}}else{parentNode.insertBefore(blockNode,node);}return blockNode;};var startsWithCaretContainer$1=function startsWithCaretContainer$1(node){return isText$8(node)&&node.data[0]===ZWSP$1;};var endsWithCaretContainer$1=function endsWithCaretContainer$1(node){return isText$8(node)&&node.data[node.data.length-1]===ZWSP$1;};var trimBogusBr=function trimBogusBr(elm){var brs=elm.getElementsByTagName('br');var lastBr=brs[brs.length-1];if(isBogus$2(lastBr)){lastBr.parentNode.removeChild(lastBr);}};var showCaretContainerBlock=function showCaretContainerBlock(caretContainer){if(caretContainer&&caretContainer.hasAttribute('data-mce-caret')){trimBogusBr(caretContainer);caretContainer.removeAttribute('data-mce-caret');caretContainer.removeAttribute('data-mce-bogus');caretContainer.removeAttribute('style');caretContainer.removeAttribute('data-mce-style');caretContainer.removeAttribute('_moz_abspos');return caretContainer;}return null;};var isRangeInCaretContainerBlock=function isRangeInCaretContainerBlock(range){return isCaretContainerBlock$1(range.startContainer);};var isContentEditableTrue$4=isContentEditableTrue$5;var isContentEditableFalse$a=isContentEditableFalse$b;var isBr$4=isBr$6;var isText$7=isText$9;var isInvalidTextElement=matchNodeNames(['script','style','textarea']);var isAtomicInline=matchNodeNames(['img','input','textarea','hr','iframe','video','audio','object','embed']);var isTable$1=matchNodeNames(['table']);var isCaretContainer$1=isCaretContainer$2;var isCaretCandidate$3=function isCaretCandidate$3(node){if(isCaretContainer$1(node)){return false;}if(isText$7(node)){return!isInvalidTextElement(node.parentNode);}return isAtomicInline(node)||isBr$4(node)||isTable$1(node)||isNonUiContentEditableFalse(node);};var isUnselectable=function isUnselectable(node){return isElement$6(node)&&node.getAttribute('unselectable')==='true';};var isNonUiContentEditableFalse=function isNonUiContentEditableFalse(node){return isUnselectable(node)===false&&isContentEditableFalse$a(node);};var isInEditable=function isInEditable(node,root){for(node=node.parentNode;node&&node!==root;node=node.parentNode){if(isNonUiContentEditableFalse(node)){return false;}if(isContentEditableTrue$4(node)){return true;}}return true;};var isAtomicContentEditableFalse=function isAtomicContentEditableFalse(node){if(!isNonUiContentEditableFalse(node)){return false;}return foldl(from(node.getElementsByTagName('*')),function(result,elm){return result||isContentEditableTrue$4(elm);},false)!==true;};var isAtomic$1=function isAtomic$1(node){return isAtomicInline(node)||isAtomicContentEditableFalse(node);};var isEditableCaretCandidate$1=function isEditableCaretCandidate$1(node,root){return isCaretCandidate$3(node)&&isInEditable(node,root);};var whiteSpaceRegExp=/^[ \t\r\n]*$/;var isWhitespaceText=function isWhitespaceText(text){return whiteSpaceRegExp.test(text);};var isCollapsibleWhitespace$1=function isCollapsibleWhitespace$1(c){return' \f\t\x0B'.indexOf(c)!==-1;};var isNewLineChar=function isNewLineChar(c){return c==='\n'||c==='\r';};var isNewline=function isNewline(text,idx){return idx<text.length&&idx>=0?isNewLineChar(text[idx]):false;};var normalize$4=function normalize$4(text){var tabSpaces=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var isStartOfContent=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var isEndOfContent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var tabSpace=repeat(' ',tabSpaces);var normalizedText=text.replace(/\t/g,tabSpace);var result=foldl(normalizedText,function(acc,c){if(isCollapsibleWhitespace$1(c)||c===nbsp){if(acc.pcIsSpace||acc.str===''&&isStartOfContent||acc.str.length===normalizedText.length-1&&isEndOfContent||isNewline(normalizedText,acc.str.length+1)){return{pcIsSpace:false,str:acc.str+nbsp};}else{return{pcIsSpace:true,str:acc.str+' '};}}else{return{pcIsSpace:isNewLineChar(c),str:acc.str+c};}},{pcIsSpace:false,str:''});return result.str;};var hasWhitespacePreserveParent=function hasWhitespacePreserveParent(node,rootNode){var rootElement=SugarElement.fromDom(rootNode);var startNode=SugarElement.fromDom(node);return ancestor$1(startNode,'pre,code',curry(eq,rootElement));};var isWhitespace$1=function isWhitespace$1(node,rootNode){return isText$9(node)&&isWhitespaceText(node.data)&&hasWhitespacePreserveParent(node,rootNode)===false;};var isNamedAnchor=function isNamedAnchor(node){return isElement$6(node)&&node.nodeName==='A'&&!node.hasAttribute('href')&&(node.hasAttribute('name')||node.hasAttribute('id'));};var isContent$1=function isContent$1(node,rootNode){return isCaretCandidate$3(node)&&isWhitespace$1(node,rootNode)===false||isNamedAnchor(node)||isBookmark(node);};var isBookmark=hasAttribute('data-mce-bookmark');var isBogus$1=hasAttribute('data-mce-bogus');var isBogusAll=hasAttributeValue('data-mce-bogus','all');var isEmptyNode=function isEmptyNode(targetNode,skipBogus){var brCount=0;if(isContent$1(targetNode,targetNode)){return false;}else{var node=targetNode.firstChild;if(!node){return true;}var walker=new DomTreeWalker(node,targetNode);do{if(skipBogus){if(isBogusAll(node)){node=walker.next(true);continue;}if(isBogus$1(node)){node=walker.next();continue;}}if(isBr$6(node)){brCount++;node=walker.next();continue;}if(isContent$1(node,targetNode)){return false;}node=walker.next();}while(node);return brCount<=1;}};var isEmpty$2=function isEmpty$2(elm){var skipBogus=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return isEmptyNode(elm.dom,skipBogus);};var isSpan=function isSpan(node){return node.nodeName.toLowerCase()==='span';};var isInlineContent=function isInlineContent(node,root){return isNonNullable(node)&&(isContent$1(node,root)||isInline$1(SugarElement.fromDom(node)));};var surroundedByInlineContent=function surroundedByInlineContent(node,root){var prev=new DomTreeWalker(node,root).prev(false);var next=new DomTreeWalker(node,root).next(false);var prevIsInline=isUndefined(prev)||isInlineContent(prev,root);var nextIsInline=isUndefined(next)||isInlineContent(next,root);return prevIsInline&&nextIsInline;};var isBookmarkNode$2=function isBookmarkNode$2(node){return isSpan(node)&&node.getAttribute('data-mce-type')==='bookmark';};var isKeepTextNode=function isKeepTextNode(node,root){return isText$9(node)&&node.data.length>0&&surroundedByInlineContent(node,root);};var isKeepElement=function isKeepElement(node){return isElement$6(node)?node.childNodes.length>0:false;};var isDocument=function isDocument(node){return isDocumentFragment(node)||isDocument$1(node);};var trimNode=function trimNode(dom,node,root){var rootNode=root||node;if(isElement$6(node)&&isBookmarkNode$2(node)){return node;}var children=node.childNodes;for(var i=children.length-1;i>=0;i--){trimNode(dom,children[i],rootNode);}if(isElement$6(node)){var currentChildren=node.childNodes;if(currentChildren.length===1&&isBookmarkNode$2(currentChildren[0])){node.parentNode.insertBefore(currentChildren[0],node);}}if(!isDocument(node)&&!isContent$1(node,rootNode)&&!isKeepElement(node)&&!isKeepTextNode(node,rootNode)){dom.remove(node);}return node;};var makeMap$3=Tools.makeMap;var attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g;var textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g;var rawCharsRegExp=/[<>&\"\']/g;var entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi;var asciiMap={128:"\u20AC",130:"\u201A",131:"\u0192",132:"\u201E",133:"\u2026",134:"\u2020",135:"\u2021",136:"\u02C6",137:"\u2030",138:"\u0160",139:"\u2039",140:"\u0152",142:"\u017D",145:"\u2018",146:"\u2019",147:"\u201C",148:"\u201D",149:"\u2022",150:"\u2013",151:"\u2014",152:"\u02DC",153:"\u2122",154:"\u0161",155:"\u203A",156:"\u0153",158:"\u017E",159:"\u0178"};var baseEntities={'"':'&quot;','\'':'&#39;','<':'&lt;','>':'&gt;','&':'&amp;','`':'&#96;'};var reverseEntities={'&lt;':'<','&gt;':'>','&amp;':'&','&quot;':'"','&apos;':"'"};var nativeDecode=function nativeDecode(text){var elm=SugarElement.fromTag('div').dom;elm.innerHTML=text;return elm.textContent||elm.innerText||text;};var buildEntitiesLookup=function buildEntitiesLookup(items,radix){var i,chr,entity;var lookup={};if(items){items=items.split(',');radix=radix||10;for(i=0;i<items.length;i+=2){chr=String.fromCharCode(parseInt(items[i],radix));if(!baseEntities[chr]){entity='&'+items[i+1]+';';lookup[chr]=entity;lookup[entity]=chr;}}return lookup;}};var namedEntities=buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,'+'5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,'+'5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,'+'5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,'+'68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,'+'6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,'+'6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,'+'75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,'+'7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,'+'7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,'+'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,'+'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,'+'t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,'+'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,'+'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,'+'81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,'+'8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,'+'8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,'+'8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,'+'8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,'+'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,'+'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,'+'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,'+'80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,'+'811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro',32);var encodeRaw=function encodeRaw(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||chr;});};var encodeAllRaw=function encodeAllRaw(text){return(''+text).replace(rawCharsRegExp,function(chr){return baseEntities[chr]||chr;});};var encodeNumeric=function encodeNumeric(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){if(chr.length>1){return'&#'+((chr.charCodeAt(0)-55296)*1024+(chr.charCodeAt(1)-56320)+65536)+';';}return baseEntities[chr]||'&#'+chr.charCodeAt(0)+';';});};var encodeNamed=function encodeNamed(text,attr,entities){entities=entities||namedEntities;return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||chr;});};var getEncodeFunc=function getEncodeFunc(name,entities){var entitiesMap=buildEntitiesLookup(entities)||namedEntities;var encodeNamedAndNumeric=function encodeNamedAndNumeric(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){if(baseEntities[chr]!==undefined){return baseEntities[chr];}if(entitiesMap[chr]!==undefined){return entitiesMap[chr];}if(chr.length>1){return'&#'+((chr.charCodeAt(0)-55296)*1024+(chr.charCodeAt(1)-56320)+65536)+';';}return'&#'+chr.charCodeAt(0)+';';});};var encodeCustomNamed=function encodeCustomNamed(text,attr){return encodeNamed(text,attr,entitiesMap);};var nameMap=makeMap$3(name.replace(/\+/g,','));if(nameMap.named&&nameMap.numeric){return encodeNamedAndNumeric;}if(nameMap.named){if(entities){return encodeCustomNamed;}return encodeNamed;}if(nameMap.numeric){return encodeNumeric;}return encodeRaw;};var decode=function decode(text){return text.replace(entityRegExp,function(all,numeric){if(numeric){if(numeric.charAt(0).toLowerCase()==='x'){numeric=parseInt(numeric.substr(1),16);}else{numeric=parseInt(numeric,10);}if(numeric>65535){numeric-=65536;return String.fromCharCode(55296+(numeric>>10),56320+(numeric&1023));}return asciiMap[numeric]||String.fromCharCode(numeric);}return reverseEntities[all]||namedEntities[all]||nativeDecode(all);});};var Entities={encodeRaw:encodeRaw,encodeAllRaw:encodeAllRaw,encodeNumeric:encodeNumeric,encodeNamed:encodeNamed,getEncodeFunc:getEncodeFunc,decode:decode};var mapCache={},dummyObj={};var makeMap$2=Tools.makeMap,each$c=Tools.each,extend$2=Tools.extend,explode$2=Tools.explode,inArray=Tools.inArray;var split$1=function split$1(items,delim){items=Tools.trim(items);return items?items.split(delim||' '):[];};var createMap=function createMap(defaultValue,extendWith){var value=makeMap$2(defaultValue,' ',makeMap$2(defaultValue.toUpperCase(),' '));return extend$2(value,extendWith);};var getTextRootBlockElements=function getTextRootBlockElements(schema){return createMap('td th li dt dd figcaption caption details summary',schema.getTextBlockElements());};var compileSchema=function compileSchema(type){var schema={};var globalAttributes,blockContent;var phrasingContent,flowContent,html4BlockContent,html4PhrasingContent;var add=function add(name){var attributes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var childNames=split$1(children);var names=split$1(name);var ni=names.length;while(ni--){var attributesOrder=split$1([globalAttributes,attributes].join(' '));schema[names[ni]]={attributes:mapToObject(attributesOrder,function(){return{};}),attributesOrder:attributesOrder,children:mapToObject(childNames,constant(dummyObj))};}};var addAttrs=function addAttrs(name,attributes){var names=split$1(name);var attrs=split$1(attributes);var ni=names.length;while(ni--){var schemaItem=schema[names[ni]];for(var i=0,l=attrs.length;i<l;i++){schemaItem.attributes[attrs[i]]={};schemaItem.attributesOrder.push(attrs[i]);}}};if(mapCache[type]){return mapCache[type];}globalAttributes='id accesskey class dir lang style tabindex title role';blockContent='address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';phrasingContent='a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd '+'label map noscript object q s samp script select small span strong sub sup '+'textarea u var #text #comment';if(type!=='html4'){globalAttributes+=' contenteditable contextmenu draggable dropzone '+'hidden spellcheck translate';blockContent+=' article aside details dialog figure main header footer hgroup section nav';phrasingContent+=' audio canvas command datalist mark meter output picture '+'progress time wbr video ruby bdi keygen';}if(type!=='html5-strict'){globalAttributes+=' xml:lang';html4PhrasingContent='acronym applet basefont big font strike tt';phrasingContent=[phrasingContent,html4PhrasingContent].join(' ');each$c(split$1(html4PhrasingContent),function(name){add(name,'',phrasingContent);});html4BlockContent='center dir isindex noframes';blockContent=[blockContent,html4BlockContent].join(' ');flowContent=[blockContent,phrasingContent].join(' ');each$c(split$1(html4BlockContent),function(name){add(name,'',flowContent);});}flowContent=flowContent||[blockContent,phrasingContent].join(' ');add('html','manifest','head body');add('head','','base command link meta noscript script style title');add('title hr noscript br');add('base','href target');add('link','href rel media hreflang type sizes hreflang');add('meta','name http-equiv content charset');add('style','media type scoped');add('script','src async defer type charset');add('body','onafterprint onbeforeprint onbeforeunload onblur onerror onfocus '+'onhashchange onload onmessage onoffline ononline onpagehide onpageshow '+'onpopstate onresize onscroll onstorage onunload',flowContent);add('address dt dd div caption','',flowContent);add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn','',phrasingContent);add('blockquote','cite',flowContent);add('ol','reversed start type','li');add('ul','','li');add('li','value',flowContent);add('dl','','dt dd');add('a','href target rel media hreflang type',phrasingContent);add('q','cite',phrasingContent);add('ins del','cite datetime',flowContent);add('img','src sizes srcset alt usemap ismap width height');add('iframe','src name width height',flowContent);add('embed','src type width height');add('object','data type typemustmatch name usemap form width height',[flowContent,'param'].join(' '));add('param','name value');add('map','name',[flowContent,'area'].join(' '));add('area','alt coords shape href target rel media hreflang type');add('table','border','caption colgroup thead tfoot tbody tr'+(type==='html4'?' col':''));add('colgroup','span','col');add('col','span');add('tbody thead tfoot','','tr');add('tr','','td th');add('td','colspan rowspan headers',flowContent);add('th','colspan rowspan headers scope abbr',flowContent);add('form','accept-charset action autocomplete enctype method name novalidate target',flowContent);add('fieldset','disabled form name',[flowContent,'legend'].join(' '));add('label','form for',phrasingContent);add('input','accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate '+'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');add('button','disabled form formaction formenctype formmethod formnovalidate formtarget name type value',type==='html4'?flowContent:phrasingContent);add('select','disabled form multiple name required size','option optgroup');add('optgroup','disabled label','option');add('option','disabled label selected value');add('textarea','cols dirname disabled form maxlength name readonly required rows wrap');add('menu','type label',[flowContent,'li'].join(' '));add('noscript','',flowContent);if(type!=='html4'){add('wbr');add('ruby','',[phrasingContent,'rt rp'].join(' '));add('figcaption','',flowContent);add('mark rt rp summary bdi','',phrasingContent);add('canvas','width height',flowContent);add('video','src crossorigin poster preload autoplay mediagroup loop '+'muted controls width height buffered',[flowContent,'track source'].join(' '));add('audio','src crossorigin preload autoplay mediagroup loop muted controls '+'buffered volume',[flowContent,'track source'].join(' '));add('picture','','img source');add('source','src srcset type media sizes');add('track','kind src srclang label default');add('datalist','',[phrasingContent,'option'].join(' '));add('article section nav aside main header footer','',flowContent);add('hgroup','','h1 h2 h3 h4 h5 h6');add('figure','',[flowContent,'figcaption'].join(' '));add('time','datetime',phrasingContent);add('dialog','open',flowContent);add('command','type label icon disabled checked radiogroup command');add('output','for form name',phrasingContent);add('progress','value max',phrasingContent);add('meter','value min max low high optimum',phrasingContent);add('details','open',[flowContent,'summary'].join(' '));add('keygen','autofocus challenge disabled form keytype name');}if(type!=='html5-strict'){addAttrs('script','language xml:space');addAttrs('style','xml:space');addAttrs('object','declare classid code codebase codetype archive standby align border hspace vspace');addAttrs('embed','align name hspace vspace');addAttrs('param','valuetype type');addAttrs('a','charset name rev shape coords');addAttrs('br','clear');addAttrs('applet','codebase archive code object alt name width height align hspace vspace');addAttrs('img','name longdesc align border hspace vspace');addAttrs('iframe','longdesc frameborder marginwidth marginheight scrolling align');addAttrs('font basefont','size color face');addAttrs('input','usemap align');addAttrs('select');addAttrs('textarea');addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption','align');addAttrs('ul','type compact');addAttrs('li','type');addAttrs('ol dl menu dir','compact');addAttrs('pre','width xml:space');addAttrs('hr','align noshade size width');addAttrs('isindex','prompt');addAttrs('table','summary width frame rules cellspacing cellpadding align bgcolor');addAttrs('col','width align char charoff valign');addAttrs('colgroup','width align char charoff valign');addAttrs('thead','align char charoff valign');addAttrs('tr','align char charoff valign bgcolor');addAttrs('th','axis align char charoff valign nowrap bgcolor width height');addAttrs('form','accept');addAttrs('td','abbr axis scope align char charoff valign nowrap bgcolor width height');addAttrs('tfoot','align char charoff valign');addAttrs('tbody','align char charoff valign');addAttrs('area','nohref');addAttrs('body','background bgcolor text link vlink alink');}if(type!=='html4'){addAttrs('input button select textarea','autofocus');addAttrs('input textarea','placeholder');addAttrs('a','download');addAttrs('link script img','crossorigin');addAttrs('img','loading');addAttrs('iframe','sandbox seamless allowfullscreen loading');}if(type!=='html4'){each$f([schema.video,schema.audio],function(item){delete item.children.audio;delete item.children.video;});}each$c(split$1('a form meter progress dfn'),function(name){if(schema[name]){delete schema[name].children[name];}});delete schema.caption.children.table;delete schema.script;mapCache[type]=schema;return schema;};var compileElementMap=function compileElementMap(value,mode){var styles;if(value){styles={};if(typeof value==='string'){value={'*':value};}each$c(value,function(value,key){styles[key]=styles[key.toUpperCase()]=mode==='map'?makeMap$2(value,/[, ]/):explode$2(value,/[, ]/);});}return styles;};var Schema=function Schema(settings){var _a;var elements={};var children={};var patternElements=[];var customElementsMap={},specialElements={};var createLookupTable=function createLookupTable(option,defaultValue,extendWith){var value=settings[option];if(!value){value=mapCache[option];if(!value){value=createMap(defaultValue,extendWith);mapCache[option]=value;}}else{value=makeMap$2(value,/[, ]/,makeMap$2(value.toUpperCase(),/[, ]/));}return value;};settings=settings||{};var schemaType=(_a=settings.schema)!==null&&_a!==void 0?_a:'html5';var schemaItems=compileSchema(schemaType);if(settings.verify_html===false){settings.valid_elements='*[*]';}var validStyles=compileElementMap(settings.valid_styles);var invalidStyles=compileElementMap(settings.invalid_styles,'map');var validClasses=compileElementMap(settings.valid_classes,'map');var whitespaceElementsMap=createLookupTable('whitespace_elements','pre script noscript style textarea video audio iframe object code');var selfClosingElementsMap=createLookupTable('self_closing_elements','colgroup dd dt li option p td tfoot th thead tr');var voidElementsMap=createLookupTable('void_elements','area base basefont br col frame hr img input isindex link '+'meta param embed source wbr track');var boolAttrMap=createLookupTable('boolean_attributes','checked compact declare defer disabled ismap multiple nohref noresize '+'noshade nowrap readonly selected autoplay loop controls allowfullscreen');var nonEmptyOrMoveCaretBeforeOnEnter='td th iframe video audio object script code';var nonEmptyElementsMap=createLookupTable('non_empty_elements',nonEmptyOrMoveCaretBeforeOnEnter+' pre',voidElementsMap);var moveCaretBeforeOnEnterElementsMap=createLookupTable('move_caret_before_on_enter_elements',nonEmptyOrMoveCaretBeforeOnEnter+' table',voidElementsMap);var textBlockElementsMap=createLookupTable('text_block_elements','h1 h2 h3 h4 h5 h6 p div address pre form '+'blockquote center dir fieldset header footer article section hgroup aside main nav figure');var blockElementsMap=createLookupTable('block_elements','hr table tbody thead tfoot '+'th tr td li ol ul caption dl dt dd noscript menu isindex option '+'datalist select optgroup figcaption details summary',textBlockElementsMap);var textInlineElementsMap=createLookupTable('text_inline_elements','span strong b em i font s strike u var cite '+'dfn code mark q sup sub samp');each$c('script noscript iframe noframes noembed title style textarea xmp plaintext'.split(' '),function(name){specialElements[name]=new RegExp('</'+name+'[^>]*>','gi');});var patternToRegExp=function patternToRegExp(str){return new RegExp('^'+str.replace(/([?+*])/g,'.$1')+'$');};var addValidElements=function addValidElements(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,value;var elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)])?$/,attrRuleRegExp=/^([!\-])?(\w+[\\:]:\w+|[^=~<]+)?(?:([=~<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements){var validElementsArr=split$1(validElements,',');if(elements['@']){globalAttributes=elements['@'].attributes;globalAttributesOrder=elements['@'].attributesOrder;}for(ei=0,el=validElementsArr.length;ei<el;ei++){matches=elementRuleRegExp.exec(validElementsArr[ei]);if(matches){prefix=matches[1];elementName=matches[2];outputName=matches[3];attrData=matches[5];attributes={};attributesOrder=[];element={attributes:attributes,attributesOrder:attributesOrder};if(prefix==='#'){element.paddEmpty=true;}if(prefix==='-'){element.removeEmpty=true;}if(matches[4]==='!'){element.removeEmptyAttrs=true;}if(globalAttributes){each$e(globalAttributes,function(value,key){attributes[key]=value;});attributesOrder.push.apply(attributesOrder,globalAttributesOrder);}if(attrData){attrData=split$1(attrData,'|');for(ai=0,al=attrData.length;ai<al;ai++){matches=attrRuleRegExp.exec(attrData[ai]);if(matches){attr={};attrType=matches[1];attrName=matches[2].replace(/[\\:]:/g,':');prefix=matches[3];value=matches[4];if(attrType==='!'){element.attributesRequired=element.attributesRequired||[];element.attributesRequired.push(attrName);attr.required=true;}if(attrType==='-'){delete attributes[attrName];attributesOrder.splice(inArray(attributesOrder,attrName),1);continue;}if(prefix){if(prefix==='='){element.attributesDefault=element.attributesDefault||[];element.attributesDefault.push({name:attrName,value:value});attr.defaultValue=value;}if(prefix==='~'){element.attributesForced=element.attributesForced||[];element.attributesForced.push({name:attrName,value:value});attr.forcedValue=value;}if(prefix==='<'){attr.validValues=makeMap$2(value,'?');}}if(hasPatternsRegExp.test(attrName)){element.attributePatterns=element.attributePatterns||[];attr.pattern=patternToRegExp(attrName);element.attributePatterns.push(attr);}else{if(!attributes[attrName]){attributesOrder.push(attrName);}attributes[attrName]=attr;}}}}if(!globalAttributes&&elementName==='@'){globalAttributes=attributes;globalAttributesOrder=attributesOrder;}if(outputName){element.outputName=elementName;elements[outputName]=element;}if(hasPatternsRegExp.test(elementName)){element.pattern=patternToRegExp(elementName);patternElements.push(element);}else{elements[elementName]=element;}}}}};var setValidElements=function setValidElements(validElements){patternElements=[];each$f(keys(elements),function(name){delete elements[name];});addValidElements(validElements);each$c(schemaItems,function(element,name){children[name]=element.children;});};var addCustomElements=function addCustomElements(customElements){var customElementRegExp=/^(~)?(.+)$/;if(customElements){mapCache.text_block_elements=mapCache.block_elements=null;each$c(split$1(customElements,','),function(rule){var matches=customElementRegExp.exec(rule),inline=matches[1]==='~',cloneName=inline?'span':'div',name=matches[2];children[name]=children[cloneName];customElementsMap[name]=cloneName;nonEmptyElementsMap[name.toUpperCase()]={};nonEmptyElementsMap[name]={};if(!inline){blockElementsMap[name.toUpperCase()]={};blockElementsMap[name]={};}if(!elements[name]){var customRule=elements[cloneName];customRule=extend$2({},customRule);delete customRule.removeEmptyAttrs;delete customRule.removeEmpty;elements[name]=customRule;}each$c(children,function(element,elmName){if(element[cloneName]){children[elmName]=element=extend$2({},children[elmName]);element[name]=element[cloneName];}});});}};var addValidChildren=function addValidChildren(validChildren){var childRuleRegExp=/^([+\-]?)([A-Za-z0-9_\-.\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]+)\[([^\]]+)]$/;mapCache[schemaType]=null;if(validChildren){each$c(split$1(validChildren,','),function(rule){var matches=childRuleRegExp.exec(rule);var parent,prefix;if(matches){prefix=matches[1];if(prefix){parent=children[matches[2]];}else{parent=children[matches[2]]={'#comment':{}};}parent=children[matches[2]];each$c(split$1(matches[3],'|'),function(child){if(prefix==='-'){delete parent[child];}else{parent[child]={};}});}});}};var getElementRule=function getElementRule(name){var element=elements[name],i;if(element){return element;}i=patternElements.length;while(i--){element=patternElements[i];if(element.pattern.test(name)){return element;}}};if(!settings.valid_elements){each$c(schemaItems,function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder};children[name]=element.children;});each$c(split$1('strong/b em/i'),function(item){var items=split$1(item,'/');elements[items[1]].outputName=items[0];});each$c(textInlineElementsMap,function(_val,name){if(elements[name]){if(settings.padd_empty_block_inline_children){elements[name].paddInEmptyBlock=true;}elements[name].removeEmpty=true;}});each$c(split$1('ol ul blockquote a table tbody'),function(name){if(elements[name]){elements[name].removeEmpty=true;}});each$c(split$1('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'),function(name){elements[name].paddEmpty=true;});each$c(split$1('span'),function(name){elements[name].removeEmptyAttrs=true;});}else{setValidElements(settings.valid_elements);}addCustomElements(settings.custom_elements);addValidChildren(settings.valid_children);addValidElements(settings.extended_valid_elements);addValidChildren('+ol[ul|ol],+ul[ul|ol]');each$c({dd:'dl',dt:'dl',li:'ul ol',td:'tr',th:'tr',tr:'tbody thead tfoot',tbody:'table',thead:'table',tfoot:'table',legend:'fieldset',area:'map',param:'video audio object'},function(parents,item){if(elements[item]){elements[item].parentsRequired=split$1(parents);}});if(settings.invalid_elements){each$c(explode$2(settings.invalid_elements),function(item){if(elements[item]){delete elements[item];}});}if(!getElementRule('span')){addValidElements('span[!data-mce-type|*]');}var getValidStyles=constant(validStyles);var getInvalidStyles=constant(invalidStyles);var getValidClasses=constant(validClasses);var getBoolAttrs=constant(boolAttrMap);var getBlockElements=constant(blockElementsMap);var getTextBlockElements=constant(textBlockElementsMap);var getTextInlineElements=constant(textInlineElementsMap);var getVoidElements=constant(Object.seal(voidElementsMap));var getSelfClosingElements=constant(selfClosingElementsMap);var getNonEmptyElements=constant(nonEmptyElementsMap);var getMoveCaretBeforeOnEnterElements=constant(moveCaretBeforeOnEnterElementsMap);var getWhitespaceElements=constant(whitespaceElementsMap);var getSpecialElements=constant(Object.seal(specialElements));var isValidChild=function isValidChild(name,child){var parent=children[name.toLowerCase()];return!!(parent&&parent[child.toLowerCase()]);};var isValid=function isValid(name,attr){var attrPatterns,i;var rule=getElementRule(name);if(rule){if(attr){if(rule.attributes[attr]){return true;}attrPatterns=rule.attributePatterns;if(attrPatterns){i=attrPatterns.length;while(i--){if(attrPatterns[i].pattern.test(attr)){return true;}}}}else{return true;}}return false;};var getCustomElements=constant(customElementsMap);return{type:schemaType,children:children,elements:elements,getValidStyles:getValidStyles,getValidClasses:getValidClasses,getBlockElements:getBlockElements,getInvalidStyles:getInvalidStyles,getVoidElements:getVoidElements,getTextBlockElements:getTextBlockElements,getTextInlineElements:getTextInlineElements,getBoolAttrs:getBoolAttrs,getElementRule:getElementRule,getSelfClosingElements:getSelfClosingElements,getNonEmptyElements:getNonEmptyElements,getMoveCaretBeforeOnEnterElements:getMoveCaretBeforeOnEnterElements,getWhitespaceElements:getWhitespaceElements,getSpecialElements:getSpecialElements,isValidChild:isValidChild,isValid:isValid,getCustomElements:getCustomElements,addValidElements:addValidElements,setValidElements:setValidElements,addCustomElements:addCustomElements,addValidChildren:addValidChildren};};var Styles=function Styles(settings,schema){var urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi;var styleRegExp=/\s*([^:]+):\s*([^;]+);?/g;var trimRightRegExp=/\s+$/;var i;var encodingLookup={};var validStyles;var invalidStyles;var invisibleChar=zeroWidth;settings=settings||{};if(schema){validStyles=schema.getValidStyles();invalidStyles=schema.getInvalidStyles();}var encodingItems=("\\\" \\' \\; \\: ; : "+invisibleChar).split(' ');for(i=0;i<encodingItems.length;i++){encodingLookup[encodingItems[i]]=invisibleChar+i;encodingLookup[invisibleChar+i]=encodingItems[i];}var self={parse:function parse(css){var styles={};var matches,name,value,isEncoded;var urlConverter=settings.url_converter;var urlConverterScope=settings.url_converter_scope||self;var compress=function compress(prefix,suffix,noJoin){var top=styles[prefix+'-top'+suffix];if(!top){return;}var right=styles[prefix+'-right'+suffix];if(!right){return;}var bottom=styles[prefix+'-bottom'+suffix];if(!bottom){return;}var left=styles[prefix+'-left'+suffix];if(!left){return;}var box=[top,right,bottom,left];i=box.length-1;while(i--){if(box[i]!==box[i+1]){break;}}if(i>-1&&noJoin){return;}styles[prefix+suffix]=i===-1?box[0]:box.join(' ');delete styles[prefix+'-top'+suffix];delete styles[prefix+'-right'+suffix];delete styles[prefix+'-bottom'+suffix];delete styles[prefix+'-left'+suffix];};var canCompress=function canCompress(key){var value=styles[key],i;if(!value){return;}value=value.split(' ');i=value.length;while(i--){if(value[i]!==value[0]){return false;}}styles[key]=value[0];return true;};var compress2=function compress2(target,a,b,c){if(!canCompress(a)){return;}if(!canCompress(b)){return;}if(!canCompress(c)){return;}styles[target]=styles[a]+' '+styles[b]+' '+styles[c];delete styles[a];delete styles[b];delete styles[c];};var encode=function encode(str){isEncoded=true;return encodingLookup[str];};var decode=function decode(str,keepSlashes){if(isEncoded){str=str.replace(/\uFEFF[0-9]/g,function(str){return encodingLookup[str];});}if(!keepSlashes){str=str.replace(/\\([\'\";:])/g,'$1');}return str;};var decodeSingleHexSequence=function decodeSingleHexSequence(escSeq){return String.fromCharCode(parseInt(escSeq.slice(1),16));};var decodeHexSequences=function decodeHexSequences(value){return value.replace(/\\[0-9a-f]+/gi,decodeSingleHexSequence);};var processUrl=function processUrl(match,url,url2,url3,str,str2){str=str||str2;if(str){str=decode(str);return"'"+str.replace(/\'/g,"\\'")+"'";}url=decode(url||url2||url3);if(!settings.allow_script_urls){var scriptUrl=url.replace(/[\s\r\n]+/g,'');if(/(java|vb)script:/i.test(scriptUrl)){return'';}if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(scriptUrl)){return'';}}if(urlConverter){url=urlConverter.call(urlConverterScope,url,'style');}return"url('"+url.replace(/\'/g,"\\'")+"')";};if(css){css=css.replace(/[\u0000-\u001F]/g,'');css=css.replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(str){return str.replace(/[;:]/g,encode);});while(matches=styleRegExp.exec(css)){styleRegExp.lastIndex=matches.index+matches[0].length;name=matches[1].replace(trimRightRegExp,'').toLowerCase();value=matches[2].replace(trimRightRegExp,'');if(name&&value){name=decodeHexSequences(name);value=decodeHexSequences(value);if(name.indexOf(invisibleChar)!==-1||name.indexOf('"')!==-1){continue;}if(!settings.allow_script_urls&&(name==='behavior'||/expression\s*\(|\/\*|\*\//.test(value))){continue;}if(name==='font-weight'&&value==='700'){value='bold';}else if(name==='color'||name==='background-color'){value=value.toLowerCase();}value=value.replace(urlOrStrRegExp,processUrl);styles[name]=isEncoded?decode(value,true):value;}}compress('border','',true);compress('border','-width');compress('border','-color');compress('border','-style');compress('padding','');compress('margin','');compress2('border','border-width','border-style','border-color');if(styles.border==='medium none'){delete styles.border;}if(styles['border-image']==='none'){delete styles['border-image'];}}return styles;},serialize:function serialize(styles,elementName){var css='';var serializeStyles=function serializeStyles(name){var value;var styleList=validStyles[name];if(styleList){for(var _i=0,l=styleList.length;_i<l;_i++){name=styleList[_i];value=styles[name];if(value){css+=(css.length>0?' ':'')+name+': '+value+';';}}}};var isValid=function isValid(name,elementName){var styleMap=invalidStyles['*'];if(styleMap&&styleMap[name]){return false;}styleMap=invalidStyles[elementName];return!(styleMap&&styleMap[name]);};if(elementName&&validStyles){serializeStyles('*');serializeStyles(elementName);}else{each$e(styles,function(value,name){if(value&&(!invalidStyles||isValid(name,elementName))){css+=(css.length>0?' ':'')+name+': '+value+';';}});}return css;}};return self;};var deprecated={keyLocation:true,layerX:true,layerY:true,returnValue:true,webkitMovementX:true,webkitMovementY:true,keyIdentifier:true,mozPressure:true};var isNativeEvent=function isNativeEvent(event){return event instanceof Event||isFunction(event.initEvent);};var hasIsDefaultPrevented=function hasIsDefaultPrevented(event){return event.isDefaultPrevented===always||event.isDefaultPrevented===never;};var needsNormalizing=function needsNormalizing(event){return isNullable(event.preventDefault)||isNativeEvent(event);};var clone$3=function clone$3(originalEvent,data){var event=data!==null&&data!==void 0?data:{};for(var _name2 in originalEvent){if(!has$2(deprecated,_name2)){event[_name2]=originalEvent[_name2];}}if(isNonNullable(event.composedPath)){event.composedPath=function(){return originalEvent.composedPath();};}return event;};var normalize$3=function normalize$3(type,originalEvent,fallbackTarget,data){var _a;var event=clone$3(originalEvent,data);event.type=type;if(isNullable(event.target)){event.target=(_a=event.srcElement)!==null&&_a!==void 0?_a:fallbackTarget;}if(needsNormalizing(originalEvent)){event.preventDefault=function(){event.defaultPrevented=true;event.isDefaultPrevented=always;if(isFunction(originalEvent.preventDefault)){originalEvent.preventDefault();}};event.stopPropagation=function(){event.cancelBubble=true;event.isPropagationStopped=always;if(isFunction(originalEvent.stopPropagation)){originalEvent.stopPropagation();}};event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=always;event.stopPropagation();};if(!hasIsDefaultPrevented(event)){event.isDefaultPrevented=event.defaultPrevented===true?always:never;event.isPropagationStopped=event.cancelBubble===true?always:never;event.isImmediatePropagationStopped=never;}}return event;};var eventExpandoPrefix='mce-data-';var mouseEventRe=/^(?:mouse|contextmenu)|click/;var addEvent=function addEvent(target,name,callback,capture){if(target.addEventListener){target.addEventListener(name,callback,capture||false);}else if(target.attachEvent){target.attachEvent('on'+name,callback);}};var removeEvent=function removeEvent(target,name,callback,capture){if(target.removeEventListener){target.removeEventListener(name,callback,capture||false);}else if(target.detachEvent){target.detachEvent('on'+name,callback);}};var isMouseEvent=function isMouseEvent(event){return isNonNullable(event)&&mouseEventRe.test(event.type);};var fix=function fix(originalEvent,data){var event=normalize$3(originalEvent.type,originalEvent,document,data);if(isMouseEvent(originalEvent)&&isUndefined(originalEvent.pageX)&&!isUndefined(originalEvent.clientX)){var eventDoc=event.target.ownerDocument||document;var doc=eventDoc.documentElement;var body=eventDoc.body;var mouseEvent=event;mouseEvent.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);mouseEvent.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}return event;};var bindOnReady=function bindOnReady(win,callback,eventUtils){var doc=win.document,event={type:'ready'};if(eventUtils.domLoaded){callback(event);return;}var isDocReady=function isDocReady(){return doc.readyState==='complete'||doc.readyState==='interactive'&&doc.body;};var readyHandler=function readyHandler(){removeEvent(win,'DOMContentLoaded',readyHandler);removeEvent(win,'load',readyHandler);if(!eventUtils.domLoaded){eventUtils.domLoaded=true;callback(event);}win=null;};if(isDocReady()){readyHandler();}else{addEvent(win,'DOMContentLoaded',readyHandler);}if(!eventUtils.domLoaded){addEvent(win,'load',readyHandler);}};var EventUtils=/*#__PURE__*/function(){function EventUtils(){_classCallCheck(this,EventUtils);this.domLoaded=false;this.events={};this.count=1;this.expando=eventExpandoPrefix+(+new Date()).toString(32);this.hasMouseEnterLeave='onmouseenter'in document.documentElement;this.hasFocusIn='onfocusin'in document.documentElement;this.count=1;}_createClass(EventUtils,[{key:"bind",value:function bind(target,names,callback,scope){var self=this;var id,callbackList,i,name,fakeName,nativeHandler,capture;var win=window;var defaultNativeHandler=function defaultNativeHandler(evt){self.executeHandlers(fix(evt||win.event),id);};if(!target||target.nodeType===3||target.nodeType===8){return;}if(!target[self.expando]){id=self.count++;target[self.expando]=id;self.events[id]={};}else{id=target[self.expando];}scope=scope||target;var namesList=names.split(' ');i=namesList.length;while(i--){name=namesList[i];nativeHandler=defaultNativeHandler;fakeName=capture=false;if(name==='DOMContentLoaded'){name='ready';}if(self.domLoaded&&name==='ready'&&target.readyState==='complete'){callback.call(scope,fix({type:name}));continue;}if(!self.hasMouseEnterLeave){fakeName=self.mouseEnterLeave[name];if(fakeName){nativeHandler=function nativeHandler(evt){var current=evt.currentTarget;var related=evt.relatedTarget;if(related&&current.contains){related=current.contains(related);}else{while(related&&related!==current){related=related.parentNode;}}if(!related){evt=fix(evt||win.event);evt.type=evt.type==='mouseout'?'mouseleave':'mouseenter';evt.target=current;self.executeHandlers(evt,id);}};}}if(!self.hasFocusIn&&(name==='focusin'||name==='focusout')){capture=true;fakeName=name==='focusin'?'focus':'blur';nativeHandler=function nativeHandler(evt){evt=fix(evt||win.event);evt.type=evt.type==='focus'?'focusin':'focusout';self.executeHandlers(evt,id);};}callbackList=self.events[id][name];if(!callbackList){self.events[id][name]=callbackList=[{func:callback,scope:scope}];callbackList.fakeName=fakeName;callbackList.capture=capture;callbackList.nativeHandler=nativeHandler;if(name==='ready'){bindOnReady(target,nativeHandler,self);}else{addEvent(target,fakeName||name,nativeHandler,capture);}}else{if(name==='ready'&&self.domLoaded){callback(fix({type:name}));}else{callbackList.push({func:callback,scope:scope});}}}target=callbackList=null;return callback;}},{key:"unbind",value:function unbind(target,names,callback){var callbackList,i,ci,name,eventMap;if(!target||target.nodeType===3||target.nodeType===8){return this;}var id=target[this.expando];if(id){eventMap=this.events[id];if(names){var namesList=names.split(' ');i=namesList.length;while(i--){name=namesList[i];callbackList=eventMap[name];if(callbackList){if(callback){ci=callbackList.length;while(ci--){if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler;var fakeName=callbackList.fakeName,capture=callbackList.capture;callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1));callbackList.nativeHandler=nativeHandler;callbackList.fakeName=fakeName;callbackList.capture=capture;eventMap[name]=callbackList;}}}if(!callback||callbackList.length===0){delete eventMap[name];removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture);}}}}else{each$e(eventMap,function(callbackList,name){removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture);});eventMap={};}for(name in eventMap){if(has$2(eventMap,name)){return this;}}delete this.events[id];try{delete target[this.expando];}catch(ex){target[this.expando]=null;}}return this;}},{key:"fire",value:function fire(target,name,args){return this.dispatch(target,name,args);}},{key:"dispatch",value:function dispatch(target,name,args){var id;if(!target||target.nodeType===3||target.nodeType===8){return this;}var event=fix({type:name,target:target},args);do{id=target[this.expando];if(id){this.executeHandlers(event,id);}target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow;}while(target&&!event.isPropagationStopped());return this;}},{key:"clean",value:function clean(target){var i,children;if(!target||target.nodeType===3||target.nodeType===8){return this;}if(target[this.expando]){this.unbind(target);}if(!target.getElementsByTagName){target=target.document;}if(target&&target.getElementsByTagName){this.unbind(target);children=target.getElementsByTagName('*');i=children.length;while(i--){target=children[i];if(target[this.expando]){this.unbind(target);}}}return this;}},{key:"destroy",value:function destroy(){this.events={};}},{key:"cancel",value:function cancel(e){if(e){e.preventDefault();e.stopImmediatePropagation();}return false;}},{key:"executeHandlers",value:function executeHandlers(evt,id){var container=this.events[id];var callbackList=container&&container[evt.type];if(callbackList){for(var i=0,l=callbackList.length;i<l;i++){var callback=callbackList[i];if(callback&&callback.func.call(callback.scope,evt)===false){evt.preventDefault();}if(evt.isImmediatePropagationStopped()){return;}}}}}]);return EventUtils;}();EventUtils.Event=new EventUtils();var each$b=Tools.each;var grep=Tools.grep;var internalStyleName='data-mce-style';var legacySetAttribute=function legacySetAttribute(elm,name,value){if(isNullable(value)||value===''){remove$b(elm,name);}else{set$2(elm,name,value);}};var setupAttrHooks=function setupAttrHooks(styles,settings,getContext){var keepValues=settings.keep_values;var keepUrlHook={set:function set(elm,value,name){var sugarElm=SugarElement.fromDom(elm);if(isFunction(settings.url_converter)&&isNonNullable(value)){value=settings.url_converter.call(settings.url_converter_scope||getContext(),value,name,elm[0]);}var internalName='data-mce-'+name;legacySetAttribute(sugarElm,internalName,value);legacySetAttribute(sugarElm,name,value);},get:function get(elm,name){var sugarElm=SugarElement.fromDom(elm);return get$9(sugarElm,'data-mce-'+name)||get$9(sugarElm,name);}};var attrHooks={style:{set:function set(elm,value){var sugarElm=SugarElement.fromDom(elm);if(isObject(value)){setAll(sugarElm,value);return;}if(keepValues){legacySetAttribute(sugarElm,internalStyleName,value);}remove$b(sugarElm,'style');if(isString(value)){setAll(sugarElm,styles.parse(value));}},get:function get(elm){var sugarElm=SugarElement.fromDom(elm);var value=get$9(sugarElm,internalStyleName)||get$9(sugarElm,'style');return styles.serialize(styles.parse(value),name(sugarElm));}}};if(keepValues){attrHooks.href=attrHooks.src=keepUrlHook;}return attrHooks;};var updateInternalStyleAttr=function updateInternalStyleAttr(styles,elm){var rawValue=get$9(elm,'style');var value=styles.serialize(styles.parse(rawValue),name(elm));legacySetAttribute(elm,internalStyleName,value);};var findNodeIndex=function findNodeIndex(node,normalized){var idx=0,lastNodeType,nodeType;if(node){for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling){nodeType=node.nodeType;if(normalized&&nodeType===3){if(nodeType===lastNodeType||!node.nodeValue.length){continue;}}idx++;lastNodeType=nodeType;}}return idx;};var numericalCssMap=Tools.makeMap('fill-opacity font-weight line-height opacity orphans widows z-index zoom',' ');var camelCaseToHyphens=function camelCaseToHyphens(name){return name.replace(/[A-Z]/g,function(v){return'-'+v.toLowerCase();});};var DOMUtils=function DOMUtils(doc){var settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var addedStyles={};var win=window;var files={};var counter=0;var stdMode=true;var boxModel=true;var styleSheetLoader=instance.forElement(SugarElement.fromDom(doc),{contentCssCors:settings.contentCssCors,referrerPolicy:settings.referrerPolicy});var boundEvents=[];var schema=settings.schema?settings.schema:Schema({});var styles=Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema);var events=settings.ownEvents?new EventUtils():EventUtils.Event;var blockElementsMap=schema.getBlockElements();var isBlock=function isBlock(node){if(isString(node)){return has$2(blockElementsMap,node);}else{return isElement$6(node)&&has$2(blockElementsMap,node.nodeName);}};var get=function get(elm){return elm&&doc&&isString(elm)?doc.getElementById(elm):elm;};var _get=function _get(elm){var value=get(elm);return isNonNullable(value)?SugarElement.fromDom(value):null;};var getAttrib=function getAttrib(elm,name,defaultVal){var value;var $elm=_get(elm);if(isNonNullable($elm)&&isElement$7($elm)){var hook=attrHooks[name];if(hook&&hook.get){value=hook.get($elm.dom,name);}else{value=get$9($elm,name);}}return isNonNullable(value)?value:defaultVal!==null&&defaultVal!==void 0?defaultVal:'';};var getAttribs=function getAttribs(elm){var node=get(elm);return isNullable(node)?[]:node.attributes;};var setAttrib=function setAttrib(elm,name,value){run(elm,function(e){if(isElement$6(e)){var $elm=SugarElement.fromDom(e);if(value===''){value=null;}var originalValue=get$9($elm,name);var hook=attrHooks[name];if(hook&&hook.set){hook.set($elm.dom,value,name);}else{legacySetAttribute($elm,name,value);}if(originalValue!==value&&settings.onSetAttrib){settings.onSetAttrib({attrElm:$elm,attrName:name,attrValue:value});}}});};var clone=function clone(node,deep){return node.cloneNode(deep);};var getRoot=function getRoot(){return settings.root_element||doc.body;};var getViewPort=function getViewPort(argWin){var vp=getBounds(argWin);return{x:vp.x,y:vp.y,w:vp.width,h:vp.height};};var getPos$1=function getPos$1(elm,rootElm){return getPos(doc.body,get(elm),rootElm);};var setStyle=function setStyle(elm,name,value){var convertStyleToString=function convertStyleToString(cssValue,cssName){if(isString(cssValue)){return cssValue;}else if(isNumber(cssValue)){return has$2(numericalCssMap,cssName)?cssValue+'':cssValue+'px';}else{return map$2(cssValue,convertStyleToString);}};var applyStyle=function applyStyle($elm,cssName,cssValue){var normalizedName=camelCaseToHyphens(cssName);if(isNullable(cssValue)||cssValue===''){remove$7($elm,normalizedName);}else{set$1($elm,normalizedName,convertStyleToString(cssValue,normalizedName));}};run(elm,function(e){var $elm=SugarElement.fromDom(e);if(isString(name)){applyStyle($elm,name,value);}else{each$e(name,function(v,n){applyStyle($elm,n,v);});}if(settings.update_styles){updateInternalStyleAttr(styles,$elm);}});};var setStyles=function setStyles(elm,stylesArg){setStyle(elm,stylesArg);};var getStyle=function getStyle(elm,name,computed){var $elm=get(elm);if(isNullable($elm)||!isElement$6($elm)){return undefined;}if(computed){return get$7(SugarElement.fromDom($elm),camelCaseToHyphens(name));}else{name=name.replace(/-(\D)/g,function(a,b){return b.toUpperCase();});if(name==='float'){name='cssFloat';}return $elm.style?$elm.style[name]:undefined;}};var getSize=function getSize(elm){var w,h;var $elm=get(elm);w=getStyle($elm,'width');h=getStyle($elm,'height');if(w.indexOf('px')===-1){w=0;}if(h.indexOf('px')===-1){h=0;}return{w:parseInt(w,10)||$elm.offsetWidth||$elm.clientWidth,h:parseInt(h,10)||$elm.offsetHeight||$elm.clientHeight};};var getRect=function getRect(elm){var $elm=get(elm);var pos=getPos$1($elm);var size=getSize($elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h};};var is=function is(elm,selector){if(!elm){return false;}var elms=isArray$1(elm)?elm:[elm];return exists(elms,function(e){return is$1(SugarElement.fromDom(e),selector);});};var getParents=function getParents(elm,selector,root,collect){var result=[];var selectorVal;var node=get(elm);collect=collect===undefined;root=root||(getRoot().nodeName!=='BODY'?getRoot().parentNode:null);if(isString(selector)){selectorVal=selector;if(selector==='*'){selector=isElement$6;}else{selector=function selector(node){return is(node,selectorVal);};}}while(node){if(node===root||isNullable(node.nodeType)||isDocument$1(node)||isDocumentFragment(node)){break;}if(!selector||selector(node)){if(collect){result.push(node);}else{return[node];}}node=node.parentNode;}return collect?result:null;};var getParent=function getParent(node,selector,root){var parents=getParents(node,selector,root,false);return parents&&parents.length>0?parents[0]:null;};var _findSib=function _findSib(node,selector,name){var func=selector;if(node){if(isString(selector)){func=function func(node){return is(node,selector);};}for(node=node[name];node;node=node[name]){if(isFunction(func)&&func(node)){return node;}}}return null;};var getNext=function getNext(node,selector){return _findSib(node,selector,'nextSibling');};var getPrev=function getPrev(node,selector){return _findSib(node,selector,'previousSibling');};var select=function select(selector,scope){var _a,_b;var elm=(_b=(_a=get(scope))!==null&&_a!==void 0?_a:settings.root_element)!==null&&_b!==void 0?_b:doc;return from(elm.querySelectorAll(selector));};var run=function run(elm,func,scope){var context=scope!==null&&scope!==void 0?scope:this;var node=isString(elm)?get(elm):elm;if(!node){return false;}if(isArray$1(node)&&(node.length||node.length===0)){var result=[];each$b(node,function(elm,i){if(elm){result.push(func.call(context,isString(elm)?get(elm):elm,i));}});return result;}else{return func.call(context,node);}};var setAttribs=function setAttribs(elm,attrs){run(elm,function($elm){each$e(attrs,function(value,name){setAttrib($elm,name,value);});});};var setHTML=function setHTML(elm,html){run(elm,function(e){var $elm=SugarElement.fromDom(e);set($elm,html);});};var add=function add(parentElm,name,attrs,html,create){return run(parentElm,function(parentElm){var newElm=isString(name)?doc.createElement(name):name;if(isNonNullable(attrs)){setAttribs(newElm,attrs);}if(html){if(!isString(html)&&html.nodeType){newElm.appendChild(html);}else if(isString(html)){setHTML(newElm,html);}}return!create?parentElm.appendChild(newElm):newElm;});};var create=function create(name,attrs,html){return add(doc.createElement(name),name,attrs,html,true);};var decode=Entities.decode;var encode=Entities.encodeAllRaw;var createHTML=function createHTML(name,attrs){var html=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var outHtml='',key;outHtml+='<'+name;for(key in attrs){if(hasNonNullableKey(attrs,key)){outHtml+=' '+key+'="'+encode(attrs[key])+'"';}}if(isEmpty$3(html)&&has$2(schema.getVoidElements(),name)){return outHtml+' />';}else{return outHtml+'>'+html+'</'+name+'>';}};var createFragment=function createFragment(html){var node;var container=doc.createElement('div');var frag=doc.createDocumentFragment();frag.appendChild(container);if(html){container.innerHTML=html;}while(node=container.firstChild){frag.appendChild(node);}frag.removeChild(container);return frag;};var remove=function remove(node,keepChildren){return run(node,function(n){var $node=SugarElement.fromDom(n);if(keepChildren){each$f(children($node),function(child){if(isText$a(child)&&child.dom.length===0){remove$6(child);}else{before$3($node,child);}});}remove$6($node);return $node.dom;});};var removeAllAttribs=function removeAllAttribs(e){return run(e,function(e){var attrs=e.attributes;for(var i=attrs.length-1;i>=0;i--){e.removeAttributeNode(attrs.item(i));}});};var parseStyle=function parseStyle(cssText){return styles.parse(cssText);};var serializeStyle=function serializeStyle(stylesArg,name){return styles.serialize(stylesArg,name);};var addStyle=function addStyle(cssText){var head,styleElm;if(self!==DOMUtils.DOM&&doc===document){if(addedStyles[cssText]){return;}addedStyles[cssText]=true;}styleElm=doc.getElementById('mceDefaultStyles');if(!styleElm){styleElm=doc.createElement('style');styleElm.id='mceDefaultStyles';styleElm.type='text/css';head=doc.getElementsByTagName('head')[0];if(head.firstChild){head.insertBefore(styleElm,head.firstChild);}else{head.appendChild(styleElm);}}if(styleElm.styleSheet){styleElm.styleSheet.cssText+=cssText;}else{styleElm.appendChild(doc.createTextNode(cssText));}};var loadCSS=function loadCSS(urls){if(!urls){urls='';}each$f(urls.split(','),function(url){files[url]=true;styleSheetLoader.load(url)["catch"](noop);});};var toggleClass=function toggleClass(elm,cls,state){run(elm,function(e){if(isElement$6(e)){var $elm=SugarElement.fromDom(e);var classes=cls.split(' ');each$f(classes,function(c){if(isNonNullable(state)){var fn=state?add$2:remove$8;fn($elm,c);}else{toggle$1($elm,c);}});}});};var addClass=function addClass(elm,cls){toggleClass(elm,cls,true);};var removeClass=function removeClass(elm,cls){toggleClass(elm,cls,false);};var hasClass=function hasClass(elm,cls){var $elm=_get(elm);var classes=cls.split(' ');return forall(classes,function(c){return has($elm,c);});};var show=function show(elm){run(elm,function(e){return remove$7(SugarElement.fromDom(e),'display');});};var hide=function hide(elm){run(elm,function(e){return set$1(SugarElement.fromDom(e),'display','none');});};var isHidden=function isHidden(elm){var $elm=_get(elm);return is$2(getRaw$1($elm,'display'),'none');};var uniqueId=function uniqueId(prefix){return(!prefix?'mce_':prefix)+counter++;};var getOuterHTML=function getOuterHTML(elm){var $elm=_get(elm);return isElement$6($elm.dom)?$elm.dom.outerHTML:getOuter($elm);};var setOuterHTML=function setOuterHTML(elm,html){run(elm,function($elm){if(isElement$6($elm)){$elm.outerHTML=html;}});};var insertAfter=function insertAfter(node,reference){var referenceNode=get(reference);return run(node,function(node){var parent=referenceNode.parentNode;var nextSibling=referenceNode.nextSibling;if(nextSibling){parent.insertBefore(node,nextSibling);}else{parent.appendChild(node);}return node;});};var replace=function replace(newElm,oldElm,keepChildren){return run(oldElm,function(oldElm){if(isArray$1(oldElm)){newElm=newElm.cloneNode(true);}if(keepChildren){each$b(grep(oldElm.childNodes),function(node){newElm.appendChild(node);});}return oldElm.parentNode.replaceChild(newElm,oldElm);});};var rename=function rename(elm,name){var newElm;if(elm.nodeName!==name.toUpperCase()){newElm=create(name);each$b(getAttribs(elm),function(attrNode){setAttrib(newElm,attrNode.nodeName,getAttrib(elm,attrNode.nodeName));});replace(newElm,elm,true);}return newElm||elm;};var findCommonAncestor=function findCommonAncestor(a,b){var ps=a,pe;while(ps){pe=b;while(pe&&ps!==pe){pe=pe.parentNode;}if(ps===pe){break;}ps=ps.parentNode;}if(!ps&&a.ownerDocument){return a.ownerDocument.documentElement;}return ps;};var isNonEmptyElement=function isNonEmptyElement(node){if(isElement$6(node)){var _isNamedAnchor=node.nodeName.toLowerCase()==='a'&&!getAttrib(node,'href')&&getAttrib(node,'id');if(getAttrib(node,'name')||getAttrib(node,'data-mce-bookmark')||_isNamedAnchor){return true;}}return false;};var isEmpty=function isEmpty(node,elements){var type,name,brCount=0;if(isNonEmptyElement(node)){return false;}node=node.firstChild;if(node){var walker=new DomTreeWalker(node,node.parentNode);var whitespace=schema?schema.getWhitespaceElements():{};elements=elements||(schema?schema.getNonEmptyElements():null);do{type=node.nodeType;if(isElement$6(node)){var bogusVal=node.getAttribute('data-mce-bogus');if(bogusVal){node=walker.next(bogusVal==='all');continue;}name=node.nodeName.toLowerCase();if(elements&&elements[name]){if(name==='br'){brCount++;node=walker.next();continue;}return false;}if(isNonEmptyElement(node)){return false;}}if(type===8){return false;}if(type===3&&!isWhitespaceText(node.nodeValue)){return false;}if(type===3&&node.parentNode&&whitespace[node.parentNode.nodeName]&&isWhitespaceText(node.nodeValue)){return false;}node=walker.next();}while(node);}return brCount<=1;};var createRng=function createRng(){return doc.createRange();};var split=function split(parentElm,splitElm,replacementElm){var range=createRng();var beforeFragment;var afterFragment;var parentNode;if(parentElm&&splitElm){range.setStart(parentElm.parentNode,findNodeIndex(parentElm));range.setEnd(splitElm.parentNode,findNodeIndex(splitElm));beforeFragment=range.extractContents();range=createRng();range.setStart(splitElm.parentNode,findNodeIndex(splitElm)+1);range.setEnd(parentElm.parentNode,findNodeIndex(parentElm)+1);afterFragment=range.extractContents();parentNode=parentElm.parentNode;parentNode.insertBefore(trimNode(self,beforeFragment),parentElm);if(replacementElm){parentNode.insertBefore(replacementElm,parentElm);}else{parentNode.insertBefore(splitElm,parentElm);}parentNode.insertBefore(trimNode(self,afterFragment),parentElm);remove(parentElm);return replacementElm||splitElm;}};var bind=function bind(target,name,func,scope){if(isArray$1(target)){var i=target.length;var rv=[];while(i--){rv[i]=bind(target[i],name,func,scope);}return rv;}else{if(settings.collect&&(target===doc||target===win)){boundEvents.push([target,name,func,scope]);}return events.bind(target,name,func,scope||self);}};var unbind=function unbind(target,name,func){if(isArray$1(target)){var i=target.length;var rv=[];while(i--){rv[i]=unbind(target[i],name,func);}return rv;}else{if(boundEvents.length>0&&(target===doc||target===win)){var _i2=boundEvents.length;while(_i2--){var item=boundEvents[_i2];if(target===item[0]&&(!name||name===item[1])&&(!func||func===item[2])){events.unbind(item[0],item[1],item[2]);}}}return events.unbind(target,name,func);}};var dispatch=function dispatch(target,name,evt){return events.dispatch(target,name,evt);};var fire=function fire(target,name,evt){return events.dispatch(target,name,evt);};var getContentEditable=function getContentEditable(node){if(node&&isElement$6(node)){var contentEditable=node.getAttribute('data-mce-contenteditable');if(contentEditable&&contentEditable!=='inherit'){return contentEditable;}return node.contentEditable!=='inherit'?node.contentEditable:null;}else{return null;}};var getContentEditableParent=function getContentEditableParent(node){var root=getRoot();var state=null;for(;node&&node!==root;node=node.parentNode){state=getContentEditable(node);if(state!==null){break;}}return state;};var destroy=function destroy(){if(boundEvents.length>0){var i=boundEvents.length;while(i--){var item=boundEvents[i];events.unbind(item[0],item[1],item[2]);}}each$e(files,function(_,url){styleSheetLoader.unload(url);delete files[url];});};var isChildOf=function isChildOf(node,parent){return node===parent||parent.contains(node);};var dumpRng=function dumpRng(r){return'startContainer: '+r.startContainer.nodeName+', startOffset: '+r.startOffset+', endContainer: '+r.endContainer.nodeName+', endOffset: '+r.endOffset;};var self={doc:doc,settings:settings,win:win,files:files,stdMode:stdMode,boxModel:boxModel,styleSheetLoader:styleSheetLoader,boundEvents:boundEvents,styles:styles,schema:schema,events:events,isBlock:isBlock,root:null,clone:clone,getRoot:getRoot,getViewPort:getViewPort,getRect:getRect,getSize:getSize,getParent:getParent,getParents:getParents,get:get,getNext:getNext,getPrev:getPrev,select:select,is:is,add:add,create:create,createHTML:createHTML,createFragment:createFragment,remove:remove,setStyle:setStyle,getStyle:getStyle,setStyles:setStyles,removeAllAttribs:removeAllAttribs,setAttrib:setAttrib,setAttribs:setAttribs,getAttrib:getAttrib,getPos:getPos$1,parseStyle:parseStyle,serializeStyle:serializeStyle,addStyle:addStyle,loadCSS:loadCSS,addClass:addClass,removeClass:removeClass,hasClass:hasClass,toggleClass:toggleClass,show:show,hide:hide,isHidden:isHidden,uniqueId:uniqueId,setHTML:setHTML,getOuterHTML:getOuterHTML,setOuterHTML:setOuterHTML,decode:decode,encode:encode,insertAfter:insertAfter,replace:replace,rename:rename,findCommonAncestor:findCommonAncestor,run:run,getAttribs:getAttribs,isEmpty:isEmpty,createRng:createRng,nodeIndex:findNodeIndex,split:split,bind:bind,unbind:unbind,fire:fire,dispatch:dispatch,getContentEditable:getContentEditable,getContentEditableParent:getContentEditableParent,destroy:destroy,isChildOf:isChildOf,dumpRng:dumpRng};var attrHooks=setupAttrHooks(styles,settings,constant(self));return self;};DOMUtils.DOM=DOMUtils(document);DOMUtils.nodeIndex=findNodeIndex;var DOM$b=DOMUtils.DOM;var QUEUED=0;var LOADING=1;var LOADED=2;var FAILED=3;var ScriptLoader=/*#__PURE__*/function(){function ScriptLoader(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,ScriptLoader);this.states={};this.queue=[];this.scriptLoadedCallbacks={};this.queueLoadedCallbacks=[];this.loading=false;this.settings=settings;}_createClass(ScriptLoader,[{key:"_setReferrerPolicy",value:function _setReferrerPolicy(referrerPolicy){this.settings.referrerPolicy=referrerPolicy;}},{key:"loadScript",value:function loadScript(url){var _this=this;return new Promise(function(resolve,reject){var dom=DOM$b;var elm;var cleanup=function cleanup(){dom.remove(id);if(elm){elm.onerror=elm.onload=elm=null;}};var done=function done(){cleanup();resolve();};var error=function error(){cleanup();reject('Failed to load script: '+url);};var id=dom.uniqueId();elm=document.createElement('script');elm.id=id;elm.type='text/javascript';elm.src=Tools._addCacheSuffix(url);if(_this.settings.referrerPolicy){dom.setAttrib(elm,'referrerpolicy',_this.settings.referrerPolicy);}elm.onload=done;elm.onerror=error;(document.getElementsByTagName('head')[0]||document.body).appendChild(elm);});}},{key:"isDone",value:function isDone(url){return this.states[url]===LOADED;}},{key:"markDone",value:function markDone(url){this.states[url]=LOADED;}},{key:"add",value:function add(url){var self=this;self.queue.push(url);var state=self.states[url];if(state===undefined){self.states[url]=QUEUED;}return new Promise(function(resolve,reject){if(!self.scriptLoadedCallbacks[url]){self.scriptLoadedCallbacks[url]=[];}self.scriptLoadedCallbacks[url].push({resolve:resolve,reject:reject});});}},{key:"load",value:function load(url){return this.add(url);}},{key:"remove",value:function remove(url){delete this.states[url];delete this.scriptLoadedCallbacks[url];}},{key:"loadQueue",value:function loadQueue(){var queue=this.queue;this.queue=[];return this.loadScripts(queue);}},{key:"loadScripts",value:function loadScripts(scripts){var self=this;var execCallbacks=function execCallbacks(name,url){get$a(self.scriptLoadedCallbacks,url).each(function(callbacks){each$f(callbacks,function(callback){return callback[name](url);});});delete self.scriptLoadedCallbacks[url];};var processResults=function processResults(results){var failures=filter$6(results,function(result){return result.status==='rejected';});if(failures.length>0){return Promise.reject(bind$3(failures,function(_ref2){var reason=_ref2.reason;return isArray$1(reason)?reason:[reason];}));}else{return Promise.resolve();}};var load=function load(urls){return Promise.allSettled(map$3(urls,function(url){if(self.states[url]===LOADED){execCallbacks('resolve',url);return Promise.resolve();}else if(self.states[url]===FAILED){execCallbacks('reject',url);return Promise.reject(url);}else{self.states[url]=LOADING;return self.loadScript(url).then(function(){self.states[url]=LOADED;execCallbacks('resolve',url);var queue=self.queue;if(queue.length>0){self.queue=[];return load(queue).then(processResults);}},function(){self.states[url]=FAILED;execCallbacks('reject',url);return Promise.reject(url);});}}));};var processQueue=function processQueue(urls){self.loading=true;return load(urls).then(function(results){self.loading=false;var nextQueuedItem=self.queueLoadedCallbacks.shift();Optional.from(nextQueuedItem).each(call);return processResults(results);});};var uniqueScripts=stringArray(scripts);if(self.loading){return new Promise(function(resolve,reject){self.queueLoadedCallbacks.push(function(){return processQueue(uniqueScripts).then(resolve,reject);});});}else{return processQueue(uniqueScripts);}}}]);return ScriptLoader;}();ScriptLoader.ScriptLoader=new ScriptLoader();var Cell=function Cell(initial){var value=initial;var get=function get(){return value;};var set=function set(v){value=v;};return{get:get,set:set};};var isRaw=function isRaw(str){return isObject(str)&&has$2(str,'raw');};var isTokenised=function isTokenised(str){return isArray$1(str)&&str.length>1;};var data={};var currentCode=Cell('en');var getLanguageData=function getLanguageData(){return get$a(data,currentCode.get());};var getData$1=function getData$1(){return map$2(data,function(value){return _objectSpread({},value);});};var setCode=function setCode(newCode){if(newCode){currentCode.set(newCode);}};var getCode=function getCode(){return currentCode.get();};var add$1=function add$1(code,items){var langData=data[code];if(!langData){data[code]=langData={};}each$e(items,function(translation,name){langData[name.toLowerCase()]=translation;});};var translate=function translate(text){var langData=getLanguageData().getOr({});var toString=function toString(obj){if(isFunction(obj)){return Object.prototype.toString.call(obj);}return!isEmpty(obj)?''+obj:'';};var isEmpty=function isEmpty(text){return text===''||text===null||text===undefined;};var getLangData=function getLangData(text){var textstr=toString(text);return get$a(langData,textstr.toLowerCase()).map(toString).getOr(textstr);};var removeContext=function removeContext(str){return str.replace(/{context:\w+}$/,'');};if(isEmpty(text)){return'';}if(isRaw(text)){return toString(text.raw);}if(isTokenised(text)){var _values=text.slice(1);var substitued=getLangData(text[0]).replace(/\{([0-9]+)\}/g,function($1,$2){return has$2(_values,$2)?toString(_values[$2]):$1;});return removeContext(substitued);}return removeContext(getLangData(text));};var isRtl$1=function isRtl$1(){return getLanguageData().bind(function(items){return get$a(items,'_dir');}).exists(function(dir){return dir==='rtl';});};var hasCode=function hasCode(code){return has$2(data,code);};var I18n={getData:getData$1,setCode:setCode,getCode:getCode,add:add$1,translate:translate,isRtl:isRtl$1,hasCode:hasCode};var AddOnManager=function AddOnManager(){var items=[];var urls={};var lookup={};var _listeners=[];var runListeners=function runListeners(name,state){var matchedListeners=filter$6(_listeners,function(listener){return listener.name===name&&listener.state===state;});each$f(matchedListeners,function(listener){return listener.resolve();});};var isLoaded=function isLoaded(name){return has$2(urls,name);};var isAdded=function isAdded(name){return has$2(lookup,name);};var get=function get(name){if(lookup[name]){return lookup[name].instance;}return undefined;};var loadLanguagePack=function loadLanguagePack(name,languages){var language=I18n.getCode();var wrappedLanguages=','+(languages||'')+',';if(!language||languages&&wrappedLanguages.indexOf(','+language+',')===-1){return;}ScriptLoader.ScriptLoader.add(urls[name]+'/langs/'+language+'.js');};var requireLangPack=function requireLangPack(name,languages){if(AddOnManager.languageLoad!==false){if(isLoaded(name)){loadLanguagePack(name,languages);}else{waitFor(name,'loaded').then(function(){return loadLanguagePack(name,languages);});}}};var add=function add(id,addOn){items.push(addOn);lookup[id]={instance:addOn};runListeners(id,'added');return addOn;};var remove=function remove(name){delete urls[name];delete lookup[name];};var createUrl=function createUrl(baseUrl,dep){if(isString(dep)){return isString(baseUrl)?{prefix:'',resource:dep,suffix:''}:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix};}else{return dep;}};var load=function load(name,addOnUrl){if(urls[name]){return Promise.resolve();}var urlString=isString(addOnUrl)?addOnUrl:addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix;if(urlString.indexOf('/')!==0&&urlString.indexOf('://')===-1){urlString=AddOnManager.baseURL+'/'+urlString;}urls[name]=urlString.substring(0,urlString.lastIndexOf('/'));var done=function done(){runListeners(name,'loaded');return Promise.resolve();};if(lookup[name]){return done();}else{return ScriptLoader.ScriptLoader.add(urlString).then(done);}};var waitFor=function waitFor(name){var state=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'added';if(state==='added'&&isAdded(name)){return Promise.resolve();}else if(state==='loaded'&&isLoaded(name)){return Promise.resolve();}else{return new Promise(function(resolve){_listeners.push({name:name,state:state,resolve:resolve});});}};return{items:items,urls:urls,lookup:lookup,get:get,requireLangPack:requireLangPack,add:add,remove:remove,createUrl:createUrl,load:load,waitFor:waitFor};};AddOnManager.languageLoad=true;AddOnManager.baseURL='';AddOnManager.PluginManager=AddOnManager();AddOnManager.ThemeManager=AddOnManager();AddOnManager.ModelManager=AddOnManager();var singleton=function singleton(doRevoke){var subject=Cell(Optional.none());var revoke=function revoke(){return subject.get().each(doRevoke);};var clear=function clear(){revoke();subject.set(Optional.none());};var isSet=function isSet(){return subject.get().isSome();};var get=function get(){return subject.get();};var set=function set(s){revoke();subject.set(Optional.some(s));};return{clear:clear,isSet:isSet,get:get,set:set};};var value$2=function value$2(){var subject=singleton(noop);var on=function on(f){return subject.get().each(f);};return _objectSpread({},subject,{on:on});};var first$1=function first$1(fn,rate){var timer=null;var cancel=function cancel(){if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7];}if(isNull(timer)){timer=setTimeout(function(){timer=null;fn.apply(null,args);},rate);}};return{cancel:cancel,throttle:throttle};};var last$1=function last$1(fn,rate){var timer=null;var cancel=function cancel(){if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8];}cancel();timer=setTimeout(function(){timer=null;fn.apply(null,args);},rate);};return{cancel:cancel,throttle:throttle};};var annotation=constant('mce-annotation');var dataAnnotation=constant('data-mce-annotation');var dataAnnotationId=constant('data-mce-annotation-uid');var dataAnnotationActive=constant('data-mce-annotation-active');var dataAnnotationClasses=constant('data-mce-annotation-classes');var dataAnnotationAttributes=constant('data-mce-annotation-attrs');var isRoot$1=function isRoot$1(root){return function(node){return eq(node,root);};};var identify=function identify(editor,annotationName){var rng=editor.selection.getRng();var start=SugarElement.fromDom(rng.startContainer);var root=SugarElement.fromDom(editor.getBody());var selector=annotationName.fold(function(){return'.'+annotation();},function(an){return"[".concat(dataAnnotation(),"=\"").concat(an,"\"]");});var newStart=child$1(start,rng.startOffset).getOr(start);var closest=closest$3(newStart,selector,isRoot$1(root));var getAttr=function getAttr(c,property){if(has$1(c,property)){return Optional.some(get$9(c,property));}else{return Optional.none();}};return closest.bind(function(c){return getAttr(c,"".concat(dataAnnotationId())).bind(function(uid){return getAttr(c,"".concat(dataAnnotation())).map(function(name){var elements=findMarkers(editor,uid);return{uid:uid,name:name,elements:elements};});});});};var isAnnotation=function isAnnotation(elem){return isElement$7(elem)&&has(elem,annotation());};var isBogusElement=function isBogusElement(elem,root){return has$1(elem,'data-mce-bogus')||ancestor$1(elem,'[data-mce-bogus="all"]',isRoot$1(root));};var findMarkers=function findMarkers(editor,uid){var body=SugarElement.fromDom(editor.getBody());var descendants$1=descendants(body,"[".concat(dataAnnotationId(),"=\"").concat(uid,"\"]"));return filter$6(descendants$1,function(descendant){return!isBogusElement(descendant,body);});};var findAll=function findAll(editor,name){var body=SugarElement.fromDom(editor.getBody());var markers=descendants(body,"[".concat(dataAnnotation(),"=\"").concat(name,"\"]"));var directory={};each$f(markers,function(m){if(!isBogusElement(m,body)){var uid=get$9(m,dataAnnotationId());var nodesAlready=get$a(directory,uid).getOr([]);directory[uid]=nodesAlready.concat([m]);}});return directory;};var setup$x=function setup$x(editor,registry){var changeCallbacks=Cell({});var initData=function initData(){return{listeners:[],previous:value$2()};};var withCallbacks=function withCallbacks(name,f){updateCallbacks(name,function(data){f(data);return data;});};var updateCallbacks=function updateCallbacks(name,f){var callbackMap=changeCallbacks.get();var data=get$a(callbackMap,name).getOrThunk(initData);var outputData=f(data);callbackMap[name]=outputData;changeCallbacks.set(callbackMap);};var fireCallbacks=function fireCallbacks(name,uid,elements){withCallbacks(name,function(data){each$f(data.listeners,function(f){return f(true,name,{uid:uid,nodes:map$3(elements,function(elem){return elem.dom;})});});});};var fireNoAnnotation=function fireNoAnnotation(name){withCallbacks(name,function(data){each$f(data.listeners,function(f){return f(false,name);});});};var toggleActiveAttr=function toggleActiveAttr(uid,state){each$f(findMarkers(editor,uid),function(elem){if(state){set$2(elem,dataAnnotationActive(),'true');}else{remove$b(elem,dataAnnotationActive());}});};var onNodeChange=last$1(function(){var annotations=sort(registry.getNames());each$f(annotations,function(name){updateCallbacks(name,function(data){var prev=data.previous.get();identify(editor,Optional.some(name)).fold(function(){prev.each(function(uid){fireNoAnnotation(name);data.previous.clear();toggleActiveAttr(uid,false);});},function(_ref3){var uid=_ref3.uid,name=_ref3.name,elements=_ref3.elements;if(!is$2(prev,uid)){prev.each(function(uid){return toggleActiveAttr(uid,false);});fireCallbacks(name,uid,elements);data.previous.set(uid);toggleActiveAttr(uid,true);}});return{previous:data.previous,listeners:data.listeners};});});},30);editor.on('remove',function(){onNodeChange.cancel();});editor.on('NodeChange',function(){onNodeChange.throttle();});var addListener=function addListener(name,f){updateCallbacks(name,function(data){return{previous:data.previous,listeners:data.listeners.concat([f])};});};return{addListener:addListener};};var setup$w=function setup$w(editor,registry){var dataAnnotation$1=dataAnnotation();var identifyParserNode=function identifyParserNode(node){return Optional.from(node.attr(dataAnnotation$1)).bind(registry.lookup);};var removeDirectAnnotation=function removeDirectAnnotation(node){var _a,_b;node.attr(dataAnnotationId(),null);node.attr(dataAnnotation(),null);node.attr(dataAnnotationActive(),null);var customAttrNames=Optional.from(node.attr(dataAnnotationAttributes())).map(function(names){return names.split(',');}).getOr([]);var customClasses=Optional.from(node.attr(dataAnnotationClasses())).map(function(names){return names.split(',');}).getOr([]);each$f(customAttrNames,function(name){return node.attr(name,null);});var classList=(_b=(_a=node.attr('class'))===null||_a===void 0?void 0:_a.split(' '))!==null&&_b!==void 0?_b:[];var newClassList=difference(classList,[annotation()].concat(customClasses));node.attr('class',newClassList.length>0?newClassList.join(' '):null);node.attr(dataAnnotationClasses(),null);node.attr(dataAnnotationAttributes(),null);};editor.serializer.addTempAttr(dataAnnotationActive());editor.serializer.addAttributeFilter(dataAnnotation$1,function(nodes){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{var _loop=function _loop(){var node=_step.value;identifyParserNode(node).each(function(settings){if(settings.persistent===false){if(node.name==='span'){node.unwrap();}else{removeDirectAnnotation(node);}}});};for(var _iterator=nodes[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_loop();}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]();}}finally{if(_didIteratorError){throw _iteratorError;}}}});};var create$c=function create$c(){var annotations={};var register=function register(name,settings){annotations[name]={name:name,settings:settings};};var lookup=function lookup(name){return get$a(annotations,name).map(function(a){return a.settings;});};var getNames=function getNames(){return keys(annotations);};return{register:register,lookup:lookup,getNames:getNames};};var unique=0;var generate$1=function generate$1(prefix){var date=new Date();var time=date.getTime();var random=Math.floor(Math.random()*1000000000);unique++;return prefix+'_'+random+unique+String(time);};var add=function add(element,classes){each$f(classes,function(x){add$2(element,x);});};var remove$5=function remove$5(element,classes){each$f(classes,function(x){remove$8(element,x);});};var clone$2=function clone$2(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep));};var shallow$1=function shallow$1(original){return clone$2(original,false);};var deep$1=function deep$1(original){return clone$2(original,true);};var shallowAs=function shallowAs(original,tag){var nu=SugarElement.fromTag(tag);var attributes=clone$4(original);setAll$1(nu,attributes);return nu;};var mutate=function mutate(original,tag){var nu=shallowAs(original,tag);after$4(original,nu);var children$1=children(original);append(nu,children$1);remove$6(original);return nu;};var TextWalker=function TextWalker(startNode,rootNode){var isBoundary=arguments.length>2&&arguments[2]!==undefined?arguments[2]:never;var walker=new DomTreeWalker(startNode,rootNode);var walk=function walk(direction){var next;do{next=walker[direction]();}while(next&&!isText$9(next)&&!isBoundary(next));return Optional.from(next).filter(isText$9);};return{current:function current(){return Optional.from(walker.current()).filter(isText$9);},next:function next(){return walk('next');},prev:function prev(){return walk('prev');},prev2:function prev2(){return walk('prev2');}};};var TextSeeker=function TextSeeker(dom,isBoundary){var isBlockBoundary=isBoundary?isBoundary:function(node){return dom.isBlock(node)||isBr$6(node)||isContentEditableFalse$b(node);};var walk=function walk(node,offset,walker,process){if(isText$9(node)){var newOffset=process(node,offset,node.data);if(newOffset!==-1){return Optional.some({container:node,offset:newOffset});}}return walker().bind(function(next){return walk(next.container,next.offset,walker,process);});};var backwards=function backwards(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,function(){return walker.prev().map(function(prev){return{container:prev,offset:prev.length};});},process).getOrNull();};var forwards=function forwards(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,function(){return walker.next().map(function(next){return{container:next,offset:0};});},process).getOrNull();};return{backwards:backwards,forwards:forwards};};var round$2=Math.round;var clone$1=function clone$1(rect){if(!rect){return{left:0,top:0,bottom:0,right:0,width:0,height:0};}return{left:round$2(rect.left),top:round$2(rect.top),bottom:round$2(rect.bottom),right:round$2(rect.right),width:round$2(rect.width),height:round$2(rect.height)};};var collapse=function collapse(rect,toStart){rect=clone$1(rect);if(toStart){rect.right=rect.left;}else{rect.left=rect.left+rect.width;rect.right=rect.left;}rect.width=0;return rect;};var isEqual=function isEqual(rect1,rect2){return rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right;};var isValidOverflow=function isValidOverflow(overflowY,rect1,rect2){return overflowY>=0&&overflowY<=Math.min(rect1.height,rect2.height)/2;};var isAbove$1=function isAbove$1(rect1,rect2){var halfHeight=Math.min(rect2.height/2,rect1.height/2);if(rect1.bottom-halfHeight<rect2.top){return true;}if(rect1.top>rect2.bottom){return false;}return isValidOverflow(rect2.top-rect1.bottom,rect1,rect2);};var isBelow$1=function isBelow$1(rect1,rect2){if(rect1.top>rect2.bottom){return true;}if(rect1.bottom<rect2.top){return false;}return isValidOverflow(rect2.bottom-rect1.top,rect1,rect2);};var containsXY=function containsXY(rect,clientX,clientY){return clientX>=rect.left&&clientX<=rect.right&&clientY>=rect.top&&clientY<=rect.bottom;};var boundingClientRectFromRects=function boundingClientRectFromRects(rects){return foldl(rects,function(acc,rect){return acc.fold(function(){return Optional.some(rect);},function(prevRect){var left=Math.min(rect.left,prevRect.left);var top=Math.min(rect.top,prevRect.top);var right=Math.max(rect.right,prevRect.right);var bottom=Math.max(rect.bottom,prevRect.bottom);return Optional.some({top:top,right:right,bottom:bottom,left:left,width:right-left,height:bottom-top});});},Optional.none());};var distanceToRectEdgeFromXY=function distanceToRectEdgeFromXY(rect,x,y){var cx=Math.max(Math.min(x,rect.left+rect.width),rect.left);var cy=Math.max(Math.min(y,rect.top+rect.height),rect.top);return Math.sqrt((x-cx)*(x-cx)+(y-cy)*(y-cy));};var overlapY=function overlapY(r1,r2){return Math.max(0,Math.min(r1.bottom,r2.bottom)-Math.max(r1.top,r2.top));};var clamp$2=function clamp$2(value,min,max){return Math.min(Math.max(value,min),max);};var getSelectedNode=function getSelectedNode(range){var startContainer=range.startContainer,startOffset=range.startOffset;if(startContainer===range.endContainer&&startContainer.hasChildNodes()&&range.endOffset===startOffset+1){return startContainer.childNodes[startOffset];}return null;};var getNode$1=function getNode$1(container,offset){if(isElement$6(container)&&container.hasChildNodes()){var childNodes=container.childNodes;var safeOffset=clamp$2(offset,0,childNodes.length-1);return childNodes[safeOffset];}else{return container;}};var getNodeUnsafe=function getNodeUnsafe(container,offset){if(offset<0&&isElement$6(container)&&container.hasChildNodes()){return undefined;}else{return getNode$1(container,offset);}};var extendingChars=new RegExp("[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A"+"\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0"+"\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E3-\u0902\u093A\u093C"+"\u0941-\u0948\u094D\u0951-\u0957\u0962-\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2-\u09E3"+"\u0A01-\u0A02\u0A3C\u0A41-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D\u0A51\u0A70-\u0A71\u0A75\u0A81-\u0A82\u0ABC"+"\u0AC1-\u0AC5\u0AC7-\u0AC8\u0ACD\u0AE2-\u0AE3\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B57"+"\u0B62-\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56"+"\u0C62-\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC-\u0CCD\u0CD5-\u0CD6\u0CE2-\u0CE3\u0D01\u0D3E\u0D41-\u0D44"+"\u0D4D\u0D57\u0D62-\u0D63\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9"+"\u0EBB-\u0EBC\u0EC8-\u0ECD\u0F18-\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86-\u0F87\u0F8D-\u0F97"+"\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039-\u103A\u103D-\u103E\u1058-\u1059\u105E-\u1060\u1071-\u1074"+"\u1082\u1085-\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u17B4-\u17B5"+"\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u1922\u1927-\u1928\u1932\u1939-\u193B\u1A17-\u1A18"+"\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1ABD\u1ABE\u1B00-\u1B03\u1B34"+"\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80-\u1B81\u1BA2-\u1BA5\u1BA8-\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8-\u1BE9"+"\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8-\u1CF9"+"\u1DC0-\u1DF5\u1DFC-\u1DFF\u200C-\u200D\u20D0-\u20DC\u20DD-\u20E0\u20E1\u20E2-\u20E4\u20E5-\u20F0\u2CEF-\u2CF1"+"\u2D7F\u2DE0-\u2DFF\u302A-\u302D\u302E-\u302F\u3099-\u309A\uA66F\uA670-\uA672\uA674-\uA67D\uA69E-\uA69F\uA6F0-\uA6F1"+"\uA802\uA806\uA80B\uA825-\uA826\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC"+"\uA9E5\uAA29-\uAA2E\uAA31-\uAA32\uAA35-\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7-\uAAB8\uAABE-\uAABF\uAAC1"+"\uAAEC-\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E-\uFF9F]");var isExtendingChar=function isExtendingChar(ch){return typeof ch==='string'&&ch.charCodeAt(0)>=768&&extendingChars.test(ch);};var or=function or(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++){args[_key9]=arguments[_key9];}return function(x){for(var i=0;i<args.length;i++){if(args[i](x)){return true;}}return false;};};var and=function and(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++){args[_key10]=arguments[_key10];}return function(x){for(var i=0;i<args.length;i++){if(!args[i](x)){return false;}}return true;};};var isElement$4=isElement$6;var isCaretCandidate$2=isCaretCandidate$3;var isBlock$1=matchStyleValues('display','block table');var isFloated=matchStyleValues('float','left right');var isValidElementCaretCandidate=and(isElement$4,isCaretCandidate$2,not(isFloated));var isNotPre=not(matchStyleValues('white-space','pre pre-line pre-wrap'));var isText$6=isText$9;var isBr$3=isBr$6;var nodeIndex$1=DOMUtils.nodeIndex;var resolveIndex$1=getNodeUnsafe;var createRange$1=function createRange$1(doc){return'createRange'in doc?doc.createRange():DOMUtils.DOM.createRng();};var isWhiteSpace$1=function isWhiteSpace$1(chr){return chr&&/[\r\n\t ]/.test(chr);};var isRange=function isRange(rng){return!!rng.setStart&&!!rng.setEnd;};var isHiddenWhiteSpaceRange=function isHiddenWhiteSpaceRange(range){var container=range.startContainer;var offset=range.startOffset;if(isWhiteSpace$1(range.toString())&&isNotPre(container.parentNode)&&isText$9(container)){var _text=container.data;if(isWhiteSpace$1(_text[offset-1])||isWhiteSpace$1(_text[offset+1])){return true;}}return false;};var getBrClientRect=function getBrClientRect(brNode){var doc=brNode.ownerDocument;var rng=createRange$1(doc);var nbsp$1=doc.createTextNode(nbsp);var parentNode=brNode.parentNode;parentNode.insertBefore(nbsp$1,brNode);rng.setStart(nbsp$1,0);rng.setEnd(nbsp$1,1);var clientRect=clone$1(rng.getBoundingClientRect());parentNode.removeChild(nbsp$1);return clientRect;};var getBoundingClientRectWebKitText=function getBoundingClientRectWebKitText(rng){var sc=rng.startContainer;var ec=rng.endContainer;var so=rng.startOffset;var eo=rng.endOffset;if(sc===ec&&isText$9(ec)&&so===0&&eo===1){var newRng=rng.cloneRange();newRng.setEndAfter(ec);return getBoundingClientRect$1(newRng);}else{return null;}};var isZeroRect=function isZeroRect(r){return r.left===0&&r.right===0&&r.top===0&&r.bottom===0;};var getBoundingClientRect$1=function getBoundingClientRect$1(item){var clientRect;var clientRects=item.getClientRects();if(clientRects.length>0){clientRect=clone$1(clientRects[0]);}else{clientRect=clone$1(item.getBoundingClientRect());}if(!isRange(item)&&isBr$3(item)&&isZeroRect(clientRect)){return getBrClientRect(item);}if(isZeroRect(clientRect)&&isRange(item)){return getBoundingClientRectWebKitText(item);}return clientRect;};var collapseAndInflateWidth=function collapseAndInflateWidth(clientRect,toStart){var newClientRect=collapse(clientRect,toStart);newClientRect.width=1;newClientRect.right=newClientRect.left+1;return newClientRect;};var getCaretPositionClientRects=function getCaretPositionClientRects(caretPosition){var clientRects=[];var addUniqueAndValidRect=function addUniqueAndValidRect(clientRect){if(clientRect.height===0){return;}if(clientRects.length>0){if(isEqual(clientRect,clientRects[clientRects.length-1])){return;}}clientRects.push(clientRect);};var addCharacterOffset=function addCharacterOffset(container,offset){var range=createRange$1(container.ownerDocument);if(offset<container.data.length){if(isExtendingChar(container.data[offset])){return clientRects;}if(isExtendingChar(container.data[offset-1])){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),false));return clientRects;}}}if(offset>0){range.setStart(container,offset-1);range.setEnd(container,offset);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),false));}}if(offset<container.data.length){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),true));}}};var container=caretPosition.container();var offset=caretPosition.offset();if(isText$6(container)){addCharacterOffset(container,offset);return clientRects;}if(isElement$4(container)){if(caretPosition.isAtEnd()){var node=resolveIndex$1(container,offset);if(isText$6(node)){addCharacterOffset(node,node.data.length);}if(isValidElementCaretCandidate(node)&&!isBr$3(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),false));}}else{var _node2=resolveIndex$1(container,offset);if(isText$6(_node2)){addCharacterOffset(_node2,0);}if(isValidElementCaretCandidate(_node2)&&caretPosition.isAtEnd()){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(_node2),false));return clientRects;}var beforeNode=resolveIndex$1(caretPosition.container(),caretPosition.offset()-1);if(isValidElementCaretCandidate(beforeNode)&&!isBr$3(beforeNode)){if(isBlock$1(beforeNode)||isBlock$1(_node2)||!isValidElementCaretCandidate(_node2)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(beforeNode),false));}}if(isValidElementCaretCandidate(_node2)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(_node2),true));}}}return clientRects;};var CaretPosition=function CaretPosition(container,offset,clientRects){var isAtStart=function isAtStart(){if(isText$6(container)){return offset===0;}return offset===0;};var isAtEnd=function isAtEnd(){if(isText$6(container)){return offset>=container.data.length;}return offset>=container.childNodes.length;};var toRange=function toRange(){var range=createRange$1(container.ownerDocument);range.setStart(container,offset);range.setEnd(container,offset);return range;};var getClientRects=function getClientRects(){if(!clientRects){clientRects=getCaretPositionClientRects(CaretPosition(container,offset));}return clientRects;};var isVisible=function isVisible(){return getClientRects().length>0;};var isEqual=function isEqual(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset();};var getNode=function getNode(before){return resolveIndex$1(container,before?offset-1:offset);};return{container:constant(container),offset:constant(offset),toRange:toRange,getClientRects:getClientRects,isVisible:isVisible,isAtStart:isAtStart,isAtEnd:isAtEnd,isEqual:isEqual,getNode:getNode};};CaretPosition.fromRangeStart=function(range){return CaretPosition(range.startContainer,range.startOffset);};CaretPosition.fromRangeEnd=function(range){return CaretPosition(range.endContainer,range.endOffset);};CaretPosition.after=function(node){return CaretPosition(node.parentNode,nodeIndex$1(node)+1);};CaretPosition.before=function(node){return CaretPosition(node.parentNode,nodeIndex$1(node));};CaretPosition.isAbove=function(pos1,pos2){return lift2(head(pos2.getClientRects()),last$3(pos1.getClientRects()),isAbove$1).getOr(false);};CaretPosition.isBelow=function(pos1,pos2){return lift2(last$3(pos2.getClientRects()),head(pos1.getClientRects()),isBelow$1).getOr(false);};CaretPosition.isAtStart=function(pos){return pos?pos.isAtStart():false;};CaretPosition.isAtEnd=function(pos){return pos?pos.isAtEnd():false;};CaretPosition.isTextPosition=function(pos){return pos?isText$9(pos.container()):false;};CaretPosition.isElementPosition=function(pos){return CaretPosition.isTextPosition(pos)===false;};var trimEmptyTextNode$1=function trimEmptyTextNode$1(dom,node){if(isText$9(node)&&node.data.length===0){dom.remove(node);}};var insertNode=function insertNode(dom,rng,node){rng.insertNode(node);trimEmptyTextNode$1(dom,node.previousSibling);trimEmptyTextNode$1(dom,node.nextSibling);};var insertFragment=function insertFragment(dom,rng,frag){var firstChild=Optional.from(frag.firstChild);var lastChild=Optional.from(frag.lastChild);rng.insertNode(frag);firstChild.each(function(child){return trimEmptyTextNode$1(dom,child.previousSibling);});lastChild.each(function(child){return trimEmptyTextNode$1(dom,child.nextSibling);});};var rangeInsertNode=function rangeInsertNode(dom,rng,node){if(isDocumentFragment(node)){insertFragment(dom,rng,node);}else{insertNode(dom,rng,node);}};var isText$5=isText$9;var isBogus=isBogus$2;var nodeIndex=DOMUtils.nodeIndex;var normalizedParent=function normalizedParent(node){var parentNode=node.parentNode;if(isBogus(parentNode)){return normalizedParent(parentNode);}return parentNode;};var getChildNodes=function getChildNodes(node){if(!node){return[];}return reduce(node.childNodes,function(result,node){if(isBogus(node)&&node.nodeName!=='BR'){result=result.concat(getChildNodes(node));}else{result.push(node);}return result;},[]);};var normalizedTextOffset=function normalizedTextOffset(node,offset){while(node=node.previousSibling){if(!isText$5(node)){break;}offset+=node.data.length;}return offset;};var equal=function equal(a){return function(b){return a===b;};};var normalizedNodeIndex=function normalizedNodeIndex(node){var nodes,index;nodes=getChildNodes(normalizedParent(node));index=findIndex$1(nodes,equal(node),node);nodes=nodes.slice(0,index+1);var numTextFragments=reduce(nodes,function(result,node,i){if(isText$5(node)&&isText$5(nodes[i-1])){result++;}return result;},0);nodes=filter$4(nodes,matchNodeNames([node.nodeName]));index=findIndex$1(nodes,equal(node),node);return index-numTextFragments;};var createPathItem=function createPathItem(node){var name;if(isText$5(node)){name='text()';}else{name=node.nodeName.toLowerCase();}return name+'['+normalizedNodeIndex(node)+']';};var parentsUntil$1=function parentsUntil$1(root,node,predicate){var parents=[];for(node=node.parentNode;node!==root;node=node.parentNode){if(predicate&&predicate(node)){break;}parents.push(node);}return parents;};var create$b=function create$b(root,caretPosition){var container,offset,path=[],outputOffset,childNodes,parents;container=caretPosition.container();offset=caretPosition.offset();if(isText$5(container)){outputOffset=normalizedTextOffset(container,offset);}else{childNodes=container.childNodes;if(offset>=childNodes.length){outputOffset='after';offset=childNodes.length-1;}else{outputOffset='before';}container=childNodes[offset];}path.push(createPathItem(container));parents=parentsUntil$1(root,container);parents=filter$4(parents,not(isBogus$2));path=path.concat(map$1(parents,function(node){return createPathItem(node);}));return path.reverse().join('/')+','+outputOffset;};var resolvePathItem=function resolvePathItem(node,name,index){var nodes=getChildNodes(node);nodes=filter$4(nodes,function(node,index){return!isText$5(node)||!isText$5(nodes[index-1]);});nodes=filter$4(nodes,matchNodeNames([name]));return nodes[index];};var findTextPosition=function findTextPosition(container,offset){var node=container,targetOffset=0,dataLen;while(isText$5(node)){dataLen=node.data.length;if(offset>=targetOffset&&offset<=targetOffset+dataLen){container=node;offset=offset-targetOffset;break;}if(!isText$5(node.nextSibling)){container=node;offset=dataLen;break;}targetOffset+=dataLen;node=node.nextSibling;}if(isText$5(container)&&offset>container.data.length){offset=container.data.length;}return CaretPosition(container,offset);};var resolve$1=function resolve$1(root,path){var offset;if(!path){return null;}var parts=path.split(',');var paths=parts[0].split('/');offset=parts.length>1?parts[1]:'before';var container=reduce(paths,function(result,value){var match=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value);if(!match){return null;}if(match[1]==='text()'){match[1]='#text';}return resolvePathItem(result,match[1],parseInt(match[2],10));},root);if(!container){return null;}if(!isText$5(container)){if(offset==='after'){offset=nodeIndex(container)+1;}else{offset=nodeIndex(container);}return CaretPosition(container.parentNode,offset);}return findTextPosition(container,parseInt(offset,10));};var isContentEditableFalse$9=isContentEditableFalse$b;var getNormalizedTextOffset=function getNormalizedTextOffset(trim,container,offset){var node,trimmedOffset;trimmedOffset=trim(container.data.slice(0,offset)).length;for(node=container.previousSibling;node&&isText$9(node);node=node.previousSibling){trimmedOffset+=trim(node.data).length;}return trimmedOffset;};var getPoint=function getPoint(dom,trim,normalized,rng,start){var container=rng[start?'startContainer':'endContainer'];var offset=rng[start?'startOffset':'endOffset'];var point=[];var childNodes,after=0;var root=dom.getRoot();if(isText$9(container)){point.push(normalized?getNormalizedTextOffset(trim,container,offset):offset);}else{childNodes=container.childNodes;if(offset>=childNodes.length&&childNodes.length){after=1;offset=Math.max(0,childNodes.length-1);}point.push(dom.nodeIndex(childNodes[offset],normalized)+after);}for(;container&&container!==root;container=container.parentNode){point.push(dom.nodeIndex(container,normalized));}return point;};var getLocation=function getLocation(trim,selection,normalized,rng){var dom=selection.dom;var start=getPoint(dom,trim,normalized,rng,true);var forward=selection.isForward();var fakeCaret=isRangeInCaretContainerBlock(rng)?{isFakeCaret:true}:{};if(!selection.isCollapsed()){var _end=getPoint(dom,trim,normalized,rng,false);return _objectSpread({start:start,end:_end,forward:forward},fakeCaret);}else{return _objectSpread({start:start,forward:forward},fakeCaret);}};var findIndex=function findIndex(dom,name,element){var count=0;Tools.each(dom.select(name),function(node){if(node.getAttribute('data-mce-bogus')==='all'){return;}if(node===element){return false;}count++;});return count;};var moveEndPoint$1=function moveEndPoint$1(rng,start){var container,offset;var prefix=start?'start':'end';container=rng[prefix+'Container'];offset=rng[prefix+'Offset'];if(isElement$6(container)&&container.nodeName==='TR'){var childNodes=container.childNodes;container=childNodes[Math.min(start?offset:offset-1,childNodes.length-1)];if(container){offset=start?0:container.childNodes.length;rng['set'+(start?'Start':'End')](container,offset);}}};var normalizeTableCellSelection=function normalizeTableCellSelection(rng){moveEndPoint$1(rng,true);moveEndPoint$1(rng,false);return rng;};var findSibling=function findSibling(node,offset){var sibling;if(isElement$6(node)){node=getNode$1(node,offset);if(isContentEditableFalse$9(node)){return node;}}if(isCaretContainer$2(node)){if(isText$9(node)&&isCaretContainerBlock$1(node)){node=node.parentNode;}sibling=node.previousSibling;if(isContentEditableFalse$9(sibling)){return sibling;}sibling=node.nextSibling;if(isContentEditableFalse$9(sibling)){return sibling;}}};var findAdjacentContentEditableFalseElm=function findAdjacentContentEditableFalseElm(rng){return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset);};var getOffsetBookmark=function getOffsetBookmark(trim,normalized,selection){var element=selection.getNode();var name=element?element.nodeName:null;var rng=selection.getRng();if(isContentEditableFalse$9(element)||name==='IMG'){return{name:name,index:findIndex(selection.dom,name,element)};}var sibling=findAdjacentContentEditableFalseElm(rng);if(sibling){name=sibling.tagName;return{name:name,index:findIndex(selection.dom,name,sibling)};}return getLocation(trim,selection,normalized,rng);};var getCaretBookmark=function getCaretBookmark(selection){var rng=selection.getRng();return{start:create$b(selection.dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:create$b(selection.dom.getRoot(),CaretPosition.fromRangeEnd(rng)),forward:selection.isForward()};};var getRangeBookmark=function getRangeBookmark(selection){return{rng:selection.getRng(),forward:selection.isForward()};};var createBookmarkSpan=function createBookmarkSpan(dom,id,filled){var args={'data-mce-type':'bookmark',id:id,'style':'overflow:hidden;line-height:0px'};return filled?dom.create('span',args,'&#xFEFF;'):dom.create('span',args);};var getPersistentBookmark=function getPersistentBookmark(selection,filled){var dom=selection.dom;var rng=selection.getRng();var id=dom.uniqueId();var collapsed=selection.isCollapsed();var element=selection.getNode();var name=element.nodeName;var forward=selection.isForward();if(name==='IMG'){return{name:name,index:findIndex(dom,name,element)};}var rng2=normalizeTableCellSelection(rng.cloneRange());if(!collapsed){rng2.collapse(false);var endBookmarkNode=createBookmarkSpan(dom,id+'_end',filled);rangeInsertNode(dom,rng2,endBookmarkNode);}rng=normalizeTableCellSelection(rng);rng.collapse(true);var startBookmarkNode=createBookmarkSpan(dom,id+'_start',filled);rangeInsertNode(dom,rng,startBookmarkNode);selection.moveToBookmark({id:id,keep:true,forward:forward});return{id:id,forward:forward};};var getBookmark$2=function getBookmark$2(selection,type,normalized){if(type===2){return getOffsetBookmark(trim$1,normalized,selection);}else if(type===3){return getCaretBookmark(selection);}else if(type){return getRangeBookmark(selection);}else{return getPersistentBookmark(selection,false);}};var getUndoBookmark=curry(getOffsetBookmark,identity,true);var value$1=function value$1(value){var applyHelper=function applyHelper(fn){return fn(value);};var constHelper=constant(value);var outputHelper=function outputHelper(){return output;};var output={tag:true,inner:value,fold:function fold(_onError,onValue){return onValue(value);},isValue:always,isError:never,map:function map(mapper){return Result.value(mapper(value));},mapError:outputHelper,bind:applyHelper,exists:applyHelper,forall:applyHelper,getOr:constHelper,or:outputHelper,getOrThunk:constHelper,orThunk:outputHelper,getOrDie:constHelper,each:function each(fn){fn(value);},toOptional:function toOptional(){return Optional.some(value);}};return output;};var error=function error(_error){var outputHelper=function outputHelper(){return output;};var output={tag:false,inner:_error,fold:function fold(onError,_onValue){return onError(_error);},isValue:never,isError:always,map:outputHelper,mapError:function mapError(mapper){return Result.error(mapper(_error));},bind:outputHelper,exists:never,forall:always,getOr:identity,or:identity,getOrThunk:apply$1,orThunk:apply$1,getOrDie:die(String(_error)),each:noop,toOptional:Optional.none};return output;};var fromOption=function fromOption(optional,err){return optional.fold(function(){return error(err);},value$1);};var Result={value:value$1,error:error,fromOption:fromOption};var generate=function generate(cases){if(!isArray$1(cases)){throw new Error('cases must be an array');}if(cases.length===0){throw new Error('there must be at least one case');}var constructors=[];var adt={};each$f(cases,function(acase,count){var keys$1=keys(acase);if(keys$1.length!==1){throw new Error('one and only one name per case');}var key=keys$1[0];var value=acase[key];if(adt[key]!==undefined){throw new Error('duplicate key detected:'+key);}else if(key==='cata'){throw new Error('cannot have a case named cata (sorry)');}else if(!isArray$1(value)){throw new Error('case arguments must be an array');}constructors.push(key);adt[key]=function(){for(var _len11=arguments.length,args=new Array(_len11),_key11=0;_key11<_len11;_key11++){args[_key11]=arguments[_key11];}var argLength=args.length;if(argLength!==value.length){throw new Error('Wrong number of arguments to case '+key+'. Expected '+value.length+' ('+value+'), got '+argLength);}var match=function match(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length){throw new Error('Wrong number of arguments to match. Expected: '+constructors.join(',')+'\nActual: '+branchKeys.join(','));}var allReqd=forall(constructors,function(reqKey){return contains$2(branchKeys,reqKey);});if(!allReqd){throw new Error('Not all branches were specified when using match. Specified: '+branchKeys.join(', ')+'\nRequired: '+constructors.join(', '));}return branches[key].apply(null,args);};return{fold:function fold(){for(var _len12=arguments.length,foldArgs=new Array(_len12),_key12=0;_key12<_len12;_key12++){foldArgs[_key12]=arguments[_key12];}if(foldArgs.length!==cases.length){throw new Error('Wrong number of arguments to fold. Expected '+cases.length+', got '+foldArgs.length);}var target=foldArgs[count];return target.apply(null,args);},match:match,log:function log(label){console.log(label,{constructors:constructors,constructor:key,params:args});}};};});return adt;};var Adt={generate:generate};Adt.generate([{bothErrors:['error1','error2']},{firstError:['error1','value2']},{secondError:['value1','error2']},{bothValues:['value1','value2']}]);var partition$1=function partition$1(results){var errors=[];var values=[];each$f(results,function(result){result.fold(function(err){errors.push(err);},function(value){values.push(value);});});return{errors:errors,values:values};};var isInlinePattern=function isInlinePattern(pattern){return pattern.type==='inline-command'||pattern.type==='inline-format';};var isBlockPattern=function isBlockPattern(pattern){return pattern.type==='block-command'||pattern.type==='block-format';};var sortPatterns=function sortPatterns(patterns){return sort(patterns,function(a,b){if(a.start.length===b.start.length){return 0;}return a.start.length>b.start.length?-1:1;});};var normalizePattern=function normalizePattern(pattern){var err=function err(message){return Result.error({message:message,pattern:pattern});};var formatOrCmd=function formatOrCmd(name,onFormat,onCommand){if(pattern.format!==undefined){var formats;if(isArray$1(pattern.format)){if(!forall(pattern.format,isString)){return err(name+' pattern has non-string items in the `format` array');}formats=pattern.format;}else if(isString(pattern.format)){formats=[pattern.format];}else{return err(name+' pattern has non-string `format` parameter');}return Result.value(onFormat(formats));}else if(pattern.cmd!==undefined){if(!isString(pattern.cmd)){return err(name+' pattern has non-string `cmd` parameter');}return Result.value(onCommand(pattern.cmd,pattern.value));}else{return err(name+' pattern is missing both `format` and `cmd` parameters');}};if(!isObject(pattern)){return err('Raw pattern is not an object');}if(!isString(pattern.start)){return err('Raw pattern is missing `start` parameter');}if(pattern.end!==undefined){if(!isString(pattern.end)){return err('Inline pattern has non-string `end` parameter');}if(pattern.start.length===0&&pattern.end.length===0){return err('Inline pattern has empty `start` and `end` parameters');}var _start=pattern.start;var _end2=pattern.end;if(_end2.length===0){_end2=_start;_start='';}return formatOrCmd('Inline',function(format){return{type:'inline-format',start:_start,end:_end2,format:format};},function(cmd,value){return{type:'inline-command',start:_start,end:_end2,cmd:cmd,value:value};});}else if(pattern.replacement!==undefined){if(!isString(pattern.replacement)){return err('Replacement pattern has non-string `replacement` parameter');}if(pattern.start.length===0){return err('Replacement pattern has empty `start` parameter');}return Result.value({type:'inline-command',start:'',end:pattern.start,cmd:'mceInsertContent',value:pattern.replacement});}else{if(pattern.start.length===0){return err('Block pattern has empty `start` parameter');}return formatOrCmd('Block',function(formats){return{type:'block-format',start:pattern.start,format:formats[0]};},function(command,commandValue){return{type:'block-command',start:pattern.start,cmd:command,value:commandValue};});}};var getBlockPatterns=function getBlockPatterns(patterns){return sortPatterns(filter$6(patterns,isBlockPattern));};var getInlinePatterns=function getInlinePatterns(patterns){return filter$6(patterns,isInlinePattern);};var createPatternSet=function createPatternSet(patterns){return{inlinePatterns:getInlinePatterns(patterns),blockPatterns:getBlockPatterns(patterns)};};var fromRawPatterns=function fromRawPatterns(patterns){var normalized=partition$1(map$3(patterns,normalizePattern));each$f(normalized.errors,function(err){return console.error(err.message,err.pattern);});return normalized.values;};var deviceDetection$1=detect$2().deviceType;var isTouch=deviceDetection$1.isTouch();var DOM$a=DOMUtils.DOM;var getHash=function getHash(value){var items=value.indexOf('=')>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(',');return foldl(items,function(output,item){var arr=item.split('=');var key=arr[0];var val=arr.length>1?arr[1]:key;output[trim$3(key)]=trim$3(val);return output;},{});};var isRegExp=function isRegExp(x){return is$4(x,RegExp);};var option=function option(name){return function(editor){return editor.options.get(name);};};var stringOrObjectProcessor=function stringOrObjectProcessor(value){return isString(value)||isObject(value);};var bodyOptionProcessor=function bodyOptionProcessor(editor){var defaultValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';return function(value){var valid=isString(value);if(valid){if(value.indexOf('=')!==-1){var bodyObj=getHash(value);return{value:get$a(bodyObj,editor.id).getOr(defaultValue),valid:valid};}else{return{value:value,valid:valid};}}else{return{valid:false,message:'Must be a string.'};}};};var register$7=function register$7(editor){var registerOption=editor.options.register;registerOption('id',{processor:'string',"default":editor.id});registerOption('selector',{processor:'string'});registerOption('target',{processor:'object'});registerOption('suffix',{processor:'string'});registerOption('cache_suffix',{processor:'string'});registerOption('base_url',{processor:'string'});registerOption('referrer_policy',{processor:'string',"default":''});registerOption('language_load',{processor:'boolean'});registerOption('inline',{processor:'boolean',"default":false});registerOption('iframe_attrs',{processor:'object',"default":{}});registerOption('doctype',{processor:'string',"default":'<!DOCTYPE html>'});registerOption('document_base_url',{processor:'string',"default":editor.documentBaseUrl});registerOption('body_id',{processor:bodyOptionProcessor(editor,'tinymce'),"default":'tinymce'});registerOption('body_class',{processor:bodyOptionProcessor(editor),"default":''});registerOption('content_security_policy',{processor:'string',"default":''});registerOption('br_in_pre',{processor:'boolean',"default":true});registerOption('forced_root_block',{processor:function processor(value){var valid=isString(value)&&isNotEmpty(value);if(valid){return{value:value,valid:valid};}else{return{valid:false,message:'Must be a non-empty string.'};}},"default":'p'});registerOption('forced_root_block_attrs',{processor:'object',"default":{}});registerOption('newline_behavior',{processor:function processor(value){var valid=contains$2(['block','linebreak','invert','default'],value);return valid?{value:value,valid:valid}:{valid:false,message:'Must be one of: block, linebreak, invert or default.'};},"default":'default'});registerOption('br_newline_selector',{processor:'string',"default":'.mce-toc h2,figcaption,caption'});registerOption('no_newline_selector',{processor:'string',"default":''});registerOption('keep_styles',{processor:'boolean',"default":true});registerOption('end_container_on_empty_block',{processor:function processor(value){if(isBoolean(value)){return{valid:true,value:value};}else if(isString(value)){return{valid:true,value:value};}else{return{valid:false,message:'Must be boolean or a string'};}},"default":'blockquote'});registerOption('font_size_style_values',{processor:'string',"default":'xx-small,x-small,small,medium,large,x-large,xx-large'});registerOption('font_size_legacy_values',{processor:'string',"default":'xx-small,small,medium,large,x-large,xx-large,300%'});registerOption('font_size_classes',{processor:'string',"default":''});registerOption('automatic_uploads',{processor:'boolean',"default":true});registerOption('images_reuse_filename',{processor:'boolean',"default":false});registerOption('images_replace_blob_uris',{processor:'boolean',"default":true});registerOption('icons',{processor:'string',"default":''});registerOption('icons_url',{processor:'string',"default":''});registerOption('images_upload_url',{processor:'string',"default":''});registerOption('images_upload_base_path',{processor:'string',"default":''});registerOption('images_upload_base_path',{processor:'string',"default":''});registerOption('images_upload_credentials',{processor:'boolean',"default":false});registerOption('images_upload_handler',{processor:'function'});registerOption('language',{processor:'string',"default":'en'});registerOption('language_url',{processor:'string',"default":''});registerOption('entity_encoding',{processor:'string',"default":'named'});registerOption('indent',{processor:'boolean',"default":true});registerOption('indent_before',{processor:'string',"default":'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,'+'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist'});registerOption('indent_after',{processor:'string',"default":'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,'+'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist'});registerOption('indent_use_margin',{processor:'boolean',"default":false});registerOption('indentation',{processor:'string',"default":'40px'});registerOption('content_css',{processor:function processor(value){var valid=value===false||isString(value)||isArrayOf(value,isString);if(valid){if(isString(value)){return{value:map$3(value.split(','),trim$3),valid:valid};}else if(isArray$1(value)){return{value:value,valid:valid};}else if(value===false){return{value:[],valid:valid};}else{return{value:value,valid:valid};}}else{return{valid:false,message:'Must be false, a string or an array of strings.'};}},"default":isInline(editor)?[]:['default']});registerOption('content_style',{processor:'string'});registerOption('content_css_cors',{processor:'boolean',"default":false});registerOption('font_css',{processor:function processor(value){var valid=isString(value)||isArrayOf(value,isString);if(valid){var newValue=isArray$1(value)?value:map$3(value.split(','),trim$3);return{value:newValue,valid:valid};}else{return{valid:false,message:'Must be a string or an array of strings.'};}},"default":[]});registerOption('inline_boundaries',{processor:'boolean',"default":true});registerOption('inline_boundaries_selector',{processor:'string',"default":'a[href],code,span.mce-annotation'});registerOption('object_resizing',{processor:function processor(value){var valid=isBoolean(value)||isString(value);if(valid){if(value===false||deviceDetection$1.isiPhone()||deviceDetection$1.isiPad()){return{value:'',valid:valid};}else{return{value:value===true?'table,img,figure.image,div,video,iframe':value,valid:valid};}}else{return{valid:false,message:'Must be boolean or a string'};}},"default":!isTouch});registerOption('resize_img_proportional',{processor:'boolean',"default":true});registerOption('event_root',{processor:'object'});registerOption('service_message',{processor:'string'});registerOption('theme',{processor:function processor(value){return value===false||isString(value)||isFunction(value);},"default":'silver'});registerOption('theme_url',{processor:'string'});registerOption('formats',{processor:'object'});registerOption('format_empty_lines',{processor:'boolean',"default":false});registerOption('preview_styles',{processor:function processor(value){var valid=value===false||isString(value);if(valid){return{value:value===false?'':value,valid:valid};}else{return{valid:false,message:'Must be false or a string'};}},"default":'font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow'});registerOption('custom_ui_selector',{processor:'string',"default":''});registerOption('hidden_input',{processor:'boolean',"default":true});registerOption('submit_patch',{processor:'boolean',"default":true});registerOption('encoding',{processor:'string'});registerOption('add_form_submit_trigger',{processor:'boolean',"default":true});registerOption('add_unload_trigger',{processor:'boolean',"default":true});registerOption('custom_undo_redo_levels',{processor:'number',"default":0});registerOption('disable_nodechange',{processor:'boolean',"default":false});registerOption('readonly',{processor:'boolean',"default":false});registerOption('plugins',{processor:'string[]',"default":[]});registerOption('external_plugins',{processor:'object'});registerOption('forced_plugins',{processor:'string[]'});registerOption('model',{processor:'string',"default":editor.hasPlugin('rtc')?'plugin':'dom'});registerOption('model_url',{processor:'string'});registerOption('block_unsupported_drop',{processor:'boolean',"default":true});registerOption('visual',{processor:'boolean',"default":true});registerOption('visual_table_class',{processor:'string',"default":'mce-item-table'});registerOption('visual_anchor_class',{processor:'string',"default":'mce-item-anchor'});registerOption('iframe_aria_text',{processor:'string',"default":'Rich Text Area. Press ALT-0 for help.'});registerOption('setup',{processor:'function'});registerOption('init_instance_callback',{processor:'function'});registerOption('url_converter',{processor:'function',"default":editor.convertURL});registerOption('url_converter_scope',{processor:'object',"default":editor});registerOption('urlconverter_callback',{processor:'function'});registerOption('allow_conditional_comments',{processor:'boolean',"default":false});registerOption('allow_html_data_urls',{processor:'boolean',"default":false});registerOption('allow_svg_data_urls',{processor:'boolean'});registerOption('allow_html_in_named_anchor',{processor:'boolean',"default":false});registerOption('allow_script_urls',{processor:'boolean',"default":false});registerOption('allow_unsafe_link_target',{processor:'boolean',"default":false});registerOption('convert_fonts_to_spans',{processor:'boolean',"default":true,deprecated:true});registerOption('fix_list_elements',{processor:'boolean',"default":false});registerOption('preserve_cdata',{processor:'boolean',"default":false});registerOption('remove_trailing_brs',{processor:'boolean'});registerOption('inline_styles',{processor:'boolean',"default":true,deprecated:true});registerOption('element_format',{processor:'string',"default":'html'});registerOption('entities',{processor:'string'});registerOption('schema',{processor:'string',"default":'html5'});registerOption('convert_urls',{processor:'boolean',"default":true});registerOption('relative_urls',{processor:'boolean',"default":true});registerOption('remove_script_host',{processor:'boolean',"default":true});registerOption('custom_elements',{processor:'string'});registerOption('extended_valid_elements',{processor:'string'});registerOption('invalid_elements',{processor:'string'});registerOption('invalid_styles',{processor:stringOrObjectProcessor});registerOption('valid_children',{processor:'string'});registerOption('valid_classes',{processor:stringOrObjectProcessor});registerOption('valid_elements',{processor:'string'});registerOption('valid_styles',{processor:stringOrObjectProcessor});registerOption('verify_html',{processor:'boolean',"default":true});registerOption('auto_focus',{processor:function processor(value){return isString(value)||value===true;}});registerOption('browser_spellcheck',{processor:'boolean',"default":false});registerOption('protect',{processor:'array'});registerOption('images_file_types',{processor:'string',"default":'jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp'});registerOption('deprecation_warnings',{processor:'boolean',"default":true});registerOption('a11y_advanced_options',{processor:'boolean',"default":false});registerOption('api_key',{processor:'string'});registerOption('paste_block_drop',{processor:'boolean',"default":false});registerOption('paste_data_images',{processor:'boolean',"default":true});registerOption('paste_preprocess',{processor:'function'});registerOption('paste_postprocess',{processor:'function'});registerOption('paste_webkit_styles',{processor:'string',"default":'none'});registerOption('paste_remove_styles_if_webkit',{processor:'boolean',"default":true});registerOption('paste_merge_formats',{processor:'boolean',"default":true});registerOption('smart_paste',{processor:'boolean',"default":true});registerOption('paste_as_text',{processor:'boolean',"default":false});registerOption('paste_tab_spaces',{processor:'number',"default":4});registerOption('text_patterns',{processor:function processor(value){if(isArrayOf(value,isObject)||value===false){var patterns=value===false?[]:value;return{value:fromRawPatterns(patterns),valid:true};}else{return{valid:false,message:'Must be an array of objects or false.'};}},"default":[{start:'*',end:'*',format:'italic'},{start:'**',end:'**',format:'bold'},{start:'#',format:'h1'},{start:'##',format:'h2'},{start:'###',format:'h3'},{start:'####',format:'h4'},{start:'#####',format:'h5'},{start:'######',format:'h6'},{start:'1. ',cmd:'InsertOrderedList'},{start:'* ',cmd:'InsertUnorderedList'},{start:'- ',cmd:'InsertUnorderedList'}]});registerOption('noneditable_class',{processor:'string',"default":'mceNonEditable'});registerOption('editable_class',{processor:'string',"default":'mceEditable'});registerOption('noneditable_regexp',{processor:function processor(value){if(isArrayOf(value,isRegExp)){return{value:value,valid:true};}else if(isRegExp(value)){return{value:[value],valid:true};}else{return{valid:false,message:'Must be a RegExp or an array of RegExp.'};}},"default":[]});registerOption('table_tab_navigation',{processor:'boolean',"default":true});editor.on('ScriptsLoaded',function(){registerOption('directionality',{processor:'string',"default":I18n.isRtl()?'rtl':undefined});registerOption('placeholder',{processor:'string',"default":DOM$a.getAttrib(editor.getElement(),'placeholder')});});};var getIframeAttrs=option('iframe_attrs');var getDocType=option('doctype');var getDocumentBaseUrl=option('document_base_url');var getBodyId=option('body_id');var getBodyClass=option('body_class');var getContentSecurityPolicy=option('content_security_policy');var shouldPutBrInPre$1=option('br_in_pre');var getForcedRootBlock=option('forced_root_block');var getForcedRootBlockAttrs=option('forced_root_block_attrs');var getNewlineBehavior=option('newline_behavior');var getBrNewLineSelector=option('br_newline_selector');var getNoNewLineSelector=option('no_newline_selector');var shouldKeepStyles=option('keep_styles');var shouldEndContainerOnEmptyBlock=option('end_container_on_empty_block');var isAutomaticUploadsEnabled=option('automatic_uploads');var shouldReuseFileName=option('images_reuse_filename');var shouldReplaceBlobUris=option('images_replace_blob_uris');var getIconPackName=option('icons');var getIconsUrl=option('icons_url');var getImageUploadUrl=option('images_upload_url');var getImageUploadBasePath=option('images_upload_base_path');var getImagesUploadCredentials=option('images_upload_credentials');var getImagesUploadHandler=option('images_upload_handler');var shouldUseContentCssCors=option('content_css_cors');var getReferrerPolicy=option('referrer_policy');var getLanguageCode=option('language');var getLanguageUrl=option('language_url');var shouldIndentUseMargin=option('indent_use_margin');var getIndentation=option('indentation');var getContentCss=option('content_css');var getContentStyle=option('content_style');var getFontCss=option('font_css');var getDirectionality=option('directionality');var getInlineBoundarySelector=option('inline_boundaries_selector');var getObjectResizing=option('object_resizing');var getResizeImgProportional=option('resize_img_proportional');var getPlaceholder=option('placeholder');var getEventRoot=option('event_root');var getServiceMessage=option('service_message');var getTheme=option('theme');var getThemeUrl=option('theme_url');var getModel=option('model');var getModelUrl=option('model_url');var isInlineBoundariesEnabled=option('inline_boundaries');var getFormats=option('formats');var getPreviewStyles=option('preview_styles');var canFormatEmptyLines=option('format_empty_lines');var getCustomUiSelector=option('custom_ui_selector');var isInline=option('inline');var hasHiddenInput=option('hidden_input');var shouldPatchSubmit=option('submit_patch');var shouldAddFormSubmitTrigger=option('add_form_submit_trigger');var shouldAddUnloadTrigger=option('add_unload_trigger');var getCustomUndoRedoLevels=option('custom_undo_redo_levels');var shouldDisableNodeChange=option('disable_nodechange');var isReadOnly$1=option('readonly');var hasContentCssCors=option('content_css_cors');var getPlugins=option('plugins');var getExternalPlugins$1=option('external_plugins');var shouldBlockUnsupportedDrop=option('block_unsupported_drop');var isVisualAidsEnabled=option('visual');var getVisualAidsTableClass=option('visual_table_class');var getVisualAidsAnchorClass=option('visual_anchor_class');var getIframeAriaText=option('iframe_aria_text');var getSetupCallback=option('setup');var getInitInstanceCallback=option('init_instance_callback');var getUrlConverterCallback=option('urlconverter_callback');var getAutoFocus=option('auto_focus');var shouldBrowserSpellcheck=option('browser_spellcheck');var getProtect=option('protect');var shouldPasteBlockDrop=option('paste_block_drop');var shouldPasteDataImages=option('paste_data_images');var getPastePreProcess=option('paste_preprocess');var getPastePostProcess=option('paste_postprocess');var getPasteWebkitStyles=option('paste_webkit_styles');var shouldPasteRemoveWebKitStyles=option('paste_remove_styles_if_webkit');var shouldPasteMergeFormats=option('paste_merge_formats');var isSmartPasteEnabled=option('smart_paste');var isPasteAsTextEnabled=option('paste_as_text');var getPasteTabSpaces=option('paste_tab_spaces');var shouldAllowHtmlDataUrls=option('allow_html_data_urls');var getTextPatterns=option('text_patterns');var getNonEditableClass=option('noneditable_class');var getEditableClass=option('editable_class');var getNonEditableRegExps=option('noneditable_regexp');var getFontStyleValues=function getFontStyleValues(editor){return Tools.explode(editor.options.get('font_size_style_values'));};var getFontSizeClasses=function getFontSizeClasses(editor){return Tools.explode(editor.options.get('font_size_classes'));};var isEncodingXml=function isEncodingXml(editor){return editor.options.get('encoding')==='xml';};var getAllowedImageFileTypes=function getAllowedImageFileTypes(editor){return Tools.explode(editor.options.get('images_file_types'));};var hasTableTabNavigation=option('table_tab_navigation');var isElement$3=isElement$6;var isText$4=isText$9;var removeNode$1=function removeNode$1(node){var parentNode=node.parentNode;if(parentNode){parentNode.removeChild(node);}};var trimCount=function trimCount(text){var trimmedText=trim$1(text);return{count:text.length-trimmedText.length,text:trimmedText};};var deleteZwspChars=function deleteZwspChars(caretContainer){var idx;while((idx=caretContainer.data.lastIndexOf(ZWSP$1))!==-1){caretContainer.deleteData(idx,1);}};var removeUnchanged=function removeUnchanged(caretContainer,pos){remove$4(caretContainer);return pos;};var removeTextAndReposition=function removeTextAndReposition(caretContainer,pos){var before=trimCount(caretContainer.data.substr(0,pos.offset()));var after=trimCount(caretContainer.data.substr(pos.offset()));var text=before.text+after.text;if(text.length>0){deleteZwspChars(caretContainer);return CaretPosition(caretContainer,pos.offset()-before.count);}else{return pos;}};var removeElementAndReposition=function removeElementAndReposition(caretContainer,pos){var parentNode=pos.container();var newPosition=indexOf$1(from(parentNode.childNodes),caretContainer).map(function(index){return index<pos.offset()?CaretPosition(parentNode,pos.offset()-1):pos;}).getOr(pos);remove$4(caretContainer);return newPosition;};var removeTextCaretContainer=function removeTextCaretContainer(caretContainer,pos){return isText$4(caretContainer)&&pos.container()===caretContainer?removeTextAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos);};var removeElementCaretContainer=function removeElementCaretContainer(caretContainer,pos){return pos.container()===caretContainer.parentNode?removeElementAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos);};var removeAndReposition=function removeAndReposition(container,pos){return CaretPosition.isTextPosition(pos)?removeTextCaretContainer(container,pos):removeElementCaretContainer(container,pos);};var remove$4=function remove$4(caretContainerNode){if(isElement$3(caretContainerNode)&&isCaretContainer$2(caretContainerNode)){if(hasContent(caretContainerNode)){caretContainerNode.removeAttribute('data-mce-caret');}else{removeNode$1(caretContainerNode);}}if(isText$4(caretContainerNode)){deleteZwspChars(caretContainerNode);if(caretContainerNode.data.length===0){removeNode$1(caretContainerNode);}}};var isContentEditableFalse$8=isContentEditableFalse$b;var isMedia$1=isMedia$2;var isTableCell$3=isTableCell$5;var inlineFakeCaretSelector='*[contentEditable=false],video,audio,embed,object';var getAbsoluteClientRect=function getAbsoluteClientRect(root,element,before){var clientRect=collapse(element.getBoundingClientRect(),before);var scrollX;var scrollY;if(root.tagName==='BODY'){var docElm=root.ownerDocument.documentElement;scrollX=root.scrollLeft||docElm.scrollLeft;scrollY=root.scrollTop||docElm.scrollTop;}else{var rootRect=root.getBoundingClientRect();scrollX=root.scrollLeft-rootRect.left;scrollY=root.scrollTop-rootRect.top;}clientRect.left+=scrollX;clientRect.right+=scrollX;clientRect.top+=scrollY;clientRect.bottom+=scrollY;clientRect.width=1;var margin=element.offsetWidth-element.clientWidth;if(margin>0){if(before){margin*=-1;}clientRect.left+=margin;clientRect.right+=margin;}return clientRect;};var trimInlineCaretContainers=function trimInlineCaretContainers(root){var fakeCaretTargetNodes=descendants(SugarElement.fromDom(root),inlineFakeCaretSelector);for(var i=0;i<fakeCaretTargetNodes.length;i++){var node=fakeCaretTargetNodes[i].dom;var _sibling3=node.previousSibling;if(endsWithCaretContainer$1(_sibling3)){var _data=_sibling3.data;if(_data.length===1){_sibling3.parentNode.removeChild(_sibling3);}else{_sibling3.deleteData(_data.length-1,1);}}_sibling3=node.nextSibling;if(startsWithCaretContainer$1(_sibling3)){var _data2=_sibling3.data;if(_data2.length===1){_sibling3.parentNode.removeChild(_sibling3);}else{_sibling3.deleteData(0,1);}}}};var FakeCaret=function FakeCaret(editor,root,isBlock,hasFocus){var lastVisualCaret=value$2();var cursorInterval;var caretContainerNode;var caretBlock=getForcedRootBlock(editor);var dom=editor.dom;var show=function show(before,element){var rng;hide();if(isTableCell$3(element)){return null;}if(isBlock(element)){caretContainerNode=insertBlock(caretBlock,element,before);var clientRect=getAbsoluteClientRect(root,element,before);dom.setStyle(caretContainerNode,'top',clientRect.top);var caret=dom.create('div',{'class':'mce-visual-caret','data-mce-bogus':'all'});dom.setStyles(caret,_objectSpread({},clientRect));dom.add(root,caret);lastVisualCaret.set({caret:caret,element:element,before:before});if(before){dom.addClass(caret,'mce-visual-caret-before');}startBlink();rng=element.ownerDocument.createRange();rng.setStart(caretContainerNode,0);rng.setEnd(caretContainerNode,0);}else{caretContainerNode=insertInline$1(element,before);rng=element.ownerDocument.createRange();if(isInlineFakeCaretTarget(caretContainerNode.nextSibling)){rng.setStart(caretContainerNode,0);rng.setEnd(caretContainerNode,0);}else{rng.setStart(caretContainerNode,1);rng.setEnd(caretContainerNode,1);}return rng;}return rng;};var hide=function hide(){trimInlineCaretContainers(root);if(caretContainerNode){remove$4(caretContainerNode);caretContainerNode=null;}lastVisualCaret.on(function(caretState){dom.remove(caretState.caret);lastVisualCaret.clear();});if(cursorInterval){clearInterval(cursorInterval);cursorInterval=undefined;}};var startBlink=function startBlink(){cursorInterval=setInterval(function(){lastVisualCaret.on(function(caretState){if(hasFocus()){dom.toggleClass(caretState.caret,'mce-visual-caret-hidden');}else{dom.addClass(caretState.caret,'mce-visual-caret-hidden');}});},500);};var reposition=function reposition(){lastVisualCaret.on(function(caretState){var clientRect=getAbsoluteClientRect(root,caretState.element,caretState.before);dom.setStyles(caretState.caret,_objectSpread({},clientRect));});};var destroy=function destroy(){return clearInterval(cursorInterval);};var getCss=function getCss(){return'.mce-visual-caret {'+'position: absolute;'+'background-color: black;'+'background-color: currentcolor;'+'}'+'.mce-visual-caret-hidden {'+'display: none;'+'}'+'*[data-mce-caret] {'+'position: absolute;'+'left: -1000px;'+'right: auto;'+'top: 0;'+'margin: 0;'+'padding: 0;'+'}';};return{show:show,hide:hide,getCss:getCss,reposition:reposition,destroy:destroy};};var isFakeCaretTableBrowser=function isFakeCaretTableBrowser(){return Env.browser.isFirefox();};var isInlineFakeCaretTarget=function isInlineFakeCaretTarget(node){return isContentEditableFalse$8(node)||isMedia$1(node);};var isFakeCaretTarget=function isFakeCaretTarget(node){return isInlineFakeCaretTarget(node)||isTable$3(node)&&isFakeCaretTableBrowser();};var isContentEditableTrue$3=isContentEditableTrue$5;var isContentEditableFalse$7=isContentEditableFalse$b;var isMedia=isMedia$2;var isBlockLike=matchStyleValues('display','block table table-cell table-caption list-item');var isCaretContainer=isCaretContainer$2;var isCaretContainerBlock=isCaretContainerBlock$1;var isElement$2=isElement$6;var isCaretCandidate$1=isCaretCandidate$3;var isForwards=function isForwards(direction){return direction>0;};var isBackwards=function isBackwards(direction){return direction<0;};var skipCaretContainers=function skipCaretContainers(walk,shallow){var node;while(node=walk(shallow)){if(!isCaretContainerBlock(node)){return node;}}return null;};var findNode=function findNode(node,direction,predicateFn,rootNode,shallow){var walker=new DomTreeWalker(node,rootNode);var isCefOrCaretContainer=isContentEditableFalse$7(node)||isCaretContainerBlock(node);if(isBackwards(direction)){if(isCefOrCaretContainer){node=skipCaretContainers(walker.prev.bind(walker),true);if(predicateFn(node)){return node;}}while(node=skipCaretContainers(walker.prev.bind(walker),shallow)){if(predicateFn(node)){return node;}}}if(isForwards(direction)){if(isCefOrCaretContainer){node=skipCaretContainers(walker.next.bind(walker),true);if(predicateFn(node)){return node;}}while(node=skipCaretContainers(walker.next.bind(walker),shallow)){if(predicateFn(node)){return node;}}}return null;};var getEditingHost=function getEditingHost(node,rootNode){var isCETrue=function isCETrue(node){return isContentEditableTrue$3(node.dom);};var isRoot=function isRoot(node){return node.dom===rootNode;};return ancestor$3(SugarElement.fromDom(node),isCETrue,isRoot).map(function(elm){return elm.dom;}).getOr(rootNode);};var getParentBlock$3=function getParentBlock$3(node,rootNode){while(node&&node!==rootNode){if(isBlockLike(node)){return node;}node=node.parentNode;}return null;};var isInSameBlock=function isInSameBlock(caretPosition1,caretPosition2,rootNode){return getParentBlock$3(caretPosition1.container(),rootNode)===getParentBlock$3(caretPosition2.container(),rootNode);};var getChildNodeAtRelativeOffset=function getChildNodeAtRelativeOffset(relativeOffset,caretPosition){if(!caretPosition){return null;}var container=caretPosition.container();var offset=caretPosition.offset();if(!isElement$2(container)){return null;}return container.childNodes[offset+relativeOffset];};var beforeAfter=function beforeAfter(before,node){var range=node.ownerDocument.createRange();if(before){range.setStartBefore(node);range.setEndBefore(node);}else{range.setStartAfter(node);range.setEndAfter(node);}return range;};var isNodesInSameBlock=function isNodesInSameBlock(root,node1,node2){return getParentBlock$3(node1,root)===getParentBlock$3(node2,root);};var lean=function lean(left,root,node){var siblingName=left?'previousSibling':'nextSibling';while(node&&node!==root){var _sibling4=node[siblingName];if(isCaretContainer(_sibling4)){_sibling4=_sibling4[siblingName];}if(isContentEditableFalse$7(_sibling4)||isMedia(_sibling4)){if(isNodesInSameBlock(root,_sibling4,node)){return _sibling4;}break;}if(isCaretCandidate$1(_sibling4)){break;}node=node.parentNode;}return null;};var before$2=curry(beforeAfter,true);var after$2=curry(beforeAfter,false);var normalizeRange=function normalizeRange(direction,root,range){var node;var leanLeft=curry(lean,true,root);var leanRight=curry(lean,false,root);var container=range.startContainer;var offset=range.startOffset;if(isCaretContainerBlock$1(container)){if(!isElement$2(container)){container=container.parentNode;}var location=container.getAttribute('data-mce-caret');if(location==='before'){node=container.nextSibling;if(isFakeCaretTarget(node)){return before$2(node);}}if(location==='after'){node=container.previousSibling;if(isFakeCaretTarget(node)){return after$2(node);}}}if(!range.collapsed){return range;}if(isText$9(container)){if(isCaretContainer(container)){if(direction===1){node=leanRight(container);if(node){return before$2(node);}node=leanLeft(container);if(node){return after$2(node);}}if(direction===-1){node=leanLeft(container);if(node){return after$2(node);}node=leanRight(container);if(node){return before$2(node);}}return range;}if(endsWithCaretContainer$1(container)&&offset>=container.data.length-1){if(direction===1){node=leanRight(container);if(node){return before$2(node);}}return range;}if(startsWithCaretContainer$1(container)&&offset<=1){if(direction===-1){node=leanLeft(container);if(node){return after$2(node);}}return range;}if(offset===container.data.length){node=leanRight(container);if(node){return before$2(node);}return range;}if(offset===0){node=leanLeft(container);if(node){return after$2(node);}return range;}}return range;};var getRelativeCefElm=function getRelativeCefElm(forward,caretPosition){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,caretPosition)).filter(isContentEditableFalse$7);};var getNormalizedRangeEndPoint=function getNormalizedRangeEndPoint(direction,root,range){var normalizedRange=normalizeRange(direction,root,range);if(direction===-1){return CaretPosition.fromRangeStart(normalizedRange);}return CaretPosition.fromRangeEnd(normalizedRange);};var getElementFromPosition=function getElementFromPosition(pos){return Optional.from(pos.getNode()).map(SugarElement.fromDom);};var getElementFromPrevPosition=function getElementFromPrevPosition(pos){return Optional.from(pos.getNode(true)).map(SugarElement.fromDom);};var getVisualCaretPosition=function getVisualCaretPosition(walkFn,caretPosition){while(caretPosition=walkFn(caretPosition)){if(caretPosition.isVisible()){return caretPosition;}}return caretPosition;};var isMoveInsideSameBlock=function isMoveInsideSameBlock(from,to){var inSameBlock=isInSameBlock(from,to);if(!inSameBlock&&isBr$6(from.getNode())){return true;}return inSameBlock;};var HDirection;(function(HDirection){HDirection[HDirection['Backwards']=-1]='Backwards';HDirection[HDirection['Forwards']=1]='Forwards';})(HDirection||(HDirection={}));var isContentEditableFalse$6=isContentEditableFalse$b;var isText$3=isText$9;var isElement$1=isElement$6;var isBr$2=isBr$6;var isCaretCandidate=isCaretCandidate$3;var isAtomic=isAtomic$1;var isEditableCaretCandidate=isEditableCaretCandidate$1;var getParents$3=function getParents$3(node,root){var parents=[];while(node&&node!==root){parents.push(node);node=node.parentNode;}return parents;};var nodeAtIndex=function nodeAtIndex(container,offset){if(container.hasChildNodes()&&offset<container.childNodes.length){return container.childNodes[offset];}return null;};var getCaretCandidatePosition=function getCaretCandidatePosition(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText$3(node.previousSibling)){return CaretPosition.before(node);}if(isText$3(node)){return CaretPosition(node,0);}}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText$3(node.nextSibling)){return CaretPosition.after(node);}if(isText$3(node)){return CaretPosition(node,node.data.length);}}if(isBackwards(direction)){if(isBr$2(node)){return CaretPosition.before(node);}return CaretPosition.after(node);}return CaretPosition.before(node);};var moveForwardFromBr=function moveForwardFromBr(root,nextNode){var nextSibling=nextNode.nextSibling;if(nextSibling&&isCaretCandidate(nextSibling)){if(isText$3(nextSibling)){return CaretPosition(nextSibling,0);}else{return CaretPosition.before(nextSibling);}}else{return findCaretPosition$1(HDirection.Forwards,CaretPosition.after(nextNode),root);}};var findCaretPosition$1=function findCaretPosition$1(direction,startPos,root){var node;var nextNode;var innerNode;var caretPosition;if(!isElement$1(root)||!startPos){return null;}if(startPos.isEqual(CaretPosition.after(root))&&root.lastChild){caretPosition=CaretPosition.after(root.lastChild);if(isBackwards(direction)&&isCaretCandidate(root.lastChild)&&isElement$1(root.lastChild)){return isBr$2(root.lastChild)?CaretPosition.before(root.lastChild):caretPosition;}}else{caretPosition=startPos;}var container=caretPosition.container();var offset=caretPosition.offset();if(isText$3(container)){if(isBackwards(direction)&&offset>0){return CaretPosition(container,--offset);}if(isForwards(direction)&&offset<container.length){return CaretPosition(container,++offset);}node=container;}else{if(isBackwards(direction)&&offset>0){nextNode=nodeAtIndex(container,offset-1);if(isCaretCandidate(nextNode)){if(!isAtomic(nextNode)){innerNode=findNode(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText$3(innerNode)){return CaretPosition(innerNode,innerNode.data.length);}return CaretPosition.after(innerNode);}}if(isText$3(nextNode)){return CaretPosition(nextNode,nextNode.data.length);}return CaretPosition.before(nextNode);}}if(isForwards(direction)&&offset<container.childNodes.length){nextNode=nodeAtIndex(container,offset);if(isCaretCandidate(nextNode)){if(isBr$2(nextNode)){return moveForwardFromBr(root,nextNode);}if(!isAtomic(nextNode)){innerNode=findNode(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText$3(innerNode)){return CaretPosition(innerNode,0);}return CaretPosition.before(innerNode);}}if(isText$3(nextNode)){return CaretPosition(nextNode,0);}return CaretPosition.after(nextNode);}}node=nextNode?nextNode:caretPosition.getNode();}if(isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart()){node=findNode(node,direction,always,root,true);if(isEditableCaretCandidate(node,root)){return getCaretCandidatePosition(direction,node);}}nextNode=findNode(node,direction,isEditableCaretCandidate,root);var rootContentEditableFalseElm=last$2(filter$6(getParents$3(container,root),isContentEditableFalse$6));if(rootContentEditableFalseElm&&(!nextNode||!rootContentEditableFalseElm.contains(nextNode))){if(isForwards(direction)){caretPosition=CaretPosition.after(rootContentEditableFalseElm);}else{caretPosition=CaretPosition.before(rootContentEditableFalseElm);}return caretPosition;}if(nextNode){return getCaretCandidatePosition(direction,nextNode);}return null;};var CaretWalker=function CaretWalker(root){return{next:function next(caretPosition){return findCaretPosition$1(HDirection.Forwards,caretPosition,root);},prev:function prev(caretPosition){return findCaretPosition$1(HDirection.Backwards,caretPosition,root);}};};var walkToPositionIn=function walkToPositionIn(forward,root,start){var position=forward?CaretPosition.before(start):CaretPosition.after(start);return fromPosition(forward,root,position);};var afterElement=function afterElement(node){return isBr$6(node)?CaretPosition.before(node):CaretPosition.after(node);};var isBeforeOrStart=function isBeforeOrStart(position){if(CaretPosition.isTextPosition(position)){return position.offset()===0;}else{return isCaretCandidate$3(position.getNode());}};var isAfterOrEnd=function isAfterOrEnd(position){if(CaretPosition.isTextPosition(position)){var container=position.container();return position.offset()===container.data.length;}else{return isCaretCandidate$3(position.getNode(true));}};var isBeforeAfterSameElement=function isBeforeAfterSameElement(from,to){return!CaretPosition.isTextPosition(from)&&!CaretPosition.isTextPosition(to)&&from.getNode()===to.getNode(true);};var isAtBr=function isAtBr(position){return!CaretPosition.isTextPosition(position)&&isBr$6(position.getNode());};var shouldSkipPosition=function shouldSkipPosition(forward,from,to){if(forward){return!isBeforeAfterSameElement(from,to)&&!isAtBr(from)&&isAfterOrEnd(from)&&isBeforeOrStart(to);}else{return!isBeforeAfterSameElement(to,from)&&isBeforeOrStart(from)&&isAfterOrEnd(to);}};var fromPosition=function fromPosition(forward,root,pos){var walker=CaretWalker(root);return Optional.from(forward?walker.next(pos):walker.prev(pos));};var navigate=function navigate(forward,root,from){return fromPosition(forward,root,from).bind(function(to){if(isInSameBlock(from,to,root)&&shouldSkipPosition(forward,from,to)){return fromPosition(forward,root,to);}else{return Optional.some(to);}});};var navigateIgnore=function navigateIgnore(forward,root,from,ignoreFilter){return navigate(forward,root,from).bind(function(pos){return ignoreFilter(pos)?navigateIgnore(forward,root,pos,ignoreFilter):Optional.some(pos);});};var positionIn=function positionIn(forward,element){var startNode=forward?element.firstChild:element.lastChild;if(isText$9(startNode)){return Optional.some(CaretPosition(startNode,forward?0:startNode.data.length));}else if(startNode){if(isCaretCandidate$3(startNode)){return Optional.some(forward?CaretPosition.before(startNode):afterElement(startNode));}else{return walkToPositionIn(forward,element,startNode);}}else{return Optional.none();}};var nextPosition=curry(fromPosition,true);var prevPosition=curry(fromPosition,false);var firstPositionIn=curry(positionIn,true);var lastPositionIn=curry(positionIn,false);var CARET_ID$1='_mce_caret';var isCaretNode=function isCaretNode(node){return isElement$6(node)&&node.id===CARET_ID$1;};var getParentCaretContainer=function getParentCaretContainer(body,node){while(node&&node!==body){if(node.id===CARET_ID$1){return node;}node=node.parentNode;}return null;};var isStringPathBookmark=function isStringPathBookmark(bookmark){return isString(bookmark.start);};var isRangeBookmark=function isRangeBookmark(bookmark){return has$2(bookmark,'rng');};var isIdBookmark=function isIdBookmark(bookmark){return has$2(bookmark,'id');};var isIndexBookmark=function isIndexBookmark(bookmark){return has$2(bookmark,'name');};var isPathBookmark=function isPathBookmark(bookmark){return Tools.isArray(bookmark.start);};var isForwardBookmark=function isForwardBookmark(bookmark){return!isIndexBookmark(bookmark)&&isBoolean(bookmark.forward)?bookmark.forward:true;};var addBogus=function addBogus(dom,node){if(isElement$6(node)&&dom.isBlock(node)&&!node.innerHTML){node.innerHTML='<br data-mce-bogus="1" />';}return node;};var resolveCaretPositionBookmark=function resolveCaretPositionBookmark(dom,bookmark){var range=dom.createRng();var startPos=resolve$1(dom.getRoot(),bookmark.start);range.setStart(startPos.container(),startPos.offset());var endPos=resolve$1(dom.getRoot(),bookmark.end);range.setEnd(endPos.container(),endPos.offset());return{range:range,forward:isForwardBookmark(bookmark)};};var insertZwsp=function insertZwsp(node,rng){var textNode=node.ownerDocument.createTextNode(ZWSP$1);node.appendChild(textNode);rng.setStart(textNode,0);rng.setEnd(textNode,0);};var isEmpty$1=function isEmpty$1(node){return node.hasChildNodes()===false;};var tryFindRangePosition=function tryFindRangePosition(node,rng){return lastPositionIn(node).fold(never,function(pos){rng.setStart(pos.container(),pos.offset());rng.setEnd(pos.container(),pos.offset());return true;});};var padEmptyCaretContainer=function padEmptyCaretContainer(root,node,rng){if(isEmpty$1(node)&&getParentCaretContainer(root,node)){insertZwsp(node,rng);return true;}else{return false;}};var setEndPoint=function setEndPoint(dom,start,bookmark,rng){var point=bookmark[start?'start':'end'];var i,node,offset,children;var root=dom.getRoot();if(point){offset=point[0];for(node=root,i=point.length-1;i>=1;i--){children=node.childNodes;if(padEmptyCaretContainer(root,node,rng)){return true;}if(point[i]>children.length-1){if(padEmptyCaretContainer(root,node,rng)){return true;}return tryFindRangePosition(node,rng);}node=children[point[i]];}if(node.nodeType===3){offset=Math.min(point[0],node.nodeValue.length);}if(node.nodeType===1){offset=Math.min(point[0],node.childNodes.length);}if(start){rng.setStart(node,offset);}else{rng.setEnd(node,offset);}}return true;};var isValidTextNode=function isValidTextNode(node){return isText$9(node)&&node.data.length>0;};var restoreEndPoint=function restoreEndPoint(dom,suffix,bookmark){var marker=dom.get(bookmark.id+'_'+suffix),node,idx,next,prev;var keep=bookmark.keep;var container,offset;if(marker){node=marker.parentNode;if(suffix==='start'){if(!keep){idx=dom.nodeIndex(marker);}else{if(marker.hasChildNodes()){node=marker.firstChild;idx=1;}else if(isValidTextNode(marker.nextSibling)){node=marker.nextSibling;idx=0;}else if(isValidTextNode(marker.previousSibling)){node=marker.previousSibling;idx=marker.previousSibling.data.length;}else{node=marker.parentNode;idx=dom.nodeIndex(marker)+1;}}container=node;offset=idx;}else{if(!keep){idx=dom.nodeIndex(marker);}else{if(marker.hasChildNodes()){node=marker.firstChild;idx=1;}else if(isValidTextNode(marker.previousSibling)){node=marker.previousSibling;idx=marker.previousSibling.data.length;}else{node=marker.parentNode;idx=dom.nodeIndex(marker);}}container=node;offset=idx;}if(!keep){prev=marker.previousSibling;next=marker.nextSibling;Tools.each(Tools.grep(marker.childNodes),function(node){if(isText$9(node)){node.nodeValue=node.nodeValue.replace(/\uFEFF/g,'');}});while(marker=dom.get(bookmark.id+'_'+suffix)){dom.remove(marker,true);}if(prev&&next&&prev.nodeType===next.nodeType&&isText$9(prev)&&!Env.browser.isOpera()){idx=prev.nodeValue.length;prev.appendData(next.nodeValue);dom.remove(next);container=prev;offset=idx;}}return Optional.some(CaretPosition(container,offset));}else{return Optional.none();}};var resolvePaths=function resolvePaths(dom,bookmark){var range=dom.createRng();if(setEndPoint(dom,true,bookmark,range)&&setEndPoint(dom,false,bookmark,range)){return Optional.some({range:range,forward:isForwardBookmark(bookmark)});}else{return Optional.none();}};var resolveId=function resolveId(dom,bookmark){var startPos=restoreEndPoint(dom,'start',bookmark);var endPos=restoreEndPoint(dom,'end',bookmark);return lift2(startPos,endPos.or(startPos),function(spos,epos){var range=dom.createRng();range.setStart(addBogus(dom,spos.container()),spos.offset());range.setEnd(addBogus(dom,epos.container()),epos.offset());return{range:range,forward:isForwardBookmark(bookmark)};});};var resolveIndex=function resolveIndex(dom,bookmark){return Optional.from(dom.select(bookmark.name)[bookmark.index]).map(function(elm){var range=dom.createRng();range.selectNode(elm);return{range:range,forward:true};});};var resolve=function resolve(selection,bookmark){var dom=selection.dom;if(bookmark){if(isPathBookmark(bookmark)){return resolvePaths(dom,bookmark);}else if(isStringPathBookmark(bookmark)){return Optional.some(resolveCaretPositionBookmark(dom,bookmark));}else if(isIdBookmark(bookmark)){return resolveId(dom,bookmark);}else if(isIndexBookmark(bookmark)){return resolveIndex(dom,bookmark);}else if(isRangeBookmark(bookmark)){return Optional.some({range:bookmark.rng,forward:isForwardBookmark(bookmark)});}}return Optional.none();};var getBookmark$1=function getBookmark$1(selection,type,normalized){return getBookmark$2(selection,type,normalized);};var moveToBookmark=function moveToBookmark(selection,bookmark){resolve(selection,bookmark).each(function(_ref4){var range=_ref4.range,forward=_ref4.forward;selection.setRng(range,forward);});};var isBookmarkNode$1=function isBookmarkNode$1(node){return isElement$6(node)&&node.tagName==='SPAN'&&node.getAttribute('data-mce-type')==='bookmark';};var is=function is(expected){return function(actual){return expected===actual;};};var isNbsp=is(nbsp);var isWhiteSpace=function isWhiteSpace(chr){return chr!==''&&' \f\n\r\t\x0B'.indexOf(chr)!==-1;};var isContent=function isContent(chr){return!isWhiteSpace(chr)&&!isNbsp(chr)&&!isZwsp$1(chr);};var hexColour=function hexColour(value){return{value:value};};var toHex=function toHex(component){var hex=component.toString(16);return(hex.length===1?'0'+hex:hex).toUpperCase();};var fromRgba=function fromRgba(rgbaColour){var value=toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue);return hexColour(value);};var rgbRegex=/^\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i;var rgbaRegex=/^\s*rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?(?:\.\d+)?)\s*\)\s*$/i;var rgbaColour=function rgbaColour(red,green,blue,alpha){return{red:red,green:green,blue:blue,alpha:alpha};};var fromStringValues=function fromStringValues(red,green,blue,alpha){var r=parseInt(red,10);var g=parseInt(green,10);var b=parseInt(blue,10);var a=parseFloat(alpha);return rgbaColour(r,g,b,a);};var fromString=function fromString(rgbaString){if(rgbaString==='transparent'){return Optional.some(rgbaColour(0,0,0,0));}var rgbMatch=rgbRegex.exec(rgbaString);if(rgbMatch!==null){return Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],'1'));}var rgbaMatch=rgbaRegex.exec(rgbaString);if(rgbaMatch!==null){return Optional.some(fromStringValues(rgbaMatch[1],rgbaMatch[2],rgbaMatch[3],rgbaMatch[4]));}return Optional.none();};var rgbaToHexString=function rgbaToHexString(color){return fromString(color).map(fromRgba).map(function(h){return'#'+h.value;}).getOr(color);};var isNode=function isNode(node){return!!node.nodeType;};var isInlineBlock=function isInlineBlock(node){return node&&/^(IMG)$/.test(node.nodeName);};var moveStart=function moveStart(dom,selection,rng){var offset=rng.startOffset;var container=rng.startContainer;if(container===rng.endContainer){if(isInlineBlock(container.childNodes[offset])){return;}}if(isElement$6(container)){var nodes=container.childNodes;var walker;if(offset<nodes.length){container=nodes[offset];walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock));}else{container=nodes[nodes.length-1];walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock));walker.next(true);}for(var node=walker.current();node;node=walker.next()){if(isText$9(node)&&!isWhiteSpaceNode$1(node)){rng.setStart(node,0);selection.setRng(rng);return;}}}};var getNonWhiteSpaceSibling=function getNonWhiteSpaceSibling(node,next,inc){if(node){var nextName=next?'nextSibling':'previousSibling';for(node=inc?node:node[nextName];node;node=node[nextName]){if(isElement$6(node)||!isWhiteSpaceNode$1(node)){return node;}}}};var isTextBlock$1=function isTextBlock$1(editor,name){if(isNode(name)){name=name.nodeName;}return!!editor.schema.getTextBlockElements()[name.toLowerCase()];};var isValid=function isValid(ed,parent,child){return ed.schema.isValidChild(parent,child);};var isWhiteSpaceNode$1=function isWhiteSpaceNode$1(node){var allowSpaces=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(isNonNullable(node)&&isText$9(node)){var _data3=allowSpaces?node.data.replace(/ /g,'\xA0'):node.data;return isWhitespaceText(_data3);}else{return false;}};var isEmptyTextNode$1=function isEmptyTextNode$1(node){return isNonNullable(node)&&isText$9(node)&&node.length===0;};var replaceVars=function replaceVars(value,vars){if(isFunction(value)){value=value(vars);}else if(isNonNullable(vars)){value=value.replace(/%(\w+)/g,function(str,name){return vars[name]||str;});}return value;};var isEq$5=function isEq$5(str1,str2){str1=str1||'';str2=str2||'';str1=''+(str1.nodeName||str1);str2=''+(str2.nodeName||str2);return str1.toLowerCase()===str2.toLowerCase();};var normalizeStyleValue=function normalizeStyleValue(value,name){if(name==='color'||name==='backgroundColor'){value=rgbaToHexString(value);}if(name==='fontWeight'&&value===700){value='bold';}if(name==='fontFamily'){value=value.replace(/[\'\"]/g,'').replace(/,\s+/g,',');}return''+value;};var getStyle=function getStyle(dom,node,name){return normalizeStyleValue(dom.getStyle(node,name),name);};var getTextDecoration=function getTextDecoration(dom,node){var decoration;dom.getParent(node,function(n){decoration=dom.getStyle(n,'text-decoration');return decoration&&decoration!=='none';});return decoration;};var getParents$2=function getParents$2(dom,node,selector){return dom.getParents(node,selector,dom.getRoot());};var isVariableFormatName=function isVariableFormatName(editor,formatName){var hasVariableValues=function hasVariableValues(format){var isVariableValue=function isVariableValue(val){return val.length>1&&val.charAt(0)==='%';};return exists(['styles','attributes'],function(key){return get$a(format,key).exists(function(field){var fieldValues=isArray$1(field)?field:values(field);return exists(fieldValues,isVariableValue);});});};return exists(editor.formatter.get(formatName),hasVariableValues);};var areSimilarFormats=function areSimilarFormats(editor,formatName,otherFormatName){var validKeys=['inline','block','selector','attributes','styles','classes'];var filterObj=function filterObj(format){return filter$5(format,function(_,key){return exists(validKeys,function(validKey){return validKey===key;});});};return exists(editor.formatter.get(formatName),function(fmt1){var filteredFmt1=filterObj(fmt1);return exists(editor.formatter.get(otherFormatName),function(fmt2){var filteredFmt2=filterObj(fmt2);return equal$1(filteredFmt1,filteredFmt2);});});};var isBlockFormat=function isBlockFormat(format){return hasNonNullableKey(format,'block');};var isSelectorFormat=function isSelectorFormat(format){return hasNonNullableKey(format,'selector');};var isInlineFormat=function isInlineFormat(format){return hasNonNullableKey(format,'inline');};var isMixedFormat=function isMixedFormat(format){return isSelectorFormat(format)&&isInlineFormat(format)&&is$2(get$a(format,'mixed'),true);};var shouldExpandToSelector=function shouldExpandToSelector(format){return isSelectorFormat(format)&&format.expand!==false&&!isInlineFormat(format);};var isBookmarkNode=isBookmarkNode$1;var getParents$1=getParents$2;var isWhiteSpaceNode=isWhiteSpaceNode$1;var isTextBlock=isTextBlock$1;var isBogusBr=function isBogusBr(node){return isBr$6(node)&&node.getAttribute('data-mce-bogus')&&!node.nextSibling;};var findParentContentEditable=function findParentContentEditable(dom,node){var parent=node;while(parent){if(isElement$6(parent)&&dom.getContentEditable(parent)){return dom.getContentEditable(parent)==='false'?parent:node;}parent=parent.parentNode;}return node;};var walkText=function walkText(start,node,offset,predicate){var str=node.data;for(var i=offset;start?i>=0:i<str.length;start?i--:i++){if(predicate(str.charAt(i))){return start?i+1:i;}}return-1;};var findSpace=function findSpace(start,node,offset){return walkText(start,node,offset,function(c){return isNbsp(c)||isWhiteSpace(c);});};var findContent=function findContent(start,node,offset){return walkText(start,node,offset,isContent);};var findWordEndPoint=function findWordEndPoint(dom,body,container,offset,start,includeTrailingSpaces){var lastTextNode;var rootNode=dom.getParent(container,dom.isBlock)||body;var walk=function walk(container,offset,pred){var textSeeker=TextSeeker(dom);var walker=start?textSeeker.backwards:textSeeker.forwards;return Optional.from(walker(container,offset,function(text,textOffset){if(isBookmarkNode(text.parentNode)){return-1;}else{lastTextNode=text;return pred(start,text,textOffset);}},rootNode));};var spaceResult=walk(container,offset,findSpace);return spaceResult.bind(function(result){return includeTrailingSpaces?walk(result.container,result.offset+(start?-1:0),findContent):Optional.some(result);}).orThunk(function(){return lastTextNode?Optional.some({container:lastTextNode,offset:start?0:lastTextNode.length}):Optional.none();});};var findSelectorEndPoint=function findSelectorEndPoint(dom,formatList,rng,container,siblingName){if(isText$9(container)&&isEmpty$3(container.data)&&container[siblingName]){container=container[siblingName];}var parents=getParents$1(dom,container);for(var i=0;i<parents.length;i++){for(var y=0;y<formatList.length;y++){var curFormat=formatList[y];if(isNonNullable(curFormat.collapsed)&&curFormat.collapsed!==rng.collapsed){continue;}if(isSelectorFormat(curFormat)&&dom.is(parents[i],curFormat.selector)){return parents[i];}}}return container;};var findBlockEndPoint=function findBlockEndPoint(editor,formatList,container,siblingName){var node=container;var dom=editor.dom;var root=dom.getRoot();var format=formatList[0];if(isBlockFormat(format)){node=format.wrapper?null:dom.getParent(container,format.block,root);}if(!node){var scopeRoot=dom.getParent(container,'LI,TD,TH');node=dom.getParent(isText$9(container)?container.parentNode:container,function(node){return node!==root&&isTextBlock(editor,node);},scopeRoot);}if(node&&isBlockFormat(format)&&format.wrapper){node=getParents$1(dom,node,'ul,ol').reverse()[0]||node;}if(!node){node=container;while(node[siblingName]&&!dom.isBlock(node[siblingName])){node=node[siblingName];if(isEq$5(node,'br')){break;}}}return node||container;};var isAtBlockBoundary$1=function isAtBlockBoundary$1(dom,root,container,siblingName){var parent=container.parentNode;if(isNonNullable(container[siblingName])){return false;}else if(parent===root||isNullable(parent)||dom.isBlock(parent)){return true;}else{return isAtBlockBoundary$1(dom,root,parent,siblingName);}};var findParentContainer=function findParentContainer(dom,formatList,container,offset,start){var parent=container;var siblingName=start?'previousSibling':'nextSibling';var root=dom.getRoot();if(isText$9(container)&&!isWhiteSpaceNode(container)){if(start?offset>0:offset<container.data.length){return container;}}while(true){if(!formatList[0].block_expand&&dom.isBlock(parent)){return parent;}for(var _sibling5=parent[siblingName];_sibling5;_sibling5=_sibling5[siblingName]){var allowSpaces=isText$9(_sibling5)&&!isAtBlockBoundary$1(dom,root,_sibling5,siblingName);if(!isBookmarkNode(_sibling5)&&!isBogusBr(_sibling5)&&!isWhiteSpaceNode(_sibling5,allowSpaces)){return parent;}}if(parent===root||parent.parentNode===root){container=parent;break;}parent=parent.parentNode;}return container;};var isSelfOrParentBookmark=function isSelfOrParentBookmark(container){return isBookmarkNode(container.parentNode)||isBookmarkNode(container);};var expandRng=function expandRng(editor,rng,formatList){var includeTrailingSpace=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;var dom=editor.dom;var format=formatList[0];if(isElement$6(startContainer)&&startContainer.hasChildNodes()){startContainer=getNode$1(startContainer,startOffset);if(isText$9(startContainer)){startOffset=0;}}if(isElement$6(endContainer)&&endContainer.hasChildNodes()){endContainer=getNode$1(endContainer,rng.collapsed?endOffset:endOffset-1);if(isText$9(endContainer)){endOffset=endContainer.nodeValue.length;}}startContainer=findParentContentEditable(dom,startContainer);endContainer=findParentContentEditable(dom,endContainer);if(isSelfOrParentBookmark(startContainer)){startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode;if(rng.collapsed){startContainer=startContainer.previousSibling||startContainer;}else{startContainer=startContainer.nextSibling||startContainer;}if(isText$9(startContainer)){startOffset=rng.collapsed?startContainer.length:0;}}if(isSelfOrParentBookmark(endContainer)){endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode;if(rng.collapsed){endContainer=endContainer.nextSibling||endContainer;}else{endContainer=endContainer.previousSibling||endContainer;}if(isText$9(endContainer)){endOffset=rng.collapsed?0:endContainer.length;}}if(rng.collapsed){var startPoint=findWordEndPoint(dom,editor.getBody(),startContainer,startOffset,true,includeTrailingSpace);startPoint.each(function(_ref5){var container=_ref5.container,offset=_ref5.offset;startContainer=container;startOffset=offset;});var endPoint=findWordEndPoint(dom,editor.getBody(),endContainer,endOffset,false,includeTrailingSpace);endPoint.each(function(_ref6){var container=_ref6.container,offset=_ref6.offset;endContainer=container;endOffset=offset;});}if(isInlineFormat(format)||format.block_expand){if(!isInlineFormat(format)||!isText$9(startContainer)||startOffset===0){startContainer=findParentContainer(dom,formatList,startContainer,startOffset,true);}if(!isInlineFormat(format)||!isText$9(endContainer)||endOffset===endContainer.nodeValue.length){endContainer=findParentContainer(dom,formatList,endContainer,endOffset,false);}}if(shouldExpandToSelector(format)){startContainer=findSelectorEndPoint(dom,formatList,rng,startContainer,'previousSibling');endContainer=findSelectorEndPoint(dom,formatList,rng,endContainer,'nextSibling');}if(isBlockFormat(format)||isSelectorFormat(format)){startContainer=findBlockEndPoint(editor,formatList,startContainer,'previousSibling');endContainer=findBlockEndPoint(editor,formatList,endContainer,'nextSibling');if(isBlockFormat(format)){if(!dom.isBlock(startContainer)){startContainer=findParentContainer(dom,formatList,startContainer,startOffset,true);}if(!dom.isBlock(endContainer)){endContainer=findParentContainer(dom,formatList,endContainer,endOffset,false);}}}if(isElement$6(startContainer)){startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode;}if(isElement$6(endContainer)){endOffset=dom.nodeIndex(endContainer)+1;endContainer=endContainer.parentNode;}return{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset};};var walk$3=function walk$3(dom,rng,callback){var startOffset=rng.startOffset;var startContainer=getNode$1(rng.startContainer,startOffset);var endOffset=rng.endOffset;var endContainer=getNode$1(rng.endContainer,endOffset-1);var exclude=function exclude(nodes){var firstNode=nodes[0];if(isText$9(firstNode)&&firstNode===startContainer&&startOffset>=firstNode.data.length){nodes.splice(0,1);}var lastNode=nodes[nodes.length-1];if(endOffset===0&&nodes.length>0&&lastNode===endContainer&&isText$9(lastNode)){nodes.splice(nodes.length-1,1);}return nodes;};var collectSiblings=function collectSiblings(node,name,endNode){var siblings=[];for(;node&&node!==endNode;node=node[name]){siblings.push(node);}return siblings;};var findEndPoint=function findEndPoint(node,root){return dom.getParent(node,function(node){return node.parentNode===root;},root);};var walkBoundary=function walkBoundary(startNode,endNode,next){var siblingName=next?'nextSibling':'previousSibling';for(var node=startNode,_parent=node.parentNode;node&&node!==endNode;node=_parent){_parent=node.parentNode;var _siblings=collectSiblings(node===startNode?node:node[siblingName],siblingName);if(_siblings.length){if(!next){_siblings.reverse();}callback(exclude(_siblings));}}};if(startContainer===endContainer){return callback(exclude([startContainer]));}var ancestor=dom.findCommonAncestor(startContainer,endContainer);if(dom.isChildOf(startContainer,endContainer)){return walkBoundary(startContainer,ancestor,true);}if(dom.isChildOf(endContainer,startContainer)){return walkBoundary(endContainer,ancestor);}var startPoint=findEndPoint(startContainer,ancestor)||startContainer;var endPoint=findEndPoint(endContainer,ancestor)||endContainer;walkBoundary(startContainer,startPoint,true);var siblings=collectSiblings(startPoint===startContainer?startPoint:startPoint.nextSibling,'nextSibling',endPoint===endContainer?endPoint.nextSibling:endPoint);if(siblings.length){callback(exclude(siblings));}walkBoundary(endContainer,endPoint);};var getRanges$1=function getRanges$1(selection){var ranges=[];if(selection){for(var i=0;i<selection.rangeCount;i++){ranges.push(selection.getRangeAt(i));}}return ranges;};var getSelectedNodes=function getSelectedNodes(ranges){return bind$3(ranges,function(range){var node=getSelectedNode(range);return node?[SugarElement.fromDom(node)]:[];});};var hasMultipleRanges=function hasMultipleRanges(selection){return getRanges$1(selection).length>1;};var getCellsFromRanges=function getCellsFromRanges(ranges){return filter$6(getSelectedNodes(ranges),isTableCell$4);};var getCellsFromElement=function getCellsFromElement(elm){return descendants(elm,'td[data-mce-selected],th[data-mce-selected]');};var getCellsFromElementOrRanges=function getCellsFromElementOrRanges(ranges,element){var selectedCells=getCellsFromElement(element);return selectedCells.length>0?selectedCells:getCellsFromRanges(ranges);};var getCellsFromEditor=function getCellsFromEditor(editor){return getCellsFromElementOrRanges(getRanges$1(editor.selection.getSel()),SugarElement.fromDom(editor.getBody()));};var getClosestTable=function getClosestTable(cell,isRoot){return ancestor$2(cell,'table',isRoot);};var getStartNode=function getStartNode(rng){var sc=rng.startContainer,so=rng.startOffset;if(isText$9(sc)){return so===0?Optional.some(SugarElement.fromDom(sc)):Optional.none();}else{return Optional.from(sc.childNodes[so]).map(SugarElement.fromDom);}};var getEndNode=function getEndNode(rng){var ec=rng.endContainer,eo=rng.endOffset;if(isText$9(ec)){return eo===ec.data.length?Optional.some(SugarElement.fromDom(ec)):Optional.none();}else{return Optional.from(ec.childNodes[eo-1]).map(SugarElement.fromDom);}};var getFirstChildren=function getFirstChildren(node){return firstChild(node).fold(constant([node]),function(child){return[node].concat(getFirstChildren(child));});};var getLastChildren=function getLastChildren(node){return lastChild(node).fold(constant([node]),function(child){if(name(child)==='br'){return prevSibling(child).map(function(sibling){return[node].concat(getLastChildren(sibling));}).getOr([]);}else{return[node].concat(getLastChildren(child));}});};var hasAllContentsSelected=function hasAllContentsSelected(elm,rng){return lift2(getStartNode(rng),getEndNode(rng),function(startNode,endNode){var start=find$2(getFirstChildren(elm),curry(eq,startNode));var end=find$2(getLastChildren(elm),curry(eq,endNode));return start.isSome()&&end.isSome();}).getOr(false);};var moveEndPoint=function moveEndPoint(dom,rng,node,start){var root=node,walker=new DomTreeWalker(node,root);var moveCaretBeforeOnEnterElementsMap=filter$5(dom.schema.getMoveCaretBeforeOnEnterElements(),function(_,name){return!contains$2(['td','th','table'],name.toLowerCase());});do{if(isText$9(node)&&Tools.trim(node.nodeValue).length!==0){if(start){rng.setStart(node,0);}else{rng.setEnd(node,node.nodeValue.length);}return;}if(moveCaretBeforeOnEnterElementsMap[node.nodeName]){if(start){rng.setStartBefore(node);}else{if(node.nodeName==='BR'){rng.setEndBefore(node);}else{rng.setEndAfter(node);}}return;}}while(node=start?walker.next():walker.prev());if(root.nodeName==='BODY'){if(start){rng.setStart(root,0);}else{rng.setEnd(root,root.childNodes.length);}}};var hasAnyRanges=function hasAnyRanges(editor){var sel=editor.selection.getSel();return sel&&sel.rangeCount>0;};var runOnRanges=function runOnRanges(editor,executor){var fakeSelectionNodes=getCellsFromEditor(editor);if(fakeSelectionNodes.length>0){each$f(fakeSelectionNodes,function(elem){var node=elem.dom;var fakeNodeRng=editor.dom.createRng();fakeNodeRng.setStartBefore(node);fakeNodeRng.setEndAfter(node);executor(fakeNodeRng,true);});}else{executor(editor.selection.getRng(),false);}};var preserve=function preserve(selection,fillBookmark,executor){var bookmark=getPersistentBookmark(selection,fillBookmark);executor(bookmark);selection.moveToBookmark(bookmark);};var validBlocks=['pre[class*=language-][contenteditable="false"]','figure.image','div[data-ephox-embed-iri]','div.tiny-pageembed','div.mce-toc','div[data-mce-toc]'];var isZeroWidth=function isZeroWidth(elem){return isText$a(elem)&&get$3(elem)===ZWSP$1;};var context=function context(editor,elem,wrapName,nodeName){return parent(elem).fold(function(){return'skipping';},function(parent){if(nodeName==='br'||isZeroWidth(elem)){return'valid';}else if(isAnnotation(elem)){return'existing';}else if(isCaretNode(elem.dom)){return'caret';}else if(exists(validBlocks,function(selector){return is$1(elem,selector);})){return'valid-block';}else if(!isValid(editor,wrapName,nodeName)||!isValid(editor,name(parent),wrapName)){return'invalid-child';}else{return'valid';}});};var applyWordGrab=function applyWordGrab(editor,rng){var r=expandRng(editor,rng,[{inline:'span'}]);rng.setStart(r.startContainer,r.startOffset);rng.setEnd(r.endContainer,r.endOffset);editor.selection.setRng(rng);};var applyAnnotation=function applyAnnotation(elem,masterUId,data,annotationName,decorate,directAnnotation){var _data$uid=data.uid,uid=_data$uid===void 0?masterUId:_data$uid,otherData=_objectWithoutProperties(data,["uid"]);add$2(elem,annotation());set$2(elem,"".concat(dataAnnotationId()),uid);set$2(elem,"".concat(dataAnnotation()),annotationName);var _decorate=decorate(uid,otherData),_decorate$attributes=_decorate.attributes,attributes=_decorate$attributes===void 0?{}:_decorate$attributes,_decorate$classes=_decorate.classes,classes=_decorate$classes===void 0?[]:_decorate$classes;setAll$1(elem,attributes);add(elem,classes);if(directAnnotation){if(classes.length>0){set$2(elem,"".concat(dataAnnotationClasses()),classes.join(','));}var attributeNames=keys(attributes);if(attributeNames.length>0){set$2(elem,"".concat(dataAnnotationAttributes()),attributeNames.join(','));}}};var removeDirectAnnotation=function removeDirectAnnotation(elem){remove$8(elem,annotation());remove$b(elem,"".concat(dataAnnotationId()));remove$b(elem,"".concat(dataAnnotation()));remove$b(elem,"".concat(dataAnnotationActive()));var customAttrNames=getOpt(elem,"".concat(dataAnnotationAttributes())).map(function(names){return names.split(',');}).getOr([]);var customClasses=getOpt(elem,"".concat(dataAnnotationClasses())).map(function(names){return names.split(',');}).getOr([]);each$f(customAttrNames,function(name){return remove$b(elem,name);});remove$5(elem,customClasses);remove$b(elem,"".concat(dataAnnotationClasses()));remove$b(elem,"".concat(dataAnnotationAttributes()));};var makeAnnotation=function makeAnnotation(eDoc,uid,data,annotationName,decorate){var master=SugarElement.fromTag('span',eDoc);applyAnnotation(master,uid,data,annotationName,decorate,false);return master;};var annotate=function annotate(editor,rng,uid,annotationName,decorate,data){var newWrappers=[];var master=makeAnnotation(editor.getDoc(),uid,data,annotationName,decorate);var wrapper=value$2();var finishWrapper=function finishWrapper(){wrapper.clear();};var getOrOpenWrapper=function getOrOpenWrapper(){return wrapper.get().getOrThunk(function(){var nu=shallow$1(master);newWrappers.push(nu);wrapper.set(nu);return nu;});};var processElements=function processElements(elems){each$f(elems,processElement);};var processElement=function processElement(elem){var ctx=context(editor,elem,'span',name(elem));switch(ctx){case'invalid-child':{finishWrapper();var children$1=children(elem);processElements(children$1);finishWrapper();break;}case'valid-block':{finishWrapper();applyAnnotation(elem,uid,data,annotationName,decorate,true);break;}case'valid':{var w=getOrOpenWrapper();wrap$2(elem,w);break;}}};var processNodes=function processNodes(nodes){var elems=map$3(nodes,SugarElement.fromDom);processElements(elems);};walk$3(editor.dom,rng,function(nodes){finishWrapper();processNodes(nodes);});return newWrappers;};var annotateWithBookmark=function annotateWithBookmark(editor,name,settings,data){editor.undoManager.transact(function(){var selection=editor.selection;var initialRng=selection.getRng();var hasFakeSelection=getCellsFromEditor(editor).length>0;var masterUid=generate$1('mce-annotation');if(initialRng.collapsed&&!hasFakeSelection){applyWordGrab(editor,initialRng);}if(selection.getRng().collapsed&&!hasFakeSelection){var wrapper=makeAnnotation(editor.getDoc(),masterUid,data,name,settings.decorate);set(wrapper,nbsp);selection.getRng().insertNode(wrapper.dom);selection.select(wrapper.dom);}else{preserve(selection,false,function(){runOnRanges(editor,function(selectionRng){annotate(editor,selectionRng,masterUid,name,settings.decorate,data);});});}});};var Annotator=function Annotator(editor){var registry=create$c();setup$w(editor,registry);var changes=setup$x(editor,registry);var isSpan=isTag('span');var removeAnnotations=function removeAnnotations(elements){each$f(elements,function(element){if(isSpan(element)){unwrap(element);}else{removeDirectAnnotation(element);}});};return{register:function register(name,settings){registry.register(name,settings);},annotate:function annotate(name,data){registry.lookup(name).each(function(settings){annotateWithBookmark(editor,name,settings,data);});},annotationChanged:function annotationChanged(name,callback){changes.addListener(name,callback);},remove:function remove(name){var bookmark=editor.selection.getBookmark();identify(editor,Optional.some(name)).each(function(_ref7){var elements=_ref7.elements;removeAnnotations(elements);});editor.selection.moveToBookmark(bookmark);},removeAll:function removeAll(name){var bookmark=editor.selection.getBookmark();each$e(findAll(editor,name),function(elements,_){removeAnnotations(elements);});editor.selection.moveToBookmark(bookmark);},getAll:function getAll(name){var directory=findAll(editor,name);return map$2(directory,function(elems){return map$3(elems,function(elem){return elem.dom;});});}};};var BookmarkManager=function BookmarkManager(selection){return{getBookmark:curry(getBookmark$1,selection),moveToBookmark:curry(moveToBookmark,selection)};};BookmarkManager.isBookmarkNode=isBookmarkNode$1;var isXYWithinRange=function isXYWithinRange(clientX,clientY,range){if(range.collapsed){return false;}else{return exists(range.getClientRects(),function(rect){return containsXY(rect,clientX,clientY);});}};var firePreProcess=function firePreProcess(editor,args){return editor.dispatch('PreProcess',args);};var firePostProcess=function firePostProcess(editor,args){return editor.dispatch('PostProcess',args);};var fireRemove=function fireRemove(editor){return editor.dispatch('remove');};var fireDetach=function fireDetach(editor){return editor.dispatch('detach');};var fireSwitchMode=function fireSwitchMode(editor,mode){return editor.dispatch('SwitchMode',{mode:mode});};var fireObjectResizeStart=function fireObjectResizeStart(editor,target,width,height,origin){editor.dispatch('ObjectResizeStart',{target:target,width:width,height:height,origin:origin});};var fireObjectResized=function fireObjectResized(editor,target,width,height,origin){editor.dispatch('ObjectResized',{target:target,width:width,height:height,origin:origin});};var firePreInit=function firePreInit(editor){return editor.dispatch('PreInit');};var firePostRender=function firePostRender(editor){return editor.dispatch('PostRender');};var fireInit=function fireInit(editor){return editor.dispatch('Init');};var firePlaceholderToggle=function firePlaceholderToggle(editor,state){return editor.dispatch('PlaceholderToggle',{state:state});};var fireError=function fireError(editor,errorType,error){return editor.dispatch(errorType,error);};var fireFormatApply=function fireFormatApply(editor,format,node,vars){return editor.dispatch('FormatApply',{format:format,node:node,vars:vars});};var fireFormatRemove=function fireFormatRemove(editor,format,node,vars){return editor.dispatch('FormatRemove',{format:format,node:node,vars:vars});};var fireBeforeSetContent=function fireBeforeSetContent(editor,args){return editor.dispatch('BeforeSetContent',args);};var fireSetContent=function fireSetContent(editor,args){return editor.dispatch('SetContent',args);};var fireBeforeGetContent=function fireBeforeGetContent(editor,args){return editor.dispatch('BeforeGetContent',args);};var fireGetContent=function fireGetContent(editor,args){return editor.dispatch('GetContent',args);};var fireAutocompleterStart=function fireAutocompleterStart(editor,args){return editor.dispatch('AutocompleterStart',args);};var fireAutocompleterUpdate=function fireAutocompleterUpdate(editor,args){return editor.dispatch('AutocompleterUpdate',args);};var fireAutocompleterEnd=function fireAutocompleterEnd(editor){return editor.dispatch('AutocompleterEnd');};var firePastePreProcess=function firePastePreProcess(editor,html,internal){return editor.dispatch('PastePreProcess',{content:html,internal:internal});};var firePastePostProcess=function firePastePostProcess(editor,node,internal){return editor.dispatch('PastePostProcess',{node:node,internal:internal});};var firePastePlainTextToggle=function firePastePlainTextToggle(editor,state){return editor.dispatch('PastePlainTextToggle',{state:state});};var VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,modifierPressed:function modifierPressed(e){return e.shiftKey||e.ctrlKey||e.altKey||VK.metaKeyPressed(e);},metaKeyPressed:function metaKeyPressed(e){return Env.os.isMacOS()||Env.os.isiOS()?e.metaKey:e.ctrlKey&&!e.altKey;}};var elementSelectionAttr='data-mce-selected';var controlElmSelector='table,img,figure.image,hr,video,span.mce-preview-object';var abs=Math.abs;var round$1=Math.round;var resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var isTouchEvent=function isTouchEvent(evt){return evt.type==='longpress'||evt.type.indexOf('touch')===0;};var ControlSelection=function ControlSelection(selection,editor){var dom=editor.dom;var editableDoc=editor.getDoc();var rootDocument=document;var rootElement=editor.getBody();var selectedElm,selectedElmGhost,resizeHelper,selectedHandle,resizeBackdrop;var startX,startY,selectedElmX,selectedElmY,startW,startH,ratio,resizeStarted;var width;var height;var startScrollWidth;var startScrollHeight;var isImage=function isImage(elm){return isNonNullable(elm)&&(isImg(elm)||dom.is(elm,'figure.image'));};var isMedia=function isMedia(elm){return isMedia$2(elm)||dom.hasClass(elm,'mce-preview-object');};var isEventOnImageOutsideRange=function isEventOnImageOutsideRange(evt,range){if(isTouchEvent(evt)){var touch=evt.touches[0];return isImage(evt.target)&&!isXYWithinRange(touch.clientX,touch.clientY,range);}else{return isImage(evt.target)&&!isXYWithinRange(evt.clientX,evt.clientY,range);}};var contextMenuSelectImage=function contextMenuSelectImage(evt){var target=evt.target;if(isEventOnImageOutsideRange(evt,editor.selection.getRng())&&!evt.isDefaultPrevented()){editor.selection.select(target);}};var getResizeTargets=function getResizeTargets(elm){if(dom.is(elm,'figure.image')){return[elm.querySelector('img')];}else if(dom.hasClass(elm,'mce-preview-object')&&isNonNullable(elm.firstElementChild)){return[elm,elm.firstElementChild];}else{return[elm];}};var isResizable=function isResizable(elm){var selector=getObjectResizing(editor);if(!selector){return false;}if(elm.getAttribute('data-mce-resize')==='false'){return false;}if(elm===editor.getBody()){return false;}if(dom.hasClass(elm,'mce-preview-object')){return is$1(SugarElement.fromDom(elm.firstElementChild),selector);}else{return is$1(SugarElement.fromDom(elm),selector);}};var createGhostElement=function createGhostElement(elm){if(isMedia(elm)){return dom.create('img',{src:Env.transparentSrc});}else{return elm.cloneNode(true);}};var setSizeProp=function setSizeProp(element,name,value){if(isNonNullable(value)){var targets=getResizeTargets(element);each$f(targets,function(target){if(target.style[name]||!editor.schema.isValid(target.nodeName.toLowerCase(),name)){dom.setStyle(target,name,value);}else{dom.setAttrib(target,name,''+value);}});}};var setGhostElmSize=function setGhostElmSize(ghostElm,width,height){setSizeProp(ghostElm,'width',width);setSizeProp(ghostElm,'height',height);};var resizeGhostElement=function resizeGhostElement(e){var deltaX,deltaY,proportional;var resizeHelperX,resizeHelperY;deltaX=e.screenX-startX;deltaY=e.screenY-startY;width=deltaX*selectedHandle[2]+startW;height=deltaY*selectedHandle[3]+startH;width=width<5?5:width;height=height<5?5:height;if((isImage(selectedElm)||isMedia(selectedElm))&&getResizeImgProportional(editor)!==false){proportional=!VK.modifierPressed(e);}else{proportional=VK.modifierPressed(e);}if(proportional){if(abs(deltaX)>abs(deltaY)){height=round$1(width*ratio);width=round$1(height/ratio);}else{width=round$1(height/ratio);height=round$1(width*ratio);}}setGhostElmSize(selectedElmGhost,width,height);resizeHelperX=selectedHandle.startPos.x+deltaX;resizeHelperY=selectedHandle.startPos.y+deltaY;resizeHelperX=resizeHelperX>0?resizeHelperX:0;resizeHelperY=resizeHelperY>0?resizeHelperY:0;dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:'block'});resizeHelper.innerHTML=width+' &times; '+height;if(selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width){dom.setStyle(selectedElmGhost,'left',selectedElmX+(startW-width));}if(selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height){dom.setStyle(selectedElmGhost,'top',selectedElmY+(startH-height));}deltaX=rootElement.scrollWidth-startScrollWidth;deltaY=rootElement.scrollHeight-startScrollHeight;if(deltaX+deltaY!==0){dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY});}if(!resizeStarted){fireObjectResizeStart(editor,selectedElm,startW,startH,'corner-'+selectedHandle.name);resizeStarted=true;}};var endGhostResize=function endGhostResize(){var wasResizeStarted=resizeStarted;resizeStarted=false;if(wasResizeStarted){setSizeProp(selectedElm,'width',width);setSizeProp(selectedElm,'height',height);}dom.unbind(editableDoc,'mousemove',resizeGhostElement);dom.unbind(editableDoc,'mouseup',endGhostResize);if(rootDocument!==editableDoc){dom.unbind(rootDocument,'mousemove',resizeGhostElement);dom.unbind(rootDocument,'mouseup',endGhostResize);}dom.remove(selectedElmGhost);dom.remove(resizeHelper);dom.remove(resizeBackdrop);showResizeRect(selectedElm);if(wasResizeStarted){fireObjectResized(editor,selectedElm,width,height,'corner-'+selectedHandle.name);dom.setAttrib(selectedElm,'style',dom.getAttrib(selectedElm,'style'));}editor.nodeChanged();};var showResizeRect=function showResizeRect(targetElm){unbindResizeHandleEvents();var position=dom.getPos(targetElm,rootElement);var selectedElmX=position.x;var selectedElmY=position.y;var rect=targetElm.getBoundingClientRect();var targetWidth=rect.width||rect.right-rect.left;var targetHeight=rect.height||rect.bottom-rect.top;if(selectedElm!==targetElm){hideResizeRect();selectedElm=targetElm;width=height=0;}var e=editor.dispatch('ObjectSelected',{target:targetElm});if(isResizable(targetElm)&&!e.isDefaultPrevented()){each$e(resizeHandles,function(handle,name){var handleElm;var startDrag=function startDrag(e){var target=getResizeTargets(selectedElm)[0];startX=e.screenX;startY=e.screenY;startW=target.clientWidth;startH=target.clientHeight;ratio=startH/startW;selectedHandle=handle;selectedHandle.name=name;selectedHandle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY};startScrollWidth=rootElement.scrollWidth;startScrollHeight=rootElement.scrollHeight;resizeBackdrop=dom.add(rootElement,'div',{'class':'mce-resize-backdrop','data-mce-bogus':'all'});dom.setStyles(resizeBackdrop,{position:'fixed',left:'0',top:'0',width:'100%',height:'100%'});selectedElmGhost=createGhostElement(selectedElm);dom.addClass(selectedElmGhost,'mce-clonedresizable');dom.setAttrib(selectedElmGhost,'data-mce-bogus','all');selectedElmGhost.contentEditable='false';dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0});setGhostElmSize(selectedElmGhost,targetWidth,targetHeight);selectedElmGhost.removeAttribute(elementSelectionAttr);rootElement.appendChild(selectedElmGhost);dom.bind(editableDoc,'mousemove',resizeGhostElement);dom.bind(editableDoc,'mouseup',endGhostResize);if(rootDocument!==editableDoc){dom.bind(rootDocument,'mousemove',resizeGhostElement);dom.bind(rootDocument,'mouseup',endGhostResize);}resizeHelper=dom.add(rootElement,'div',{'class':'mce-resize-helper','data-mce-bogus':'all'},startW+' &times; '+startH);};handleElm=dom.get('mceResizeHandle'+name);if(handleElm){dom.remove(handleElm);}handleElm=dom.add(rootElement,'div',{'id':'mceResizeHandle'+name,'data-mce-bogus':'all','class':'mce-resizehandle','unselectable':true,'style':'cursor:'+name+'-resize; margin:0; padding:0'});dom.bind(handleElm,'mousedown',function(e){e.stopImmediatePropagation();e.preventDefault();startDrag(e);});handle.elm=handleElm;dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2});});}else{hideResizeRect(false);}};var throttledShowResizeRect=first$1(showResizeRect,0);var hideResizeRect=function hideResizeRect(){var removeSelected=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;throttledShowResizeRect.cancel();unbindResizeHandleEvents();if(selectedElm&&removeSelected){selectedElm.removeAttribute(elementSelectionAttr);}each$e(resizeHandles,function(value,name){var handleElm=dom.get('mceResizeHandle'+name);if(handleElm){dom.unbind(handleElm);dom.remove(handleElm);}});};var isChildOrEqual=function isChildOrEqual(node,parent){return isNonNullable(node)&&dom.isChildOf(node,parent);};var updateResizeRect=function updateResizeRect(e){if(resizeStarted||editor.removed||editor.composing){return;}var targetElm=e.type==='mousedown'?e.target:selection.getNode();var controlElm=closest$3(SugarElement.fromDom(targetElm),controlElmSelector).map(function(e){return e.dom;}).getOrUndefined();var selectedValue=isNonNullable(controlElm)?dom.getAttrib(controlElm,elementSelectionAttr,'1'):'1';each$f(dom.select("img[".concat(elementSelectionAttr,"],hr[").concat(elementSelectionAttr,"]")),function(img){img.removeAttribute(elementSelectionAttr);});if(isChildOrEqual(controlElm,rootElement)){disableGeckoResize();var startElm=selection.getStart(true);if(isChildOrEqual(startElm,controlElm)&&isChildOrEqual(selection.getEnd(true),controlElm)){dom.setAttrib(controlElm,elementSelectionAttr,selectedValue);throttledShowResizeRect.throttle(controlElm);return;}}hideResizeRect();};var unbindResizeHandleEvents=function unbindResizeHandleEvents(){each$e(resizeHandles,function(handle){if(handle.elm){dom.unbind(handle.elm);delete handle.elm;}});};var disableGeckoResize=function disableGeckoResize(){try{editor.getDoc().execCommand('enableObjectResizing',false,'false');}catch(ex){}};editor.on('init',function(){disableGeckoResize();editor.on('NodeChange ResizeEditor ResizeWindow ResizeContent drop',updateResizeRect);editor.on('keyup compositionend',function(e){if(selectedElm&&selectedElm.nodeName==='TABLE'){updateResizeRect(e);}});editor.on('hide blur',hideResizeRect);editor.on('contextmenu longpress',contextMenuSelectImage,true);});editor.on('remove',unbindResizeHandleEvents);var destroy=function destroy(){throttledShowResizeRect.cancel();selectedElm=selectedElmGhost=resizeBackdrop=null;};return{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,destroy:destroy};};var setStart=function setStart(rng,situ){situ.fold(function(e){rng.setStartBefore(e.dom);},function(e,o){rng.setStart(e.dom,o);},function(e){rng.setStartAfter(e.dom);});};var setFinish=function setFinish(rng,situ){situ.fold(function(e){rng.setEndBefore(e.dom);},function(e,o){rng.setEnd(e.dom,o);},function(e){rng.setEndAfter(e.dom);});};var relativeToNative=function relativeToNative(win,startSitu,finishSitu){var range=win.document.createRange();setStart(range,startSitu);setFinish(range,finishSitu);return range;};var exactToNative=function exactToNative(win,start,soffset,finish,foffset){var rng=win.document.createRange();rng.setStart(start.dom,soffset);rng.setEnd(finish.dom,foffset);return rng;};var adt$3=Adt.generate([{ltr:['start','soffset','finish','foffset']},{rtl:['start','soffset','finish','foffset']}]);var fromRange=function fromRange(win,type,range){return type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset);};var getRanges=function getRanges(win,selection){return selection.match({domRange:function domRange(rng){return{ltr:constant(rng),rtl:Optional.none};},relative:function relative(startSitu,finishSitu){return{ltr:cached(function(){return relativeToNative(win,startSitu,finishSitu);}),rtl:cached(function(){return Optional.some(relativeToNative(win,finishSitu,startSitu));})};},exact:function exact(start,soffset,finish,foffset){return{ltr:cached(function(){return exactToNative(win,start,soffset,finish,foffset);}),rtl:cached(function(){return Optional.some(exactToNative(win,finish,foffset,start,soffset));})};}});};var doDiagnose=function doDiagnose(win,ranges){var rng=ranges.ltr();if(rng.collapsed){var reversed=ranges.rtl().filter(function(rev){return rev.collapsed===false;});return reversed.map(function(rev){return adt$3.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset);}).getOrThunk(function(){return fromRange(win,adt$3.ltr,rng);});}else{return fromRange(win,adt$3.ltr,rng);}};var diagnose=function diagnose(win,selection){var ranges=getRanges(win,selection);return doDiagnose(win,ranges);};adt$3.ltr;adt$3.rtl;var create$a=function create$a(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset};};var SimRange={create:create$a};var caretPositionFromPoint=function caretPositionFromPoint(doc,x,y){var _a,_b;return Optional.from((_b=(_a=doc.dom).caretPositionFromPoint)===null||_b===void 0?void 0:_b.call(_a,x,y)).bind(function(pos){if(pos.offsetNode===null){return Optional.none();}var r=doc.dom.createRange();r.setStart(pos.offsetNode,pos.offset);r.collapse();return Optional.some(r);});};var caretRangeFromPoint=function caretRangeFromPoint(doc,x,y){var _a,_b;return Optional.from((_b=(_a=doc.dom).caretRangeFromPoint)===null||_b===void 0?void 0:_b.call(_a,x,y));};var availableSearch=function(){if(document.caretPositionFromPoint){return caretPositionFromPoint;}else if(document.caretRangeFromPoint){return caretRangeFromPoint;}else{return Optional.none;}}();var fromPoint$1=function fromPoint$1(win,x,y){var doc=SugarElement.fromDom(win.document);return availableSearch(doc,x,y).map(function(rng){return SimRange.create(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset);});};var adt$2=Adt.generate([{before:['element']},{on:['element','offset']},{after:['element']}]);var cata=function cata(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter);};var getStart$2=function getStart$2(situ){return situ.fold(identity,identity,identity);};var before$1=adt$2.before;var on=adt$2.on;var after$1=adt$2.after;var Situ={before:before$1,on:on,after:after$1,cata:cata,getStart:getStart$2};var adt$1=Adt.generate([{domRange:['rng']},{relative:['startSitu','finishSitu']},{exact:['start','soffset','finish','foffset']}]);var exactFromRange=function exactFromRange(simRange){return adt$1.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset);};var getStart$1=function getStart$1(selection){return selection.match({domRange:function domRange(rng){return SugarElement.fromDom(rng.startContainer);},relative:function relative(startSitu,_finishSitu){return Situ.getStart(startSitu);},exact:function exact(start,_soffset,_finish,_foffset){return start;}});};var domRange=adt$1.domRange;var relative=adt$1.relative;var exact=adt$1.exact;var getWin=function getWin(selection){var start=getStart$1(selection);return defaultView(start);};var range=SimRange.create;var SimSelection={domRange:domRange,relative:relative,exact:exact,exactFromRange:exactFromRange,getWin:getWin,range:range};var beforeSpecial=function beforeSpecial(element,offset){var name$1=name(element);if('input'===name$1){return Situ.after(element);}else if(!contains$2(['br','img'],name$1)){return Situ.on(element,offset);}else{return offset===0?Situ.before(element):Situ.after(element);}};var preprocessRelative=function preprocessRelative(startSitu,finishSitu){var start=startSitu.fold(Situ.before,beforeSpecial,Situ.after);var finish=finishSitu.fold(Situ.before,beforeSpecial,Situ.after);return SimSelection.relative(start,finish);};var preprocessExact=function preprocessExact(start,soffset,finish,foffset){var startSitu=beforeSpecial(start,soffset);var finishSitu=beforeSpecial(finish,foffset);return SimSelection.relative(startSitu,finishSitu);};var preprocess=function preprocess(selection){return selection.match({domRange:function domRange(rng){var start=SugarElement.fromDom(rng.startContainer);var finish=SugarElement.fromDom(rng.endContainer);return preprocessExact(start,rng.startOffset,finish,rng.endOffset);},relative:preprocessRelative,exact:preprocessExact});};var fromElements=function fromElements(elements,scope){var doc=scope||document;var fragment=doc.createDocumentFragment();each$f(elements,function(element){fragment.appendChild(element.dom);});return SugarElement.fromDom(fragment);};var toNative=function toNative(selection){var win=SimSelection.getWin(selection).dom;var getDomRange=function getDomRange(start,soffset,finish,foffset){return exactToNative(win,start,soffset,finish,foffset);};var filtered=preprocess(selection);return diagnose(win,filtered).match({ltr:getDomRange,rtl:getDomRange});};var getAtPoint=function getAtPoint(win,x,y){return fromPoint$1(win,x,y);};var fromPoint=function fromPoint(clientX,clientY,doc){return getAtPoint(doc.defaultView,clientX,clientY).map(function(simRange){var rng=doc.createRange();rng.setStart(simRange.start.dom,simRange.soffset);rng.setEnd(simRange.finish.dom,simRange.foffset);return rng;}).getOrUndefined();};var isEq$4=function isEq$4(rng1,rng2){return rng1&&rng2&&rng1.startContainer===rng2.startContainer&&rng1.startOffset===rng2.startOffset&&rng1.endContainer===rng2.endContainer&&rng1.endOffset===rng2.endOffset;};var findParent=function findParent(node,rootNode,predicate){while(node&&node!==rootNode){if(predicate(node)){return node;}node=node.parentNode;}return null;};var hasParent$1=function hasParent$1(node,rootNode,predicate){return findParent(node,rootNode,predicate)!==null;};var hasParentWithName=function hasParentWithName(node,rootNode,name){return hasParent$1(node,rootNode,function(node){return node.nodeName===name;});};var isTable=function isTable(node){return node&&node.nodeName==='TABLE';};var isTableCell$2=function isTableCell$2(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName);};var isCeFalseCaretContainer=function isCeFalseCaretContainer(node,rootNode){return isCaretContainer$2(node)&&hasParent$1(node,rootNode,isCaretNode)===false;};var hasBrBeforeAfter=function hasBrBeforeAfter(dom,node,left){var walker=new DomTreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||dom.getRoot());while(node=walker[left?'prev':'next']()){if(isBr$6(node)){return true;}}};var isPrevNode=function isPrevNode(node,name){return node.previousSibling&&node.previousSibling.nodeName===name;};var hasContentEditableFalseParent=function hasContentEditableFalseParent(body,node){while(node&&node!==body){if(isContentEditableFalse$b(node)){return true;}node=node.parentNode;}return false;};var findTextNodeRelative=function findTextNodeRelative(dom,isAfterNode,collapsed,left,startNode){var lastInlineElement;var body=dom.getRoot();var node;var nonEmptyElementsMap=dom.schema.getNonEmptyElements();var parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body;if(left&&isBr$6(startNode)&&isAfterNode&&dom.isEmpty(parentBlockContainer)){return Optional.some(CaretPosition(startNode.parentNode,dom.nodeIndex(startNode)));}var walker=new DomTreeWalker(startNode,parentBlockContainer);while(node=walker[left?'prev':'next']()){if(dom.getContentEditableParent(node)==='false'||isCeFalseCaretContainer(node,body)){return Optional.none();}if(isText$9(node)&&node.nodeValue.length>0){if(hasParentWithName(node,body,'A')===false){return Optional.some(CaretPosition(node,left?node.nodeValue.length:0));}return Optional.none();}if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()]){return Optional.none();}lastInlineElement=node;}if(isComment(lastInlineElement)){return Optional.none();}if(collapsed&&lastInlineElement){return Optional.some(CaretPosition(lastInlineElement,0));}return Optional.none();};var normalizeEndPoint=function normalizeEndPoint(dom,collapsed,start,rng){var container,offset;var body=dom.getRoot();var node;var directionLeft,normalized=false;container=rng[(start?'start':'end')+'Container'];offset=rng[(start?'start':'end')+'Offset'];var isAfterNode=isElement$6(container)&&offset===container.childNodes.length;var nonEmptyElementsMap=dom.schema.getNonEmptyElements();directionLeft=start;if(isCaretContainer$2(container)){return Optional.none();}if(isElement$6(container)&&offset>container.childNodes.length-1){directionLeft=false;}if(isDocument$1(container)){container=body;offset=0;}if(container===body){if(directionLeft){node=container.childNodes[offset>0?offset-1:0];if(node){if(isCaretContainer$2(node)){return Optional.none();}if(nonEmptyElementsMap[node.nodeName]||isTable(node)){return Optional.none();}}}if(container.hasChildNodes()){offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1);container=container.childNodes[offset];offset=isText$9(container)&&isAfterNode?container.data.length:0;if(!collapsed&&container===body.lastChild&&isTable(container)){return Optional.none();}if(hasContentEditableFalseParent(body,container)||isCaretContainer$2(container)){return Optional.none();}if(container.hasChildNodes()&&isTable(container)===false){node=container;var walker=new DomTreeWalker(container,body);do{if(isContentEditableFalse$b(node)||isCaretContainer$2(node)){normalized=false;break;}if(isText$9(node)&&node.nodeValue.length>0){offset=directionLeft?0:node.nodeValue.length;container=node;normalized=true;break;}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCell$2(node)){offset=dom.nodeIndex(node);container=node.parentNode;if(!directionLeft){offset++;}normalized=true;break;}}while(node=directionLeft?walker.next():walker.prev());}}}if(collapsed){if(isText$9(container)&&offset===0){findTextNodeRelative(dom,isAfterNode,collapsed,true,container).each(function(pos){container=pos.container();offset=pos.offset();normalized=true;});}if(isElement$6(container)){node=container.childNodes[offset];if(!node){node=container.childNodes[offset-1];}if(node&&isBr$6(node)&&!isPrevNode(node,'A')&&!hasBrBeforeAfter(dom,node,false)&&!hasBrBeforeAfter(dom,node,true)){findTextNodeRelative(dom,isAfterNode,collapsed,true,node).each(function(pos){container=pos.container();offset=pos.offset();normalized=true;});}}}if(directionLeft&&!collapsed&&isText$9(container)&&offset===container.nodeValue.length){findTextNodeRelative(dom,isAfterNode,collapsed,false,container).each(function(pos){container=pos.container();offset=pos.offset();normalized=true;});}return normalized?Optional.some(CaretPosition(container,offset)):Optional.none();};var normalize$2=function normalize$2(dom,rng){var collapsed=rng.collapsed,normRng=rng.cloneRange();var startPos=CaretPosition.fromRangeStart(rng);normalizeEndPoint(dom,collapsed,true,normRng).each(function(pos){if(!collapsed||!CaretPosition.isAbove(startPos,pos)){normRng.setStart(pos.container(),pos.offset());}});if(!collapsed){normalizeEndPoint(dom,collapsed,false,normRng).each(function(pos){normRng.setEnd(pos.container(),pos.offset());});}if(collapsed){normRng.collapse(true);}return isEq$4(rng,normRng)?Optional.none():Optional.some(normRng);};var splitText=function splitText(node,offset){return node.splitText(offset);};var split=function split(rng){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if(startContainer===endContainer&&isText$9(startContainer)){if(startOffset>0&&startOffset<startContainer.nodeValue.length){endContainer=splitText(startContainer,startOffset);startContainer=endContainer.previousSibling;if(endOffset>startOffset){endOffset=endOffset-startOffset;startContainer=endContainer=splitText(endContainer,endOffset).previousSibling;endOffset=endContainer.nodeValue.length;startOffset=0;}else{endOffset=0;}}}else{if(isText$9(startContainer)&&startOffset>0&&startOffset<startContainer.nodeValue.length){startContainer=splitText(startContainer,startOffset);startOffset=0;}if(isText$9(endContainer)&&endOffset>0&&endOffset<endContainer.nodeValue.length){endContainer=splitText(endContainer,endOffset).previousSibling;endOffset=endContainer.nodeValue.length;}}return{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset};};var RangeUtils=function RangeUtils(dom){var walk=function walk(rng,callback){return walk$3(dom,rng,callback);};var split$1=split;var normalize=function normalize(rng){return normalize$2(dom,rng).fold(never,function(normalizedRng){rng.setStart(normalizedRng.startContainer,normalizedRng.startOffset);rng.setEnd(normalizedRng.endContainer,normalizedRng.endOffset);return true;});};return{walk:walk,split:split$1,normalize:normalize};};RangeUtils.compareRanges=isEq$4;RangeUtils.getCaretRangeFromPoint=fromPoint;RangeUtils.getSelectedNode=getSelectedNode;RangeUtils.getNode=getNode$1;var Dimension=function Dimension(name,getOffset){var set=function set(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/)){throw new Error(name+'.set accepts only positive integer values. Value was '+h);}var dom=element.dom;if(isSupported$1(dom)){dom.style[name]=h+'px';}};var get=function get(element){var r=getOffset(element);if(r<=0||r===null){var css=get$7(element,name);return parseFloat(css)||0;}return r;};var getOuter=get;var aggregate=function aggregate(element,properties){return foldl(properties,function(acc,property){var val=get$7(element,property);var value=val===undefined?0:parseInt(val,10);return isNaN(value)?acc:acc+value;},0);};var max=function max(element,value,properties){var cumulativeInclusions=aggregate(element,properties);var absoluteMax=value>cumulativeInclusions?value-cumulativeInclusions:0;return absoluteMax;};return{set:set,get:get,getOuter:getOuter,aggregate:aggregate,max:max};};var api=Dimension('height',function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight;});var get$2=function get$2(element){return api.get(element);};var getDocument=function getDocument(){return SugarElement.fromDom(document);};var walkUp=function walkUp(navigation,doc){var frame=navigation.view(doc);return frame.fold(constant([]),function(f){var parent=navigation.owner(f);var rest=walkUp(navigation,parent);return[f].concat(rest);});};var pathTo=function pathTo(element,navigation){var d=navigation.owner(element);return walkUp(navigation,d);};var view=function view(doc){var _a;var element=doc.dom===document?Optional.none():Optional.from((_a=doc.dom.defaultView)===null||_a===void 0?void 0:_a.frameElement);return element.map(SugarElement.fromDom);};var owner=function owner(element){return documentOrOwner(element);};var Navigation=/*#__PURE__*/Object.freeze({__proto__:null,view:view,owner:owner});var find=function find(element){var doc=getDocument();var scroll=get$5(doc);var frames=pathTo(element,Navigation);var offset=viewport(element);var r=foldr(frames,function(b,a){var loc=viewport(a);return{left:b.left+loc.left,top:b.top+loc.top};},{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top);};var excludeFromDescend=function excludeFromDescend(element){return name(element)==='textarea';};var fireScrollIntoViewEvent=function fireScrollIntoViewEvent(editor,data){var scrollEvent=editor.dispatch('ScrollIntoView',data);return scrollEvent.isDefaultPrevented();};var fireAfterScrollIntoViewEvent=function fireAfterScrollIntoViewEvent(editor,data){editor.dispatch('AfterScrollIntoView',data);};var descend=function descend(element,offset){var children$1=children(element);if(children$1.length===0||excludeFromDescend(element)){return{element:element,offset:offset};}else if(offset<children$1.length&&!excludeFromDescend(children$1[offset])){return{element:children$1[offset],offset:0};}else{var _last=children$1[children$1.length-1];if(excludeFromDescend(_last)){return{element:element,offset:offset};}else{if(name(_last)==='img'){return{element:_last,offset:1};}else if(isText$a(_last)){return{element:_last,offset:get$3(_last).length};}else{return{element:_last,offset:children(_last).length};}}}};var markerInfo=function markerInfo(element,cleanupFun){var pos=absolute(element);var height=get$2(element);return{element:element,bottom:pos.top+height,height:height,pos:pos,cleanup:cleanupFun};};var createMarker$1=function createMarker$1(element,offset){var startPoint=descend(element,offset);var span=SugarElement.fromHtml('<span data-mce-bogus="all" style="display: inline-block;">'+ZWSP$1+'</span>');before$3(startPoint.element,span);return markerInfo(span,function(){return remove$6(span);});};var elementMarker=function elementMarker(element){return markerInfo(SugarElement.fromDom(element),noop);};var withMarker=function withMarker(editor,f,rng,alignToTop){preserveWith(editor,function(_s,_e){return applyWithMarker(editor,f,rng,alignToTop);},rng);};var withScrollEvents=function withScrollEvents(editor,doc,f,marker,alignToTop){var data={elm:marker.element.dom,alignToTop:alignToTop};if(fireScrollIntoViewEvent(editor,data)){return;}var scrollTop=get$5(doc).top;f(doc,scrollTop,marker,alignToTop);fireAfterScrollIntoViewEvent(editor,data);};var applyWithMarker=function applyWithMarker(editor,f,rng,alignToTop){var body=SugarElement.fromDom(editor.getBody());var doc=SugarElement.fromDom(editor.getDoc());reflow(body);var marker=createMarker$1(SugarElement.fromDom(rng.startContainer),rng.startOffset);withScrollEvents(editor,doc,f,marker,alignToTop);marker.cleanup();};var withElement=function withElement(editor,element,f,alignToTop){var doc=SugarElement.fromDom(editor.getDoc());withScrollEvents(editor,doc,f,elementMarker(element),alignToTop);};var preserveWith=function preserveWith(editor,f,rng){var startElement=rng.startContainer;var startOffset=rng.startOffset;var endElement=rng.endContainer;var endOffset=rng.endOffset;f(SugarElement.fromDom(startElement),SugarElement.fromDom(endElement));var newRng=editor.dom.createRng();newRng.setStart(startElement,startOffset);newRng.setEnd(endElement,endOffset);editor.selection.setRng(rng);};var scrollToMarker=function scrollToMarker(marker,viewHeight,alignToTop,doc){var pos=marker.pos;if(alignToTop){to(pos.left,pos.top,doc);}else{var y=pos.top-viewHeight+marker.height;to(pos.left,y,doc);}};var intoWindowIfNeeded=function intoWindowIfNeeded(doc,scrollTop,viewHeight,marker,alignToTop){var viewportBottom=viewHeight+scrollTop;var markerTop=marker.pos.top;var markerBottom=marker.bottom;var largerThanViewport=markerBottom-markerTop>=viewHeight;if(markerTop<scrollTop){scrollToMarker(marker,viewHeight,alignToTop!==false,doc);}else if(markerTop>viewportBottom){var align=largerThanViewport?alignToTop!==false:alignToTop===true;scrollToMarker(marker,viewHeight,align,doc);}else if(markerBottom>viewportBottom&&!largerThanViewport){scrollToMarker(marker,viewHeight,alignToTop===true,doc);}};var intoWindow=function intoWindow(doc,scrollTop,marker,alignToTop){var viewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,viewHeight,marker,alignToTop);};var intoFrame=function intoFrame(doc,scrollTop,marker,alignToTop){var frameViewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,frameViewHeight,marker,alignToTop);var op=find(marker.element);var viewportBounds=getBounds(window);if(op.top<viewportBounds.y){intoView(marker.element,alignToTop!==false);}else if(op.top>viewportBounds.bottom){intoView(marker.element,alignToTop===true);}};var rangeIntoWindow=function rangeIntoWindow(editor,rng,alignToTop){return withMarker(editor,intoWindow,rng,alignToTop);};var elementIntoWindow=function elementIntoWindow(editor,element,alignToTop){return withElement(editor,element,intoWindow,alignToTop);};var rangeIntoFrame=function rangeIntoFrame(editor,rng,alignToTop){return withMarker(editor,intoFrame,rng,alignToTop);};var elementIntoFrame=function elementIntoFrame(editor,element,alignToTop){return withElement(editor,element,intoFrame,alignToTop);};var scrollElementIntoView=function scrollElementIntoView(editor,element,alignToTop){var scroller=editor.inline?elementIntoWindow:elementIntoFrame;scroller(editor,element,alignToTop);};var scrollRangeIntoView=function scrollRangeIntoView(editor,rng,alignToTop){var scroller=editor.inline?rangeIntoWindow:rangeIntoFrame;scroller(editor,rng,alignToTop);};var focus$1=function focus$1(element){return element.dom.focus();};var hasFocus$1=function hasFocus$1(element){var root=getRootNode(element).dom;return element.dom===root.activeElement;};var active$1=function active$1(){var root=arguments.length>0&&arguments[0]!==undefined?arguments[0]:getDocument();return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);};var search=function search(element){return active$1(getRootNode(element)).filter(function(e){return element.dom.contains(e.dom);});};var clamp$1=function clamp$1(offset,element){var max=isText$a(element)?get$3(element).length:children(element).length+1;if(offset>max){return max;}else if(offset<0){return 0;}return offset;};var normalizeRng=function normalizeRng(rng){return SimSelection.range(rng.start,clamp$1(rng.soffset,rng.start),rng.finish,clamp$1(rng.foffset,rng.finish));};var isOrContains=function isOrContains(root,elm){return!isRestrictedNode(elm.dom)&&(contains(root,elm)||eq(root,elm));};var isRngInRoot=function isRngInRoot(root){return function(rng){return isOrContains(root,rng.start)&&isOrContains(root,rng.finish);};};var shouldStore=function shouldStore(editor){return editor.inline;};var nativeRangeToSelectionRange=function nativeRangeToSelectionRange(r){return SimSelection.range(SugarElement.fromDom(r.startContainer),r.startOffset,SugarElement.fromDom(r.endContainer),r.endOffset);};var readRange=function readRange(win){var selection=win.getSelection();var rng=!selection||selection.rangeCount===0?Optional.none():Optional.from(selection.getRangeAt(0));return rng.map(nativeRangeToSelectionRange);};var getBookmark=function getBookmark(root){var win=defaultView(root);return readRange(win.dom).filter(isRngInRoot(root));};var validate=function validate(root,bookmark){return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);};var bookmarkToNativeRng=function bookmarkToNativeRng(bookmark){var rng=document.createRange();try{rng.setStart(bookmark.start.dom,bookmark.soffset);rng.setEnd(bookmark.finish.dom,bookmark.foffset);return Optional.some(rng);}catch(_){return Optional.none();}};var store=function store(editor){var newBookmark=shouldStore(editor)?getBookmark(SugarElement.fromDom(editor.getBody())):Optional.none();editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark;};var getRng=function getRng(editor){var bookmark=editor.bookmark?editor.bookmark:Optional.none();return bookmark.bind(function(x){return validate(SugarElement.fromDom(editor.getBody()),x);}).bind(bookmarkToNativeRng);};var restore=function restore(editor){getRng(editor).each(function(rng){return editor.selection.setRng(rng);});};var isEditorUIElement$1=function isEditorUIElement$1(elm){var className=elm.className.toString();return className.indexOf('tox-')!==-1||className.indexOf('mce-')!==-1;};var FocusManager={isEditorUIElement:isEditorUIElement$1};var wrappedSetTimeout=function wrappedSetTimeout(callback,time){if(!isNumber(time)){time=0;}return setTimeout(callback,time);};var wrappedSetInterval=function wrappedSetInterval(callback,time){if(!isNumber(time)){time=0;}return setInterval(callback,time);};var Delay={setEditorTimeout:function setEditorTimeout(editor,callback,time){return wrappedSetTimeout(function(){if(!editor.removed){callback();}},time);},setEditorInterval:function setEditorInterval(editor,callback,time){var timer=wrappedSetInterval(function(){if(!editor.removed){callback();}else{clearInterval(timer);}},time);return timer;}};var isManualNodeChange=function isManualNodeChange(e){return e.type==='nodechange'&&e.selectionChange;};var registerPageMouseUp=function registerPageMouseUp(editor,throttledStore){var mouseUpPage=function mouseUpPage(){throttledStore.throttle();};DOMUtils.DOM.bind(document,'mouseup',mouseUpPage);editor.on('remove',function(){DOMUtils.DOM.unbind(document,'mouseup',mouseUpPage);});};var registerMouseUp=function registerMouseUp(editor,throttledStore){editor.on('mouseup touchend',function(_e){throttledStore.throttle();});};var registerEditorEvents=function registerEditorEvents(editor,throttledStore){registerMouseUp(editor,throttledStore);editor.on('keyup NodeChange AfterSetSelectionRange',function(e){if(!isManualNodeChange(e)){store(editor);}});};var register$6=function register$6(editor){var throttledStore=first$1(function(){store(editor);},0);editor.on('init',function(){if(editor.inline){registerPageMouseUp(editor,throttledStore);}registerEditorEvents(editor,throttledStore);});editor.on('remove',function(){throttledStore.cancel();});};var documentFocusInHandler;var DOM$9=DOMUtils.DOM;var isEditorUIElement=function isEditorUIElement(elm){return FocusManager.isEditorUIElement(elm);};var isEditorContentAreaElement=function isEditorContentAreaElement(elm){var classList=elm.classList;if(classList!==undefined){return classList.contains('tox-edit-area')||classList.contains('tox-edit-area__iframe')||classList.contains('mce-content-body');}else{return false;}};var isUIElement=function isUIElement(editor,elm){var customSelector=getCustomUiSelector(editor);var parent=DOM$9.getParent(elm,function(elm){return isEditorUIElement(elm)||(customSelector?editor.dom.is(elm,customSelector):false);});return parent!==null;};var getActiveElement=function getActiveElement(editor){try{var root=getRootNode(SugarElement.fromDom(editor.getElement()));return active$1(root).fold(function(){return document.body;},function(x){return x.dom;});}catch(ex){return document.body;}};var registerEvents$1=function registerEvents$1(editorManager,e){var editor=e.editor;register$6(editor);editor.on('focusin',function(){var focusedEditor=editorManager.focusedEditor;if(focusedEditor!==editor){if(focusedEditor){focusedEditor.dispatch('blur',{focusedEditor:editor});}editorManager.setActive(editor);editorManager.focusedEditor=editor;editor.dispatch('focus',{blurredEditor:focusedEditor});editor.focus(true);}});editor.on('focusout',function(){Delay.setEditorTimeout(editor,function(){var focusedEditor=editorManager.focusedEditor;if(!isUIElement(editor,getActiveElement(editor))&&focusedEditor===editor){editor.dispatch('blur',{focusedEditor:null});editorManager.focusedEditor=null;}});});if(!documentFocusInHandler){documentFocusInHandler=function documentFocusInHandler(e){var activeEditor=editorManager.activeEditor;if(activeEditor){getOriginalEventTarget(e).each(function(target){if(target.ownerDocument===document){if(target!==document.body&&!isUIElement(activeEditor,target)&&editorManager.focusedEditor===activeEditor){activeEditor.dispatch('blur',{focusedEditor:null});editorManager.focusedEditor=null;}}});}};DOM$9.bind(document,'focusin',documentFocusInHandler);}};var unregisterDocumentEvents=function unregisterDocumentEvents(editorManager,e){if(editorManager.focusedEditor===e.editor){editorManager.focusedEditor=null;}if(!editorManager.activeEditor){DOM$9.unbind(document,'focusin',documentFocusInHandler);documentFocusInHandler=null;}};var setup$v=function setup$v(editorManager){editorManager.on('AddEditor',curry(registerEvents$1,editorManager));editorManager.on('RemoveEditor',curry(unregisterDocumentEvents,editorManager));};var getContentEditableHost=function getContentEditableHost(editor,node){return editor.dom.getParent(node,function(node){return editor.dom.getContentEditable(node)==='true';});};var getCollapsedNode=function getCollapsedNode(rng){return rng.collapsed?Optional.from(getNode$1(rng.startContainer,rng.startOffset)).map(SugarElement.fromDom):Optional.none();};var getFocusInElement=function getFocusInElement(root,rng){return getCollapsedNode(rng).bind(function(node){if(isTableSection(node)){return Optional.some(node);}else if(contains(root,node)===false){return Optional.some(root);}else{return Optional.none();}});};var normalizeSelection=function normalizeSelection(editor,rng){getFocusInElement(SugarElement.fromDom(editor.getBody()),rng).bind(function(elm){return firstPositionIn(elm.dom);}).fold(function(){editor.selection.normalize();return;},function(caretPos){return editor.selection.setRng(caretPos.toRange());});};var focusBody=function focusBody(body){if(body.setActive){try{body.setActive();}catch(ex){body.focus();}}else{body.focus();}};var hasElementFocus=function hasElementFocus(elm){return hasFocus$1(elm)||search(elm).isSome();};var hasIframeFocus=function hasIframeFocus(editor){return editor.iframeElement&&hasFocus$1(SugarElement.fromDom(editor.iframeElement));};var hasInlineFocus=function hasInlineFocus(editor){var rawBody=editor.getBody();return rawBody&&hasElementFocus(SugarElement.fromDom(rawBody));};var hasUiFocus=function hasUiFocus(editor){var dos=getRootNode(SugarElement.fromDom(editor.getElement()));return active$1(dos).filter(function(elem){return!isEditorContentAreaElement(elem.dom)&&isUIElement(editor,elem.dom);}).isSome();};var _hasFocus=function hasFocus(editor){return editor.inline?hasInlineFocus(editor):hasIframeFocus(editor);};var hasEditorOrUiFocus=function hasEditorOrUiFocus(editor){return _hasFocus(editor)||hasUiFocus(editor);};var focusEditor=function focusEditor(editor){var selection=editor.selection;var body=editor.getBody();var rng=selection.getRng();editor.quirks.refreshContentEditable();if(editor.bookmark!==undefined&&_hasFocus(editor)===false){getRng(editor).each(function(bookmarkRng){editor.selection.setRng(bookmarkRng);rng=bookmarkRng;});}var contentEditableHost=getContentEditableHost(editor,selection.getNode());if(editor.dom.isChildOf(contentEditableHost,body)){focusBody(contentEditableHost);normalizeSelection(editor,rng);activateEditor(editor);return;}if(!editor.inline){if(!Env.browser.isOpera()){focusBody(body);}editor.getWin().focus();}if(Env.browser.isFirefox()||editor.inline){focusBody(body);normalizeSelection(editor,rng);}activateEditor(editor);};var activateEditor=function activateEditor(editor){return editor.editorManager.setActive(editor);};var focus=function focus(editor,skipFocus){if(editor.removed){return;}if(skipFocus){activateEditor(editor);}else{focusEditor(editor);}};var getEndpointElement=function getEndpointElement(root,rng,start,real,resolve){var container=start?rng.startContainer:rng.endContainer;var offset=start?rng.startOffset:rng.endOffset;return Optional.from(container).map(SugarElement.fromDom).map(function(elm){return!real||!rng.collapsed?child$1(elm,resolve(elm,offset)).getOr(elm):elm;}).bind(function(elm){return isElement$7(elm)?Optional.some(elm):parent(elm).filter(isElement$7);}).map(function(elm){return elm.dom;}).getOr(root);};var getStart=function getStart(root,rng,real){return getEndpointElement(root,rng,true,real,function(elm,offset){return Math.min(childNodesCount(elm),offset);});};var getEnd$1=function getEnd$1(root,rng,real){return getEndpointElement(root,rng,false,real,function(elm,offset){return offset>0?offset-1:offset;});};var skipEmptyTextNodes=function skipEmptyTextNodes(node,forwards){var orig=node;while(node&&isText$9(node)&&node.length===0){node=forwards?node.nextSibling:node.previousSibling;}return node||orig;};var getNode=function getNode(root,rng){var elm,startContainer,endContainer;if(!rng){return root;}startContainer=rng.startContainer;endContainer=rng.endContainer;var startOffset=rng.startOffset;var endOffset=rng.endOffset;elm=rng.commonAncestorContainer;if(!rng.collapsed){if(startContainer===endContainer){if(endOffset-startOffset<2){if(startContainer.hasChildNodes()){elm=startContainer.childNodes[startOffset];}}}if(startContainer.nodeType===3&&endContainer.nodeType===3){if(startContainer.length===startOffset){startContainer=skipEmptyTextNodes(startContainer.nextSibling,true);}else{startContainer=startContainer.parentNode;}if(endOffset===0){endContainer=skipEmptyTextNodes(endContainer.previousSibling,false);}else{endContainer=endContainer.parentNode;}if(startContainer&&startContainer===endContainer){return startContainer;}}}if(elm&&elm.nodeType===3){return elm.parentNode;}return elm;};var getSelectedBlocks=function getSelectedBlocks(dom,rng,startElm,endElm){var node;var selectedBlocks=[];var root=dom.getRoot();startElm=dom.getParent(startElm||getStart(root,rng,rng.collapsed),dom.isBlock);endElm=dom.getParent(endElm||getEnd$1(root,rng,rng.collapsed),dom.isBlock);if(startElm&&startElm!==root){selectedBlocks.push(startElm);}if(startElm&&endElm&&startElm!==endElm){node=startElm;var walker=new DomTreeWalker(startElm,root);while((node=walker.next())&&node!==endElm){if(dom.isBlock(node)){selectedBlocks.push(node);}}}if(endElm&&startElm!==endElm&&endElm!==root){selectedBlocks.push(endElm);}return selectedBlocks;};var select=function select(dom,node,content){return Optional.from(node).map(function(node){var idx=dom.nodeIndex(node);var rng=dom.createRng();rng.setStart(node.parentNode,idx);rng.setEnd(node.parentNode,idx+1);if(content){moveEndPoint(dom,rng,node,true);moveEndPoint(dom,rng,node,false);}return rng;});};var processRanges=function processRanges(editor,ranges){return map$3(ranges,function(range){var evt=editor.dispatch('GetSelectionRange',{range:range});return evt.range!==range?evt.range:range;});};var getEnd=function getEnd(element){return name(element)==='img'?1:getOption(element).fold(function(){return children(element).length;},function(v){return v.length;});};var isTextNodeWithCursorPosition=function isTextNodeWithCursorPosition(el){return getOption(el).filter(function(text){return text.trim().length!==0||text.indexOf(nbsp)>-1;}).isSome();};var elementsWithCursorPosition=['img','br'];var isCursorPosition=function isCursorPosition(elem){var hasCursorPosition=isTextNodeWithCursorPosition(elem);return hasCursorPosition||contains$2(elementsWithCursorPosition,name(elem));};var first=function first(element){return descendant$1(element,isCursorPosition);};var last=function last(element){return descendantRtl(element,isCursorPosition);};var descendantRtl=function descendantRtl(scope,predicate){var descend=function descend(element){var children$1=children(element);for(var i=children$1.length-1;i>=0;i--){var _child2=children$1[i];if(predicate(_child2)){return Optional.some(_child2);}var res=descend(_child2);if(res.isSome()){return res;}}return Optional.none();};return descend(scope);};var autocompleteSelector='[data-mce-autocompleter]';var create$9=function create$9(editor,range){if(findIn(SugarElement.fromDom(editor.getBody())).isNone()){var wrapper=SugarElement.fromHtml('<span data-mce-autocompleter="1" data-mce-bogus="1"></span>',editor.getDoc());append$1(wrapper,SugarElement.fromDom(range.extractContents()));range.insertNode(wrapper.dom);parent(wrapper).each(function(elm){return elm.dom.normalize();});last(wrapper).map(function(last){editor.selection.setCursorLocation(last.dom,getEnd(last));});}};var detect$1=function detect$1(elm){return closest$3(elm,autocompleteSelector);};var findIn=function findIn(elm){return descendant(elm,autocompleteSelector);};var remove$3=function remove$3(editor,elm){return findIn(elm).each(function(wrapper){var bookmark=editor.selection.getBookmark();unwrap(wrapper);editor.selection.moveToBookmark(bookmark);});};var typeLookup={'#text':3,'#comment':8,'#cdata':4,'#pi':7,'#doctype':10,'#document-fragment':11};var walk$2=function walk$2(node,root,prev){var startName=prev?'lastChild':'firstChild';var siblingName=prev?'prev':'next';if(node[startName]){return node[startName];}if(node!==root){var _sibling6=node[siblingName];if(_sibling6){return _sibling6;}for(var _parent2=node.parent;_parent2&&_parent2!==root;_parent2=_parent2.parent){_sibling6=_parent2[siblingName];if(_sibling6){return _sibling6;}}}};var isEmptyTextNode=function isEmptyTextNode(node){if(!isWhitespaceText(node.value)){return false;}var parentNode=node.parent;if(parentNode&&(parentNode.name!=='span'||parentNode.attr('style'))&&/^[ ]+$/.test(node.value)){return false;}return true;};var isNonEmptyElement=function isNonEmptyElement(node){var isNamedAnchor=node.name==='a'&&!node.attr('href')&&node.attr('id');return node.attr('name')||node.attr('id')&&!node.firstChild||node.attr('data-mce-bookmark')||isNamedAnchor;};var AstNode=/*#__PURE__*/function(){function AstNode(name,type){_classCallCheck(this,AstNode);this.name=name;this.type=type;if(type===1){this.attributes=[];this.attributes.map={};}}_createClass(AstNode,[{key:"replace",value:function replace(node){var self=this;if(node.parent){node.remove();}self.insert(node,self);self.remove();return self;}},{key:"attr",value:function attr(name,value){var self=this;var attrs;if(typeof name!=='string'){if(name!==undefined&&name!==null){each$e(name,function(value,key){self.attr(key,value);});}return self;}if(attrs=self.attributes){if(value!==undefined){if(value===null){if(name in attrs.map){delete attrs.map[name];var i=attrs.length;while(i--){if(attrs[i].name===name){attrs.splice(i,1);return self;}}}return self;}if(name in attrs.map){var _i3=attrs.length;while(_i3--){if(attrs[_i3].name===name){attrs[_i3].value=value;break;}}}else{attrs.push({name:name,value:value});}attrs.map[name]=value;return self;}return attrs.map[name];}}},{key:"clone",value:function clone(){var self=this;var clone=new AstNode(self.name,self.type);var selfAttrs;if(selfAttrs=self.attributes){var cloneAttrs=[];cloneAttrs.map={};for(var i=0,l=selfAttrs.length;i<l;i++){var selfAttr=selfAttrs[i];if(selfAttr.name!=='id'){cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value};cloneAttrs.map[selfAttr.name]=selfAttr.value;}}clone.attributes=cloneAttrs;}clone.value=self.value;return clone;}},{key:"wrap",value:function wrap(wrapper){var self=this;self.parent.insert(wrapper,self);wrapper.append(self);return self;}},{key:"unwrap",value:function unwrap(){var self=this;for(var node=self.firstChild;node;){var _next=node.next;self.insert(node,self,true);node=_next;}self.remove();}},{key:"remove",value:function remove(){var self=this,parent=self.parent,next=self.next,prev=self.prev;if(parent){if(parent.firstChild===self){parent.firstChild=next;if(next){next.prev=null;}}else{prev.next=next;}if(parent.lastChild===self){parent.lastChild=prev;if(prev){prev.next=null;}}else{next.prev=prev;}self.parent=self.next=self.prev=null;}return self;}},{key:"append",value:function append(node){var self=this;if(node.parent){node.remove();}var last=self.lastChild;if(last){last.next=node;node.prev=last;self.lastChild=node;}else{self.lastChild=self.firstChild=node;}node.parent=self;return node;}},{key:"insert",value:function insert(node,refNode,before){if(node.parent){node.remove();}var parent=refNode.parent||this;if(before){if(refNode===parent.firstChild){parent.firstChild=node;}else{refNode.prev.next=node;}node.prev=refNode.prev;node.next=refNode;refNode.prev=node;}else{if(refNode===parent.lastChild){parent.lastChild=node;}else{refNode.next.prev=node;}node.next=refNode.next;node.prev=refNode;refNode.next=node;}node.parent=parent;return node;}},{key:"getAll",value:function getAll(name){var self=this;var collection=[];for(var node=self.firstChild;node;node=walk$2(node,self)){if(node.name===name){collection.push(node);}}return collection;}},{key:"children",value:function children(){var self=this;var collection=[];for(var node=self.firstChild;node;node=node.next){collection.push(node);}return collection;}},{key:"empty",value:function empty(){var self=this;if(self.firstChild){var nodes=[];for(var node=self.firstChild;node;node=walk$2(node,self)){nodes.push(node);}var i=nodes.length;while(i--){var _node3=nodes[i];_node3.parent=_node3.firstChild=_node3.lastChild=_node3.next=_node3.prev=null;}}self.firstChild=self.lastChild=null;return self;}},{key:"isEmpty",value:function isEmpty(elements){var whitespace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var predicate=arguments.length>2?arguments[2]:undefined;var self=this;var node=self.firstChild;if(isNonEmptyElement(self)){return false;}if(node){do{if(node.type===1){if(node.attr('data-mce-bogus')){continue;}if(elements[node.name]){return false;}if(isNonEmptyElement(node)){return false;}}if(node.type===8){return false;}if(node.type===3&&!isEmptyTextNode(node)){return false;}if(node.type===3&&node.parent&&whitespace[node.parent.name]&&isWhitespaceText(node.value)){return false;}if(predicate&&predicate(node)){return false;}}while(node=walk$2(node,self));}return true;}},{key:"walk",value:function walk(prev){return walk$2(this,null,prev);}}],[{key:"create",value:function create(name,attrs){var node=new AstNode(name,typeLookup[name]||1);if(attrs){each$e(attrs,function(value,attrName){node.attr(attrName,value);});}return node;}}]);return AstNode;}();var isConditionalComment=function isConditionalComment(html,startIndex){return /^\s*\[if [\w\W]+\]>.*<!\[endif\](--!?)?>/.test(html.substr(startIndex));};var findCommentEndIndex=function findCommentEndIndex(html,isBogus){var startIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var lcHtml=html.toLowerCase();if(lcHtml.indexOf('[if ',startIndex)!==-1&&isConditionalComment(lcHtml,startIndex)){var endIfIndex=lcHtml.indexOf('[endif]',startIndex);return lcHtml.indexOf('>',endIfIndex);}else{if(isBogus){var endIndex=lcHtml.indexOf('>',startIndex);return endIndex!==-1?endIndex:lcHtml.length;}else{var endCommentRegexp=/--!?>/g;endCommentRegexp.lastIndex=startIndex;var _match=endCommentRegexp.exec(html);return _match?_match.index+_match[0].length:lcHtml.length;}}};var findMatchingEndTagIndex=function findMatchingEndTagIndex(schema,html,startIndex){var startTagRegExp=/<([!?\/])?([A-Za-z0-9\-_:.]+)/g;var endTagRegExp=/(?:\s(?:[^'">]+(?:"[^"]*"|'[^']*'))*[^"'>]*(?:"[^">]*|'[^'>]*)?|\s*|\/)>/g;var voidElements=schema.getVoidElements();var count=1,index=startIndex;while(count!==0){startTagRegExp.lastIndex=index;while(true){var startMatch=startTagRegExp.exec(html);if(startMatch===null){return index;}else if(startMatch[1]==='!'){if(startsWith(startMatch[2],'--')){index=findCommentEndIndex(html,false,startMatch.index+'!--'.length);}else{index=findCommentEndIndex(html,true,startMatch.index+1);}break;}else{endTagRegExp.lastIndex=startTagRegExp.lastIndex;var endMatch=endTagRegExp.exec(html);if(isNull(endMatch)||endMatch.index!==startTagRegExp.lastIndex){continue;}if(startMatch[1]==='/'){count-=1;}else if(!has$2(voidElements,startMatch[2])){count+=1;}index=startTagRegExp.lastIndex+endMatch[0].length;break;}}}return index;};var trimHtml$1=function trimHtml$1(tempAttrs,html){var trimContentRegExp=new RegExp(['\\s?('+tempAttrs.join('|')+')="[^"]+"'].join('|'),'gi');return html.replace(trimContentRegExp,'');};var trimInternal=function trimInternal(serializer,html){var bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g;var schema=serializer.schema;var content=trimHtml$1(serializer.getTempAttrs(),html);var voidElements=schema.getVoidElements();var matches;while(matches=bogusAllRegExp.exec(content)){var index=bogusAllRegExp.lastIndex;var matchLength=matches[0].length;var endTagIndex=void 0;if(voidElements[matches[1]]){endTagIndex=index;}else{endTagIndex=findMatchingEndTagIndex(schema,content,index);}content=content.substring(0,index-matchLength)+content.substring(endTagIndex);bogusAllRegExp.lastIndex=index-matchLength;}return trim$1(content);};var trimExternal=trimInternal;var trimEmptyContents=function trimEmptyContents(editor,html){var blockName=getForcedRootBlock(editor);var emptyRegExp=new RegExp("^(<".concat(blockName,"[^>]*>(&nbsp;|&#160;|\\s|\xA0|<br \\/>|)<\\/").concat(blockName,">[\r\n]*|<br \\/>[\r\n]*)$"));return html.replace(emptyRegExp,'');};var getContentFromBody=function getContentFromBody(editor,args,body){var content;if(args.format==='raw'){content=Tools.trim(trimExternal(editor.serializer,body.innerHTML));}else if(args.format==='text'){content=trim$1(body.innerText);content=content==='\n'?'':content;}else if(args.format==='tree'){content=editor.serializer.serialize(body,args);}else{content=trimEmptyContents(editor,editor.serializer.serialize(body,args));}var shouldTrim=args.format!=='text'&&!isWsPreserveElement(SugarElement.fromDom(body));return shouldTrim&&isString(content)?Tools.trim(content):content;};var getContentInternal=function getContentInternal(editor,args){return Optional.from(editor.getBody()).fold(constant(args.format==='tree'?new AstNode('body',11):''),function(body){return getContentFromBody(editor,args,body);});};var each$a=Tools.each;var ElementUtils=function ElementUtils(dom){var compare=function compare(node1,node2){if(node1.nodeName!==node2.nodeName){return false;}var getAttribs=function getAttribs(node){var attribs={};each$a(dom.getAttribs(node),function(attr){var name=attr.nodeName.toLowerCase();if(name.indexOf('_')!==0&&name!=='style'&&name.indexOf('data-')!==0){attribs[name]=dom.getAttrib(node,name);}});return attribs;};var compareObjects=function compareObjects(obj1,obj2){var value,name;for(name in obj1){if(has$2(obj1,name)){value=obj2[name];if(typeof value==='undefined'){return false;}if(obj1[name]!==value){return false;}delete obj2[name];}}for(name in obj2){if(has$2(obj2,name)){return false;}}return true;};if(!compareObjects(getAttribs(node1),getAttribs(node2))){return false;}if(!compareObjects(dom.parseStyle(dom.getAttrib(node1,'style')),dom.parseStyle(dom.getAttrib(node2,'style')))){return false;}return!isBookmarkNode$1(node1)&&!isBookmarkNode$1(node2);};return{compare:compare};};var makeMap$1=Tools.makeMap;var Writer=function Writer(settings){var html=[];settings=settings||{};var indent=settings.indent;var indentBefore=makeMap$1(settings.indent_before||'');var indentAfter=makeMap$1(settings.indent_after||'');var encode=Entities.getEncodeFunc(settings.entity_encoding||'raw',settings.entities);var htmlOutput=settings.element_format!=='xhtml';return{start:function start(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=='\n'){html.push('\n');}}html.push('<',name);if(attrs){for(i=0,l=attrs.length;i<l;i++){attr=attrs[i];html.push(' ',attr.name,'="',encode(attr.value,true),'"');}}if(!empty||htmlOutput){html[html.length]='>';}else{html[html.length]=' />';}if(empty&&indent&&indentAfter[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=='\n'){html.push('\n');}}},end:function end(name){var value;html.push('</',name,'>');if(indent&&indentAfter[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=='\n'){html.push('\n');}}},text:function text(_text2,raw){if(_text2.length>0){html[html.length]=raw?_text2:encode(_text2);}},cdata:function cdata(text){html.push('<![CDATA[',text,']]>');},comment:function comment(text){html.push('<!--',text,'-->');},pi:function pi(name,text){if(text){html.push('<?',name,' ',encode(text),'?>');}else{html.push('<?',name,'?>');}if(indent){html.push('\n');}},doctype:function doctype(text){html.push('<!DOCTYPE',text,'>',indent?'\n':'');},reset:function reset(){html.length=0;},getContent:function getContent(){return html.join('').replace(/\n$/,'');}};};var HtmlSerializer=function HtmlSerializer(settings){var schema=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Schema();var writer=Writer(settings);settings=settings||{};settings.validate='validate'in settings?settings.validate:true;var serialize=function serialize(node){var validate=settings.validate;var handlers={3:function _(node){writer.text(node.value,node.raw);},8:function _(node){writer.comment(node.value);},7:function _(node){writer.pi(node.name,node.value);},10:function _(node){writer.doctype(node.value);},4:function _(node){writer.cdata(node.value);},11:function _(node){if(node=node.firstChild){do{walk(node);}while(node=node.next);}}};writer.reset();var walk=function walk(node){var handler=handlers[node.type];if(!handler){var _name3=node.name;var _isEmpty=_name3 in schema.getVoidElements();var attrs=node.attributes;if(validate&&attrs&&attrs.length>1){var sortedAttrs=[];sortedAttrs.map={};var elementRule=schema.getElementRule(node.name);if(elementRule){for(var i=0,l=elementRule.attributesOrder.length;i<l;i++){var attrName=elementRule.attributesOrder[i];if(attrName in attrs.map){var attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue;sortedAttrs.push({name:attrName,value:attrValue});}}for(var _i4=0,_l=attrs.length;_i4<_l;_i4++){var _attrName=attrs[_i4].name;if(!(_attrName in sortedAttrs.map)){var _attrValue=attrs.map[_attrName];sortedAttrs.map[_attrName]=_attrValue;sortedAttrs.push({name:_attrName,value:_attrValue});}}attrs=sortedAttrs;}}writer.start(_name3,attrs,_isEmpty);if(!_isEmpty){var _child3=node.firstChild;if(_child3){if((_name3==='pre'||_name3==='textarea')&&_child3.type===3&&_child3.value[0]==='\n'){writer.text('\n',true);}do{walk(_child3);}while(_child3=_child3.next);}writer.end(_name3);}}else{handler(node);}};if(node.type===1&&!settings.inner){walk(node);}else if(node.type===3){handlers[3](node);}else{handlers[11](node);}return writer.getContent();};return{serialize:serialize};};var nonInheritableStyles=new Set();(function(){var nonInheritableStylesArr=['margin','margin-left','margin-right','margin-top','margin-bottom','padding','padding-left','padding-right','padding-top','padding-bottom','border','border-width','border-style','border-color','background','background-attachment','background-clip','background-color','background-image','background-origin','background-position','background-repeat','background-size','float','position','left','right','top','bottom','z-index','display','transform','width','max-width','min-width','height','max-height','min-height','overflow','overflow-x','overflow-y','text-overflow','vertical-align','transition','transition-delay','transition-duration','transition-property','transition-timing-function'];each$f(nonInheritableStylesArr,function(style){nonInheritableStyles.add(style);});})();var shorthandStyleProps=['font','text-decoration','text-emphasis'];var getStyleProps=function getStyleProps(dom,node){return keys(dom.parseStyle(dom.getAttrib(node,'style')));};var isNonInheritableStyle=function isNonInheritableStyle(style){return nonInheritableStyles.has(style);};var hasInheritableStyles=function hasInheritableStyles(dom,node){return forall(getStyleProps(dom,node),function(style){return!isNonInheritableStyle(style);});};var getLonghandStyleProps=function getLonghandStyleProps(styles){return filter$6(styles,function(style){return exists(shorthandStyleProps,function(prop){return startsWith(style,prop);});});};var hasStyleConflict=function hasStyleConflict(dom,node,parentNode){var nodeStyleProps=getStyleProps(dom,node);var parentNodeStyleProps=getStyleProps(dom,parentNode);var valueMismatch=function valueMismatch(prop){var _a,_b;var nodeValue=(_a=dom.getStyle(node,prop))!==null&&_a!==void 0?_a:'';var parentValue=(_b=dom.getStyle(parentNode,prop))!==null&&_b!==void 0?_b:'';return isNotEmpty(nodeValue)&&isNotEmpty(parentValue)&&nodeValue!==parentValue;};return exists(nodeStyleProps,function(nodeStyleProp){var propExists=function propExists(props){return exists(props,function(prop){return prop===nodeStyleProp;});};if(!propExists(parentNodeStyleProps)&&propExists(shorthandStyleProps)){var longhandProps=getLonghandStyleProps(parentNodeStyleProps);return exists(longhandProps,valueMismatch);}else{return valueMismatch(nodeStyleProp);}});};var isChar=function isChar(forward,predicate,pos){return Optional.from(pos.container()).filter(isText$9).exists(function(text){var delta=forward?0:-1;return predicate(text.data.charAt(pos.offset()+delta));});};var isBeforeSpace=curry(isChar,true,isWhiteSpace);var isAfterSpace=curry(isChar,false,isWhiteSpace);var isEmptyText=function isEmptyText(pos){var container=pos.container();return isText$9(container)&&(container.data.length===0||isZwsp(container.data)&&BookmarkManager.isBookmarkNode(container.parentNode));};var matchesElementPosition=function matchesElementPosition(before,predicate){return function(pos){return Optional.from(getChildNodeAtRelativeOffset(before?0:-1,pos)).filter(predicate).isSome();};};var isImageBlock=function isImageBlock(node){return isImg(node)&&get$7(SugarElement.fromDom(node),'display')==='block';};var isCefNode=function isCefNode(node){return isContentEditableFalse$b(node)&&!isBogusAll$1(node);};var isBeforeImageBlock=matchesElementPosition(true,isImageBlock);var isAfterImageBlock=matchesElementPosition(false,isImageBlock);var isBeforeMedia=matchesElementPosition(true,isMedia$2);var isAfterMedia=matchesElementPosition(false,isMedia$2);var isBeforeTable=matchesElementPosition(true,isTable$3);var isAfterTable=matchesElementPosition(false,isTable$3);var isBeforeContentEditableFalse=matchesElementPosition(true,isCefNode);var isAfterContentEditableFalse=matchesElementPosition(false,isCefNode);var dropLast=function dropLast(xs){return xs.slice(0,-1);};var parentsUntil=function parentsUntil(start,root,predicate){if(contains(root,start)){return dropLast(parents$1(start,function(elm){return predicate(elm)||eq(elm,root);}));}else{return[];}};var parents=function parents(start,root){return parentsUntil(start,root,never);};var parentsAndSelf=function parentsAndSelf(start,root){return[start].concat(parents(start,root));};var navigateIgnoreEmptyTextNodes=function navigateIgnoreEmptyTextNodes(forward,root,from){return navigateIgnore(forward,root,from,isEmptyText);};var getClosestBlock$1=function getClosestBlock$1(root,pos){return find$2(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);};var isAtBeforeAfterBlockBoundary=function isAtBeforeAfterBlockBoundary(forward,root,pos){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall(function(newPos){return getClosestBlock$1(root,pos).fold(function(){return isInSameBlock(newPos,pos,root.dom)===false;},function(fromBlock){return isInSameBlock(newPos,pos,root.dom)===false&&contains(fromBlock,SugarElement.fromDom(newPos.container()));});});};var isAtBlockBoundary=function isAtBlockBoundary(forward,root,pos){return getClosestBlock$1(root,pos).fold(function(){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall(function(newPos){return isInSameBlock(newPos,pos,root.dom)===false;});},function(parent){return navigateIgnoreEmptyTextNodes(forward,parent.dom,pos).isNone();});};var isAtStartOfBlock=curry(isAtBlockBoundary,false);var isAtEndOfBlock=curry(isAtBlockBoundary,true);var isBeforeBlock=curry(isAtBeforeAfterBlockBoundary,false);var isAfterBlock=curry(isAtBeforeAfterBlockBoundary,true);var isBr$1=function isBr$1(pos){return getElementFromPosition(pos).exists(isBr$5);};var findBr=function findBr(forward,root,pos){var parentBlocks=filter$6(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);var scope=head(parentBlocks).getOr(root);return fromPosition(forward,scope.dom,pos).filter(isBr$1);};var isBeforeBr$1=function isBeforeBr$1(root,pos){return getElementFromPosition(pos).exists(isBr$5)||findBr(true,root,pos).isSome();};var isAfterBr=function isAfterBr(root,pos){return getElementFromPrevPosition(pos).exists(isBr$5)||findBr(false,root,pos).isSome();};var findPreviousBr=curry(findBr,false);var findNextBr=curry(findBr,true);var isInMiddleOfText=function isInMiddleOfText(pos){return CaretPosition.isTextPosition(pos)&&!pos.isAtStart()&&!pos.isAtEnd();};var getClosestBlock=function getClosestBlock(root,pos){var parentBlocks=filter$6(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);return head(parentBlocks).getOr(root);};var hasSpaceBefore=function hasSpaceBefore(root,pos){if(isInMiddleOfText(pos)){return isAfterSpace(pos);}else{return isAfterSpace(pos)||prevPosition(getClosestBlock(root,pos).dom,pos).exists(isAfterSpace);}};var hasSpaceAfter=function hasSpaceAfter(root,pos){if(isInMiddleOfText(pos)){return isBeforeSpace(pos);}else{return isBeforeSpace(pos)||nextPosition(getClosestBlock(root,pos).dom,pos).exists(isBeforeSpace);}};var isPreValue=function isPreValue(value){return contains$2(['pre','pre-wrap'],value);};var isInPre=function isInPre(pos){return getElementFromPosition(pos).bind(function(elm){return closest$4(elm,isElement$7);}).exists(function(elm){return isPreValue(get$7(elm,'white-space'));});};var isAtBeginningOfBody=function isAtBeginningOfBody(root,pos){return prevPosition(root.dom,pos).isNone();};var isAtEndOfBody=function isAtEndOfBody(root,pos){return nextPosition(root.dom,pos).isNone();};var isAtLineBoundary=function isAtLineBoundary(root,pos){return isAtBeginningOfBody(root,pos)||isAtEndOfBody(root,pos)||isAtStartOfBlock(root,pos)||isAtEndOfBlock(root,pos)||isAfterBr(root,pos)||isBeforeBr$1(root,pos);};var isCefBlock=function isCefBlock(node){return isNonNullable(node)&&isContentEditableFalse$b(node)&&isBlockLike(node);};var isSiblingCefBlock=function isSiblingCefBlock(root){return function(container){return isCefBlock(new DomTreeWalker(container,root).next());};};var isBeforeCefBlock=function isBeforeCefBlock(root,pos){var nextPos=nextPosition(root.dom,pos).getOr(pos);var isNextCefBlock=isSiblingCefBlock(root.dom);return pos.isAtEnd()&&(isNextCefBlock(pos.container())||isNextCefBlock(nextPos.container()));};var needsToHaveNbsp=function needsToHaveNbsp(root,pos){if(isInPre(pos)){return false;}else{return isAtLineBoundary(root,pos)||hasSpaceBefore(root,pos)||hasSpaceAfter(root,pos);}};var needsToBeNbspLeft=function needsToBeNbspLeft(root,pos){if(isInPre(pos)){return false;}else{return isAtStartOfBlock(root,pos)||isBeforeBlock(root,pos)||isAfterBr(root,pos)||hasSpaceBefore(root,pos);}};var leanRight=function leanRight(pos){var container=pos.container();var offset=pos.offset();if(isText$9(container)&&offset<container.data.length){return CaretPosition(container,offset+1);}else{return pos;}};var needsToBeNbspRight=function needsToBeNbspRight(root,pos){if(isInPre(pos)){return false;}else{return isAtEndOfBlock(root,pos)||isAfterBlock(root,pos)||isBeforeBr$1(root,pos)||hasSpaceAfter(root,pos)||isBeforeCefBlock(root,pos);}};var needsToBeNbsp=function needsToBeNbsp(root,pos){return needsToBeNbspLeft(root,pos)||needsToBeNbspRight(root,leanRight(pos));};var isNbspAt=function isNbspAt(text,offset){return isNbsp(text.charAt(offset));};var hasNbsp=function hasNbsp(pos){var container=pos.container();return isText$9(container)&&contains$1(container.data,nbsp);};var normalizeNbspMiddle=function normalizeNbspMiddle(text){var chars=text.split('');return map$3(chars,function(chr,i){if(isNbsp(chr)&&i>0&&i<chars.length-1&&isContent(chars[i-1])&&isContent(chars[i+1])){return' ';}else{return chr;}}).join('');};var normalizeNbspAtStart=function normalizeNbspAtStart(root,node){var text=node.data;var firstPos=CaretPosition(node,0);if(isNbspAt(text,0)&&!needsToBeNbsp(root,firstPos)){node.data=' '+text.slice(1);return true;}else{return false;}};var normalizeNbspInMiddleOfTextNode=function normalizeNbspInMiddleOfTextNode(node){var text=node.data;var newText=normalizeNbspMiddle(text);if(newText!==text){node.data=newText;return true;}else{return false;}};var normalizeNbspAtEnd=function normalizeNbspAtEnd(root,node){var text=node.data;var lastPos=CaretPosition(node,text.length-1);if(isNbspAt(text,text.length-1)&&!needsToBeNbsp(root,lastPos)){node.data=text.slice(0,-1)+' ';return true;}else{return false;}};var normalizeNbsps=function normalizeNbsps(root,pos){return Optional.some(pos).filter(hasNbsp).bind(function(pos){var container=pos.container();var normalized=normalizeNbspAtStart(root,container)||normalizeNbspInMiddleOfTextNode(container)||normalizeNbspAtEnd(root,container);return normalized?Optional.some(pos):Optional.none();});};var normalizeNbspsInEditor=function normalizeNbspsInEditor(editor){var root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){normalizeNbsps(root,CaretPosition.fromRangeStart(editor.selection.getRng())).each(function(pos){editor.selection.setRng(pos.toRange());});}};var normalize$1=function normalize$1(node,offset,count){if(count===0){return;}var elm=SugarElement.fromDom(node);var root=ancestor$3(elm,isBlock$2).getOr(elm);var whitespace=node.data.slice(offset,offset+count);var isEndOfContent=offset+count>=node.data.length&&needsToBeNbspRight(root,CaretPosition(node,node.data.length));var isStartOfContent=offset===0&&needsToBeNbspLeft(root,CaretPosition(node,0));node.replaceData(offset,count,normalize$4(whitespace,4,isStartOfContent,isEndOfContent));};var normalizeWhitespaceAfter=function normalizeWhitespaceAfter(node,offset){var content=node.data.slice(offset);var whitespaceCount=content.length-lTrim(content).length;normalize$1(node,offset,whitespaceCount);};var normalizeWhitespaceBefore=function normalizeWhitespaceBefore(node,offset){var content=node.data.slice(0,offset);var whitespaceCount=content.length-rTrim(content).length;normalize$1(node,offset-whitespaceCount,whitespaceCount);};var mergeTextNodes=function mergeTextNodes(prevNode,nextNode,normalizeWhitespace){var mergeToPrev=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var whitespaceOffset=rTrim(prevNode.data).length;var newNode=mergeToPrev?prevNode:nextNode;var removeNode=mergeToPrev?nextNode:prevNode;if(mergeToPrev){newNode.appendData(removeNode.data);}else{newNode.insertData(0,removeNode.data);}remove$6(SugarElement.fromDom(removeNode));if(normalizeWhitespace){normalizeWhitespaceAfter(newNode,whitespaceOffset);}return newNode;};var needsReposition=function needsReposition(pos,elm){var container=pos.container();var offset=pos.offset();return CaretPosition.isTextPosition(pos)===false&&container===elm.parentNode&&offset>CaretPosition.before(elm).offset();};var reposition=function reposition(elm,pos){return needsReposition(pos,elm)?CaretPosition(pos.container(),pos.offset()-1):pos;};var beforeOrStartOf=function beforeOrStartOf(node){return isText$9(node)?CaretPosition(node,0):CaretPosition.before(node);};var afterOrEndOf=function afterOrEndOf(node){return isText$9(node)?CaretPosition(node,node.data.length):CaretPosition.after(node);};var getPreviousSiblingCaretPosition=function getPreviousSiblingCaretPosition(elm){if(isCaretCandidate$3(elm.previousSibling)){return Optional.some(afterOrEndOf(elm.previousSibling));}else{return elm.previousSibling?lastPositionIn(elm.previousSibling):Optional.none();}};var getNextSiblingCaretPosition=function getNextSiblingCaretPosition(elm){if(isCaretCandidate$3(elm.nextSibling)){return Optional.some(beforeOrStartOf(elm.nextSibling));}else{return elm.nextSibling?firstPositionIn(elm.nextSibling):Optional.none();}};var findCaretPositionBackwardsFromElm=function findCaretPositionBackwardsFromElm(rootElement,elm){var startPosition=CaretPosition.before(elm.previousSibling?elm.previousSibling:elm.parentNode);return prevPosition(rootElement,startPosition).fold(function(){return nextPosition(rootElement,CaretPosition.after(elm));},Optional.some);};var findCaretPositionForwardsFromElm=function findCaretPositionForwardsFromElm(rootElement,elm){return nextPosition(rootElement,CaretPosition.after(elm)).fold(function(){return prevPosition(rootElement,CaretPosition.before(elm));},Optional.some);};var findCaretPositionBackwards=function findCaretPositionBackwards(rootElement,elm){return getPreviousSiblingCaretPosition(elm).orThunk(function(){return getNextSiblingCaretPosition(elm);}).orThunk(function(){return findCaretPositionBackwardsFromElm(rootElement,elm);});};var findCaretPositionForward=function findCaretPositionForward(rootElement,elm){return getNextSiblingCaretPosition(elm).orThunk(function(){return getPreviousSiblingCaretPosition(elm);}).orThunk(function(){return findCaretPositionForwardsFromElm(rootElement,elm);});};var findCaretPosition=function findCaretPosition(forward,rootElement,elm){return forward?findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm);};var findCaretPosOutsideElmAfterDelete=function findCaretPosOutsideElmAfterDelete(forward,rootElement,elm){return findCaretPosition(forward,rootElement,elm).map(curry(reposition,elm));};var setSelection$1=function setSelection$1(editor,forward,pos){pos.fold(function(){editor.focus();},function(pos){editor.selection.setRng(pos.toRange(),forward);});};var eqRawNode=function eqRawNode(rawNode){return function(elm){return elm.dom===rawNode;};};var isBlock=function isBlock(editor,elm){return elm&&has$2(editor.schema.getBlockElements(),name(elm));};var paddEmptyBlock=function paddEmptyBlock(elm){if(isEmpty$2(elm)){var br=SugarElement.fromHtml('<br data-mce-bogus="1">');empty(elm);append$1(elm,br);return Optional.some(CaretPosition.before(br.dom));}else{return Optional.none();}};var deleteNormalized=function deleteNormalized(elm,afterDeletePosOpt,normalizeWhitespace){var prevTextOpt=prevSibling(elm).filter(isText$a);var nextTextOpt=nextSibling(elm).filter(isText$a);remove$6(elm);return lift3(prevTextOpt,nextTextOpt,afterDeletePosOpt,function(prev,next,pos){var prevNode=prev.dom,nextNode=next.dom;var offset=prevNode.data.length;mergeTextNodes(prevNode,nextNode,normalizeWhitespace);return pos.container()===nextNode?CaretPosition(prevNode,offset):pos;}).orThunk(function(){if(normalizeWhitespace){prevTextOpt.each(function(elm){return normalizeWhitespaceBefore(elm.dom,elm.dom.length);});nextTextOpt.each(function(elm){return normalizeWhitespaceAfter(elm.dom,0);});}return afterDeletePosOpt;});};var isInlineElement=function isInlineElement(editor,element){return has$2(editor.schema.getTextInlineElements(),name(element));};var deleteElement$2=function deleteElement$2(editor,forward,elm){var moveCaret=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom);var parentBlock=ancestor$3(elm,curry(isBlock,editor),eqRawNode(editor.getBody()));var normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos,isInlineElement(editor,elm));if(editor.dom.isEmpty(editor.getBody())){editor.setContent('');editor.selection.setCursorLocation();}else{parentBlock.bind(paddEmptyBlock).fold(function(){if(moveCaret){setSelection$1(editor,forward,normalizedAfterDeletePos);}},function(paddPos){if(moveCaret){setSelection$1(editor,forward,Optional.some(paddPos));}});}};var strongRtl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/;var hasStrongRtl=function hasStrongRtl(text){return strongRtl.test(text);};var isInlineTarget=function isInlineTarget(editor,elm){return is$1(SugarElement.fromDom(elm),getInlineBoundarySelector(editor));};var isRtl=function isRtl(element){return DOMUtils.DOM.getStyle(element,'direction',true)==='rtl'||hasStrongRtl(element.textContent);};var findInlineParents=function findInlineParents(isInlineTarget,rootNode,pos){return filter$6(DOMUtils.DOM.getParents(pos.container(),'*',rootNode),isInlineTarget);};var findRootInline=function findRootInline(isInlineTarget,rootNode,pos){var parents=findInlineParents(isInlineTarget,rootNode,pos);return Optional.from(parents[parents.length-1]);};var hasSameParentBlock=function hasSameParentBlock(rootNode,node1,node2){var block1=getParentBlock$3(node1,rootNode);var block2=getParentBlock$3(node2,rootNode);return block1&&block1===block2;};var isAtZwsp=function isAtZwsp(pos){return isBeforeInline(pos)||isAfterInline(pos);};var normalizePosition=function normalizePosition(forward,pos){if(!pos){return pos;}var container=pos.container(),offset=pos.offset();if(forward){if(isCaretContainerInline(container)){if(isText$9(container.nextSibling)){return CaretPosition(container.nextSibling,0);}else{return CaretPosition.after(container);}}else{return isBeforeInline(pos)?CaretPosition(container,offset+1):pos;}}else{if(isCaretContainerInline(container)){if(isText$9(container.previousSibling)){return CaretPosition(container.previousSibling,container.previousSibling.data.length);}else{return CaretPosition.before(container);}}else{return isAfterInline(pos)?CaretPosition(container,offset-1):pos;}}};var normalizeForwards=curry(normalizePosition,true);var normalizeBackwards=curry(normalizePosition,false);var execCommandIgnoreInputEvents=function execCommandIgnoreInputEvents(editor,command){var inputBlocker=function inputBlocker(e){return e.stopImmediatePropagation();};editor.on('beforeinput input',inputBlocker,true);editor.getDoc().execCommand(command);editor.off('beforeinput input',inputBlocker);};var execDeleteCommand=function execDeleteCommand(editor){return execCommandIgnoreInputEvents(editor,'Delete');};var execForwardDeleteCommand=function execForwardDeleteCommand(editor){return execCommandIgnoreInputEvents(editor,'ForwardDelete');};var isBeforeRoot=function isBeforeRoot(rootNode){return function(elm){return eq(rootNode,SugarElement.fromDom(elm.dom.parentNode));};};var isTextBlockOrListItem=function isTextBlockOrListItem(element){return isTextBlock$2(element)||isListItem(element);};var getParentBlock$2=function getParentBlock$2(rootNode,elm){if(contains(rootNode,elm)){return closest$4(elm,isTextBlockOrListItem,isBeforeRoot(rootNode));}else{return Optional.none();}};var paddEmptyBody=function paddEmptyBody(editor){var moveSelection=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(editor.dom.isEmpty(editor.getBody())){editor.setContent('',{no_selection:!moveSelection});}};var willDeleteLastPositionInElement=function willDeleteLastPositionInElement(forward,fromPos,elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(true,firstPos);var normalizedLastPos=normalizePosition(false,lastPos);var normalizedFromPos=normalizePosition(false,fromPos);if(forward){return nextPosition(elm,normalizedFromPos).exists(function(nextPos){return nextPos.isEqual(normalizedLastPos)&&fromPos.isEqual(normalizedFirstPos);});}else{return prevPosition(elm,normalizedFromPos).exists(function(prevPos){return prevPos.isEqual(normalizedFirstPos)&&fromPos.isEqual(normalizedLastPos);});}}).getOr(true);};var freefallRtl=function freefallRtl(root){var child=isComment$1(root)?prevSibling(root):lastChild(root);return child.bind(freefallRtl).orThunk(function(){return Optional.some(root);});};var deleteRangeContents=function deleteRangeContents(editor,rng,root){var moveSelection=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var _a;rng.deleteContents();var lastNode=freefallRtl(root).getOr(root);var lastBlock=SugarElement.fromDom((_a=editor.dom.getParent(lastNode.dom,editor.dom.isBlock))!==null&&_a!==void 0?_a:root.dom);if(lastBlock.dom===editor.getBody()){paddEmptyBody(editor,moveSelection);}else if(isEmpty$2(lastBlock)){fillWithPaddingBr(lastBlock);if(moveSelection){editor.selection.setCursorLocation(lastBlock.dom,0);}}if(!eq(root,lastBlock)){var additionalCleanupNodes=is$2(parent(lastBlock),root)?[]:siblings(lastBlock);each$f(additionalCleanupNodes.concat(children(root)),function(node){if(!eq(node,lastBlock)&&!contains(node,lastBlock)&&isEmpty$2(node)){remove$6(node);}});}};var isRootFromElement=function isRootFromElement(root){return function(cur){return eq(root,cur);};};var getTableCells=function getTableCells(table){return descendants(table,'td,th');};var getTableDetailsFromRange=function getTableDetailsFromRange(rng,isRoot){var getTable=function getTable(node){return getClosestTable(SugarElement.fromDom(node),isRoot);};var startTable=getTable(rng.startContainer);var endTable=getTable(rng.endContainer);var isStartInTable=startTable.isSome();var isEndInTable=endTable.isSome();var isSameTable=lift2(startTable,endTable,eq).getOr(false);var isMultiTable=!isSameTable&&isStartInTable&&isEndInTable;return{startTable:startTable,endTable:endTable,isStartInTable:isStartInTable,isEndInTable:isEndInTable,isSameTable:isSameTable,isMultiTable:isMultiTable};};var tableCellRng=function tableCellRng(start,end){return{start:start,end:end};};var tableSelection=function tableSelection(rng,table,cells){return{rng:rng,table:table,cells:cells};};var deleteAction=Adt.generate([{singleCellTable:['rng','cell']},{fullTable:['table']},{partialTable:['cells','outsideDetails']},{multiTable:['startTableCells','endTableCells','betweenRng']}]);var getClosestCell$1=function getClosestCell$1(container,isRoot){return closest$3(SugarElement.fromDom(container),'td,th',isRoot);};var isExpandedCellRng=function isExpandedCellRng(cellRng){return!eq(cellRng.start,cellRng.end);};var getTableFromCellRng=function getTableFromCellRng(cellRng,isRoot){return getClosestTable(cellRng.start,isRoot).bind(function(startParentTable){return getClosestTable(cellRng.end,isRoot).bind(function(endParentTable){return someIf(eq(startParentTable,endParentTable),startParentTable);});});};var isSingleCellTable=function isSingleCellTable(cellRng,isRoot){return!isExpandedCellRng(cellRng)&&getTableFromCellRng(cellRng,isRoot).exists(function(table){var rows=table.dom.rows;return rows.length===1&&rows[0].cells.length===1;});};var getCellRng=function getCellRng(rng,isRoot){var startCell=getClosestCell$1(rng.startContainer,isRoot);var endCell=getClosestCell$1(rng.endContainer,isRoot);return lift2(startCell,endCell,tableCellRng);};var getCellRangeFromStartTable=function getCellRangeFromStartTable(isRoot){return function(startCell){return getClosestTable(startCell,isRoot).bind(function(table){return last$3(getTableCells(table)).map(function(endCell){return tableCellRng(startCell,endCell);});});};};var getCellRangeFromEndTable=function getCellRangeFromEndTable(isRoot){return function(endCell){return getClosestTable(endCell,isRoot).bind(function(table){return head(getTableCells(table)).map(function(startCell){return tableCellRng(startCell,endCell);});});};};var getTableSelectionFromCellRng=function getTableSelectionFromCellRng(isRoot){return function(cellRng){return getTableFromCellRng(cellRng,isRoot).map(function(table){return tableSelection(cellRng,table,getTableCells(table));});};};var getTableSelections=function getTableSelections(cellRng,selectionDetails,rng,isRoot){if(rng.collapsed||!cellRng.forall(isExpandedCellRng)){return Optional.none();}else if(selectionDetails.isSameTable){var sameTableSelection=cellRng.bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:sameTableSelection,end:sameTableSelection});}else{var startCell=getClosestCell$1(rng.startContainer,isRoot);var endCell=getClosestCell$1(rng.endContainer,isRoot);var startTableSelection=startCell.bind(getCellRangeFromStartTable(isRoot)).bind(getTableSelectionFromCellRng(isRoot));var endTableSelection=endCell.bind(getCellRangeFromEndTable(isRoot)).bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:startTableSelection,end:endTableSelection});}};var getCellIndex=function getCellIndex(cells,cell){return findIndex$2(cells,function(x){return eq(x,cell);});};var getSelectedCells=function getSelectedCells(tableSelection){return lift2(getCellIndex(tableSelection.cells,tableSelection.rng.start),getCellIndex(tableSelection.cells,tableSelection.rng.end),function(startIndex,endIndex){return tableSelection.cells.slice(startIndex,endIndex+1);});};var isSingleCellTableContentSelected=function isSingleCellTableContentSelected(optCellRng,rng,isRoot){return optCellRng.exists(function(cellRng){return isSingleCellTable(cellRng,isRoot)&&hasAllContentsSelected(cellRng.start,rng);});};var unselectCells=function unselectCells(rng,selectionDetails){var startTable=selectionDetails.startTable,endTable=selectionDetails.endTable;var otherContentRng=rng.cloneRange();startTable.each(function(table){return otherContentRng.setStartAfter(table.dom);});endTable.each(function(table){return otherContentRng.setEndBefore(table.dom);});return otherContentRng;};var handleSingleTable=function handleSingleTable(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind(function(_ref8){var start=_ref8.start,end=_ref8.end;return start.or(end);}).bind(function(tableSelection){var isSameTable=selectionDetails.isSameTable;var selectedCells=getSelectedCells(tableSelection).getOr([]);if(isSameTable&&tableSelection.cells.length===selectedCells.length){return Optional.some(deleteAction.fullTable(tableSelection.table));}else if(selectedCells.length>0){if(isSameTable){return Optional.some(deleteAction.partialTable(selectedCells,Optional.none()));}else{var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.partialTable(selectedCells,Optional.some(_objectSpread({},selectionDetails,{rng:otherContentRng}))));}}else{return Optional.none();}});};var handleMultiTable=function handleMultiTable(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind(function(_ref9){var start=_ref9.start,end=_ref9.end;var startTableSelectedCells=start.bind(getSelectedCells).getOr([]);var endTableSelectedCells=end.bind(getSelectedCells).getOr([]);if(startTableSelectedCells.length>0&&endTableSelectedCells.length>0){var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.multiTable(startTableSelectedCells,endTableSelectedCells,otherContentRng));}else{return Optional.none();}});};var getActionFromRange=function getActionFromRange(root,rng){var isRoot=isRootFromElement(root);var optCellRng=getCellRng(rng,isRoot);var selectionDetails=getTableDetailsFromRange(rng,isRoot);if(isSingleCellTableContentSelected(optCellRng,rng,isRoot)){return optCellRng.map(function(cellRng){return deleteAction.singleCellTable(rng,cellRng.start);});}else if(selectionDetails.isMultiTable){return handleMultiTable(optCellRng,selectionDetails,rng,isRoot);}else{return handleSingleTable(optCellRng,selectionDetails,rng,isRoot);}};var cleanCells=function cleanCells(cells){return each$f(cells,function(cell){remove$b(cell,'contenteditable');fillWithPaddingBr(cell);});};var getOutsideBlock=function getOutsideBlock(editor,container){return Optional.from(editor.dom.getParent(container,editor.dom.isBlock)).map(SugarElement.fromDom);};var handleEmptyBlock=function handleEmptyBlock(editor,startInTable,emptyBlock){emptyBlock.each(function(block){if(startInTable){remove$6(block);}else{fillWithPaddingBr(block);editor.selection.setCursorLocation(block.dom,0);}});};var deleteContentInsideCell=function deleteContentInsideCell(editor,cell,rng,isFirstCellInSelection){var insideTableRng=rng.cloneRange();if(isFirstCellInSelection){insideTableRng.setStart(rng.startContainer,rng.startOffset);insideTableRng.setEndAfter(cell.dom.lastChild);}else{insideTableRng.setStartBefore(cell.dom.firstChild);insideTableRng.setEnd(rng.endContainer,rng.endOffset);}deleteCellContents(editor,insideTableRng,cell,false).each(function(action){return action();});};var collapseAndRestoreCellSelection=function collapseAndRestoreCellSelection(editor){var selectedCells=getCellsFromEditor(editor);var selectedNode=SugarElement.fromDom(editor.selection.getNode());if(isTableCell$5(selectedNode.dom)&&isEmpty$2(selectedNode)){editor.selection.setCursorLocation(selectedNode.dom,0);}else{editor.selection.collapse(true);}if(selectedCells.length>1&&exists(selectedCells,function(cell){return eq(cell,selectedNode);})){set$2(selectedNode,'data-mce-selected','1');}};var emptySingleTableCells=function emptySingleTableCells(editor,cells,outsideDetails){return Optional.some(function(){var editorRng=editor.selection.getRng();var cellsToClean=outsideDetails.bind(function(_ref10){var rng=_ref10.rng,isStartInTable=_ref10.isStartInTable;var outsideBlock=getOutsideBlock(editor,isStartInTable?rng.endContainer:rng.startContainer);rng.deleteContents();handleEmptyBlock(editor,isStartInTable,outsideBlock.filter(isEmpty$2));var endPointCell=isStartInTable?cells[0]:cells[cells.length-1];deleteContentInsideCell(editor,endPointCell,editorRng,isStartInTable);if(!isEmpty$2(endPointCell)){return Optional.some(isStartInTable?cells.slice(1):cells.slice(0,-1));}else{return Optional.none();}}).getOr(cells);cleanCells(cellsToClean);collapseAndRestoreCellSelection(editor);});};var emptyMultiTableCells=function emptyMultiTableCells(editor,startTableCells,endTableCells,betweenRng){return Optional.some(function(){var rng=editor.selection.getRng();var startCell=startTableCells[0];var endCell=endTableCells[endTableCells.length-1];deleteContentInsideCell(editor,startCell,rng,true);deleteContentInsideCell(editor,endCell,rng,false);var startTableCellsToClean=isEmpty$2(startCell)?startTableCells:startTableCells.slice(1);var endTableCellsToClean=isEmpty$2(endCell)?endTableCells:endTableCells.slice(0,-1);cleanCells(startTableCellsToClean.concat(endTableCellsToClean));betweenRng.deleteContents();collapseAndRestoreCellSelection(editor);});};var deleteCellContents=function deleteCellContents(editor,rng,cell){var moveSelection=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;return Optional.some(function(){deleteRangeContents(editor,rng,cell,moveSelection);});};var deleteTableElement=function deleteTableElement(editor,table){return Optional.some(function(){return deleteElement$2(editor,false,table);});};var deleteCellRange=function deleteCellRange(editor,rootElm,rng){return getActionFromRange(rootElm,rng).bind(function(action){return action.fold(curry(deleteCellContents,editor),curry(deleteTableElement,editor),curry(emptySingleTableCells,editor),curry(emptyMultiTableCells,editor));});};var deleteCaptionRange=function deleteCaptionRange(editor,caption){return emptyElement(editor,caption);};var deleteTableRange=function deleteTableRange(editor,rootElm,rng,startElm){return getParentCaption(rootElm,startElm).fold(function(){return deleteCellRange(editor,rootElm,rng);},function(caption){return deleteCaptionRange(editor,caption);});};var deleteRange$2=function deleteRange$2(editor,startElm,selectedCells){var rootNode=SugarElement.fromDom(editor.getBody());var rng=editor.selection.getRng();return selectedCells.length!==0?emptySingleTableCells(editor,selectedCells,Optional.none()):deleteTableRange(editor,rootNode,rng,startElm);};var getParentCell=function getParentCell(rootElm,elm){return find$2(parentsAndSelf(elm,rootElm),isTableCell$4);};var getParentCaption=function getParentCaption(rootElm,elm){return find$2(parentsAndSelf(elm,rootElm),isTag('caption'));};var deleteBetweenCells=function deleteBetweenCells(editor,rootElm,forward,fromCell,from){return navigate(forward,editor.getBody(),from).bind(function(to){return getParentCell(rootElm,SugarElement.fromDom(to.getNode())).bind(function(toCell){return eq(toCell,fromCell)?Optional.none():Optional.some(noop);});});};var emptyElement=function emptyElement(editor,elm){return Optional.some(function(){fillWithPaddingBr(elm);editor.selection.setCursorLocation(elm.dom,0);});};var isDeleteOfLastCharPos=function isDeleteOfLastCharPos(fromCaption,forward,from,to){return firstPositionIn(fromCaption.dom).bind(function(first){return lastPositionIn(fromCaption.dom).map(function(last){return forward?from.isEqual(first)&&to.isEqual(last):from.isEqual(last)&&to.isEqual(first);});}).getOr(true);};var emptyCaretCaption=function emptyCaretCaption(editor,elm){return emptyElement(editor,elm);};var validateCaretCaption=function validateCaretCaption(rootElm,fromCaption,to){return getParentCaption(rootElm,SugarElement.fromDom(to.getNode())).fold(function(){return Optional.some(noop);},function(toCaption){return someIf(!eq(toCaption,fromCaption),noop);});};var deleteCaretInsideCaption=function deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from){return navigate(forward,editor.getBody(),from).fold(function(){return Optional.some(noop);},function(to){return isDeleteOfLastCharPos(fromCaption,forward,from,to)?emptyCaretCaption(editor,fromCaption):validateCaretCaption(rootElm,fromCaption,to);});};var deleteCaretCells=function deleteCaretCells(editor,forward,rootElm,startElm){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return getParentCell(rootElm,startElm).bind(function(fromCell){return isEmpty$2(fromCell)?emptyElement(editor,fromCell):deleteBetweenCells(editor,rootElm,forward,fromCell,from);});};var deleteCaretCaption=function deleteCaretCaption(editor,forward,rootElm,fromCaption){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return isEmpty$2(fromCaption)?emptyElement(editor,fromCaption):deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from);};var isNearTable=function isNearTable(forward,pos){return forward?isBeforeTable(pos):isAfterTable(pos);};var isBeforeOrAfterTable=function isBeforeOrAfterTable(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return isNearTable(forward,fromPos)||fromPosition(forward,editor.getBody(),fromPos).exists(function(pos){return isNearTable(forward,pos);});};var deleteCaret$3=function deleteCaret$3(editor,forward,startElm){var rootElm=SugarElement.fromDom(editor.getBody());return getParentCaption(rootElm,startElm).fold(function(){return deleteCaretCells(editor,forward,rootElm,startElm).orThunk(function(){return someIf(isBeforeOrAfterTable(editor,forward),noop);});},function(fromCaption){return deleteCaretCaption(editor,forward,rootElm,fromCaption);});};var backspaceDelete$9=function backspaceDelete$9(editor,forward){var startElm=SugarElement.fromDom(editor.selection.getStart(true));var cells=getCellsFromEditor(editor);return editor.selection.isCollapsed()&&cells.length===0?deleteCaret$3(editor,forward,startElm):deleteRange$2(editor,startElm,cells);};var getContentEditableRoot$1=function getContentEditableRoot$1(root,node){while(node&&node!==root){if(isContentEditableTrue$5(node)||isContentEditableFalse$b(node)){return node;}node=node.parentNode;}return null;};var traverse=function traverse(node,fn){fn(node);if(node.firstChild){traverse(node.firstChild,fn);}if(node.next){traverse(node.next,fn);}};var matchNode$1=function matchNode$1(nodeFilters,attributeFilters,node,matches){var name=node.name;for(var ni=0,nl=nodeFilters.length;ni<nl;ni++){var _filter=nodeFilters[ni];if(_filter.name===name){var _match2=matches.nodes[name];if(_match2){_match2.nodes.push(node);}else{matches.nodes[name]={filter:_filter,nodes:[node]};}}}if(node.attributes){for(var ai=0,al=attributeFilters.length;ai<al;ai++){var _filter2=attributeFilters[ai];var attrName=_filter2.name;if(attrName in node.attributes.map){var _match3=matches.attributes[attrName];if(_match3){_match3.nodes.push(node);}else{matches.attributes[attrName]={filter:_filter2,nodes:[node]};}}}}};var findMatchingNodes=function findMatchingNodes(nodeFilters,attributeFilters,node){var matches={nodes:{},attributes:{}};if(node.firstChild){traverse(node.firstChild,function(node){matchNode$1(nodeFilters,attributeFilters,node,matches);});}return matches;};var runFilters=function runFilters(matches,args){var run=function run(matchRecord){each$e(matchRecord,function(match){var nodes=filter$6(match.nodes,function(node){return isNonNullable(node.parent);});each$f(match.filter.callbacks,function(callback){callback(nodes,match.filter.name,args);});});};run(matches.nodes);run(matches.attributes);};var filter$3=function filter$3(nodeFilters,attributeFilters,node){var args=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var matches=findMatchingNodes(nodeFilters,attributeFilters,node);runFilters(matches,args);};var paddEmptyNode=function paddEmptyNode(settings,args,blockElements,node){if(args.insert&&blockElements[node.name]){node.empty().append(new AstNode('br',1));}else{node.empty().append(new AstNode('#text',3)).value=nbsp;}};var isPaddedWithNbsp=function isPaddedWithNbsp(node){return hasOnlyChild(node,'#text')&&node.firstChild.value===nbsp;};var hasOnlyChild=function hasOnlyChild(node,name){return node&&node.firstChild&&node.firstChild===node.lastChild&&node.firstChild.name===name;};var isPadded=function isPadded(schema,node){var rule=schema.getElementRule(node.name);return rule&&rule.paddEmpty;};var isEmpty=function isEmpty(schema,nonEmptyElements,whitespaceElements,node){return node.isEmpty(nonEmptyElements,whitespaceElements,function(node){return isPadded(schema,node);});};var isLineBreakNode=function isLineBreakNode(node,blockElements){return node&&(node.name in blockElements||node.name==='br');};var removeOrUnwrapInvalidNode=function removeOrUnwrapInvalidNode(node,schema){var originalNodeParent=arguments.length>2&&arguments[2]!==undefined?arguments[2]:node.parent;if(schema.getSpecialElements()[node.name]){node.empty().remove();}else{var _children=node.children();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=_children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var childNode=_step2.value;if(!schema.isValidChild(originalNodeParent.name,childNode.name)){removeOrUnwrapInvalidNode(childNode,schema,originalNodeParent);}}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}node.unwrap();}};var cleanInvalidNodes=function cleanInvalidNodes(nodes,schema){var onCreate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:noop;var textBlockElements=schema.getTextBlockElements();var nonEmptyElements=schema.getNonEmptyElements();var whitespaceElements=schema.getWhitespaceElements();var nonSplittableElements=Tools.makeMap('tr,td,th,tbody,thead,tfoot,table');var fixed=new Set();for(var ni=0;ni<nodes.length;ni++){var node=nodes[ni];var _parent3=void 0;var newParent=void 0;var tempNode=void 0;if(!node.parent||fixed.has(node)){continue;}if(textBlockElements[node.name]&&node.parent.name==='li'){var _sibling7=node.next;while(_sibling7){if(textBlockElements[_sibling7.name]){_sibling7.name='li';fixed.add(_sibling7);node.parent.insert(_sibling7,node.parent);}else{break;}_sibling7=_sibling7.next;}node.unwrap();continue;}var _parents=[node];for(_parent3=node.parent;_parent3&&!schema.isValidChild(_parent3.name,node.name)&&!nonSplittableElements[_parent3.name];_parent3=_parent3.parent){_parents.push(_parent3);}if(_parent3&&_parents.length>1){if(schema.isValidChild(_parent3.name,node.name)){_parents.reverse();newParent=_parents[0].clone();onCreate(newParent);var currentNode=newParent;for(var i=0;i<_parents.length-1;i++){if(schema.isValidChild(currentNode.name,_parents[i].name)){tempNode=_parents[i].clone();onCreate(tempNode);currentNode.append(tempNode);}else{tempNode=currentNode;}for(var childNode=_parents[i].firstChild;childNode&&childNode!==_parents[i+1];){var nextNode=childNode.next;tempNode.append(childNode);childNode=nextNode;}currentNode=tempNode;}if(!isEmpty(schema,nonEmptyElements,whitespaceElements,newParent)){_parent3.insert(newParent,_parents[0],true);_parent3.insert(node,newParent);}else{_parent3.insert(node,_parents[0],true);}_parent3=_parents[0];if(isEmpty(schema,nonEmptyElements,whitespaceElements,_parent3)||hasOnlyChild(_parent3,'br')){_parent3.empty().remove();}}else{removeOrUnwrapInvalidNode(node,schema);}}else if(node.parent){if(node.name==='li'){var _sibling8=node.prev;if(_sibling8&&(_sibling8.name==='ul'||_sibling8.name==='ol')){_sibling8.append(node);continue;}_sibling8=node.next;if(_sibling8&&(_sibling8.name==='ul'||_sibling8.name==='ol')){_sibling8.insert(node,_sibling8.firstChild,true);continue;}var wrapper=new AstNode('ul',1);onCreate(wrapper);node.wrap(wrapper);continue;}if(schema.isValidChild(node.parent.name,'div')&&schema.isValidChild('div',node.name)){var _wrapper=new AstNode('div',1);onCreate(_wrapper);node.wrap(_wrapper);}else{removeOrUnwrapInvalidNode(node,schema);}}}};var createRange=function createRange(sc,so,ec,eo){var rng=document.createRange();rng.setStart(sc,so);rng.setEnd(ec,eo);return rng;};var normalizeBlockSelectionRange=function normalizeBlockSelectionRange(rng){var startPos=CaretPosition.fromRangeStart(rng);var endPos=CaretPosition.fromRangeEnd(rng);var rootNode=rng.commonAncestorContainer;return fromPosition(false,rootNode,endPos).map(function(newEndPos){if(!isInSameBlock(startPos,endPos,rootNode)&&isInSameBlock(startPos,newEndPos,rootNode)){return createRange(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset());}else{return rng;}}).getOr(rng);};var normalize=function normalize(rng){return rng.collapsed?rng:normalizeBlockSelectionRange(rng);};var hasOnlyOneChild$1=function hasOnlyOneChild$1(node){return node.firstChild&&node.firstChild===node.lastChild;};var isPaddingNode=function isPaddingNode(node){return node.name==='br'||node.value===nbsp;};var isPaddedEmptyBlock=function isPaddedEmptyBlock(schema,node){var blockElements=schema.getBlockElements();return blockElements[node.name]&&hasOnlyOneChild$1(node)&&isPaddingNode(node.firstChild);};var isEmptyFragmentElement=function isEmptyFragmentElement(schema,node){var nonEmptyElements=schema.getNonEmptyElements();return node&&(node.isEmpty(nonEmptyElements)||isPaddedEmptyBlock(schema,node));};var isListFragment=function isListFragment(schema,fragment){var firstChild=fragment.firstChild;var lastChild=fragment.lastChild;if(firstChild&&firstChild.name==='meta'){firstChild=firstChild.next;}if(lastChild&&lastChild.attr('id')==='mce_marker'){lastChild=lastChild.prev;}if(isEmptyFragmentElement(schema,lastChild)){lastChild=lastChild.prev;}if(!firstChild||firstChild!==lastChild){return false;}return firstChild.name==='ul'||firstChild.name==='ol';};var cleanupDomFragment=function cleanupDomFragment(domFragment){var firstChild=domFragment.firstChild;var lastChild=domFragment.lastChild;if(firstChild&&firstChild.nodeName==='META'){firstChild.parentNode.removeChild(firstChild);}if(lastChild&&lastChild.id==='mce_marker'){lastChild.parentNode.removeChild(lastChild);}return domFragment;};var toDomFragment=function toDomFragment(dom,serializer,fragment){var html=serializer.serialize(fragment);var domFragment=dom.createFragment(html);return cleanupDomFragment(domFragment);};var listItems=function listItems(elm){return filter$6(elm.childNodes,function(child){return child.nodeName==='LI';});};var isPadding=function isPadding(node){return node.data===nbsp||isBr$6(node);};var isListItemPadded=function isListItemPadded(node){return node&&node.firstChild&&node.firstChild===node.lastChild&&isPadding(node.firstChild);};var isEmptyOrPadded=function isEmptyOrPadded(elm){return!elm.firstChild||isListItemPadded(elm);};var trimListItems=function trimListItems(elms){return elms.length>0&&isEmptyOrPadded(elms[elms.length-1])?elms.slice(0,-1):elms;};var getParentLi=function getParentLi(dom,node){var parentBlock=dom.getParent(node,dom.isBlock);return parentBlock&&parentBlock.nodeName==='LI'?parentBlock:null;};var isParentBlockLi=function isParentBlockLi(dom,node){return!!getParentLi(dom,node);};var getSplit=function getSplit(parentNode,rng){var beforeRng=rng.cloneRange();var afterRng=rng.cloneRange();beforeRng.setStartBefore(parentNode);afterRng.setEndAfter(parentNode);return[beforeRng.cloneContents(),afterRng.cloneContents()];};var findFirstIn=function findFirstIn(node,rootNode){var caretPos=CaretPosition.before(node);var caretWalker=CaretWalker(rootNode);var newCaretPos=caretWalker.next(caretPos);return newCaretPos?newCaretPos.toRange():null;};var findLastOf=function findLastOf(node,rootNode){var caretPos=CaretPosition.after(node);var caretWalker=CaretWalker(rootNode);var newCaretPos=caretWalker.prev(caretPos);return newCaretPos?newCaretPos.toRange():null;};var insertMiddle=function insertMiddle(target,elms,rootNode,rng){var parts=getSplit(target,rng);var parentElm=target.parentNode;parentElm.insertBefore(parts[0],target);Tools.each(elms,function(li){parentElm.insertBefore(li,target);});parentElm.insertBefore(parts[1],target);parentElm.removeChild(target);return findLastOf(elms[elms.length-1],rootNode);};var insertBefore$1=function insertBefore$1(target,elms,rootNode){var parentElm=target.parentNode;Tools.each(elms,function(elm){parentElm.insertBefore(elm,target);});return findFirstIn(target,rootNode);};var insertAfter$1=function insertAfter$1(target,elms,rootNode,dom){dom.insertAfter(elms.reverse(),target);return findLastOf(elms[0],rootNode);};var insertAtCaret$1=function insertAtCaret$1(serializer,dom,rng,fragment){var domFragment=toDomFragment(dom,serializer,fragment);var liTarget=getParentLi(dom,rng.startContainer);var liElms=trimListItems(listItems(domFragment.firstChild));var BEGINNING=1,END=2;var rootNode=dom.getRoot();var isAt=function isAt(location){var caretPos=CaretPosition.fromRangeStart(rng);var caretWalker=CaretWalker(dom.getRoot());var newPos=location===BEGINNING?caretWalker.prev(caretPos):caretWalker.next(caretPos);return newPos?getParentLi(dom,newPos.getNode())!==liTarget:true;};if(isAt(BEGINNING)){return insertBefore$1(liTarget,liElms,rootNode);}else if(isAt(END)){return insertAfter$1(liTarget,liElms,rootNode,dom);}return insertMiddle(liTarget,liElms,rootNode,rng);};var mergeableWrappedElements=['pre'];var shouldPasteContentOnly=function shouldPasteContentOnly(dom,fragment,parentNode,root){var _a;var firstNode=fragment.firstChild;var lastNode=fragment.lastChild;var last=lastNode.attr('data-mce-type')==='bookmark'?lastNode.prev:lastNode;var isPastingSingleElement=firstNode===last;var isWrappedElement=contains$2(mergeableWrappedElements,firstNode.name);if(isPastingSingleElement&&isWrappedElement){var isContentEditable=firstNode.attr('contenteditable')!=='false';var isPastingInTheSameBlockTag=((_a=dom.getParent(parentNode,dom.isBlock))===null||_a===void 0?void 0:_a.nodeName.toLowerCase())===firstNode.name;var isPastingInContentEditable=Optional.from(getContentEditableRoot$1(root,parentNode)).forall(isContentEditableTrue$5);return isContentEditable&&isPastingInTheSameBlockTag&&isPastingInContentEditable;}else{return false;}};var isTableCell$1=isTableCell$5;var isTableCellContentSelected=function isTableCellContentSelected(dom,rng,cell){if(cell!==null){var endCell=dom.getParent(rng.endContainer,isTableCell$1);return cell===endCell&&hasAllContentsSelected(SugarElement.fromDom(cell),rng);}else{return false;}};var validInsertion=function validInsertion(editor,value,parentNode){if(parentNode.getAttribute('data-mce-bogus')==='all'){parentNode.parentNode.insertBefore(editor.dom.createFragment(value),parentNode);}else{var node=parentNode.firstChild;var node2=parentNode.lastChild;if(!node||node===node2&&node.nodeName==='BR'){editor.dom.setHTML(parentNode,value);}else{editor.selection.setContent(value,{no_events:true});}}};var trimBrsFromTableCell=function trimBrsFromTableCell(dom,elm){Optional.from(dom.getParent(elm,'td,th')).map(SugarElement.fromDom).each(trimBlockTrailingBr);};var reduceInlineTextElements=function reduceInlineTextElements(editor,merge){var textInlineElements=editor.schema.getTextInlineElements();var dom=editor.dom;if(merge){var root=editor.getBody();var elementUtils=ElementUtils(dom);Tools.each(dom.select('*[data-mce-fragment]'),function(node){var isInline=isNonNullable(textInlineElements[node.nodeName.toLowerCase()]);if(isInline&&hasInheritableStyles(dom,node)){for(var parentNode=node.parentNode;isNonNullable(parentNode)&&parentNode!==root;parentNode=parentNode.parentNode){var styleConflict=hasStyleConflict(dom,node,parentNode);if(styleConflict){break;}if(elementUtils.compare(parentNode,node)){dom.remove(node,true);break;}}}});}};var markFragmentElements=function markFragmentElements(fragment){var node=fragment;while(node=node.walk()){if(node.type===1){node.attr('data-mce-fragment','1');}}};var unmarkFragmentElements=function unmarkFragmentElements(elm){Tools.each(elm.getElementsByTagName('*'),function(elm){elm.removeAttribute('data-mce-fragment');});};var isPartOfFragment=function isPartOfFragment(node){return!!node.getAttribute('data-mce-fragment');};var canHaveChildren=function canHaveChildren(editor,node){return node&&!editor.schema.getVoidElements()[node.nodeName];};var moveSelectionToMarker=function moveSelectionToMarker(editor,marker){var nextRng;var dom=editor.dom;var selection=editor.selection;if(!marker){return;}selection.scrollIntoView(marker);var parentEditableElm=getContentEditableRoot$1(editor.getBody(),marker);if(dom.getContentEditable(parentEditableElm)==='false'){dom.remove(marker);selection.select(parentEditableElm);return;}var rng=dom.createRng();var node=marker.previousSibling;if(isText$9(node)){rng.setStart(node,node.nodeValue.length);var node2=marker.nextSibling;if(isText$9(node2)){node.appendData(node2.data);node2.parentNode.removeChild(node2);}}else{rng.setStartBefore(marker);rng.setEndBefore(marker);}var findNextCaretRng=function findNextCaretRng(rng){var caretPos=CaretPosition.fromRangeStart(rng);var caretWalker=CaretWalker(editor.getBody());caretPos=caretWalker.next(caretPos);if(caretPos){return caretPos.toRange();}};var parentBlock=dom.getParent(marker,dom.isBlock);dom.remove(marker);if(parentBlock&&dom.isEmpty(parentBlock)){empty(SugarElement.fromDom(parentBlock));rng.setStart(parentBlock,0);rng.setEnd(parentBlock,0);if(!isTableCell$1(parentBlock)&&!isPartOfFragment(parentBlock)&&(nextRng=findNextCaretRng(rng))){rng=nextRng;dom.remove(parentBlock);}else{dom.add(parentBlock,dom.create('br',{'data-mce-bogus':'1'}));}}selection.setRng(rng);};var deleteSelectedContent=function deleteSelectedContent(editor){var dom=editor.dom;var rng=normalize(editor.selection.getRng());editor.selection.setRng(rng);var startCell=dom.getParent(rng.startContainer,isTableCell$1);if(isTableCellContentSelected(dom,rng,startCell)){deleteCellContents(editor,rng,SugarElement.fromDom(startCell));}else{editor.getDoc().execCommand('Delete',false,null);}};var insertHtmlAtCaret=function insertHtmlAtCaret(editor,value,details){var _a;var parentNode;var rng,node;var selection=editor.selection;var dom=editor.dom;var parser=editor.parser;var merge=details.merge;var serializer=HtmlSerializer({validate:true},editor.schema);var bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;</span>';if(value.indexOf('{$caret}')===-1){value+='{$caret}';}value=value.replace(/\{\$caret\}/,bookmarkHtml);rng=selection.getRng();var caretElement=rng.startContainer||(rng.parentElement?rng.parentElement():null);var body=editor.getBody();if(caretElement===body&&selection.isCollapsed()){if(dom.isBlock(body.firstChild)&&canHaveChildren(editor,body.firstChild)&&dom.isEmpty(body.firstChild)){rng=dom.createRng();rng.setStart(body.firstChild,0);rng.setEnd(body.firstChild,0);selection.setRng(rng);}}if(!selection.isCollapsed()){deleteSelectedContent(editor);}parentNode=selection.getNode();var parserArgs={context:parentNode.nodeName.toLowerCase(),data:details.data,insert:true};var fragment=parser.parse(value,parserArgs);if(details.paste===true&&isListFragment(editor.schema,fragment)&&isParentBlockLi(dom,parentNode)){rng=insertAtCaret$1(serializer,dom,selection.getRng(),fragment);selection.setRng(rng);return value;}if(details.paste===true&&shouldPasteContentOnly(dom,fragment,parentNode,editor.getBody())){(_a=fragment.firstChild)===null||_a===void 0?void 0:_a.unwrap();}markFragmentElements(fragment);node=fragment.lastChild;if(node.attr('id')==='mce_marker'){var marker=node;for(node=node.prev;node;node=node.walk(true)){if(node.type===3||!dom.isBlock(node.name)){if(editor.schema.isValidChild(node.parent.name,'span')){node.parent.insert(marker,node,node.name==='br');}break;}}}editor._selectionOverrides.showBlockCaretContainer(parentNode);if(!parserArgs.invalid){value=serializer.serialize(fragment);validInsertion(editor,value,parentNode);}else{editor.selection.setContent(bookmarkHtml);parentNode=selection.getNode();var rootNode=editor.getBody();if(parentNode.nodeType===9){parentNode=node=rootNode;}else{node=parentNode;}while(node!==rootNode){parentNode=node;node=node.parentNode;}value=parentNode===rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode);var root=parser.parse(value);for(var markerNode=root;markerNode;markerNode=markerNode.walk()){if(markerNode.attr('id')==='mce_marker'){markerNode.replace(fragment);break;}}var toExtract=fragment.children();var _parent4=fragment.parent.name;fragment.unwrap();var invalidChildren=filter$6(toExtract,function(node){return!editor.schema.isValidChild(_parent4,node.name);});cleanInvalidNodes(invalidChildren,editor.schema);filter$3(parser.getNodeFilters(),parser.getAttributeFilters(),root);value=serializer.serialize(root);if(parentNode===rootNode){dom.setHTML(rootNode,value);}else{dom.setOuterHTML(parentNode,value);}}reduceInlineTextElements(editor,merge);moveSelectionToMarker(editor,dom.get('mce_marker'));unmarkFragmentElements(editor.getBody());trimBrsFromTableCell(dom,selection.getStart());return value;};var isTreeNode=function isTreeNode(content){return content instanceof AstNode;};var moveSelection=function moveSelection(editor){if(_hasFocus(editor)){firstPositionIn(editor.getBody()).each(function(pos){var node=pos.getNode();var caretPos=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange());});}};var setEditorHtml=function setEditorHtml(editor,html,noSelection){editor.dom.setHTML(editor.getBody(),html);if(noSelection!==true){moveSelection(editor);}};var setContentString=function setContentString(editor,body,content,args){if(content.length===0||/^\s+$/.test(content)){var padd='<br data-mce-bogus="1">';if(body.nodeName==='TABLE'){content='<tr><td>'+padd+'</td></tr>';}else if(/^(UL|OL)$/.test(body.nodeName)){content='<li>'+padd+'</li>';}var forcedRootBlockName=getForcedRootBlock(editor);if(editor.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())){content=padd;content=editor.dom.createHTML(forcedRootBlockName,getForcedRootBlockAttrs(editor),content);}else if(!content){content=padd;}setEditorHtml(editor,content,args.no_selection);return{content:content,html:content};}else{if(args.format!=='raw'){content=HtmlSerializer({validate:false},editor.schema).serialize(editor.parser.parse(content,{isRootContent:true,insert:true}));}var trimmedHtml=isWsPreserveElement(SugarElement.fromDom(body))?content:Tools.trim(content);setEditorHtml(editor,trimmedHtml,args.no_selection);return{content:trimmedHtml,html:trimmedHtml};}};var setContentTree=function setContentTree(editor,body,content,args){filter$3(editor.parser.getNodeFilters(),editor.parser.getAttributeFilters(),content);var html=HtmlSerializer({validate:false},editor.schema).serialize(content);var trimmedHtml=isWsPreserveElement(SugarElement.fromDom(body))?html:Tools.trim(html);setEditorHtml(editor,trimmedHtml,args.no_selection);return{content:content,html:trimmedHtml};};var setContentInternal=function setContentInternal(editor,content,args){return Optional.from(editor.getBody()).map(function(body){if(isTreeNode(content)){return setContentTree(editor,body,content,args);}else{return setContentString(editor,body,content,args);}}).getOr({content:content,html:isTreeNode(args.content)?'':args.content});};var sibling=function sibling(scope,predicate){return sibling$1(scope,predicate).isSome();};var ensureIsRoot=function ensureIsRoot(isRoot){return isFunction(isRoot)?isRoot:never;};var ancestor=function ancestor(scope,transform,isRoot){var element=scope.dom;var stop=ensureIsRoot(isRoot);while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);var transformed=transform(el);if(transformed.isSome()){return transformed;}else if(stop(el)){break;}}return Optional.none();};var closest$2=function closest$2(scope,transform,isRoot){var current=transform(scope);var stop=ensureIsRoot(isRoot);return current.orThunk(function(){return stop(scope)?Optional.none():ancestor(scope,transform,stop);});};var isEq$3=isEq$5;var matchesUnInheritedFormatSelector=function matchesUnInheritedFormatSelector(ed,node,name){var formatList=ed.formatter.get(name);if(formatList){for(var i=0;i<formatList.length;i++){var format=formatList[i];if(isSelectorFormat(format)&&format.inherit===false&&ed.dom.is(node,format.selector)){return true;}}}return false;};var matchParents=function matchParents(editor,node,name,vars,similar){var root=editor.dom.getRoot();if(node===root){return false;}node=editor.dom.getParent(node,function(node){if(matchesUnInheritedFormatSelector(editor,node,name)){return true;}return node.parentNode===root||!!_matchNode(editor,node,name,vars,true);});return!!_matchNode(editor,node,name,vars,similar);};var matchName=function matchName(dom,node,format){if(isInlineFormat(format)&&isEq$3(node,format.inline)){return true;}if(isBlockFormat(format)&&isEq$3(node,format.block)){return true;}if(isSelectorFormat(format)){return isElement$6(node)&&dom.is(node,format.selector);}return false;};var matchItems=function matchItems(dom,node,format,itemName,similar,vars){var items=format[itemName];if(isFunction(format.onmatch)){return format.onmatch(node,format,itemName);}if(items){if(isUndefined(items.length)){for(var key in items){if(has$2(items,key)){var _value3=itemName==='attributes'?dom.getAttrib(node,key):getStyle(dom,node,key);var expectedValue=replaceVars(items[key],vars);var isEmptyValue=isNullable(_value3)||isEmpty$3(_value3);if(isEmptyValue&&isNullable(expectedValue)){continue;}if(similar&&isEmptyValue&&!format.exact){return false;}if((!similar||format.exact)&&!isEq$3(_value3,normalizeStyleValue(expectedValue,key))){return false;}}}}else{for(var i=0;i<items.length;i++){if(itemName==='attributes'?dom.getAttrib(node,items[i]):getStyle(dom,node,items[i])){return true;}}}}return true;};var _matchNode=function matchNode(ed,node,name,vars,similar){var formatList=ed.formatter.get(name);var dom=ed.dom;if(formatList&&node){for(var i=0;i<formatList.length;i++){var format=formatList[i];if(matchName(ed.dom,node,format)&&matchItems(dom,node,format,'attributes',similar,vars)&&matchItems(dom,node,format,'styles',similar,vars)){var classes=format.classes;if(classes){for(var x=0;x<classes.length;x++){if(!ed.dom.hasClass(node,replaceVars(classes[x],vars))){return;}}}return format;}}}};var match$2=function match$2(editor,name,vars,node,similar){if(node){return matchParents(editor,node,name,vars,similar);}node=editor.selection.getNode();if(matchParents(editor,node,name,vars,similar)){return true;}var startNode=editor.selection.getStart();if(startNode!==node){if(matchParents(editor,startNode,name,vars,similar)){return true;}}return false;};var _matchAll=function matchAll(editor,names,vars){var matchedFormatNames=[];var checkedMap={};var startElement=editor.selection.getStart();editor.dom.getParent(startElement,function(node){for(var i=0;i<names.length;i++){var _name4=names[i];if(!checkedMap[_name4]&&_matchNode(editor,node,_name4,vars)){checkedMap[_name4]=true;matchedFormatNames.push(_name4);}}},editor.dom.getRoot());return matchedFormatNames;};var closest$1=function closest$1(editor,names){var isRoot=function isRoot(elm){return eq(elm,SugarElement.fromDom(editor.getBody()));};var match=function match(elm,name){return _matchNode(editor,elm.dom,name)?Optional.some(name):Optional.none();};return Optional.from(editor.selection.getStart(true)).bind(function(rawElm){return closest$2(SugarElement.fromDom(rawElm),function(elm){return findMap(names,function(name){return match(elm,name);});},isRoot);}).getOrNull();};var _canApply=function canApply(editor,name){var formatList=editor.formatter.get(name);var dom=editor.dom;if(formatList){var startNode=editor.selection.getStart();var _parents2=getParents$2(dom,startNode);for(var x=formatList.length-1;x>=0;x--){var format=formatList[x];if(!isSelectorFormat(format)){return true;}for(var i=_parents2.length-1;i>=0;i--){if(dom.is(_parents2[i],format.selector)){return true;}}}}return false;};var matchAllOnNode=function matchAllOnNode(editor,node,formatNames){return foldl(formatNames,function(acc,name){var matchSimilar=isVariableFormatName(editor,name);if(editor.formatter.matchNode(node,name,{},matchSimilar)){return acc.concat([name]);}else{return acc;}},[]);};var ZWSP=ZWSP$1,CARET_ID='_mce_caret';var importNode=function importNode(ownerDocument,node){return ownerDocument.importNode(node,true);};var getEmptyCaretContainers=function getEmptyCaretContainers(node){var nodes=[];while(node){if(node.nodeType===3&&node.nodeValue!==ZWSP||node.childNodes.length>1){return[];}if(node.nodeType===1){nodes.push(node);}node=node.firstChild;}return nodes;};var isCaretContainerEmpty=function isCaretContainerEmpty(node){return getEmptyCaretContainers(node).length>0;};var findFirstTextNode=function findFirstTextNode(node){if(node){var walker=new DomTreeWalker(node,node);for(node=walker.current();node;node=walker.next()){if(isText$9(node)){return node;}}}return null;};var createCaretContainer=function createCaretContainer(fill){var caretContainer=SugarElement.fromTag('span');setAll$1(caretContainer,{'id':CARET_ID,'data-mce-bogus':'1','data-mce-type':'format-caret'});if(fill){append$1(caretContainer,SugarElement.fromText(ZWSP));}return caretContainer;};var trimZwspFromCaretContainer=function trimZwspFromCaretContainer(caretContainerNode){var textNode=findFirstTextNode(caretContainerNode);if(textNode&&textNode.nodeValue.charAt(0)===ZWSP){textNode.deleteData(0,1);}return textNode;};var removeCaretContainerNode=function removeCaretContainerNode(editor,node){var moveCaret=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var dom=editor.dom,selection=editor.selection;if(isCaretContainerEmpty(node)){deleteElement$2(editor,false,SugarElement.fromDom(node),moveCaret);}else{var rng=selection.getRng();var block=dom.getParent(node,dom.isBlock);var startContainer=rng.startContainer;var startOffset=rng.startOffset;var endContainer=rng.endContainer;var endOffset=rng.endOffset;var textNode=trimZwspFromCaretContainer(node);dom.remove(node,true);if(startContainer===textNode&&startOffset>0){rng.setStart(textNode,startOffset-1);}if(endContainer===textNode&&endOffset>0){rng.setEnd(textNode,endOffset-1);}if(block&&dom.isEmpty(block)){fillWithPaddingBr(SugarElement.fromDom(block));}selection.setRng(rng);}};var removeCaretContainer=function removeCaretContainer(editor,node){var moveCaret=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var dom=editor.dom,selection=editor.selection;if(!node){node=getParentCaretContainer(editor.getBody(),selection.getStart());if(!node){while(node=dom.get(CARET_ID)){removeCaretContainerNode(editor,node,false);}}}else{removeCaretContainerNode(editor,node,moveCaret);}};var insertCaretContainerNode=function insertCaretContainerNode(editor,caretContainer,formatNode){var dom=editor.dom,block=dom.getParent(formatNode,curry(isTextBlock$1,editor));if(block&&dom.isEmpty(block)){formatNode.parentNode.replaceChild(caretContainer,formatNode);}else{removeTrailingBr(SugarElement.fromDom(formatNode));if(dom.isEmpty(formatNode)){formatNode.parentNode.replaceChild(caretContainer,formatNode);}else{dom.insertAfter(caretContainer,formatNode);}}};var appendNode=function appendNode(parentNode,node){parentNode.appendChild(node);return node;};var insertFormatNodesIntoCaretContainer=function insertFormatNodesIntoCaretContainer(formatNodes,caretContainer){var innerMostFormatNode=foldr(formatNodes,function(parentNode,formatNode){return appendNode(parentNode,formatNode.cloneNode(false));},caretContainer);return appendNode(innerMostFormatNode,innerMostFormatNode.ownerDocument.createTextNode(ZWSP));};var cleanFormatNode=function cleanFormatNode(editor,caretContainer,formatNode,name,vars,similar){var formatter=editor.formatter;var dom=editor.dom;var validFormats=filter$6(keys(formatter.get()),function(formatName){return formatName!==name&&!contains$1(formatName,'removeformat');});var matchedFormats=matchAllOnNode(editor,formatNode,validFormats);var uniqueFormats=filter$6(matchedFormats,function(fmtName){return!areSimilarFormats(editor,fmtName,name);});if(uniqueFormats.length>0){var clonedFormatNode=formatNode.cloneNode(false);dom.add(caretContainer,clonedFormatNode);formatter.remove(name,vars,clonedFormatNode,similar);dom.remove(clonedFormatNode);return Optional.some(clonedFormatNode);}else{return Optional.none();}};var applyCaretFormat=function applyCaretFormat(editor,name,vars){var caretContainer,textNode;var selection=editor.selection;var selectionRng=selection.getRng();var offset=selectionRng.startOffset;var container=selectionRng.startContainer;var text=container.nodeValue;caretContainer=getParentCaretContainer(editor.getBody(),selection.getStart());if(caretContainer){textNode=findFirstTextNode(caretContainer);}var wordcharRegex=/[^\s\u00a0\u00ad\u200b\ufeff]/;if(text&&offset>0&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))){var bookmark=selection.getBookmark();selectionRng.collapse(true);var rng=expandRng(editor,selectionRng,editor.formatter.get(name));rng=split(rng);editor.formatter.apply(name,vars,rng);selection.moveToBookmark(bookmark);}else{if(!caretContainer||textNode.nodeValue!==ZWSP){caretContainer=importNode(editor.getDoc(),createCaretContainer(true).dom);textNode=caretContainer.firstChild;selectionRng.insertNode(caretContainer);offset=1;editor.formatter.apply(name,vars,caretContainer);}else{editor.formatter.apply(name,vars,caretContainer);}selection.setCursorLocation(textNode,offset);}};var removeCaretFormat=function removeCaretFormat(editor,name,vars,similar){var dom=editor.dom;var selection=editor.selection;var hasContentAfter,node,formatNode;var parents=[];var rng=selection.getRng();var container=rng.startContainer;var offset=rng.startOffset;node=container;if(container.nodeType===3){if(offset!==container.nodeValue.length){hasContentAfter=true;}node=node.parentNode;}while(node){if(_matchNode(editor,node,name,vars,similar)){formatNode=node;break;}if(node.nextSibling){hasContentAfter=true;}parents.push(node);node=node.parentNode;}if(!formatNode){return;}if(hasContentAfter){var bookmark=selection.getBookmark();rng.collapse(true);var expandedRng=expandRng(editor,rng,editor.formatter.get(name),true);expandedRng=split(expandedRng);editor.formatter.remove(name,vars,expandedRng,similar);selection.moveToBookmark(bookmark);}else{var caretContainer=getParentCaretContainer(editor.getBody(),formatNode);var newCaretContainer=createCaretContainer(false).dom;insertCaretContainerNode(editor,newCaretContainer,caretContainer!==null?caretContainer:formatNode);var cleanedFormatNode=cleanFormatNode(editor,newCaretContainer,formatNode,name,vars,similar);var caretTextNode=insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()),newCaretContainer);removeCaretContainerNode(editor,caretContainer,false);selection.setCursorLocation(caretTextNode,1);if(dom.isEmpty(formatNode)){dom.remove(formatNode);}}};var disableCaretContainer=function disableCaretContainer(editor,keyCode){var selection=editor.selection,body=editor.getBody();removeCaretContainer(editor,null,false);if((keyCode===8||keyCode===46)&&selection.isCollapsed()&&selection.getStart().innerHTML===ZWSP){removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()));}if(keyCode===37||keyCode===39){removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()));}};var setup$u=function setup$u(editor){editor.on('mouseup keydown',function(e){disableCaretContainer(editor,e.keyCode);});};var replaceWithCaretFormat=function replaceWithCaretFormat(targetNode,formatNodes){var caretContainer=createCaretContainer(false);var innerMost=insertFormatNodesIntoCaretContainer(formatNodes,caretContainer.dom);before$3(SugarElement.fromDom(targetNode),caretContainer);remove$6(SugarElement.fromDom(targetNode));return CaretPosition(innerMost,0);};var isFormatElement=function isFormatElement(editor,element){var inlineElements=editor.schema.getTextInlineElements();return has$2(inlineElements,name(element))&&!isCaretNode(element.dom)&&!isBogus$2(element.dom);};var isEmptyCaretFormatElement=function isEmptyCaretFormatElement(element){return isCaretNode(element.dom)&&isCaretContainerEmpty(element.dom);};var postProcessHooks={};var filter$2=filter$4;var each$9=each$d;var addPostProcessHook=function addPostProcessHook(name,hook){var hooks=postProcessHooks[name];if(!hooks){postProcessHooks[name]=[];}postProcessHooks[name].push(hook);};var postProcess$1=function postProcess$1(name,editor){each$9(postProcessHooks[name],function(hook){hook(editor);});};addPostProcessHook('pre',function(editor){var rng=editor.selection.getRng();var blocks;var hasPreSibling=function hasPreSibling(pre){return isPre(pre.previousSibling)&&indexOf(blocks,pre.previousSibling)!==-1;};var joinPre=function joinPre(pre1,pre2){var sPre2=SugarElement.fromDom(pre2);var doc=documentOrOwner(sPre2).dom;remove$6(sPre2);append(SugarElement.fromDom(pre1),[SugarElement.fromTag('br',doc),SugarElement.fromTag('br',doc)].concat(_toConsumableArray2(children(sPre2))));};var isPre=matchNodeNames(['pre']);if(!rng.collapsed){blocks=editor.selection.getSelectedBlocks();each$9(filter$2(filter$2(blocks,isPre),hasPreSibling),function(pre){joinPre(pre.previousSibling,pre);});}});var each$8=Tools.each;var isElementNode$1=function isElementNode$1(node){return isElement$6(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node);};var findElementSibling=function findElementSibling(node,siblingName){for(var _sibling9=node;_sibling9;_sibling9=_sibling9[siblingName]){if(isText$9(_sibling9)&&isNotEmpty(_sibling9.data)){return node;}if(isElement$6(_sibling9)&&!isBookmarkNode$1(_sibling9)){return _sibling9;}}return node;};var mergeSiblingsNodes=function mergeSiblingsNodes(dom,prev,next){var elementUtils=ElementUtils(dom);if(prev&&next){prev=findElementSibling(prev,'previousSibling');next=findElementSibling(next,'nextSibling');if(elementUtils.compare(prev,next)){for(var _sibling10=prev.nextSibling;_sibling10&&_sibling10!==next;){var tmpSibling=_sibling10;_sibling10=_sibling10.nextSibling;prev.appendChild(tmpSibling);}dom.remove(next);Tools.each(Tools.grep(next.childNodes),function(node){prev.appendChild(node);});return prev;}}return next;};var mergeSiblings=function mergeSiblings(dom,format,vars,node){if(node&&format.merge_siblings!==false){var newNode=mergeSiblingsNodes(dom,getNonWhiteSpaceSibling(node),node);mergeSiblingsNodes(dom,newNode,getNonWhiteSpaceSibling(newNode,true));}};var clearChildStyles=function clearChildStyles(dom,format,node){if(format.clear_child_styles){var selector=format.links?'*:not(a)':'*';each$8(dom.select(selector,node),function(node){if(isElementNode$1(node)){each$8(format.styles,function(value,name){dom.setStyle(node,name,'');});}});}};var processChildElements=function processChildElements(node,filter,process){each$8(node.childNodes,function(node){if(isElementNode$1(node)){if(filter(node)){process(node);}if(node.hasChildNodes()){processChildElements(node,filter,process);}}});};var unwrapEmptySpan=function unwrapEmptySpan(dom,node){if(node.nodeName==='SPAN'&&dom.getAttribs(node).length===0){dom.remove(node,true);}};var hasStyle=function hasStyle(dom,name){return function(node){return!!(node&&getStyle(dom,node,name));};};var applyStyle=function applyStyle(dom,name,value){return function(node){dom.setStyle(node,name,value);if(node.getAttribute('style')===''){node.removeAttribute('style');}unwrapEmptySpan(dom,node);};};var removeResult=Adt.generate([{keep:[]},{rename:['name']},{removed:[]}]);var MCE_ATTR_RE=/^(src|href|style)$/;var each$7=Tools.each;var isEq$2=isEq$5;var isTableCellOrRow=function isTableCellOrRow(node){return /^(TR|TH|TD)$/.test(node.nodeName);};var isChildOfInlineParent=function isChildOfInlineParent(dom,node,parent){return dom.isChildOf(node,parent)&&node!==parent&&!dom.isBlock(parent);};var getContainer=function getContainer(ed,rng,start){var container=rng[start?'startContainer':'endContainer'];var offset=rng[start?'startOffset':'endOffset'];if(isElement$6(container)){var lastIdx=container.childNodes.length-1;if(!start&&offset){offset--;}container=container.childNodes[offset>lastIdx?lastIdx:offset];}if(isText$9(container)&&start&&offset>=container.nodeValue.length){container=new DomTreeWalker(container,ed.getBody()).next()||container;}if(isText$9(container)&&!start&&offset===0){container=new DomTreeWalker(container,ed.getBody()).prev()||container;}return container;};var normalizeTableSelection=function normalizeTableSelection(node,start){var prop=start?'firstChild':'lastChild';if(isTableCellOrRow(node)&&node[prop]){var childNode=node[prop];if(node.nodeName==='TR'){return childNode[prop]||childNode;}else{return childNode;}}return node;};var wrap$1=function wrap$1(dom,node,name,attrs){var wrapper=dom.create(name,attrs);node.parentNode.insertBefore(wrapper,node);wrapper.appendChild(node);return wrapper;};var wrapWithSiblings=function wrapWithSiblings(dom,node,next,name,attrs){var start=SugarElement.fromDom(node);var wrapper=SugarElement.fromDom(dom.create(name,attrs));var siblings=next?nextSiblings(start):prevSiblings(start);append(wrapper,siblings);if(next){before$3(start,wrapper);prepend(wrapper,start);}else{after$4(start,wrapper);append$1(wrapper,start);}return wrapper.dom;};var isColorFormatAndAnchor=function isColorFormatAndAnchor(node,format){return format.links&&node.nodeName==='A';};var removeNode=function removeNode(ed,node,format){var parentNode=node.parentNode;var rootBlockElm;var dom=ed.dom;var forcedRootBlock=getForcedRootBlock(ed);if(isBlockFormat(format)){if(parentNode===dom.getRoot()){if(!format.list_block||!isEq$2(node,format.list_block)){each$f(from(node.childNodes),function(node){if(isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())){if(!rootBlockElm){rootBlockElm=wrap$1(dom,node,forcedRootBlock);dom.setAttribs(rootBlockElm,getForcedRootBlockAttrs(ed));}else{rootBlockElm.appendChild(node);}}else{rootBlockElm=null;}});}}}if(isMixedFormat(format)&&!isEq$2(format.inline,node)){return;}dom.remove(node,true);};var removeFormatInternal=function removeFormatInternal(ed,format,vars,node,compareNode){var stylesModified;var dom=ed.dom;if(!matchName(dom,node,format)&&!isColorFormatAndAnchor(node,format)){return removeResult.keep();}var elm=node;if(isInlineFormat(format)&&format.remove==='all'&&isArray$1(format.preserve_attributes)){var attrsToPreserve=filter$6(dom.getAttribs(elm),function(attr){return contains$2(format.preserve_attributes,attr.name.toLowerCase());});dom.removeAllAttribs(elm);each$f(attrsToPreserve,function(attr){return dom.setAttrib(elm,attr.name,attr.value);});if(attrsToPreserve.length>0){return removeResult.rename('span');}}if(format.remove!=='all'){each$7(format.styles,function(value,name){value=normalizeStyleValue(replaceVars(value,vars),name+'');if(isNumber(name)){name=value;compareNode=null;}if(format.remove_similar||!compareNode||isEq$2(getStyle(dom,compareNode,name),value)){dom.setStyle(elm,name,'');}stylesModified=true;});if(stylesModified&&dom.getAttrib(elm,'style')===''){elm.removeAttribute('style');elm.removeAttribute('data-mce-style');}each$7(format.attributes,function(value,name){var valueOut;value=replaceVars(value,vars);if(isNumber(name)){name=value;compareNode=null;}if(format.remove_similar||!compareNode||isEq$2(dom.getAttrib(compareNode,name),value)){if(name==='class'){value=dom.getAttrib(elm,name);if(value){valueOut='';each$f(value.split(/\s+/),function(cls){if(/mce\-\w+/.test(cls)){valueOut+=(valueOut?' ':'')+cls;}});if(valueOut){dom.setAttrib(elm,name,valueOut);return;}}}if(MCE_ATTR_RE.test(name)){elm.removeAttribute('data-mce-'+name);}if(name==='style'&&matchNodeNames(['li'])(elm)&&dom.getStyle(elm,'list-style-type')==='none'){elm.removeAttribute(name);dom.setStyle(elm,'list-style-type','none');return;}if(name==='class'){elm.removeAttribute('className');}elm.removeAttribute(name);}});each$7(format.classes,function(value){value=replaceVars(value,vars);if(!compareNode||dom.hasClass(compareNode,value)){dom.removeClass(elm,value);}});var attrs=dom.getAttribs(elm);for(var i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(attrName.indexOf('_')!==0&&attrName.indexOf('data-')!==0){return removeResult.keep();}}}if(format.remove!=='none'){removeNode(ed,elm,format);return removeResult.removed();}return removeResult.keep();};var removeFormat$1=function removeFormat$1(ed,format,vars,node,compareNode){return removeFormatInternal(ed,format,vars,node,compareNode).fold(never,function(newName){ed.dom.rename(node,newName);return true;},always);};var findFormatRoot=function findFormatRoot(editor,container,name,vars,similar){var formatRoot;each$f(getParents$2(editor.dom,container.parentNode).reverse(),function(parent){if(!formatRoot&&parent.id!=='_start'&&parent.id!=='_end'){var format=_matchNode(editor,parent,name,vars,similar);if(format&&format.split!==false){formatRoot=parent;}}});return formatRoot;};var removeFormatFromClone=function removeFormatFromClone(editor,format,vars,clone){return removeFormatInternal(editor,format,vars,clone,clone).fold(constant(clone),function(newName){var fragment=editor.dom.createFragment();fragment.appendChild(clone);return editor.dom.rename(clone,newName);},constant(null));};var wrapAndSplit=function wrapAndSplit(editor,formatList,formatRoot,container,target,split,format,vars){var clone,lastClone,firstClone;var dom=editor.dom;if(formatRoot){var formatRootParent=formatRoot.parentNode;for(var _parent5=container.parentNode;_parent5&&_parent5!==formatRootParent;_parent5=_parent5.parentNode){clone=dom.clone(_parent5,false);for(var i=0;i<formatList.length;i++){clone=removeFormatFromClone(editor,formatList[i],vars,clone);if(clone===null){break;}}if(clone){if(lastClone){clone.appendChild(lastClone);}if(!firstClone){firstClone=clone;}lastClone=clone;}}if(split&&(!format.mixed||!dom.isBlock(formatRoot))){container=dom.split(formatRoot,container);}if(lastClone){target.parentNode.insertBefore(lastClone,target);firstClone.appendChild(target);if(isInlineFormat(format)){mergeSiblings(dom,format,vars,lastClone);}}}return container;};var remove$2=function remove$2(ed,name,vars,node,similar){var formatList=ed.formatter.get(name);var format=formatList[0];var contentEditable=true;var dom=ed.dom;var selection=ed.selection;var splitToFormatRoot=function splitToFormatRoot(container){var formatRoot=findFormatRoot(ed,container,name,vars,similar);return wrapAndSplit(ed,formatList,formatRoot,container,container,true,format,vars);};var isRemoveBookmarkNode=function isRemoveBookmarkNode(node){return isBookmarkNode$1(node)&&isElement$6(node)&&(node.id==='_start'||node.id==='_end');};var removeNodeFormat=function removeNodeFormat(node){return exists(formatList,function(fmt){return removeFormat$1(ed,fmt,vars,node,node);});};var process=function process(node){var lastContentEditable=true;var hasContentEditableState=false;if(isElement$6(node)&&dom.getContentEditable(node)){lastContentEditable=contentEditable;contentEditable=dom.getContentEditable(node)==='true';hasContentEditableState=true;}var children=from(node.childNodes);if(contentEditable&&!hasContentEditableState){var removed=removeNodeFormat(node);var currentNodeMatches=removed||exists(formatList,function(f){return matchName(dom,node,f);});var parentNode=node.parentNode;if(!currentNodeMatches&&isNonNullable(parentNode)&&shouldExpandToSelector(format)){removeNodeFormat(parentNode);}}if(format.deep){if(children.length){for(var i=0;i<children.length;i++){process(children[i]);}if(hasContentEditableState){contentEditable=lastContentEditable;}}}var textDecorations=['underline','line-through','overline'];each$f(textDecorations,function(decoration){if(isElement$6(node)&&ed.dom.getStyle(node,'text-decoration')===decoration&&node.parentNode&&getTextDecoration(dom,node.parentNode)===decoration){removeFormat$1(ed,{deep:false,exact:true,inline:'span',styles:{textDecoration:decoration}},null,node);}});};var unwrap=function unwrap(start){var node=dom.get(start?'_start':'_end');var out=node[start?'firstChild':'lastChild'];if(isRemoveBookmarkNode(out)){out=out[start?'firstChild':'lastChild'];}if(isText$9(out)&&out.data.length===0){out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling;}dom.remove(node,true);return out;};var removeRngStyle=function removeRngStyle(rng){var startContainer,endContainer;var expandedRng=expandRng(ed,rng,formatList,rng.collapsed);if(format.split){expandedRng=split(expandedRng);startContainer=getContainer(ed,expandedRng,true);endContainer=getContainer(ed,expandedRng);if(startContainer!==endContainer){startContainer=normalizeTableSelection(startContainer,true);endContainer=normalizeTableSelection(endContainer,false);if(isChildOfInlineParent(dom,startContainer,endContainer)){var marker=Optional.from(startContainer.firstChild).getOr(startContainer);splitToFormatRoot(wrapWithSiblings(dom,marker,true,'span',{'id':'_start','data-mce-type':'bookmark'}));unwrap(true);return;}if(isChildOfInlineParent(dom,endContainer,startContainer)){var _marker=Optional.from(endContainer.lastChild).getOr(endContainer);splitToFormatRoot(wrapWithSiblings(dom,_marker,false,'span',{'id':'_end','data-mce-type':'bookmark'}));unwrap(false);return;}startContainer=wrap$1(dom,startContainer,'span',{'id':'_start','data-mce-type':'bookmark'});endContainer=wrap$1(dom,endContainer,'span',{'id':'_end','data-mce-type':'bookmark'});var newRng=dom.createRng();newRng.setStartAfter(startContainer);newRng.setEndBefore(endContainer);walk$3(dom,newRng,function(nodes){each$f(nodes,function(n){if(!isBookmarkNode$1(n)&&!isBookmarkNode$1(n.parentNode)){splitToFormatRoot(n);}});});splitToFormatRoot(startContainer);splitToFormatRoot(endContainer);startContainer=unwrap(true);endContainer=unwrap();}else{startContainer=endContainer=splitToFormatRoot(startContainer);}expandedRng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer;expandedRng.startOffset=dom.nodeIndex(startContainer);expandedRng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer;expandedRng.endOffset=dom.nodeIndex(endContainer)+1;}walk$3(dom,expandedRng,function(nodes){each$f(nodes,process);});};if(node){if(isNode(node)){var rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);removeRngStyle(rng);}else{removeRngStyle(node);}fireFormatRemove(ed,name,node,vars);return;}if(dom.getContentEditable(selection.getNode())==='false'){node=selection.getNode();for(var i=0;i<formatList.length;i++){if(formatList[i].ceFalseOverride){if(removeFormat$1(ed,formatList[i],vars,node,node)){break;}}}fireFormatRemove(ed,name,node,vars);return;}if(!selection.isCollapsed()||!isInlineFormat(format)||getCellsFromEditor(ed).length){preserve(selection,true,function(){runOnRanges(ed,removeRngStyle);});if(isInlineFormat(format)&&match$2(ed,name,vars,selection.getStart())){moveStart(dom,selection,selection.getRng());}ed.nodeChanged();}else{removeCaretFormat(ed,name,vars,similar);}fireFormatRemove(ed,name,node,vars);};var each$6=Tools.each;var mergeTextDecorationsAndColor=function mergeTextDecorationsAndColor(dom,format,vars,node){var processTextDecorationsAndColor=function processTextDecorationsAndColor(n){if(n.nodeType===1&&n.parentNode&&n.parentNode.nodeType===1){var textDecoration=getTextDecoration(dom,n.parentNode);if(dom.getStyle(n,'color')&&textDecoration){dom.setStyle(n,'text-decoration',textDecoration);}else if(dom.getStyle(n,'text-decoration')===textDecoration){dom.setStyle(n,'text-decoration',null);}}};if(format.styles&&(format.styles.color||format.styles.textDecoration)){Tools.walk(node,processTextDecorationsAndColor,'childNodes');processTextDecorationsAndColor(node);}};var mergeBackgroundColorAndFontSize=function mergeBackgroundColorAndFontSize(dom,format,vars,node){if(format.styles&&format.styles.backgroundColor){processChildElements(node,hasStyle(dom,'fontSize'),applyStyle(dom,'backgroundColor',replaceVars(format.styles.backgroundColor,vars)));}};var mergeSubSup=function mergeSubSup(dom,format,vars,node){if(isInlineFormat(format)&&(format.inline==='sub'||format.inline==='sup')){processChildElements(node,hasStyle(dom,'fontSize'),applyStyle(dom,'fontSize',''));dom.remove(dom.select(format.inline==='sup'?'sub':'sup',node),true);}};var mergeWithChildren=function mergeWithChildren(editor,formatList,vars,node){each$6(formatList,function(format){if(isInlineFormat(format)){each$6(editor.dom.select(format.inline,node),function(child){if(!isElementNode$1(child)){return;}removeFormat$1(editor,format,vars,child,format.exact?child:null);});}clearChildStyles(editor.dom,format,node);});};var mergeWithParents=function mergeWithParents(editor,format,name,vars,node){if(_matchNode(editor,node.parentNode,name,vars)){if(removeFormat$1(editor,format,vars,node)){return;}}if(format.merge_with_parents){editor.dom.getParent(node.parentNode,function(parent){if(_matchNode(editor,parent,name,vars)){removeFormat$1(editor,format,vars,node);return true;}});}};var each$5=Tools.each;var isElementNode=function isElementNode(node){return isElement$6(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node);};var canFormatBR=function canFormatBR(editor,format,node,parentName){if(canFormatEmptyLines(editor)&&isInlineFormat(format)){var validBRParentElements=getTextRootBlockElements(editor.schema);var hasCaretNodeSibling=sibling(SugarElement.fromDom(node),function(sibling){return isCaretNode(sibling.dom);});return hasNonNullableKey(validBRParentElements,parentName)&&isEmpty$2(SugarElement.fromDom(node.parentNode),false)&&!hasCaretNodeSibling;}else{return false;}};var applyFormat$1=function applyFormat$1(ed,name,vars,node){var formatList=ed.formatter.get(name);var format=formatList[0];var isCollapsed=!node&&ed.selection.isCollapsed();var dom=ed.dom;var selection=ed.selection;var setElementFormat=function setElementFormat(elm){var fmt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:format;if(isFunction(fmt.onformat)){fmt.onformat(elm,fmt,vars,node);}each$5(fmt.styles,function(value,name){dom.setStyle(elm,name,replaceVars(value,vars));});if(fmt.styles){var styleVal=dom.getAttrib(elm,'style');if(styleVal){dom.setAttrib(elm,'data-mce-style',styleVal);}}each$5(fmt.attributes,function(value,name){dom.setAttrib(elm,name,replaceVars(value,vars));});each$5(fmt.classes,function(value){value=replaceVars(value,vars);if(!dom.hasClass(elm,value)){dom.addClass(elm,value);}});};var applyNodeStyle=function applyNodeStyle(formatList,node){var found=false;each$5(formatList,function(format){if(!isSelectorFormat(format)){return false;}if(isNonNullable(format.collapsed)&&format.collapsed!==isCollapsed){return;}if(dom.is(node,format.selector)&&!isCaretNode(node)){setElementFormat(node,format);found=true;return false;}});return found;};var createWrapElement=function createWrapElement(wrapName){if(isString(wrapName)){var wrapElm=dom.create(wrapName);setElementFormat(wrapElm);return wrapElm;}else{return null;}};var applyRngStyle=function applyRngStyle(dom,rng,nodeSpecific){var newWrappers=[];var contentEditable=true;var wrapName=format.inline||format.block;var wrapElm=createWrapElement(wrapName);walk$3(dom,rng,function(nodes){var currentWrapElm;var process=function process(node){var hasContentEditableState=false;var lastContentEditable=contentEditable;var nodeName=node.nodeName.toLowerCase();var parentNode=node.parentNode;var parentName=parentNode.nodeName.toLowerCase();if(isElement$6(node)&&dom.getContentEditable(node)){lastContentEditable=contentEditable;contentEditable=dom.getContentEditable(node)==='true';hasContentEditableState=true;}if(isBr$6(node)&&!canFormatBR(ed,format,node,parentName)){currentWrapElm=null;if(isBlockFormat(format)){dom.remove(node);}return;}if(isBlockFormat(format)&&format.wrapper&&_matchNode(ed,node,name,vars)){currentWrapElm=null;return;}if(contentEditable&&!hasContentEditableState&&isBlockFormat(format)&&!format.wrapper&&isTextBlock$1(ed,nodeName)&&isValid(ed,parentName,wrapName)){var elm=dom.rename(node,wrapName);setElementFormat(elm);newWrappers.push(elm);currentWrapElm=null;return;}if(isSelectorFormat(format)){var found=applyNodeStyle(formatList,node);if(!found&&isNonNullable(parentNode)&&shouldExpandToSelector(format)){found=applyNodeStyle(formatList,parentNode);}if(!isInlineFormat(format)||found){currentWrapElm=null;return;}}if(contentEditable&&!hasContentEditableState&&isValid(ed,wrapName,nodeName)&&isValid(ed,parentName,wrapName)&&!(!nodeSpecific&&isText$9(node)&&isZwsp(node.data))&&!isCaretNode(node)&&(!isInlineFormat(format)||!dom.isBlock(node))){if(!currentWrapElm){currentWrapElm=dom.clone(wrapElm,false);node.parentNode.insertBefore(currentWrapElm,node);newWrappers.push(currentWrapElm);}currentWrapElm.appendChild(node);}else{currentWrapElm=null;each$f(from(node.childNodes),process);if(hasContentEditableState){contentEditable=lastContentEditable;}currentWrapElm=null;}};each$f(nodes,process);});if(format.links===true){each$f(newWrappers,function(node){var process=function process(node){if(node.nodeName==='A'){setElementFormat(node,format);}each$f(from(node.childNodes),process);};process(node);});}each$f(newWrappers,function(node){var getChildCount=function getChildCount(node){var count=0;each$f(node.childNodes,function(node){if(!isEmptyTextNode$1(node)&&!isBookmarkNode$1(node)){count++;}});return count;};var mergeStyles=function mergeStyles(node){var childElement=find$2(node.childNodes,isElementNode).filter(function(child){return matchName(dom,child,format);});return childElement.map(function(child){var clone=dom.clone(child,false);setElementFormat(clone);dom.replace(clone,node,true);dom.remove(child,true);return clone;}).getOr(node);};var childCount=getChildCount(node);if((newWrappers.length>1||!dom.isBlock(node))&&childCount===0){dom.remove(node,true);return;}if(isInlineFormat(format)||isBlockFormat(format)&&format.wrapper){if(!format.exact&&childCount===1){node=mergeStyles(node);}mergeWithChildren(ed,formatList,vars,node);mergeWithParents(ed,format,name,vars,node);mergeBackgroundColorAndFontSize(dom,format,vars,node);mergeTextDecorationsAndColor(dom,format,vars,node);mergeSubSup(dom,format,vars,node);mergeSiblings(dom,format,vars,node);}});};if(dom.getContentEditable(selection.getNode())==='false'){node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){var formatItem=formatList[i];if(formatItem.ceFalseOverride&&isSelectorFormat(formatItem)&&dom.is(node,formatItem.selector)){setElementFormat(node,formatItem);break;}}fireFormatApply(ed,name,node,vars);return;}if(format){if(node){if(isNode(node)){if(!applyNodeStyle(formatList,node)){var rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);applyRngStyle(dom,expandRng(ed,rng,formatList),true);}}else{applyRngStyle(dom,node,true);}}else{if(!isCollapsed||!isInlineFormat(format)||getCellsFromEditor(ed).length){selection.setRng(normalize(selection.getRng()));preserve(selection,true,function(){runOnRanges(ed,function(selectionRng,fake){var expandedRng=fake?selectionRng:expandRng(ed,selectionRng,formatList);applyRngStyle(dom,expandedRng,false);});});moveStart(dom,selection,selection.getRng());ed.nodeChanged();}else{applyCaretFormat(ed,name,vars);}}postProcess$1(name,ed);}fireFormatApply(ed,name,node,vars);};var hasVars=function hasVars(value){return has$2(value,'vars');};var setup$t=function setup$t(registeredFormatListeners,editor){registeredFormatListeners.set({});editor.on('NodeChange',function(e){updateAndFireChangeCallbacks(editor,e.element,registeredFormatListeners.get());});editor.on('FormatApply FormatRemove',function(e){var element=Optional.from(e.node).map(function(nodeOrRange){return isNode(nodeOrRange)?nodeOrRange:nodeOrRange.startContainer;}).bind(function(node){return isElement$6(node)?Optional.some(node):Optional.from(node.parentElement);}).getOrThunk(function(){return fallbackElement(editor);});updateAndFireChangeCallbacks(editor,element,registeredFormatListeners.get());});};var fallbackElement=function fallbackElement(editor){return editor.selection.getStart();};var matchingNode=function matchingNode(editor,parents,format,similar,vars){var isMatchingNode=function isMatchingNode(node){var matchingFormat=editor.formatter.matchNode(node,format,vars!==null&&vars!==void 0?vars:{},similar);return!isUndefined(matchingFormat);};var isUnableToMatch=function isUnableToMatch(node){if(matchesUnInheritedFormatSelector(editor,node,format)){return true;}else{if(!similar){return isNonNullable(editor.formatter.matchNode(node,format,vars,true));}else{return false;}}};return findUntil$1(parents,isMatchingNode,isUnableToMatch);};var getParents=function getParents(editor,elm){var element=elm!==null&&elm!==void 0?elm:fallbackElement(editor);return filter$6(getParents$2(editor.dom,element),function(node){return isElement$6(node)&&!isBogus$2(node);});};var updateAndFireChangeCallbacks=function updateAndFireChangeCallbacks(editor,elm,registeredCallbacks){var parents=getParents(editor,elm);each$e(registeredCallbacks,function(data,format){var runIfChanged=function runIfChanged(spec){var match=matchingNode(editor,parents,format,spec.similar,hasVars(spec)?spec.vars:undefined);var isSet=match.isSome();if(spec.state.get()!==isSet){spec.state.set(isSet);var node=match.getOr(elm);if(hasVars(spec)){spec.callback(isSet,{node:node,format:format,parents:parents});}else{each$f(spec.callbacks,function(callback){return callback(isSet,{node:node,format:format,parents:parents});});}}};each$f([data.withSimilar,data.withoutSimilar],runIfChanged);each$f(data.withVars,runIfChanged);});};var addListeners=function addListeners(editor,registeredFormatListeners,formats,callback,similar,vars){var formatChangeItems=registeredFormatListeners.get();each$f(formats.split(','),function(format){var group=get$a(formatChangeItems,format).getOrThunk(function(){var base={withSimilar:{state:Cell(false),similar:true,callbacks:[]},withoutSimilar:{state:Cell(false),similar:false,callbacks:[]},withVars:[]};formatChangeItems[format]=base;return base;});var getCurrent=function getCurrent(){var parents=getParents(editor);return matchingNode(editor,parents,format,similar,vars).isSome();};if(isUndefined(vars)){var toAppendTo=similar?group.withSimilar:group.withoutSimilar;toAppendTo.callbacks.push(callback);if(toAppendTo.callbacks.length===1){toAppendTo.state.set(getCurrent());}}else{group.withVars.push({state:Cell(getCurrent()),similar:similar,vars:vars,callback:callback});}});registeredFormatListeners.set(formatChangeItems);};var removeListeners=function removeListeners(registeredFormatListeners,formats,callback){var formatChangeItems=registeredFormatListeners.get();each$f(formats.split(','),function(format){return get$a(formatChangeItems,format).each(function(group){formatChangeItems[format]={withSimilar:_objectSpread({},group.withSimilar,{callbacks:filter$6(group.withSimilar.callbacks,function(cb){return cb!==callback;})}),withoutSimilar:_objectSpread({},group.withoutSimilar,{callbacks:filter$6(group.withoutSimilar.callbacks,function(cb){return cb!==callback;})}),withVars:filter$6(group.withVars,function(item){return item.callback!==callback;})};});});registeredFormatListeners.set(formatChangeItems);};var formatChangedInternal=function formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars){if(registeredFormatListeners.get()===null){setup$t(registeredFormatListeners,editor);}addListeners(editor,registeredFormatListeners,formats,callback,similar,vars);return{unbind:function unbind(){return removeListeners(registeredFormatListeners,formats,callback);}};};var _toggle=function toggle(editor,name,vars,node){var fmt=editor.formatter.get(name);if(match$2(editor,name,vars,node)&&(!('toggle'in fmt[0])||fmt[0].toggle)){remove$2(editor,name,vars,node);}else{applyFormat$1(editor,name,vars,node);}};function _typeof(obj){'@babel/helpers - typeof';return _typeof='function'==typeof Symbol&&'symbol'==_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj);}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':_typeof2(obj);},_typeof(obj);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _isNativeReflectConstruct(){if(typeof Reflect==='undefined'||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==='function')return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _iterableToArray(iter){if(typeof Symbol!=='undefined'&&iter[Symbol.iterator]!=null||iter['@@iterator']!=null)return Array.from(iter);}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==='string')return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==='Object'&&o.constructor)n=o.constructor.name;if(n==='Map'||n==='Set')return Array.from(o);if(n==='Arguments'||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _nonIterableSpread(){throw new TypeError('Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.');}var hasOwnProperty=Object.hasOwnProperty,setPrototypeOf=Object.setPrototypeOf,isFrozen=Object.isFrozen,getPrototypeOf=Object.getPrototypeOf,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;var freeze=Object.freeze,seal=Object.seal,create$8=Object.create;var _ref=typeof Reflect!=='undefined'&&Reflect,apply=_ref.apply,construct=_ref.construct;if(!apply){apply=function apply(fun,thisValue,args){return fun.apply(thisValue,args);};}if(!freeze){freeze=function freeze(x){return x;};}if(!seal){seal=function seal(x){return x;};}if(!construct){construct=function construct(Func,args){return _construct(Func,_toConsumableArray(args));};}var arrayForEach=unapply(Array.prototype.forEach);var arrayPop=unapply(Array.prototype.pop);var arrayPush=unapply(Array.prototype.push);var stringToLowerCase=unapply(String.prototype.toLowerCase);var stringMatch=unapply(String.prototype.match);var stringReplace=unapply(String.prototype.replace);var stringIndexOf=unapply(String.prototype.indexOf);var stringTrim=unapply(String.prototype.trim);var regExpTest=unapply(RegExp.prototype.test);var typeErrorCreate=unconstruct(TypeError);function unapply(func){return function(thisArg){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}return apply(func,thisArg,args);};}function unconstruct(func){return function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return construct(func,args);};}function addToSet(set,array){if(setPrototypeOf){setPrototypeOf(set,null);}var l=array.length;while(l--){var element=array[l];if(typeof element==='string'){var lcElement=stringToLowerCase(element);if(lcElement!==element){if(!isFrozen(array)){array[l]=lcElement;}element=lcElement;}}set[element]=true;}return set;}function clone(object){var newObject=create$8(null);var property;for(property in object){if(apply(hasOwnProperty,object,[property])){newObject[property]=object[property];}}return newObject;}function lookupGetter(object,prop){while(object!==null){var desc=getOwnPropertyDescriptor(object,prop);if(desc){if(desc.get){return unapply(desc.get);}if(typeof desc.value==='function'){return unapply(desc.value);}}object=getPrototypeOf(object);}function fallbackValue(element){console.warn('fallback value for',element);return null;}return fallbackValue;}var html$1=freeze(['a','abbr','acronym','address','area','article','aside','audio','b','bdi','bdo','big','blink','blockquote','body','br','button','canvas','caption','center','cite','code','col','colgroup','content','data','datalist','dd','decorator','del','details','dfn','dialog','dir','div','dl','dt','element','em','fieldset','figcaption','figure','font','footer','form','h1','h2','h3','h4','h5','h6','head','header','hgroup','hr','html','i','img','input','ins','kbd','label','legend','li','main','map','mark','marquee','menu','menuitem','meter','nav','nobr','ol','optgroup','option','output','p','picture','pre','progress','q','rp','rt','ruby','s','samp','section','select','shadow','small','source','spacer','span','strike','strong','style','sub','summary','sup','table','tbody','td','template','textarea','tfoot','th','thead','time','tr','track','tt','u','ul','var','video','wbr']);var svg$1=freeze(['svg','a','altglyph','altglyphdef','altglyphitem','animatecolor','animatemotion','animatetransform','circle','clippath','defs','desc','ellipse','filter','font','g','glyph','glyphref','hkern','image','line','lineargradient','marker','mask','metadata','mpath','path','pattern','polygon','polyline','radialgradient','rect','stop','style','switch','symbol','text','textpath','title','tref','tspan','view','vkern']);var svgFilters=freeze(['feBlend','feColorMatrix','feComponentTransfer','feComposite','feConvolveMatrix','feDiffuseLighting','feDisplacementMap','feDistantLight','feFlood','feFuncA','feFuncB','feFuncG','feFuncR','feGaussianBlur','feImage','feMerge','feMergeNode','feMorphology','feOffset','fePointLight','feSpecularLighting','feSpotLight','feTile','feTurbulence']);var svgDisallowed=freeze(['animate','color-profile','cursor','discard','fedropshadow','font-face','font-face-format','font-face-name','font-face-src','font-face-uri','foreignobject','hatch','hatchpath','mesh','meshgradient','meshpatch','meshrow','missing-glyph','script','set','solidcolor','unknown','use']);var mathMl$1=freeze(['math','menclose','merror','mfenced','mfrac','mglyph','mi','mlabeledtr','mmultiscripts','mn','mo','mover','mpadded','mphantom','mroot','mrow','ms','mspace','msqrt','mstyle','msub','msup','msubsup','mtable','mtd','mtext','mtr','munder','munderover']);var mathMlDisallowed=freeze(['maction','maligngroup','malignmark','mlongdiv','mscarries','mscarry','msgroup','mstack','msline','msrow','semantics','annotation','annotation-xml','mprescripts','none']);var text=freeze(['#text']);var html=freeze(['accept','action','align','alt','autocapitalize','autocomplete','autopictureinpicture','autoplay','background','bgcolor','border','capture','cellpadding','cellspacing','checked','cite','class','clear','color','cols','colspan','controls','controlslist','coords','crossorigin','datetime','decoding','default','dir','disabled','disablepictureinpicture','disableremoteplayback','download','draggable','enctype','enterkeyhint','face','for','headers','height','hidden','high','href','hreflang','id','inputmode','integrity','ismap','kind','label','lang','list','loading','loop','low','max','maxlength','media','method','min','minlength','multiple','muted','name','nonce','noshade','novalidate','nowrap','open','optimum','pattern','placeholder','playsinline','poster','preload','pubdate','radiogroup','readonly','rel','required','rev','reversed','role','rows','rowspan','spellcheck','scope','selected','shape','size','sizes','span','srclang','start','src','srcset','step','style','summary','tabindex','title','translate','type','usemap','valign','value','width','xmlns','slot']);var svg=freeze(['accent-height','accumulate','additive','alignment-baseline','ascent','attributename','attributetype','azimuth','basefrequency','baseline-shift','begin','bias','by','class','clip','clippathunits','clip-path','clip-rule','color','color-interpolation','color-interpolation-filters','color-profile','color-rendering','cx','cy','d','dx','dy','diffuseconstant','direction','display','divisor','dur','edgemode','elevation','end','fill','fill-opacity','fill-rule','filter','filterunits','flood-color','flood-opacity','font-family','font-size','font-size-adjust','font-stretch','font-style','font-variant','font-weight','fx','fy','g1','g2','glyph-name','glyphref','gradientunits','gradienttransform','height','href','id','image-rendering','in','in2','k','k1','k2','k3','k4','kerning','keypoints','keysplines','keytimes','lang','lengthadjust','letter-spacing','kernelmatrix','kernelunitlength','lighting-color','local','marker-end','marker-mid','marker-start','markerheight','markerunits','markerwidth','maskcontentunits','maskunits','max','mask','media','method','mode','min','name','numoctaves','offset','operator','opacity','order','orient','orientation','origin','overflow','paint-order','path','pathlength','patterncontentunits','patterntransform','patternunits','points','preservealpha','preserveaspectratio','primitiveunits','r','rx','ry','radius','refx','refy','repeatcount','repeatdur','restart','result','rotate','scale','seed','shape-rendering','specularconstant','specularexponent','spreadmethod','startoffset','stddeviation','stitchtiles','stop-color','stop-opacity','stroke-dasharray','stroke-dashoffset','stroke-linecap','stroke-linejoin','stroke-miterlimit','stroke-opacity','stroke','stroke-width','style','surfacescale','systemlanguage','tabindex','targetx','targety','transform','transform-origin','text-anchor','text-decoration','text-rendering','textlength','type','u1','u2','unicode','values','viewbox','visibility','version','vert-adv-y','vert-origin-x','vert-origin-y','width','word-spacing','wrap','writing-mode','xchannelselector','ychannelselector','x','x1','x2','xmlns','y','y1','y2','z','zoomandpan']);var mathMl=freeze(['accent','accentunder','align','bevelled','close','columnsalign','columnlines','columnspan','denomalign','depth','dir','display','displaystyle','encoding','fence','frame','height','href','id','largeop','length','linethickness','lspace','lquote','mathbackground','mathcolor','mathsize','mathvariant','maxsize','minsize','movablelimits','notation','numalign','open','rowalign','rowlines','rowspacing','rowspan','rspace','rquote','scriptlevel','scriptminsize','scriptsizemultiplier','selection','separator','separators','stretchy','subscriptshift','supscriptshift','symmetric','voffset','width','xmlns']);var xml=freeze(['xlink:href','xml:id','xlink:title','xml:space','xmlns:xlink']);var MUSTACHE_EXPR=seal(/\{\{[\w\W]*|[\w\W]*\}\}/gm);var ERB_EXPR=seal(/<%[\w\W]*|[\w\W]*%>/gm);var DATA_ATTR=seal(/^data-[\-\w.\u00B7-\uFFFF]/);var ARIA_ATTR=seal(/^aria-[\-\w]+$/);var IS_ALLOWED_URI=seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i);var IS_SCRIPT_OR_DATA=seal(/^(?:\w+script|data):/i);var ATTR_WHITESPACE=seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g);var DOCTYPE_NAME=seal(/^html$/i);var getGlobal=function getGlobal(){return typeof window==='undefined'?null:window;};var _createTrustedTypesPolicy=function _createTrustedTypesPolicy(trustedTypes,document){if(_typeof(trustedTypes)!=='object'||typeof trustedTypes.createPolicy!=='function'){return null;}var suffix=null;var ATTR_NAME='data-tt-policy-suffix';if(document.currentScript&&document.currentScript.hasAttribute(ATTR_NAME)){suffix=document.currentScript.getAttribute(ATTR_NAME);}var policyName='dompurify'+(suffix?'#'+suffix:'');try{return trustedTypes.createPolicy(policyName,{createHTML:function createHTML(html){return html;}});}catch(_){console.warn('TrustedTypes policy '+policyName+' could not be created.');return null;}};function createDOMPurify(){var window=arguments.length>0&&arguments[0]!==undefined?arguments[0]:getGlobal();var DOMPurify=function DOMPurify(root){return createDOMPurify(root);};DOMPurify.version='2.3.8';DOMPurify.removed=[];if(!window||!window.document||window.document.nodeType!==9){DOMPurify.isSupported=false;return DOMPurify;}var originalDocument=window.document;var document=window.document;var DocumentFragment=window.DocumentFragment,HTMLTemplateElement=window.HTMLTemplateElement,Node=window.Node,Element=window.Element,NodeFilter=window.NodeFilter,_window$NamedNodeMap=window.NamedNodeMap,NamedNodeMap=_window$NamedNodeMap===void 0?window.NamedNodeMap||window.MozNamedAttrMap:_window$NamedNodeMap,HTMLFormElement=window.HTMLFormElement,DOMParser=window.DOMParser,trustedTypes=window.trustedTypes;var ElementPrototype=Element.prototype;var cloneNode=lookupGetter(ElementPrototype,'cloneNode');var getNextSibling=lookupGetter(ElementPrototype,'nextSibling');var getChildNodes=lookupGetter(ElementPrototype,'childNodes');var getParentNode=lookupGetter(ElementPrototype,'parentNode');if(typeof HTMLTemplateElement==='function'){var template=document.createElement('template');if(template.content&&template.content.ownerDocument){document=template.content.ownerDocument;}}var trustedTypesPolicy=_createTrustedTypesPolicy(trustedTypes,originalDocument);var emptyHTML=trustedTypesPolicy?trustedTypesPolicy.createHTML(''):'';var _document=document,implementation=_document.implementation,createNodeIterator=_document.createNodeIterator,createDocumentFragment=_document.createDocumentFragment,getElementsByTagName=_document.getElementsByTagName;var importNode=originalDocument.importNode;var documentMode={};try{documentMode=clone(document).documentMode?document.documentMode:{};}catch(_){}var hooks={};DOMPurify.isSupported=typeof getParentNode==='function'&&implementation&&typeof implementation.createHTMLDocument!=='undefined'&&documentMode!==9;var MUSTACHE_EXPR$1=MUSTACHE_EXPR,ERB_EXPR$1=ERB_EXPR,DATA_ATTR$1=DATA_ATTR,ARIA_ATTR$1=ARIA_ATTR,IS_SCRIPT_OR_DATA$1=IS_SCRIPT_OR_DATA,ATTR_WHITESPACE$1=ATTR_WHITESPACE;var IS_ALLOWED_URI$1=IS_ALLOWED_URI;var ALLOWED_TAGS=null;var DEFAULT_ALLOWED_TAGS=addToSet({},[].concat(_toConsumableArray(html$1),_toConsumableArray(svg$1),_toConsumableArray(svgFilters),_toConsumableArray(mathMl$1),_toConsumableArray(text)));var ALLOWED_ATTR=null;var DEFAULT_ALLOWED_ATTR=addToSet({},[].concat(_toConsumableArray(html),_toConsumableArray(svg),_toConsumableArray(mathMl),_toConsumableArray(xml)));var CUSTOM_ELEMENT_HANDLING=Object.seal(Object.create(null,{tagNameCheck:{writable:true,configurable:false,enumerable:true,value:null},attributeNameCheck:{writable:true,configurable:false,enumerable:true,value:null},allowCustomizedBuiltInElements:{writable:true,configurable:false,enumerable:true,value:false}}));var FORBID_TAGS=null;var FORBID_ATTR=null;var ALLOW_ARIA_ATTR=true;var ALLOW_DATA_ATTR=true;var ALLOW_UNKNOWN_PROTOCOLS=false;var SAFE_FOR_TEMPLATES=false;var WHOLE_DOCUMENT=false;var SET_CONFIG=false;var FORCE_BODY=false;var RETURN_DOM=false;var RETURN_DOM_FRAGMENT=false;var RETURN_TRUSTED_TYPE=false;var SANITIZE_DOM=true;var KEEP_CONTENT=true;var IN_PLACE=false;var USE_PROFILES={};var FORBID_CONTENTS=null;var DEFAULT_FORBID_CONTENTS=addToSet({},['annotation-xml','audio','colgroup','desc','foreignobject','head','iframe','math','mi','mn','mo','ms','mtext','noembed','noframes','noscript','plaintext','script','style','svg','template','thead','title','video','xmp']);var DATA_URI_TAGS=null;var DEFAULT_DATA_URI_TAGS=addToSet({},['audio','video','img','source','image','track']);var URI_SAFE_ATTRIBUTES=null;var DEFAULT_URI_SAFE_ATTRIBUTES=addToSet({},['alt','class','for','id','label','name','pattern','placeholder','role','summary','title','value','style','xmlns']);var MATHML_NAMESPACE='http://www.w3.org/1998/Math/MathML';var SVG_NAMESPACE='http://www.w3.org/2000/svg';var HTML_NAMESPACE='http://www.w3.org/1999/xhtml';var NAMESPACE=HTML_NAMESPACE;var IS_EMPTY_INPUT=false;var PARSER_MEDIA_TYPE;var SUPPORTED_PARSER_MEDIA_TYPES=['application/xhtml+xml','text/html'];var DEFAULT_PARSER_MEDIA_TYPE='text/html';var transformCaseFunc;var CONFIG=null;var formElement=document.createElement('form');var isRegexOrFunction=function isRegexOrFunction(testValue){return testValue instanceof RegExp||testValue instanceof Function;};var _parseConfig=function _parseConfig(cfg){if(CONFIG&&CONFIG===cfg){return;}if(!cfg||_typeof(cfg)!=='object'){cfg={};}cfg=clone(cfg);ALLOWED_TAGS='ALLOWED_TAGS'in cfg?addToSet({},cfg.ALLOWED_TAGS):DEFAULT_ALLOWED_TAGS;ALLOWED_ATTR='ALLOWED_ATTR'in cfg?addToSet({},cfg.ALLOWED_ATTR):DEFAULT_ALLOWED_ATTR;URI_SAFE_ATTRIBUTES='ADD_URI_SAFE_ATTR'in cfg?addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES),cfg.ADD_URI_SAFE_ATTR):DEFAULT_URI_SAFE_ATTRIBUTES;DATA_URI_TAGS='ADD_DATA_URI_TAGS'in cfg?addToSet(clone(DEFAULT_DATA_URI_TAGS),cfg.ADD_DATA_URI_TAGS):DEFAULT_DATA_URI_TAGS;FORBID_CONTENTS='FORBID_CONTENTS'in cfg?addToSet({},cfg.FORBID_CONTENTS):DEFAULT_FORBID_CONTENTS;FORBID_TAGS='FORBID_TAGS'in cfg?addToSet({},cfg.FORBID_TAGS):{};FORBID_ATTR='FORBID_ATTR'in cfg?addToSet({},cfg.FORBID_ATTR):{};USE_PROFILES='USE_PROFILES'in cfg?cfg.USE_PROFILES:false;ALLOW_ARIA_ATTR=cfg.ALLOW_ARIA_ATTR!==false;ALLOW_DATA_ATTR=cfg.ALLOW_DATA_ATTR!==false;ALLOW_UNKNOWN_PROTOCOLS=cfg.ALLOW_UNKNOWN_PROTOCOLS||false;SAFE_FOR_TEMPLATES=cfg.SAFE_FOR_TEMPLATES||false;WHOLE_DOCUMENT=cfg.WHOLE_DOCUMENT||false;RETURN_DOM=cfg.RETURN_DOM||false;RETURN_DOM_FRAGMENT=cfg.RETURN_DOM_FRAGMENT||false;RETURN_TRUSTED_TYPE=cfg.RETURN_TRUSTED_TYPE||false;FORCE_BODY=cfg.FORCE_BODY||false;SANITIZE_DOM=cfg.SANITIZE_DOM!==false;KEEP_CONTENT=cfg.KEEP_CONTENT!==false;IN_PLACE=cfg.IN_PLACE||false;IS_ALLOWED_URI$1=cfg.ALLOWED_URI_REGEXP||IS_ALLOWED_URI$1;NAMESPACE=cfg.NAMESPACE||HTML_NAMESPACE;if(cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)){CUSTOM_ELEMENT_HANDLING.tagNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;}if(cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)){CUSTOM_ELEMENT_HANDLING.attributeNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;}if(cfg.CUSTOM_ELEMENT_HANDLING&&typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements==='boolean'){CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;}PARSER_MEDIA_TYPE=SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE)===-1?PARSER_MEDIA_TYPE=DEFAULT_PARSER_MEDIA_TYPE:PARSER_MEDIA_TYPE=cfg.PARSER_MEDIA_TYPE;transformCaseFunc=PARSER_MEDIA_TYPE==='application/xhtml+xml'?function(x){return x;}:stringToLowerCase;if(SAFE_FOR_TEMPLATES){ALLOW_DATA_ATTR=false;}if(RETURN_DOM_FRAGMENT){RETURN_DOM=true;}if(USE_PROFILES){ALLOWED_TAGS=addToSet({},_toConsumableArray(text));ALLOWED_ATTR=[];if(USE_PROFILES.html===true){addToSet(ALLOWED_TAGS,html$1);addToSet(ALLOWED_ATTR,html);}if(USE_PROFILES.svg===true){addToSet(ALLOWED_TAGS,svg$1);addToSet(ALLOWED_ATTR,svg);addToSet(ALLOWED_ATTR,xml);}if(USE_PROFILES.svgFilters===true){addToSet(ALLOWED_TAGS,svgFilters);addToSet(ALLOWED_ATTR,svg);addToSet(ALLOWED_ATTR,xml);}if(USE_PROFILES.mathMl===true){addToSet(ALLOWED_TAGS,mathMl$1);addToSet(ALLOWED_ATTR,mathMl);addToSet(ALLOWED_ATTR,xml);}}if(cfg.ADD_TAGS){if(ALLOWED_TAGS===DEFAULT_ALLOWED_TAGS){ALLOWED_TAGS=clone(ALLOWED_TAGS);}addToSet(ALLOWED_TAGS,cfg.ADD_TAGS);}if(cfg.ADD_ATTR){if(ALLOWED_ATTR===DEFAULT_ALLOWED_ATTR){ALLOWED_ATTR=clone(ALLOWED_ATTR);}addToSet(ALLOWED_ATTR,cfg.ADD_ATTR);}if(cfg.ADD_URI_SAFE_ATTR){addToSet(URI_SAFE_ATTRIBUTES,cfg.ADD_URI_SAFE_ATTR);}if(cfg.FORBID_CONTENTS){if(FORBID_CONTENTS===DEFAULT_FORBID_CONTENTS){FORBID_CONTENTS=clone(FORBID_CONTENTS);}addToSet(FORBID_CONTENTS,cfg.FORBID_CONTENTS);}if(KEEP_CONTENT){ALLOWED_TAGS['#text']=true;}if(WHOLE_DOCUMENT){addToSet(ALLOWED_TAGS,['html','head','body']);}if(ALLOWED_TAGS.table){addToSet(ALLOWED_TAGS,['tbody']);delete FORBID_TAGS.tbody;}if(freeze){freeze(cfg);}CONFIG=cfg;};var MATHML_TEXT_INTEGRATION_POINTS=addToSet({},['mi','mo','mn','ms','mtext']);var HTML_INTEGRATION_POINTS=addToSet({},['foreignobject','desc','title','annotation-xml']);var COMMON_SVG_AND_HTML_ELEMENTS=addToSet({},['title','style','font','a','script']);var ALL_SVG_TAGS=addToSet({},svg$1);addToSet(ALL_SVG_TAGS,svgFilters);addToSet(ALL_SVG_TAGS,svgDisallowed);var ALL_MATHML_TAGS=addToSet({},mathMl$1);addToSet(ALL_MATHML_TAGS,mathMlDisallowed);var _checkValidNamespace=function _checkValidNamespace(element){var parent=getParentNode(element);if(!parent||!parent.tagName){parent={namespaceURI:HTML_NAMESPACE,tagName:'template'};}var tagName=stringToLowerCase(element.tagName);var parentTagName=stringToLowerCase(parent.tagName);if(element.namespaceURI===SVG_NAMESPACE){if(parent.namespaceURI===HTML_NAMESPACE){return tagName==='svg';}if(parent.namespaceURI===MATHML_NAMESPACE){return tagName==='svg'&&(parentTagName==='annotation-xml'||MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);}return Boolean(ALL_SVG_TAGS[tagName]);}if(element.namespaceURI===MATHML_NAMESPACE){if(parent.namespaceURI===HTML_NAMESPACE){return tagName==='math';}if(parent.namespaceURI===SVG_NAMESPACE){return tagName==='math'&&HTML_INTEGRATION_POINTS[parentTagName];}return Boolean(ALL_MATHML_TAGS[tagName]);}if(element.namespaceURI===HTML_NAMESPACE){if(parent.namespaceURI===SVG_NAMESPACE&&!HTML_INTEGRATION_POINTS[parentTagName]){return false;}if(parent.namespaceURI===MATHML_NAMESPACE&&!MATHML_TEXT_INTEGRATION_POINTS[parentTagName]){return false;}return!ALL_MATHML_TAGS[tagName]&&(COMMON_SVG_AND_HTML_ELEMENTS[tagName]||!ALL_SVG_TAGS[tagName]);}return false;};var _forceRemove=function _forceRemove(node){arrayPush(DOMPurify.removed,{element:node});try{node.parentNode.removeChild(node);}catch(_){try{node.outerHTML=emptyHTML;}catch(_){node.remove();}}};var _removeAttribute=function _removeAttribute(name,node){try{arrayPush(DOMPurify.removed,{attribute:node.getAttributeNode(name),from:node});}catch(_){arrayPush(DOMPurify.removed,{attribute:null,from:node});}node.removeAttribute(name);if(name==='is'&&!ALLOWED_ATTR[name]){if(RETURN_DOM||RETURN_DOM_FRAGMENT){try{_forceRemove(node);}catch(_){}}else{try{node.setAttribute(name,'');}catch(_){}}}};var _initDocument=function _initDocument(dirty){var doc;var leadingWhitespace;if(FORCE_BODY){dirty='<remove></remove>'+dirty;}else{var matches=stringMatch(dirty,/^[\r\n\t ]+/);leadingWhitespace=matches&&matches[0];}if(PARSER_MEDIA_TYPE==='application/xhtml+xml'){dirty='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+dirty+'</body></html>';}var dirtyPayload=trustedTypesPolicy?trustedTypesPolicy.createHTML(dirty):dirty;if(NAMESPACE===HTML_NAMESPACE){try{doc=new DOMParser().parseFromString(dirtyPayload,PARSER_MEDIA_TYPE);}catch(_){}}if(!doc||!doc.documentElement){doc=implementation.createDocument(NAMESPACE,'template',null);try{doc.documentElement.innerHTML=IS_EMPTY_INPUT?'':dirtyPayload;}catch(_){}}var body=doc.body||doc.documentElement;if(dirty&&leadingWhitespace){body.insertBefore(document.createTextNode(leadingWhitespace),body.childNodes[0]||null);}if(NAMESPACE===HTML_NAMESPACE){return getElementsByTagName.call(doc,WHOLE_DOCUMENT?'html':'body')[0];}return WHOLE_DOCUMENT?doc.documentElement:body;};var _createIterator=function _createIterator(root){return createNodeIterator.call(root.ownerDocument||root,root,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,null,false);};var _isClobbered=function _isClobbered(elm){return elm instanceof HTMLFormElement&&(typeof elm.nodeName!=='string'||typeof elm.textContent!=='string'||typeof elm.removeChild!=='function'||!(elm.attributes instanceof NamedNodeMap)||typeof elm.removeAttribute!=='function'||typeof elm.setAttribute!=='function'||typeof elm.namespaceURI!=='string'||typeof elm.insertBefore!=='function');};var _isNode=function _isNode(object){return _typeof(Node)==='object'?object instanceof Node:object&&_typeof(object)==='object'&&typeof object.nodeType==='number'&&typeof object.nodeName==='string';};var _executeHook=function _executeHook(entryPoint,currentNode,data){if(!hooks[entryPoint]){return;}arrayForEach(hooks[entryPoint],function(hook){hook.call(DOMPurify,currentNode,data,CONFIG);});};var _sanitizeElements=function _sanitizeElements(currentNode){var content;_executeHook('beforeSanitizeElements',currentNode,null);if(_isClobbered(currentNode)){_forceRemove(currentNode);return true;}if(regExpTest(/[\u0080-\uFFFF]/,currentNode.nodeName)){_forceRemove(currentNode);return true;}var tagName=transformCaseFunc(currentNode.nodeName);_executeHook('uponSanitizeElement',currentNode,{tagName:tagName,allowedTags:ALLOWED_TAGS});if(currentNode.hasChildNodes()&&!_isNode(currentNode.firstElementChild)&&(!_isNode(currentNode.content)||!_isNode(currentNode.content.firstElementChild))&&regExpTest(/<[/\w]/g,currentNode.innerHTML)&&regExpTest(/<[/\w]/g,currentNode.textContent)){_forceRemove(currentNode);return true;}if(tagName==='select'&&regExpTest(/<template/i,currentNode.innerHTML)){_forceRemove(currentNode);return true;}if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){if(!FORBID_TAGS[tagName]&&_basicCustomElementTest(tagName)){if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,tagName))return false;if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName))return false;}if(KEEP_CONTENT&&!FORBID_CONTENTS[tagName]){var parentNode=getParentNode(currentNode)||currentNode.parentNode;var childNodes=getChildNodes(currentNode)||currentNode.childNodes;if(childNodes&&parentNode){var childCount=childNodes.length;for(var i=childCount-1;i>=0;--i){parentNode.insertBefore(cloneNode(childNodes[i],true),getNextSibling(currentNode));}}}_forceRemove(currentNode);return true;}if(currentNode instanceof Element&&!_checkValidNamespace(currentNode)){_forceRemove(currentNode);return true;}if((tagName==='noscript'||tagName==='noembed')&&regExpTest(/<\/no(script|embed)/i,currentNode.innerHTML)){_forceRemove(currentNode);return true;}if(SAFE_FOR_TEMPLATES&&currentNode.nodeType===3){content=currentNode.textContent;content=stringReplace(content,MUSTACHE_EXPR$1,' ');content=stringReplace(content,ERB_EXPR$1,' ');if(currentNode.textContent!==content){arrayPush(DOMPurify.removed,{element:currentNode.cloneNode()});currentNode.textContent=content;}}_executeHook('afterSanitizeElements',currentNode,null);return false;};var _isValidAttribute=function _isValidAttribute(lcTag,lcName,value){if(SANITIZE_DOM&&(lcName==='id'||lcName==='name')&&(value in document||value in formElement)){return false;}if(ALLOW_DATA_ATTR&&!FORBID_ATTR[lcName]&&regExpTest(DATA_ATTR$1,lcName));else if(ALLOW_ARIA_ATTR&&regExpTest(ARIA_ATTR$1,lcName));else if(!ALLOWED_ATTR[lcName]||FORBID_ATTR[lcName]){if(_basicCustomElementTest(lcTag)&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,lcTag)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag))&&(CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck,lcName)||CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName))||lcName==='is'&&CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,value)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(value)));else{return false;}}else if(URI_SAFE_ATTRIBUTES[lcName]);else if(regExpTest(IS_ALLOWED_URI$1,stringReplace(value,ATTR_WHITESPACE$1,'')));else if((lcName==='src'||lcName==='xlink:href'||lcName==='href')&&lcTag!=='script'&&stringIndexOf(value,'data:')===0&&DATA_URI_TAGS[lcTag]);else if(ALLOW_UNKNOWN_PROTOCOLS&&!regExpTest(IS_SCRIPT_OR_DATA$1,stringReplace(value,ATTR_WHITESPACE$1,'')));else if(!value);else{return false;}return true;};var _basicCustomElementTest=function _basicCustomElementTest(tagName){return tagName.indexOf('-')>0;};var _sanitizeAttributes=function _sanitizeAttributes(currentNode){var attr;var value;var lcName;var l;_executeHook('beforeSanitizeAttributes',currentNode,null);var attributes=currentNode.attributes;if(!attributes){return;}var hookEvent={attrName:'',attrValue:'',keepAttr:true,allowedAttributes:ALLOWED_ATTR};l=attributes.length;while(l--){attr=attributes[l];var _attr=attr,name=_attr.name,namespaceURI=_attr.namespaceURI;value=name==='value'?attr.value:stringTrim(attr.value);lcName=transformCaseFunc(name);var initValue=value;hookEvent.attrName=lcName;hookEvent.attrValue=value;hookEvent.keepAttr=true;hookEvent.forceKeepAttr=undefined;_executeHook('uponSanitizeAttribute',currentNode,hookEvent);value=hookEvent.attrValue;if(hookEvent.forceKeepAttr){continue;}if(!hookEvent.keepAttr){_removeAttribute(name,currentNode);continue;}if(regExpTest(/\/>/i,value)){_removeAttribute(name,currentNode);continue;}if(SAFE_FOR_TEMPLATES){value=stringReplace(value,MUSTACHE_EXPR$1,' ');value=stringReplace(value,ERB_EXPR$1,' ');}var lcTag=transformCaseFunc(currentNode.nodeName);if(!_isValidAttribute(lcTag,lcName,value)){_removeAttribute(name,currentNode);continue;}if(value!==initValue){try{if(namespaceURI){currentNode.setAttributeNS(namespaceURI,name,value);}else{currentNode.setAttribute(name,value);}}catch(_){_removeAttribute(name,currentNode);}}}_executeHook('afterSanitizeAttributes',currentNode,null);};var _sanitizeShadowDOM=function _sanitizeShadowDOM(fragment){var shadowNode;var shadowIterator=_createIterator(fragment);_executeHook('beforeSanitizeShadowDOM',fragment,null);while(shadowNode=shadowIterator.nextNode()){_executeHook('uponSanitizeShadowNode',shadowNode,null);if(_sanitizeElements(shadowNode)){continue;}if(shadowNode.content instanceof DocumentFragment){_sanitizeShadowDOM(shadowNode.content);}_sanitizeAttributes(shadowNode);}_executeHook('afterSanitizeShadowDOM',fragment,null);};DOMPurify.sanitize=function(dirty,cfg){var body;var importedNode;var currentNode;var oldNode;var returnNode;IS_EMPTY_INPUT=!dirty;if(IS_EMPTY_INPUT){dirty='<!-->';}if(typeof dirty!=='string'&&!_isNode(dirty)){if(typeof dirty.toString!=='function'){throw typeErrorCreate('toString is not a function');}else{dirty=dirty.toString();if(typeof dirty!=='string'){throw typeErrorCreate('dirty is not a string, aborting');}}}if(!DOMPurify.isSupported){if(_typeof(window.toStaticHTML)==='object'||typeof window.toStaticHTML==='function'){if(typeof dirty==='string'){return window.toStaticHTML(dirty);}if(_isNode(dirty)){return window.toStaticHTML(dirty.outerHTML);}}return dirty;}if(!SET_CONFIG){_parseConfig(cfg);}DOMPurify.removed=[];if(typeof dirty==='string'){IN_PLACE=false;}if(IN_PLACE){if(dirty.nodeName){var tagName=transformCaseFunc(dirty.nodeName);if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');}}}else if(dirty instanceof Node){body=_initDocument('<!---->');importedNode=body.ownerDocument.importNode(dirty,true);if(importedNode.nodeType===1&&importedNode.nodeName==='BODY'){body=importedNode;}else if(importedNode.nodeName==='HTML'){body=importedNode;}else{body.appendChild(importedNode);}}else{if(!RETURN_DOM&&!SAFE_FOR_TEMPLATES&&!WHOLE_DOCUMENT&&dirty.indexOf('<')===-1){return trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(dirty):dirty;}body=_initDocument(dirty);if(!body){return RETURN_DOM?null:RETURN_TRUSTED_TYPE?emptyHTML:'';}}if(body&&FORCE_BODY){_forceRemove(body.firstChild);}var nodeIterator=_createIterator(IN_PLACE?dirty:body);while(currentNode=nodeIterator.nextNode()){if(currentNode.nodeType===3&&currentNode===oldNode){continue;}if(_sanitizeElements(currentNode)){continue;}if(currentNode.content instanceof DocumentFragment){_sanitizeShadowDOM(currentNode.content);}_sanitizeAttributes(currentNode);oldNode=currentNode;}oldNode=null;if(IN_PLACE){return dirty;}if(RETURN_DOM){if(RETURN_DOM_FRAGMENT){returnNode=createDocumentFragment.call(body.ownerDocument);while(body.firstChild){returnNode.appendChild(body.firstChild);}}else{returnNode=body;}if(ALLOWED_ATTR.shadowroot){returnNode=importNode.call(originalDocument,returnNode,true);}return returnNode;}var serializedHTML=WHOLE_DOCUMENT?body.outerHTML:body.innerHTML;if(WHOLE_DOCUMENT&&ALLOWED_TAGS['!doctype']&&body.ownerDocument&&body.ownerDocument.doctype&&body.ownerDocument.doctype.name&&regExpTest(DOCTYPE_NAME,body.ownerDocument.doctype.name)){serializedHTML='<!DOCTYPE '+body.ownerDocument.doctype.name+'>\n'+serializedHTML;}if(SAFE_FOR_TEMPLATES){serializedHTML=stringReplace(serializedHTML,MUSTACHE_EXPR$1,' ');serializedHTML=stringReplace(serializedHTML,ERB_EXPR$1,' ');}return trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(serializedHTML):serializedHTML;};DOMPurify.setConfig=function(cfg){_parseConfig(cfg);SET_CONFIG=true;};DOMPurify.clearConfig=function(){CONFIG=null;SET_CONFIG=false;};DOMPurify.isValidAttribute=function(tag,attr,value){if(!CONFIG){_parseConfig({});}var lcTag=transformCaseFunc(tag);var lcName=transformCaseFunc(attr);return _isValidAttribute(lcTag,lcName,value);};DOMPurify.addHook=function(entryPoint,hookFunction){if(typeof hookFunction!=='function'){return;}hooks[entryPoint]=hooks[entryPoint]||[];arrayPush(hooks[entryPoint],hookFunction);};DOMPurify.removeHook=function(entryPoint){if(hooks[entryPoint]){return arrayPop(hooks[entryPoint]);}};DOMPurify.removeHooks=function(entryPoint){if(hooks[entryPoint]){hooks[entryPoint]=[];}};DOMPurify.removeAllHooks=function(){hooks={};};return DOMPurify;}var purify=createDOMPurify();var explode$1=Tools.explode;var create$7=function create$7(){var filters={};var addFilter=function addFilter(name,callback){each$f(explode$1(name),function(name){if(!has$2(filters,name)){filters[name]={name:name,callbacks:[]};}filters[name].callbacks.push(callback);});};var getFilters=function getFilters(){return values(filters);};var removeFilter=function removeFilter(name,callback){each$f(explode$1(name),function(name){if(has$2(filters,name)){if(isNonNullable(callback)){var _filter3=filters[name];var newCallbacks=filter$6(_filter3.callbacks,function(c){return c!==callback;});if(newCallbacks.length>0){_filter3.callbacks=newCallbacks;}else{delete filters[name];}}else{delete filters[name];}}});};return{addFilter:addFilter,getFilters:getFilters,removeFilter:removeFilter};};var removeAttrs=function removeAttrs(node,names){each$f(names,function(name){node.attr(name,null);});};var addFontToSpansFilter=function addFontToSpansFilter(domParser,styles,fontSizes){domParser.addNodeFilter('font',function(nodes){each$f(nodes,function(node){var props=styles.parse(node.attr('style'));var color=node.attr('color');var face=node.attr('face');var size=node.attr('size');if(color){props.color=color;}if(face){props['font-family']=face;}if(size){props['font-size']=fontSizes[parseInt(node.attr('size'),10)-1];}node.name='span';node.attr('style',styles.serialize(props));removeAttrs(node,['color','face','size']);});});};var addStrikeFilter=function addStrikeFilter(domParser,schema,styles){domParser.addNodeFilter('strike',function(nodes){var convertToSTag=schema.type!=='html4';each$f(nodes,function(node){if(convertToSTag){node.name='s';}else{var props=styles.parse(node.attr('style'));props['text-decoration']='line-through';node.name='span';node.attr('style',styles.serialize(props));}});});};var addFilters=function addFilters(domParser,settings,schema){var styles=Styles();if(settings.convert_fonts_to_spans){addFontToSpansFilter(domParser,styles,Tools.explode(settings.font_size_legacy_values));}addStrikeFilter(domParser,schema,styles);};var register$5=function register$5(domParser,settings,schema){if(settings.inline_styles){addFilters(domParser,settings,schema);}};var blobUriToBlob=function blobUriToBlob(url){return fetch(url).then(function(res){return res.ok?res.blob():Promise.reject();})["catch"](function(){return Promise.reject("Cannot convert ".concat(url," to Blob. Resource might not exist or is inaccessible."));});};var extractBase64Data=function extractBase64Data(data){var matches=/([a-z0-9+\/=\s]+)/i.exec(data);return matches?matches[1]:'';};var parseDataUri=function parseDataUri(uri){var _uri$split=uri.split(','),_uri$split2=_toArray(_uri$split),type=_uri$split2[0],rest=_uri$split2.slice(1);var data=rest.join(',');var matches=/data:([^/]+\/[^;]+)(;.+)?/.exec(type);if(matches){var base64Encoded=matches[2]===';base64';var extractedData=base64Encoded?extractBase64Data(data):decodeURIComponent(data);return Optional.some({type:matches[1],data:extractedData,base64Encoded:base64Encoded});}else{return Optional.none();}};var buildBlob=function buildBlob(type,data){var base64Encoded=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var str=data;if(base64Encoded){try{str=atob(data);}catch(e){return Optional.none();}}var arr=new Uint8Array(str.length);for(var i=0;i<arr.length;i++){arr[i]=str.charCodeAt(i);}return Optional.some(new Blob([arr],{type:type}));};var dataUriToBlob=function dataUriToBlob(uri){return new Promise(function(resolve,reject){parseDataUri(uri).bind(function(_ref11){var type=_ref11.type,data=_ref11.data,base64Encoded=_ref11.base64Encoded;return buildBlob(type,data,base64Encoded);}).fold(function(){return reject('Invalid data URI');},resolve);});};var uriToBlob=function uriToBlob(url){if(startsWith(url,'blob:')){return blobUriToBlob(url);}else if(startsWith(url,'data:')){return dataUriToBlob(url);}else{return Promise.reject('Unknown URI format');}};var blobToDataUri=function blobToDataUri(blob){return new Promise(function(resolve,reject){var reader=new FileReader();reader.onloadend=function(){resolve(reader.result);};reader.onerror=function(){reject(reader.error.message);};reader.readAsDataURL(blob);});};var count$1=0;var uniqueId$1=function uniqueId$1(prefix){return(prefix||'blobid')+count$1++;};var processDataUri=function processDataUri(dataUri,base64Only,generateBlobInfo){return parseDataUri(dataUri).bind(function(_ref12){var data=_ref12.data,type=_ref12.type,base64Encoded=_ref12.base64Encoded;if(base64Only&&!base64Encoded){return Optional.none();}else{var base64=base64Encoded?data:btoa(data);return generateBlobInfo(base64,type);}});};var createBlobInfo$1=function createBlobInfo$1(blobCache,blob,base64){var blobInfo=blobCache.create(uniqueId$1(),blob,base64);blobCache.add(blobInfo);return blobInfo;};var dataUriToBlobInfo=function dataUriToBlobInfo(blobCache,dataUri){var base64Only=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return processDataUri(dataUri,base64Only,function(base64,type){return Optional.from(blobCache.getByData(base64,type)).orThunk(function(){return buildBlob(type,base64).map(function(blob){return createBlobInfo$1(blobCache,blob,base64);});});});};var imageToBlobInfo=function imageToBlobInfo(blobCache,imageSrc){var invalidDataUri=function invalidDataUri(){return Promise.reject('Invalid data URI');};if(startsWith(imageSrc,'blob:')){var blobInfo=blobCache.getByUri(imageSrc);if(isNonNullable(blobInfo)){return Promise.resolve(blobInfo);}else{return uriToBlob(imageSrc).then(function(blob){return blobToDataUri(blob).then(function(dataUri){return processDataUri(dataUri,false,function(base64){return Optional.some(createBlobInfo$1(blobCache,blob,base64));}).getOrThunk(invalidDataUri);});});}}else if(startsWith(imageSrc,'data:')){return dataUriToBlobInfo(blobCache,imageSrc).fold(invalidDataUri,function(blobInfo){return Promise.resolve(blobInfo);});}else{return Promise.reject('Unknown image data format');}};var isBogusImage=function isBogusImage(img){return isNonNullable(img.attr('data-mce-bogus'));};var isInternalImageSource=function isInternalImageSource(img){return img.attr('src')===Env.transparentSrc||isNonNullable(img.attr('data-mce-placeholder'));};var registerBase64ImageFilter=function registerBase64ImageFilter(parser,settings){var blobCache=settings.blob_cache;var processImage=function processImage(img){var inputSrc=img.attr('src');if(isInternalImageSource(img)||isBogusImage(img)){return;}dataUriToBlobInfo(blobCache,inputSrc,true).each(function(blobInfo){img.attr('src',blobInfo.blobUri());});};if(blobCache){parser.addAttributeFilter('src',function(nodes){return each$f(nodes,processImage);});}};var register$4=function register$4(parser,settings){var schema=parser.schema;if(settings.remove_trailing_brs){parser.addNodeFilter('br',function(nodes,_,args){var blockElements=Tools.extend({},schema.getBlockElements());var nonEmptyElements=schema.getNonEmptyElements();var whitespaceElements=schema.getWhitespaceElements();blockElements.body=1;for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];var _parent6=node.parent;if(blockElements[node.parent.name]&&node===_parent6.lastChild){var _prev=node.prev;while(_prev){var prevName=_prev.name;if(prevName!=='span'||_prev.attr('data-mce-type')!=='bookmark'){if(prevName==='br'){node=null;}break;}_prev=_prev.prev;}if(node){node.remove();if(isEmpty(schema,nonEmptyElements,whitespaceElements,_parent6)){var elementRule=schema.getElementRule(_parent6.name);if(elementRule){if(elementRule.removeEmpty){_parent6.remove();}else if(elementRule.paddEmpty){paddEmptyNode(settings,args,blockElements,_parent6);}}}}}else{var lastParent=node;while(_parent6&&_parent6.firstChild===lastParent&&_parent6.lastChild===lastParent){lastParent=_parent6;if(blockElements[_parent6.name]){break;}_parent6=_parent6.parent;}if(lastParent===_parent6){var textNode=new AstNode('#text',3);textNode.value=nbsp;node.replace(textNode);}}}});}parser.addAttributeFilter('href',function(nodes){var i=nodes.length;var appendRel=function appendRel(rel){var parts=rel.split(' ').filter(function(p){return p.length>0;});return parts.concat(['noopener']).sort().join(' ');};var addNoOpener=function addNoOpener(rel){var newRel=rel?Tools.trim(rel):'';if(!/\b(noopener)\b/g.test(newRel)){return appendRel(newRel);}else{return newRel;}};if(!settings.allow_unsafe_link_target){while(i--){var node=nodes[i];if(node.name==='a'&&node.attr('target')==='_blank'){node.attr('rel',addNoOpener(node.attr('rel')));}}}});if(!settings.allow_html_in_named_anchor){parser.addAttributeFilter('id,name',function(nodes){var i=nodes.length,sibling,prevSibling,parent,node;while(i--){node=nodes[i];if(node.name==='a'&&node.firstChild&&!node.attr('href')){parent=node.parent;sibling=node.lastChild;do{prevSibling=sibling.prev;parent.insert(sibling,node);sibling=prevSibling;}while(sibling);}}});}if(settings.fix_list_elements){parser.addNodeFilter('ul,ol',function(nodes){var i=nodes.length,node,parentNode;while(i--){node=nodes[i];parentNode=node.parent;if(parentNode.name==='ul'||parentNode.name==='ol'){if(node.prev&&node.prev.name==='li'){node.prev.append(node);}else{var li=new AstNode('li',1);li.attr('style','list-style-type: none');node.wrap(li);}}}});}if(settings.validate&&schema.getValidClasses()){parser.addAttributeFilter('class',function(nodes){var validClasses=schema.getValidClasses();var i=nodes.length;while(i--){var node=nodes[i];var classList=node.attr('class').split(' ');var classValue='';for(var ci=0;ci<classList.length;ci++){var className=classList[ci];var valid=false;var validClassesMap=validClasses['*'];if(validClassesMap&&validClassesMap[className]){valid=true;}validClassesMap=validClasses[node.name];if(!valid&&validClassesMap&&validClassesMap[className]){valid=true;}if(valid){if(classValue){classValue+=' ';}classValue+=className;}}if(!classValue.length){classValue=null;}node.attr('class',classValue);}});}registerBase64ImageFilter(parser,settings);};var each$4=Tools.each,trim=Tools.trim;var queryParts='source protocol authority userInfo user password host port relative path directory file query anchor'.split(' ');var DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25};var safeSvgDataUrlElements=['img','video'];var blockSvgDataUris=function blockSvgDataUris(allowSvgDataUrls,tagName){if(isNonNullable(allowSvgDataUrls)){return!allowSvgDataUrls;}else{return isNonNullable(tagName)?!contains$2(safeSvgDataUrlElements,tagName):true;}};var decodeUri=function decodeUri(encodedUri){try{return decodeURIComponent(encodedUri);}catch(ex){return unescape(encodedUri);}};var isInvalidUri=function isInvalidUri(settings,uri,tagName){var decodedUri=decodeUri(uri);if(settings.allow_script_urls){return false;}else if(/((java|vb)script|mhtml):/i.test(decodedUri)){return true;}else if(settings.allow_html_data_urls){return false;}else if(/^data:image\//i.test(decodedUri)){return blockSvgDataUris(settings.allow_svg_data_urls,tagName)&&/^data:image\/svg\+xml/i.test(decodedUri);}else{return /^data:/i.test(decodedUri);}};var URI=/*#__PURE__*/function(){function URI(url,settings){_classCallCheck(this,URI);url=trim(url);this.settings=settings||{};var baseUri=this.settings.base_uri;var self=this;if(/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url)){self.source=url;return;}var isProtocolRelative=url.indexOf('//')===0;if(url.indexOf('/')===0&&!isProtocolRelative){url=(baseUri?baseUri.protocol||'http':'http')+'://mce_host'+url;}if(!/^[\w\-]*:?\/\//.test(url)){var baseUrl=this.settings.base_uri?this.settings.base_uri.path:new URI(document.location.href).directory;if(this.settings.base_uri&&this.settings.base_uri.protocol==''){url='//mce_host'+self.toAbsPath(baseUrl,url);}else{var _match4=/([^#?]*)([#?]?.*)/.exec(url);url=(baseUri&&baseUri.protocol||'http')+'://mce_host'+self.toAbsPath(baseUrl,_match4[1])+_match4[2];}}url=url.replace(/@@/g,'(mce_at)');var urlMatch=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?(\[[a-zA-Z0-9:.%]+\]|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url);each$4(queryParts,function(v,i){var part=urlMatch[i];if(part){part=part.replace(/\(mce_at\)/g,'@@');}self[v]=part;});if(baseUri){if(!self.protocol){self.protocol=baseUri.protocol;}if(!self.userInfo){self.userInfo=baseUri.userInfo;}if(!self.port&&self.host==='mce_host'){self.port=baseUri.port;}if(!self.host||self.host==='mce_host'){self.host=baseUri.host;}self.source='';}if(isProtocolRelative){self.protocol='';}}_createClass(URI,[{key:"setPath",value:function setPath(path){var pathMatch=/^(.*?)\/?(\w+)?$/.exec(path);this.path=pathMatch[0];this.directory=pathMatch[1];this.file=pathMatch[2];this.source='';this.getURI();}},{key:"toRelative",value:function toRelative(uri){var output;if(uri==='./'){return uri;}var relativeUri=new URI(uri,{base_uri:this});if(relativeUri.host!=='mce_host'&&this.host!==relativeUri.host&&relativeUri.host||this.port!==relativeUri.port||this.protocol!==relativeUri.protocol&&relativeUri.protocol!==''){return relativeUri.getURI();}var tu=this.getURI(),uu=relativeUri.getURI();if(tu===uu||tu.charAt(tu.length-1)==='/'&&tu.substr(0,tu.length-1)===uu){return tu;}output=this.toRelPath(this.path,relativeUri.path);if(relativeUri.query){output+='?'+relativeUri.query;}if(relativeUri.anchor){output+='#'+relativeUri.anchor;}return output;}},{key:"toAbsolute",value:function toAbsolute(uri,noHost){var absoluteUri=new URI(uri,{base_uri:this});return absoluteUri.getURI(noHost&&this.isSameOrigin(absoluteUri));}},{key:"isSameOrigin",value:function isSameOrigin(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port){return true;}var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort)){return true;}}return false;}},{key:"toRelPath",value:function toRelPath(base,path){var breakPoint=0,out='',i,l;var normalizedBase=base.substring(0,base.lastIndexOf('/')).split('/');var items=path.split('/');if(normalizedBase.length>=items.length){for(i=0,l=normalizedBase.length;i<l;i++){if(i>=items.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break;}}}if(normalizedBase.length<items.length){for(i=0,l=items.length;i<l;i++){if(i>=normalizedBase.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break;}}}if(breakPoint===1){return path;}for(i=0,l=normalizedBase.length-(breakPoint-1);i<l;i++){out+='../';}for(i=breakPoint-1,l=items.length;i<l;i++){if(i!==breakPoint-1){out+='/'+items[i];}else{out+=items[i];}}return out;}},{key:"toAbsPath",value:function toAbsPath(base,path){var i,nb=0,o=[],outPath;var tr=/\/$/.test(path)?'/':'';var normalizedBase=base.split('/');var normalizedPath=path.split('/');each$4(normalizedBase,function(k){if(k){o.push(k);}});normalizedBase=o;for(i=normalizedPath.length-1,o=[];i>=0;i--){if(normalizedPath[i].length===0||normalizedPath[i]==='.'){continue;}if(normalizedPath[i]==='..'){nb++;continue;}if(nb>0){nb--;continue;}o.push(normalizedPath[i]);}i=normalizedBase.length-nb;if(i<=0){outPath=reverse(o).join('/');}else{outPath=normalizedBase.slice(0,i).join('/')+'/'+reverse(o).join('/');}if(outPath.indexOf('/')!==0){outPath='/'+outPath;}if(tr&&outPath.lastIndexOf('/')!==outPath.length-1){outPath+=tr;}return outPath;}},{key:"getURI",value:function getURI(){var noProtoHost=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var s;if(!this.source||noProtoHost){s='';if(!noProtoHost){if(this.protocol){s+=this.protocol+'://';}else{s+='//';}if(this.userInfo){s+=this.userInfo+'@';}if(this.host){s+=this.host;}if(this.port){s+=':'+this.port;}}if(this.path){s+=this.path;}if(this.query){s+='?'+this.query;}if(this.anchor){s+='#'+this.anchor;}this.source=s;}return this.source;}}],[{key:"parseDataUri",value:function parseDataUri(uri){var type;var uriComponents=decodeURIComponent(uri).split(',');var matches=/data:([^;]+)/.exec(uriComponents[0]);if(matches){type=matches[1];}return{type:type,data:uriComponents[1]};}},{key:"isDomSafe",value:function isDomSafe(uri,context){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(options.allow_script_urls){return true;}else{var decodedUri=Entities.decode(uri).replace(/[\s\u0000-\u001F]+/g,'');return!isInvalidUri(options,decodedUri,context);}}},{key:"getDocumentBaseUrl",value:function getDocumentBaseUrl(loc){var baseUrl;if(loc.protocol.indexOf('http')!==0&&loc.protocol!=='file:'){baseUrl=loc.href;}else{baseUrl=loc.protocol+'//'+loc.host+loc.pathname;}if(/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)){baseUrl=baseUrl.replace(/[\?#].*$/,'').replace(/[\/\\][^\/]+$/,'');if(!/[\/\\]$/.test(baseUrl)){baseUrl+='/';}}return baseUrl;}}]);return URI;}();var makeMap=Tools.makeMap,extend$1=Tools.extend;var basePurifyConfig={IN_PLACE:true,ALLOW_UNKNOWN_PROTOCOLS:true,ALLOWED_TAGS:['#comment','#cdata-section','body'],ALLOWED_ATTR:[]};var filteredUrlAttrs=Tools.makeMap('src,href,data,background,action,formaction,poster,xlink:href');var internalElementAttr='data-mce-type';var getPurifyConfig=function getPurifyConfig(settings,mimeType){var config=_objectSpread({},basePurifyConfig);config.PARSER_MEDIA_TYPE=mimeType;if(settings.allow_script_urls){config.ALLOWED_URI_REGEXP=/.*/;}else if(settings.allow_html_data_urls){config.ALLOWED_URI_REGEXP=/^(?!(\w+script|mhtml):)/i;}return config;};var setupPurify=function setupPurify(settings,schema){var purify$1=purify();var specialElements=schema.getSpecialElements();var validate=settings.validate;var uid=0;purify$1.addHook('uponSanitizeElement',function(ele,evt){var _a,_b;if(ele.nodeType===COMMENT&&!settings.allow_conditional_comments&&/^\[if/i.test(ele.nodeValue)){ele.nodeValue=' '+ele.nodeValue;}var tagName=evt.tagName;if(ele.nodeType!==ELEMENT||tagName==='body'){return;}var element=SugarElement.fromDom(ele);var lcTagName=tagName.toLowerCase();var isInternalElement=has$1(element,internalElementAttr);var bogus=get$9(element,'data-mce-bogus');if(!isInternalElement&&isString(bogus)){if(bogus==='all'){remove$6(element);}else{unwrap(element);}return;}var rule=schema.getElementRule(lcTagName);if(validate&&!rule){if(has$2(specialElements,lcTagName)){remove$6(element);}else{unwrap(element);}return;}else{evt.allowedTags[tagName]=true;}if(validate&&!isInternalElement){each$f((_a=rule.attributesForced)!==null&&_a!==void 0?_a:[],function(attr){set$2(element,attr.name,attr.value==='{$uid}'?"mce_".concat(uid++):attr.value);});each$f((_b=rule.attributesDefault)!==null&&_b!==void 0?_b:[],function(attr){if(!has$1(element,attr.name)){set$2(element,attr.name,attr.value==='{$uid}'?"mce_".concat(uid++):attr.value);}});if(rule.attributesRequired&&!exists(rule.attributesRequired,function(attr){return has$1(element,attr);})){unwrap(element);return;}if(rule.removeEmptyAttrs&&hasNone(element)){unwrap(element);return;}if(rule.outputName&&rule.outputName!==lcTagName){mutate(element,rule.outputName);}}});purify$1.addHook('uponSanitizeAttribute',function(ele,evt){var tagName=ele.tagName.toLowerCase();var attrName=evt.attrName,attrValue=evt.attrValue;evt.keepAttr=!validate||schema.isValid(tagName,attrName)||startsWith(attrName,'data-')||startsWith(attrName,'aria-');if(attrName in filteredUrlAttrs&&isInvalidUri(settings,attrValue,tagName)){evt.keepAttr=false;}if(evt.keepAttr){evt.allowedAttributes[attrName]=true;if(attrName in schema.getBoolAttrs()){evt.attrValue=attrName;}if(settings.allow_svg_data_urls&&startsWith(attrValue,'data:image/svg+xml')){evt.forceKeepAttr=true;}}else if(ele.hasAttribute(internalElementAttr)&&(attrName==='id'||attrName==='class'||attrName==='style')){evt.forceKeepAttr=true;}});return purify$1;};var transferChildren=function transferChildren(parent,nativeParent,specialElements){var parentName=parent.name;var isSpecial=parentName in specialElements&&parentName!=='title'&&parentName!=='textarea';var childNodes=nativeParent.childNodes;for(var ni=0,nl=childNodes.length;ni<nl;ni++){var nativeChild=childNodes[ni];var _child4=new AstNode(nativeChild.nodeName.toLowerCase(),nativeChild.nodeType);if(isElement$6(nativeChild)){var attributes=nativeChild.attributes;for(var ai=0,al=attributes.length;ai<al;ai++){var attr=attributes[ai];_child4.attr(attr.name,attr.value);}}else if(isText$9(nativeChild)){_child4.value=nativeChild.data;if(isSpecial){_child4.raw=true;}}else if(isComment(nativeChild)||isCData(nativeChild)||isPi(nativeChild)){_child4.value=nativeChild.data;}transferChildren(_child4,nativeChild,specialElements);parent.append(_child4);}};var walkTree=function walkTree(root,preprocessors,postprocessors){var traverseOrder=[];var _loop2=function _loop2(_node4,lastNode){each$f(preprocessors,function(preprocess){return preprocess(_node4);});if(isNullable(_node4.parent)&&_node4!==root){_node4=lastNode;}else{traverseOrder.push(_node4);}node=_node4;};for(var node=root,lastNode=node;isNonNullable(node);lastNode=node,node=node.walk()){_loop2(node,lastNode);}var _loop3=function _loop3(i){var node=traverseOrder[i];each$f(postprocessors,function(postprocess){return postprocess(node);});};for(var i=traverseOrder.length-1;i>=0;i--){_loop3(i);}};var whitespaceCleaner=function whitespaceCleaner(root,schema,settings,args){var validate=settings.validate;var nonEmptyElements=schema.getNonEmptyElements();var whitespaceElements=schema.getWhitespaceElements();var blockElements=extend$1(makeMap('script,style,head,html,body,title,meta,param'),schema.getBlockElements());var textRootBlockElements=getTextRootBlockElements(schema);var allWhiteSpaceRegExp=/[ \t\r\n]+/g;var startWhiteSpaceRegExp=/^[ \t\r\n]+/;var endWhiteSpaceRegExp=/[ \t\r\n]+$/;var hasWhitespaceParent=function hasWhitespaceParent(node){node=node.parent;while(isNonNullable(node)){if(node.name in whitespaceElements){return true;}else{node=node.parent;}}return false;};var isTextRootBlockEmpty=function isTextRootBlockEmpty(node){var tempNode=node;while(isNonNullable(tempNode)){if(tempNode.name in textRootBlockElements){return isEmpty(schema,nonEmptyElements,whitespaceElements,tempNode);}else{tempNode=tempNode.parent;}}return false;};var isAtEdgeOfBlock=function isAtEdgeOfBlock(node,start){var neighbour=start?node.prev:node.next;if(isNonNullable(neighbour)){return false;}return node.parent.name in blockElements&&(node.parent!==root||args.isRootContent);};var preprocess=function preprocess(node){if(node.type===3){if(!hasWhitespaceParent(node)){var _text3=node.value;_text3=_text3.replace(allWhiteSpaceRegExp,' ');if(isLineBreakNode(node.prev,blockElements)||isAtEdgeOfBlock(node,true)){_text3=_text3.replace(startWhiteSpaceRegExp,'');}if(_text3.length===0){node.remove();}else{node.value=_text3;}}}};var postprocess=function postprocess(node){var _a;if(node.type===1){var elementRule=schema.getElementRule(node.name);if(validate&&elementRule){var isNodeEmpty=isEmpty(schema,nonEmptyElements,whitespaceElements,node);if(elementRule.paddInEmptyBlock&&isNodeEmpty&&isTextRootBlockEmpty(node)){paddEmptyNode(settings,args,blockElements,node);}else if(elementRule.removeEmpty&&isNodeEmpty){if(blockElements[node.name]){node.remove();}else{node.unwrap();}}else if(elementRule.paddEmpty&&(isNodeEmpty||isPaddedWithNbsp(node))){paddEmptyNode(settings,args,blockElements,node);}}}else if(node.type===3){if(!hasWhitespaceParent(node)){var _text4=node.value;if(blockElements[(_a=node.next)===null||_a===void 0?void 0:_a.name]||isAtEdgeOfBlock(node,false)){_text4=_text4.replace(endWhiteSpaceRegExp,'');}if(_text4.length===0){node.remove();}else{node.value=_text4;}}}};return[preprocess,postprocess];};var getRootBlockName=function getRootBlockName(settings,args){var _a;var name=(_a=args.forced_root_block)!==null&&_a!==void 0?_a:settings.forced_root_block;if(name===false){return'';}else if(name===true){return'p';}else{return name;}};var DomParser=function DomParser(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var schema=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Schema();var nodeFilterRegistry=create$7();var attributeFilterRegistry=create$7();var defaultedSettings=_objectSpread({validate:true,root_name:'body'},settings);var parser=new DOMParser();var purify=setupPurify(defaultedSettings,schema);var parseAndSanitizeWithContext=function parseAndSanitizeWithContext(html,rootName){var format=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'html';var mimeType=format==='xhtml'?'application/xhtml+xml':'text/html';var isSpecialRoot=has$2(schema.getSpecialElements(),rootName.toLowerCase());var content=isSpecialRoot?"<".concat(rootName,">").concat(html,"</").concat(rootName,">"):html;var wrappedHtml=format==='xhtml'?"<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>".concat(content,"</body></html>"):"<body>".concat(content,"</body>");var body=parser.parseFromString(wrappedHtml,mimeType).body;purify.sanitize(body,getPurifyConfig(defaultedSettings,mimeType));purify.removed=[];return isSpecialRoot?body.firstChild:body;};var addNodeFilter=nodeFilterRegistry.addFilter;var getNodeFilters=nodeFilterRegistry.getFilters;var removeNodeFilter=nodeFilterRegistry.removeFilter;var addAttributeFilter=attributeFilterRegistry.addFilter;var getAttributeFilters=attributeFilterRegistry.getFilters;var removeAttributeFilter=attributeFilterRegistry.removeFilter;var findInvalidChildren=function findInvalidChildren(node,invalidChildren){var parent=node.parent;if(parent&&schema.children[node.name]&&!schema.isValidChild(parent.name,node.name)){invalidChildren.push(node);}};var addRootBlocks=function addRootBlocks(rootNode,rootBlockName){var blockElements=extend$1(makeMap('script,style,head,html,body,title,meta,param'),schema.getBlockElements());var startWhiteSpaceRegExp=/^[ \t\r\n]+/;var endWhiteSpaceRegExp=/[ \t\r\n]+$/;var node=rootNode.firstChild,rootBlockNode=null;var trim=function trim(rootBlock){if(rootBlock){node=rootBlock.firstChild;if(node&&node.type===3){node.value=node.value.replace(startWhiteSpaceRegExp,'');}node=rootBlock.lastChild;if(node&&node.type===3){node.value=node.value.replace(endWhiteSpaceRegExp,'');}}};if(!schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){return;}while(node){var _next2=node.next;if(node.type===3||node.type===1&&node.name!=='p'&&!blockElements[node.name]&&!node.attr(internalElementAttr)){if(!rootBlockNode){rootBlockNode=new AstNode(rootBlockName,1);rootBlockNode.attr(defaultedSettings.forced_root_block_attrs);rootNode.insert(rootBlockNode,node);rootBlockNode.append(node);}else{rootBlockNode.append(node);}}else{trim(rootBlockNode);rootBlockNode=null;}node=_next2;}trim(rootBlockNode);};var parse=function parse(html){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _a;var validate=defaultedSettings.validate;var rootName=(_a=args.context)!==null&&_a!==void 0?_a:defaultedSettings.root_name;var element=parseAndSanitizeWithContext(html,rootName,args.format);var rootNode=new AstNode(rootName,11);transferChildren(rootNode,element,schema.getSpecialElements());var _whitespaceCleaner=whitespaceCleaner(rootNode,schema,defaultedSettings,args),_whitespaceCleaner2=_slicedToArray(_whitespaceCleaner,2),whitespacePre=_whitespaceCleaner2[0],whitespacePost=_whitespaceCleaner2[1];var invalidChildren=[];var invalidFinder=validate?function(node){return findInvalidChildren(node,invalidChildren);}:noop;var matches={nodes:{},attributes:{}};var matchFinder=function matchFinder(node){return matchNode$1(getNodeFilters(),getAttributeFilters(),node,matches);};walkTree(rootNode,[whitespacePre,matchFinder],[whitespacePost,invalidFinder]);invalidChildren.reverse();if(validate&&invalidChildren.length>0){if(args.context){var _partition$=partition$2(invalidChildren,function(child){return child.parent===rootNode;}),topLevelChildren=_partition$.pass,otherChildren=_partition$.fail;cleanInvalidNodes(otherChildren,schema,matchFinder);args.invalid=topLevelChildren.length>0;}else{cleanInvalidNodes(invalidChildren,schema,matchFinder);}}var rootBlockName=getRootBlockName(defaultedSettings,args);if(rootBlockName&&(rootNode.name==='body'||args.isRootContent)){addRootBlocks(rootNode,rootBlockName);}if(!args.invalid){runFilters(matches,args);}return rootNode;};var exports={schema:schema,addAttributeFilter:addAttributeFilter,getAttributeFilters:getAttributeFilters,removeAttributeFilter:removeAttributeFilter,addNodeFilter:addNodeFilter,getNodeFilters:getNodeFilters,removeNodeFilter:removeNodeFilter,parse:parse};register$4(exports,defaultedSettings);register$5(exports,defaultedSettings,schema);return exports;};var serializeContent=function serializeContent(content){return isTreeNode(content)?HtmlSerializer({validate:false}).serialize(content):content;};var withSerializedContent=function withSerializedContent(content,fireEvent){var serializedContent=serializeContent(content);var eventArgs=fireEvent(serializedContent);if(eventArgs.isDefaultPrevented()){return eventArgs;}else if(isTreeNode(content)){if(eventArgs.content!==serializedContent){var rootNode=DomParser({validate:false,forced_root_block:false}).parse(eventArgs.content,{context:content.name});return _objectSpread({},eventArgs,{content:rootNode});}else{return _objectSpread({},eventArgs,{content:content});}}else{return eventArgs;}};var preProcessGetContent=function preProcessGetContent(editor,args){if(args.no_events){return Result.value(args);}else{var eventArgs=fireBeforeGetContent(editor,args);if(eventArgs.isDefaultPrevented()){return Result.error(fireGetContent(editor,_objectSpread({content:''},eventArgs)).content);}else{return Result.value(eventArgs);}}};var postProcessGetContent=function postProcessGetContent(editor,content,args){if(args.no_events){return content;}else{var processedEventArgs=withSerializedContent(content,function(c){return fireGetContent(editor,_objectSpread({},args,{content:c}));});return processedEventArgs.content;}};var preProcessSetContent=function preProcessSetContent(editor,args){if(args.no_events){return Result.value(args);}else{var processedEventArgs=withSerializedContent(args.content,function(content){return fireBeforeSetContent(editor,_objectSpread({},args,{content:content}));});if(processedEventArgs.isDefaultPrevented()){fireSetContent(editor,processedEventArgs);return Result.error(undefined);}else{return Result.value(processedEventArgs);}}};var postProcessSetContent=function postProcessSetContent(editor,content,args){if(!args.no_events){fireSetContent(editor,_objectSpread({},args,{content:content}));}};var tableModel=function tableModel(element,width,rows){return{element:element,width:width,rows:rows};};var tableRow=function tableRow(element,cells){return{element:element,cells:cells};};var cellPosition=function cellPosition(x,y){return{x:x,y:y};};var getSpan=function getSpan(td,key){var value=parseInt(get$9(td,key),10);return isNaN(value)?1:value;};var fillout=function fillout(table,x,y,tr,td){var rowspan=getSpan(td,'rowspan');var colspan=getSpan(td,'colspan');var rows=table.rows;for(var y2=y;y2<y+rowspan;y2++){if(!rows[y2]){rows[y2]=tableRow(deep$1(tr),[]);}for(var x2=x;x2<x+colspan;x2++){var _cells=rows[y2].cells;_cells[x2]=y2===y&&x2===x?td:shallow$1(td);}}};var cellExists=function cellExists(table,x,y){var rows=table.rows;var cells=rows[y]?rows[y].cells:[];return!!cells[x];};var skipCellsX=function skipCellsX(table,x,y){while(cellExists(table,x,y)){x++;}return x;};var getWidth=function getWidth(rows){return foldl(rows,function(acc,row){return row.cells.length>acc?row.cells.length:acc;},0);};var findElementPos=function findElementPos(table,element){var rows=table.rows;for(var y=0;y<rows.length;y++){var _cells2=rows[y].cells;for(var x=0;x<_cells2.length;x++){if(eq(_cells2[x],element)){return Optional.some(cellPosition(x,y));}}}return Optional.none();};var extractRows=function extractRows(table,sx,sy,ex,ey){var newRows=[];var rows=table.rows;for(var y=sy;y<=ey;y++){var _cells3=rows[y].cells;var slice=sx<ex?_cells3.slice(sx,ex+1):_cells3.slice(ex,sx+1);newRows.push(tableRow(rows[y].element,slice));}return newRows;};var subTable=function subTable(table,startPos,endPos){var sx=startPos.x,sy=startPos.y;var ex=endPos.x,ey=endPos.y;var newRows=sy<ey?extractRows(table,sx,sy,ex,ey):extractRows(table,sx,ey,ex,sy);return tableModel(table.element,getWidth(newRows),newRows);};var createDomTable=function createDomTable(table,rows){var tableElement=shallow$1(table.element);var tableBody=SugarElement.fromTag('tbody');append(tableBody,rows);append$1(tableElement,tableBody);return tableElement;};var modelRowsToDomRows=function modelRowsToDomRows(table){return map$3(table.rows,function(row){var cells=map$3(row.cells,function(cell){var td=deep$1(cell);remove$b(td,'colspan');remove$b(td,'rowspan');return td;});var tr=shallow$1(row.element);append(tr,cells);return tr;});};var fromDom=function fromDom(tableElm){var table=tableModel(shallow$1(tableElm),0,[]);each$f(descendants(tableElm,'tr'),function(tr,y){each$f(descendants(tr,'td,th'),function(td,x){fillout(table,skipCellsX(table,x,y),y,tr,td);});});return tableModel(table.element,getWidth(table.rows),table.rows);};var toDom=function toDom(table){return createDomTable(table,modelRowsToDomRows(table));};var subsection=function subsection(table,startElement,endElement){return findElementPos(table,startElement).bind(function(startPos){return findElementPos(table,endElement).map(function(endPos){return subTable(table,startPos,endPos);});});};var findParentListContainer=function findParentListContainer(parents){return find$2(parents,function(elm){return name(elm)==='ul'||name(elm)==='ol';});};var getFullySelectedListWrappers=function getFullySelectedListWrappers(parents,rng){return find$2(parents,function(elm){return name(elm)==='li'&&hasAllContentsSelected(elm,rng);}).fold(constant([]),function(_li){return findParentListContainer(parents).map(function(listCont){var listElm=SugarElement.fromTag(name(listCont));var listStyles=filter$5(getAllRaw(listCont),function(_style,name){return startsWith(name,'list-style');});setAll(listElm,listStyles);return[SugarElement.fromTag('li'),listElm];}).getOr([]);});};var wrap=function wrap(innerElm,elms){var wrapped=foldl(elms,function(acc,elm){append$1(elm,acc);return elm;},innerElm);return elms.length>0?fromElements([wrapped]):wrapped;};var directListWrappers=function directListWrappers(commonAnchorContainer){if(isListItem(commonAnchorContainer)){return parent(commonAnchorContainer).filter(isList).fold(constant([]),function(listElm){return[commonAnchorContainer,listElm];});}else{return isList(commonAnchorContainer)?[commonAnchorContainer]:[];}};var getWrapElements=function getWrapElements(rootNode,rng){var commonAnchorContainer=SugarElement.fromDom(rng.commonAncestorContainer);var parents=parentsAndSelf(commonAnchorContainer,rootNode);var wrapElements=filter$6(parents,isWrapElement);var listWrappers=getFullySelectedListWrappers(parents,rng);var allWrappers=wrapElements.concat(listWrappers.length?listWrappers:directListWrappers(commonAnchorContainer));return map$3(allWrappers,shallow$1);};var emptyFragment=function emptyFragment(){return fromElements([]);};var getFragmentFromRange=function getFragmentFromRange(rootNode,rng){return wrap(SugarElement.fromDom(rng.cloneContents()),getWrapElements(rootNode,rng));};var getParentTable=function getParentTable(rootElm,cell){return ancestor$2(cell,'table',curry(eq,rootElm));};var getTableFragment=function getTableFragment(rootNode,selectedTableCells){return getParentTable(rootNode,selectedTableCells[0]).bind(function(tableElm){var firstCell=selectedTableCells[0];var lastCell=selectedTableCells[selectedTableCells.length-1];var fullTableModel=fromDom(tableElm);return subsection(fullTableModel,firstCell,lastCell).map(function(sectionedTableModel){return fromElements([toDom(sectionedTableModel)]);});}).getOrThunk(emptyFragment);};var getSelectionFragment=function getSelectionFragment(rootNode,ranges){return ranges.length>0&&ranges[0].collapsed?emptyFragment():getFragmentFromRange(rootNode,ranges[0]);};var read$3=function read$3(rootNode,ranges){var selectedCells=getCellsFromElementOrRanges(ranges,rootNode);return selectedCells.length>0?getTableFragment(rootNode,selectedCells):getSelectionFragment(rootNode,ranges);};var isCollapsibleWhitespace=function isCollapsibleWhitespace(text,index){return index>=0&&index<text.length&&isWhiteSpace(text.charAt(index));};var getInnerText=function getInnerText(bin){return trim$1(bin.innerText);};var getContextNodeName=function getContextNodeName(parentBlockOpt){return parentBlockOpt.map(function(block){return block.nodeName;}).getOr('div').toLowerCase();};var getTextContent=function getTextContent(editor){return Optional.from(editor.selection.getRng()).map(function(rng){var parentBlockOpt=Optional.from(editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock));var body=editor.getBody();var contextNodeName=getContextNodeName(parentBlockOpt);var bin=editor.dom.add(body,contextNodeName,{'data-mce-bogus':'all','style':'overflow: hidden; opacity: 0;'},rng.cloneContents());var text=getInnerText(bin);var nonRenderedText=trim$1(bin.textContent);editor.dom.remove(bin);if(isCollapsibleWhitespace(nonRenderedText,0)||isCollapsibleWhitespace(nonRenderedText,nonRenderedText.length-1)){var parentBlock=parentBlockOpt.getOr(body);var parentBlockText=getInnerText(parentBlock);var textIndex=parentBlockText.indexOf(text);if(textIndex===-1){return text;}else{var hasProceedingSpace=isCollapsibleWhitespace(parentBlockText,textIndex-1);var hasTrailingSpace=isCollapsibleWhitespace(parentBlockText,textIndex+text.length);return(hasProceedingSpace?' ':'')+text+(hasTrailingSpace?' ':'');}}else{return text;}}).getOr('');};var getSerializedContent=function getSerializedContent(editor,args){var rng=editor.selection.getRng(),tmpElm=editor.dom.create('body');var sel=editor.selection.getSel();var ranges=processRanges(editor,getRanges$1(sel));var fragment=args.contextual?read$3(SugarElement.fromDom(editor.getBody()),ranges).dom:rng.cloneContents();if(fragment){tmpElm.appendChild(fragment);}return editor.selection.serializer.serialize(tmpElm,args);};var extractSelectedContent=function extractSelectedContent(editor,args){if(args.format==='text'){return getTextContent(editor);}else{var content=getSerializedContent(editor,args);if(args.format==='tree'){return content;}else{return editor.selection.isCollapsed()?'':content;}}};var setupArgs$3=function setupArgs$3(args,format){return _objectSpread({},args,{format:format,get:true,selection:true,getInner:true});};var getSelectedContentInternal=function getSelectedContentInternal(editor,format){var args=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var defaultedArgs=setupArgs$3(args,format);return preProcessGetContent(editor,defaultedArgs).fold(identity,function(updatedArgs){var content=extractSelectedContent(editor,updatedArgs);return postProcessGetContent(editor,content,updatedArgs);});};var KEEP=0,INSERT=1,DELETE=2;var diff=function diff(left,right){var size=left.length+right.length+2;var vDown=new Array(size);var vUp=new Array(size);var snake=function snake(start,end,diag){return{start:start,end:end,diag:diag};};var buildScript=function buildScript(start1,end1,start2,end2,script){var middle=getMiddleSnake(start1,end1,start2,end2);if(middle===null||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2){var i=start1;var j=start2;while(i<end1||j<end2){if(i<end1&&j<end2&&left[i]===right[j]){script.push([KEEP,left[i]]);++i;++j;}else{if(end1-start1>end2-start2){script.push([DELETE,left[i]]);++i;}else{script.push([INSERT,right[j]]);++j;}}}}else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2){script.push([KEEP,left[i2]]);}buildScript(middle.end,end1,middle.end-middle.diag,end2,script);}};var buildSnake=function buildSnake(start,diag,end1,end2){var end=start;while(end-diag<end2&&end<end1&&left[end]===right[end-diag]){++end;}return snake(start,end,diag);};var getMiddleSnake=function getMiddleSnake(start1,end1,start2,end2){var m=end1-start1;var n=end2-start2;if(m===0||n===0){return null;}var delta=m-n;var sum=n+m;var offset=(sum%2===0?sum:sum+1)/2;vDown[1+offset]=start1;vUp[1+offset]=end1+1;var d,k,i,x,y;for(d=0;d<=offset;++d){for(k=-d;k<=d;k+=2){i=k+offset;if(k===-d||k!==d&&vDown[i-1]<vDown[i+1]){vDown[i]=vDown[i+1];}else{vDown[i]=vDown[i-1]+1;}x=vDown[i];y=x-start1+start2-k;while(x<end1&&y<end2&&left[x]===right[y]){vDown[i]=++x;++y;}if(delta%2!==0&&delta-d<=k&&k<=delta+d){if(vUp[i-delta]<=vDown[i]){return buildSnake(vUp[i-delta],k+start1-start2,end1,end2);}}}for(k=delta-d;k<=delta+d;k+=2){i=k+offset-delta;if(k===delta-d||k!==delta+d&&vUp[i+1]<=vUp[i-1]){vUp[i]=vUp[i+1]-1;}else{vUp[i]=vUp[i-1];}x=vUp[i]-1;y=x-start1+start2-k;while(x>=start1&&y>=start2&&left[x]===right[y]){vUp[i]=x--;y--;}if(delta%2===0&&-d<=k&&k<=d){if(vUp[i]<=vDown[i+delta]){return buildSnake(vUp[i],k+start1-start2,end1,end2);}}}}};var script=[];buildScript(0,left.length,0,right.length,script);return script;};var getOuterHtml=function getOuterHtml(elm){if(isElement$6(elm)){return elm.outerHTML;}else if(isText$9(elm)){return Entities.encodeRaw(elm.data,false);}else if(isComment(elm)){return'<!--'+elm.data+'-->';}return'';};var createFragment=function createFragment(html){var node;var container=document.createElement('div');var frag=document.createDocumentFragment();if(html){container.innerHTML=html;}while(node=container.firstChild){frag.appendChild(node);}return frag;};var insertAt=function insertAt(elm,html,index){var fragment=createFragment(html);if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.insertBefore(fragment,target);}else{elm.appendChild(fragment);}};var removeAt=function removeAt(elm,index){if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.removeChild(target);}};var applyDiff=function applyDiff(diff,elm){var index=0;each$f(diff,function(action){if(action[0]===KEEP){index++;}else if(action[0]===INSERT){insertAt(elm,action[1],index);index++;}else if(action[0]===DELETE){removeAt(elm,index);}});};var read$2=function read$2(elm){return filter$6(map$3(from(elm.childNodes),getOuterHtml),function(item){return item.length>0;});};var write=function write(fragments,elm){var currentFragments=map$3(from(elm.childNodes),getOuterHtml);applyDiff(diff(currentFragments,fragments),elm);return elm;};var lazyTempDocument=cached(function(){return document.implementation.createHTMLDocument('undo');});var hasIframes=function hasIframes(html){return html.indexOf('</iframe>')!==-1;};var createFragmentedLevel=function createFragmentedLevel(fragments){return{type:'fragmented',fragments:fragments,content:'',bookmark:null,beforeBookmark:null};};var createCompleteLevel=function createCompleteLevel(content){return{type:'complete',fragments:null,content:content,bookmark:null,beforeBookmark:null};};var createFromEditor=function createFromEditor(editor){var fragments=read$2(editor.getBody());var trimmedFragments=bind$3(fragments,function(html){var trimmed=trimInternal(editor.serializer,html);return trimmed.length>0?[trimmed]:[];});var content=trimmedFragments.join('');return hasIframes(content)?createFragmentedLevel(trimmedFragments):createCompleteLevel(content);};var applyToEditor=function applyToEditor(editor,level,before){var bookmark=before?level.beforeBookmark:level.bookmark;if(level.type==='fragmented'){write(level.fragments,editor.getBody());}else{editor.setContent(level.content,{format:'raw',no_selection:isNonNullable(bookmark)&&isPathBookmark(bookmark)?!bookmark.isFakeCaret:true});}editor.selection.moveToBookmark(bookmark);};var getLevelContent=function getLevelContent(level){return level.type==='fragmented'?level.fragments.join(''):level.content;};var getCleanLevelContent=function getCleanLevelContent(level){var elm=SugarElement.fromTag('body',lazyTempDocument());set(elm,getLevelContent(level));each$f(descendants(elm,'*[data-mce-bogus]'),unwrap);return get$6(elm);};var hasEqualContent=function hasEqualContent(level1,level2){return getLevelContent(level1)===getLevelContent(level2);};var hasEqualCleanedContent=function hasEqualCleanedContent(level1,level2){return getCleanLevelContent(level1)===getCleanLevelContent(level2);};var isEq$1=function isEq$1(level1,level2){if(!level1||!level2){return false;}else if(hasEqualContent(level1,level2)){return true;}else{return hasEqualCleanedContent(level1,level2);}};var isUnlocked=function isUnlocked(locks){return locks.get()===0;};var setTyping=function setTyping(undoManager,typing,locks){if(isUnlocked(locks)){undoManager.typing=typing;}};var endTyping=function endTyping(undoManager,locks){if(undoManager.typing){setTyping(undoManager,false,locks);undoManager.add();}};var endTypingLevelIgnoreLocks=function endTypingLevelIgnoreLocks(undoManager){if(undoManager.typing){undoManager.typing=false;undoManager.add();}};var beforeChange$1=function beforeChange$1(editor,locks,beforeBookmark){if(isUnlocked(locks)){beforeBookmark.set(getUndoBookmark(editor.selection));}};var addUndoLevel$1=function addUndoLevel$1(editor,undoManager,index,locks,beforeBookmark,level,event){var currentLevel=createFromEditor(editor);level=level||{};level=Tools.extend(level,currentLevel);if(isUnlocked(locks)===false||editor.removed){return null;}var lastLevel=undoManager.data[index.get()];if(editor.dispatch('BeforeAddUndo',{level:level,lastLevel:lastLevel,originalEvent:event}).isDefaultPrevented()){return null;}if(lastLevel&&isEq$1(lastLevel,level)){return null;}if(undoManager.data[index.get()]){beforeBookmark.get().each(function(bm){undoManager.data[index.get()].beforeBookmark=bm;});}var customUndoRedoLevels=getCustomUndoRedoLevels(editor);if(customUndoRedoLevels){if(undoManager.data.length>customUndoRedoLevels){for(var i=0;i<undoManager.data.length-1;i++){undoManager.data[i]=undoManager.data[i+1];}undoManager.data.length--;index.set(undoManager.data.length);}}level.bookmark=getUndoBookmark(editor.selection);if(index.get()<undoManager.data.length-1){undoManager.data.length=index.get()+1;}undoManager.data.push(level);index.set(undoManager.data.length-1);var args={level:level,lastLevel:lastLevel,originalEvent:event};if(index.get()>0){editor.setDirty(true);editor.dispatch('AddUndo',args);editor.dispatch('change',args);}else{editor.dispatch('AddUndo',args);}return level;};var clear$1=function clear$1(editor,undoManager,index){undoManager.data=[];index.set(0);undoManager.typing=false;editor.dispatch('ClearUndos');};var extra$1=function extra$1(editor,undoManager,index,callback1,callback2){if(undoManager.transact(callback1)){var bookmark=undoManager.data[index.get()].bookmark;var lastLevel=undoManager.data[index.get()-1];applyToEditor(editor,lastLevel,true);if(undoManager.transact(callback2)){undoManager.data[index.get()-1].beforeBookmark=bookmark;}}};var redo$1=function redo$1(editor,index,data){var level;if(index.get()<data.length-1){index.set(index.get()+1);level=data[index.get()];applyToEditor(editor,level,false);editor.setDirty(true);editor.dispatch('Redo',{level:level});}return level;};var undo$1=function undo$1(editor,undoManager,locks,index){var level;if(undoManager.typing){undoManager.add();undoManager.typing=false;setTyping(undoManager,false,locks);}if(index.get()>0){index.set(index.get()-1);level=undoManager.data[index.get()];applyToEditor(editor,level,true);editor.setDirty(true);editor.dispatch('Undo',{level:level});}return level;};var reset$1=function reset$1(undoManager){undoManager.clear();undoManager.add();};var hasUndo$1=function hasUndo$1(editor,undoManager,index){return index.get()>0||undoManager.typing&&undoManager.data[0]&&!isEq$1(createFromEditor(editor),undoManager.data[0]);};var hasRedo$1=function hasRedo$1(undoManager,index){return index.get()<undoManager.data.length-1&&!undoManager.typing;};var transact$1=function transact$1(undoManager,locks,callback){endTyping(undoManager,locks);undoManager.beforeChange();undoManager.ignore(callback);return undoManager.add();};var ignore$1=function ignore$1(locks,callback){try{locks.set(locks.get()+1);callback();}finally{locks.set(locks.get()-1);}};var addVisualInternal=function addVisualInternal(editor,elm){var dom=editor.dom;var scope=isNonNullable(elm)?elm:editor.getBody();if(isUndefined(editor.hasVisual)){editor.hasVisual=isVisualAidsEnabled(editor);}each$f(dom.select('table,a',scope),function(matchedElm){switch(matchedElm.nodeName){case'TABLE':var cls=getVisualAidsTableClass(editor);var _value4=dom.getAttrib(matchedElm,'border');if((!_value4||_value4==='0')&&editor.hasVisual){dom.addClass(matchedElm,cls);}else{dom.removeClass(matchedElm,cls);}break;case'A':if(!dom.getAttrib(matchedElm,'href')){var _value5=dom.getAttrib(matchedElm,'name')||matchedElm.id;var _cls=getVisualAidsAnchorClass(editor);if(_value5&&editor.hasVisual){dom.addClass(matchedElm,_cls);}else{dom.removeClass(matchedElm,_cls);}}break;}});editor.dispatch('VisualAid',{element:elm,hasVisual:editor.hasVisual});};var makePlainAdaptor=function makePlainAdaptor(editor){return{init:{bindEvents:noop},undoManager:{beforeChange:function beforeChange(locks,beforeBookmark){return beforeChange$1(editor,locks,beforeBookmark);},add:function add(undoManager,index,locks,beforeBookmark,level,event){return addUndoLevel$1(editor,undoManager,index,locks,beforeBookmark,level,event);},undo:function undo(undoManager,locks,index){return undo$1(editor,undoManager,locks,index);},redo:function redo(index,data){return redo$1(editor,index,data);},clear:function clear(undoManager,index){return clear$1(editor,undoManager,index);},reset:function reset(undoManager){return reset$1(undoManager);},hasUndo:function hasUndo(undoManager,index){return hasUndo$1(editor,undoManager,index);},hasRedo:function hasRedo(undoManager,index){return hasRedo$1(undoManager,index);},transact:function transact(undoManager,locks,callback){return transact$1(undoManager,locks,callback);},ignore:function ignore(locks,callback){return ignore$1(locks,callback);},extra:function extra(undoManager,index,callback1,callback2){return extra$1(editor,undoManager,index,callback1,callback2);}},formatter:{match:function match(name,vars,node,similar){return match$2(editor,name,vars,node,similar);},matchAll:function matchAll(names,vars){return _matchAll(editor,names,vars);},matchNode:function matchNode(node,name,vars,similar){return _matchNode(editor,node,name,vars,similar);},canApply:function canApply(name){return _canApply(editor,name);},closest:function closest(names){return closest$1(editor,names);},apply:function apply(name,vars,node){return applyFormat$1(editor,name,vars,node);},remove:function remove(name,vars,node,similar){return remove$2(editor,name,vars,node,similar);},toggle:function toggle(name,vars,node){return _toggle(editor,name,vars,node);},formatChanged:function formatChanged(registeredFormatListeners,formats,callback,similar,vars){return formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars);}},editor:{getContent:function getContent(args){return getContentInternal(editor,args);},setContent:function setContent(content,args){return setContentInternal(editor,content,args);},insertContent:function insertContent(value,details){return insertHtmlAtCaret(editor,value,details);},addVisual:function addVisual(elm){return addVisualInternal(editor,elm);}},selection:{getContent:function getContent(format,args){return getSelectedContentInternal(editor,format,args);}},autocompleter:{addDecoration:function addDecoration(range){return create$9(editor,range);},removeDecoration:function removeDecoration(){return remove$3(editor,SugarElement.fromDom(editor.getBody()));}},raw:{getModel:function getModel(){return Optional.none();}}};};var makeRtcAdaptor=function makeRtcAdaptor(rtcEditor){var defaultVars=function defaultVars(vars){return isObject(vars)?vars:{};};var init=rtcEditor.init,undoManager=rtcEditor.undoManager,formatter=rtcEditor.formatter,editor=rtcEditor.editor,selection=rtcEditor.selection,autocompleter=rtcEditor.autocompleter,raw=rtcEditor.raw;return{init:{bindEvents:init.bindEvents},undoManager:{beforeChange:undoManager.beforeChange,add:undoManager.add,undo:undoManager.undo,redo:undoManager.redo,clear:undoManager.clear,reset:undoManager.reset,hasUndo:undoManager.hasUndo,hasRedo:undoManager.hasRedo,transact:function transact(_undoManager,_locks,fn){return undoManager.transact(fn);},ignore:function ignore(_locks,callback){return undoManager.ignore(callback);},extra:function extra(_undoManager,_index,callback1,callback2){return undoManager.extra(callback1,callback2);}},formatter:{match:function match(name,vars,_node,similar){return formatter.match(name,defaultVars(vars),similar);},matchAll:formatter.matchAll,matchNode:formatter.matchNode,canApply:function canApply(name){return formatter.canApply(name);},closest:function closest(names){return formatter.closest(names);},apply:function apply(name,vars,_node){return formatter.apply(name,defaultVars(vars));},remove:function remove(name,vars,_node,_similar){return formatter.remove(name,defaultVars(vars));},toggle:function toggle(name,vars,_node){return formatter.toggle(name,defaultVars(vars));},formatChanged:function formatChanged(_rfl,formats,callback,similar,vars){return formatter.formatChanged(formats,callback,similar,vars);}},editor:{getContent:function getContent(args){return editor.getContent(args);},setContent:function setContent(content,args){return{content:editor.setContent(content,args),html:''};},insertContent:function insertContent(content,_details){editor.insertContent(content);return'';},addVisual:editor.addVisual},selection:{getContent:function getContent(_format,args){return selection.getContent(args);}},autocompleter:{addDecoration:autocompleter.addDecoration,removeDecoration:autocompleter.removeDecoration},raw:{getModel:function getModel(){return Optional.some(raw.getRawModel());}}};};var makeNoopAdaptor=function makeNoopAdaptor(){var nul=constant(null);var empty=constant('');return{init:{bindEvents:noop},undoManager:{beforeChange:noop,add:nul,undo:nul,redo:nul,clear:noop,reset:noop,hasUndo:never,hasRedo:never,transact:nul,ignore:noop,extra:noop},formatter:{match:never,matchAll:constant([]),matchNode:constant(undefined),canApply:never,closest:empty,apply:noop,remove:noop,toggle:noop,formatChanged:constant({unbind:noop})},editor:{getContent:empty,setContent:constant({content:'',html:''}),insertContent:constant(''),addVisual:noop},selection:{getContent:empty},autocompleter:{addDecoration:noop,removeDecoration:noop},raw:{getModel:constant(Optional.none())}};};var isRtc=function isRtc(editor){return has$2(editor.plugins,'rtc');};var getRtcSetup=function getRtcSetup(editor){return get$a(editor.plugins,'rtc').bind(function(rtcPlugin){return Optional.from(rtcPlugin.setup);});};var setup$s=function setup$s(editor){var editorCast=editor;return getRtcSetup(editor).fold(function(){editorCast.rtcInstance=makePlainAdaptor(editor);return Optional.none();},function(setup){editorCast.rtcInstance=makeNoopAdaptor();return Optional.some(function(){return setup().then(function(rtcEditor){editorCast.rtcInstance=makeRtcAdaptor(rtcEditor);return rtcEditor.rtc.isRemote;});});});};var getRtcInstanceWithFallback=function getRtcInstanceWithFallback(editor){return editor.rtcInstance?editor.rtcInstance:makePlainAdaptor(editor);};var getRtcInstanceWithError=function getRtcInstanceWithError(editor){var rtcInstance=editor.rtcInstance;if(!rtcInstance){throw new Error('Failed to get RTC instance not yet initialized.');}else{return rtcInstance;}};var _beforeChange=function beforeChange(editor,locks,beforeBookmark){getRtcInstanceWithError(editor).undoManager.beforeChange(locks,beforeBookmark);};var addUndoLevel=function addUndoLevel(editor,undoManager,index,locks,beforeBookmark,level,event){return getRtcInstanceWithError(editor).undoManager.add(undoManager,index,locks,beforeBookmark,level,event);};var _undo=function undo(editor,undoManager,locks,index){return getRtcInstanceWithError(editor).undoManager.undo(undoManager,locks,index);};var _redo=function redo(editor,index,data){return getRtcInstanceWithError(editor).undoManager.redo(index,data);};var _clear=function clear(editor,undoManager,index){getRtcInstanceWithError(editor).undoManager.clear(undoManager,index);};var _reset=function reset(editor,undoManager){getRtcInstanceWithError(editor).undoManager.reset(undoManager);};var _hasUndo=function hasUndo(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager,index);};var _hasRedo=function hasRedo(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager,index);};var _transact=function transact(editor,undoManager,locks,callback){return getRtcInstanceWithError(editor).undoManager.transact(undoManager,locks,callback);};var _ignore=function ignore(editor,locks,callback){getRtcInstanceWithError(editor).undoManager.ignore(locks,callback);};var _extra=function extra(editor,undoManager,index,callback1,callback2){getRtcInstanceWithError(editor).undoManager.extra(undoManager,index,callback1,callback2);};var matchFormat=function matchFormat(editor,name,vars,node,similar){return getRtcInstanceWithError(editor).formatter.match(name,vars,node,similar);};var matchAllFormats=function matchAllFormats(editor,names,vars){return getRtcInstanceWithError(editor).formatter.matchAll(names,vars);};var matchNodeFormat=function matchNodeFormat(editor,node,name,vars,similar){return getRtcInstanceWithError(editor).formatter.matchNode(node,name,vars,similar);};var canApplyFormat=function canApplyFormat(editor,name){return getRtcInstanceWithError(editor).formatter.canApply(name);};var closestFormat=function closestFormat(editor,names){return getRtcInstanceWithError(editor).formatter.closest(names);};var applyFormat=function applyFormat(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.apply(name,vars,node);};var removeFormat=function removeFormat(editor,name,vars,node,similar){getRtcInstanceWithError(editor).formatter.remove(name,vars,node,similar);};var toggleFormat=function toggleFormat(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.toggle(name,vars,node);};var _formatChanged=function formatChanged(editor,registeredFormatListeners,formats,callback,similar,vars){return getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners,formats,callback,similar,vars);};var getContent$2=function getContent$2(editor,args){return getRtcInstanceWithFallback(editor).editor.getContent(args);};var setContent$2=function setContent$2(editor,content,args){return getRtcInstanceWithFallback(editor).editor.setContent(content,args);};var insertContent$1=function insertContent$1(editor,value,details){return getRtcInstanceWithFallback(editor).editor.insertContent(value,details);};var getSelectedContent=function getSelectedContent(editor,format,args){return getRtcInstanceWithError(editor).selection.getContent(format,args);};var addVisual$1=function addVisual$1(editor,elm){return getRtcInstanceWithError(editor).editor.addVisual(elm);};var bindEvents=function bindEvents(editor){return getRtcInstanceWithError(editor).init.bindEvents();};var addAutocompleterDecoration=function addAutocompleterDecoration(editor,range){return getRtcInstanceWithError(editor).autocompleter.addDecoration(range);};var removeAutocompleterDecoration=function removeAutocompleterDecoration(editor){return getRtcInstanceWithError(editor).autocompleter.removeDecoration();};var getContent$1=function getContent$1(editor){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var format=args.format?args.format:'html';return getSelectedContent(editor,format,args);};var removeEmpty=function removeEmpty(text){if(text.dom.length===0){remove$6(text);return Optional.none();}else{return Optional.some(text);}};var walkPastBookmark=function walkPastBookmark(node,start){return node.filter(function(elm){return BookmarkManager.isBookmarkNode(elm.dom);}).bind(start?nextSibling:prevSibling);};var merge$1=function merge$1(outer,inner,rng,start){var outerElm=outer.dom;var innerElm=inner.dom;var oldLength=start?outerElm.length:innerElm.length;if(start){mergeTextNodes(outerElm,innerElm,false,!start);rng.setStart(innerElm,oldLength);}else{mergeTextNodes(innerElm,outerElm,false,!start);rng.setEnd(innerElm,oldLength);}};var normalizeTextIfRequired=function normalizeTextIfRequired(inner,start){parent(inner).each(function(root){var text=inner.dom;if(start&&needsToBeNbspLeft(root,CaretPosition(text,0))){normalizeWhitespaceAfter(text,0);}else if(!start&&needsToBeNbspRight(root,CaretPosition(text,text.length))){normalizeWhitespaceBefore(text,text.length);}});};var mergeAndNormalizeText=function mergeAndNormalizeText(outerNode,innerNode,rng,start){outerNode.bind(function(outer){var normalizer=start?normalizeWhitespaceBefore:normalizeWhitespaceAfter;normalizer(outer.dom,start?outer.dom.length:0);return innerNode.filter(isText$a).map(function(inner){return merge$1(outer,inner,rng,start);});}).orThunk(function(){var innerTextNode=walkPastBookmark(innerNode,start).or(innerNode).filter(isText$a);return innerTextNode.map(function(inner){return normalizeTextIfRequired(inner,start);});});};var rngSetContent=function rngSetContent(rng,fragment){var firstChild=Optional.from(fragment.firstChild).map(SugarElement.fromDom);var lastChild=Optional.from(fragment.lastChild).map(SugarElement.fromDom);rng.deleteContents();rng.insertNode(fragment);var prevText=firstChild.bind(prevSibling).filter(isText$a).bind(removeEmpty);var nextText=lastChild.bind(nextSibling).filter(isText$a).bind(removeEmpty);mergeAndNormalizeText(prevText,firstChild,rng,true);mergeAndNormalizeText(nextText,lastChild,rng,false);rng.collapse(false);};var setupArgs$2=function setupArgs$2(args,content){return _objectSpread({format:'html'},args,{set:true,selection:true,content:content});};var cleanContent=function cleanContent(editor,args){if(args.format!=='raw'){var rng=editor.selection.getRng();var contextBlock=editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock);var contextArgs=contextBlock?{context:contextBlock.nodeName.toLowerCase()}:{};var _node5=editor.parser.parse(args.content,_objectSpread({forced_root_block:false},contextArgs,{},args));return HtmlSerializer({validate:false},editor.schema).serialize(_node5);}else{return args.content;}};var setContent$1=function setContent$1(editor,content){var args=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var defaultedArgs=setupArgs$2(args,content);preProcessSetContent(editor,defaultedArgs).each(function(updatedArgs){var cleanedContent=cleanContent(editor,updatedArgs);var rng=editor.selection.getRng();rngSetContent(rng,rng.createContextualFragment(cleanedContent));editor.selection.setRng(rng);scrollRangeIntoView(editor,rng);postProcessSetContent(editor,cleanedContent,updatedArgs);});};var deleteFromCallbackMap=function deleteFromCallbackMap(callbackMap,selector,callback){if(callbackMap&&has$2(callbackMap,selector)){var newCallbacks=filter$6(callbackMap[selector],function(cb){return cb!==callback;});if(newCallbacks.length===0){delete callbackMap[selector];}else{callbackMap[selector]=newCallbacks;}}};var SelectorChanged=function SelectorChanged(dom,editor){var selectorChangedData;var currentSelectors;var findMatchingNode=function findMatchingNode(selector,nodes){return find$2(nodes,function(node){return dom.is(node,selector);});};var getParents=function getParents(elem){return dom.getParents(elem,null,dom.getRoot());};return{selectorChangedWithUnbind:function selectorChangedWithUnbind(selector,callback){if(!selectorChangedData){selectorChangedData={};currentSelectors={};editor.on('NodeChange',function(e){var node=e.element;var parents=getParents(node);var matchedSelectors={};Tools.each(selectorChangedData,function(callbacks,selector){findMatchingNode(selector,parents).each(function(node){if(!currentSelectors[selector]){each$f(callbacks,function(callback){callback(true,{node:node,selector:selector,parents:parents});});currentSelectors[selector]=callbacks;}matchedSelectors[selector]=callbacks;});});Tools.each(currentSelectors,function(callbacks,selector){if(!matchedSelectors[selector]){delete currentSelectors[selector];Tools.each(callbacks,function(callback){callback(false,{node:node,selector:selector,parents:parents});});}});});}if(!selectorChangedData[selector]){selectorChangedData[selector]=[];}selectorChangedData[selector].push(callback);findMatchingNode(selector,getParents(editor.selection.getStart())).each(function(){currentSelectors[selector]=selectorChangedData[selector];});return{unbind:function unbind(){deleteFromCallbackMap(selectorChangedData,selector,callback);deleteFromCallbackMap(currentSelectors,selector,callback);}};}};};var isAttachedToDom=function isAttachedToDom(node){return!!(node&&node.ownerDocument)&&contains(SugarElement.fromDom(node.ownerDocument),SugarElement.fromDom(node));};var isValidRange=function isValidRange(rng){if(!rng){return false;}else{return isAttachedToDom(rng.startContainer)&&isAttachedToDom(rng.endContainer);}};var EditorSelection=function EditorSelection(dom,win,serializer,editor){var selectedRange;var explicitRange;var _SelectorChanged=SelectorChanged(dom,editor),selectorChangedWithUnbind=_SelectorChanged.selectorChangedWithUnbind;var setCursorLocation=function setCursorLocation(node,offset){var rng=dom.createRng();if(isNonNullable(node)&&isNonNullable(offset)){rng.setStart(node,offset);rng.setEnd(node,offset);setRng(rng);collapse(false);}else{moveEndPoint(dom,rng,editor.getBody(),true);setRng(rng);}};var getContent=function getContent(args){return getContent$1(editor,args);};var setContent=function setContent(content,args){return setContent$1(editor,content,args);};var getStart$1=function getStart$1(real){return getStart(editor.getBody(),getRng$1(),real);};var getEnd=function getEnd(real){return getEnd$1(editor.getBody(),getRng$1(),real);};var getBookmark=function getBookmark(type,normalized){return bookmarkManager.getBookmark(type,normalized);};var moveToBookmark=function moveToBookmark(bookmark){return bookmarkManager.moveToBookmark(bookmark);};var select$1=function select$1(node,content){select(dom,node,content).each(setRng);return node;};var isCollapsed=function isCollapsed(){var rng=getRng$1(),sel=getSel();if(!rng||rng.item){return false;}if(rng.compareEndPoints){return rng.compareEndPoints('StartToEnd',rng)===0;}return!sel||rng.collapsed;};var collapse=function collapse(toStart){var rng=getRng$1();rng.collapse(!!toStart);setRng(rng);};var getSel=function getSel(){return win.getSelection?win.getSelection():win.document.selection;};var getRng$1=function getRng$1(){var selection,rng,elm;var tryCompareBoundaryPoints=function tryCompareBoundaryPoints(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange);}catch(ex){return-1;}};var doc=win.document;if(editor.bookmark!==undefined&&_hasFocus(editor)===false){var bookmark=getRng(editor);if(bookmark.isSome()){return bookmark.map(function(r){return processRanges(editor,[r])[0];}).getOr(doc.createRange());}}try{if((selection=getSel())&&!isRestrictedNode(selection.anchorNode)){if(selection.rangeCount>0){rng=selection.getRangeAt(0);}else{rng=selection.createRange?selection.createRange():doc.createRange();}rng=processRanges(editor,[rng])[0];}}catch(ex){}if(!rng){rng=doc.createRange();}if(rng.setStart&&rng.startContainer.nodeType===9&&rng.collapsed){elm=dom.getRoot();rng.setStart(elm,0);rng.setEnd(elm,0);}if(selectedRange&&explicitRange){if(tryCompareBoundaryPoints(rng.START_TO_START,rng,selectedRange)===0&&tryCompareBoundaryPoints(rng.END_TO_END,rng,selectedRange)===0){rng=explicitRange;}else{selectedRange=null;explicitRange=null;}}return rng;};var setRng=function setRng(rng,forward){var node;if(!isValidRange(rng)){return;}var sel=getSel();var evt=editor.dispatch('SetSelectionRange',{range:rng,forward:forward});rng=evt.range;if(sel){explicitRange=rng;try{sel.removeAllRanges();sel.addRange(rng);}catch(ex){}if(forward===false&&sel.extend){sel.collapse(rng.endContainer,rng.endOffset);sel.extend(rng.startContainer,rng.startOffset);}selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null;}if(!rng.collapsed&&rng.startContainer===rng.endContainer&&sel.setBaseAndExtent){if(rng.endOffset-rng.startOffset<2){if(rng.startContainer.hasChildNodes()){node=rng.startContainer.childNodes[rng.startOffset];if(node&&node.tagName==='IMG'){sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset);if(sel.anchorNode!==rng.startContainer||sel.focusNode!==rng.endContainer){sel.setBaseAndExtent(node,0,node,1);}}}}}editor.dispatch('AfterSetSelectionRange',{range:rng,forward:forward});};var setNode=function setNode(elm){setContent(dom.getOuterHTML(elm));return elm;};var getNode$1=function getNode$1(){return getNode(editor.getBody(),getRng$1());};var getSelectedBlocks$1=function getSelectedBlocks$1(startElm,endElm){return getSelectedBlocks(dom,getRng$1(),startElm,endElm);};var isForward=function isForward(){var sel=getSel();var anchorNode=sel===null||sel===void 0?void 0:sel.anchorNode;var focusNode=sel===null||sel===void 0?void 0:sel.focusNode;if(!sel||!anchorNode||!focusNode||isRestrictedNode(anchorNode)||isRestrictedNode(focusNode)){return true;}var anchorRange=dom.createRng();var focusRange=dom.createRng();try{anchorRange.setStart(anchorNode,sel.anchorOffset);anchorRange.collapse(true);focusRange.setStart(focusNode,sel.focusOffset);focusRange.collapse(true);}catch(e){return true;}return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0;};var normalize=function normalize(){var rng=getRng$1();var sel=getSel();if(!hasMultipleRanges(sel)&&hasAnyRanges(editor)){var normRng=normalize$2(dom,rng);normRng.each(function(normRng){setRng(normRng,isForward());});return normRng.getOr(rng);}return rng;};var selectorChanged=function selectorChanged(selector,callback){selectorChangedWithUnbind(selector,callback);return exports;};var getScrollContainer=function getScrollContainer(){var scrollContainer;var node=dom.getRoot();while(node&&node.nodeName!=='BODY'){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break;}node=node.parentNode;}return scrollContainer;};var scrollIntoView=function scrollIntoView(elm,alignToTop){if(isNonNullable(elm)){scrollElementIntoView(editor,elm,alignToTop);}else{scrollRangeIntoView(editor,getRng$1(),alignToTop);}};var placeCaretAt=function placeCaretAt(clientX,clientY){return setRng(fromPoint(clientX,clientY,editor.getDoc()));};var getBoundingClientRect=function getBoundingClientRect(){var rng=getRng$1();return rng.collapsed?CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect();};var destroy=function destroy(){win=selectedRange=explicitRange=null;controlSelection.destroy();};var exports={bookmarkManager:null,controlSelection:null,dom:dom,win:win,serializer:serializer,editor:editor,collapse:collapse,setCursorLocation:setCursorLocation,getContent:getContent,setContent:setContent,getBookmark:getBookmark,moveToBookmark:moveToBookmark,select:select$1,isCollapsed:isCollapsed,isForward:isForward,setNode:setNode,getNode:getNode$1,getSel:getSel,setRng:setRng,getRng:getRng$1,getStart:getStart$1,getEnd:getEnd,getSelectedBlocks:getSelectedBlocks$1,normalize:normalize,selectorChanged:selectorChanged,selectorChangedWithUnbind:selectorChangedWithUnbind,getScrollContainer:getScrollContainer,scrollIntoView:scrollIntoView,placeCaretAt:placeCaretAt,getBoundingClientRect:getBoundingClientRect,destroy:destroy};var bookmarkManager=BookmarkManager(exports);var controlSelection=ControlSelection(exports,editor);exports.bookmarkManager=bookmarkManager;exports.controlSelection=controlSelection;return exports;};var register$3=function register$3(htmlParser,settings,dom){htmlParser.addAttributeFilter('data-mce-tabindex',function(nodes,name){var i=nodes.length;while(i--){var _node6=nodes[i];_node6.attr('tabindex',_node6.attr('data-mce-tabindex'));_node6.attr(name,null);}});htmlParser.addAttributeFilter('src,href,style',function(nodes,name){var internalName='data-mce-'+name;var urlConverter=settings.url_converter;var urlConverterScope=settings.url_converter_scope;var i=nodes.length;while(i--){var _node7=nodes[i];var _value6=_node7.attr(internalName);if(_value6!==undefined){_node7.attr(name,_value6.length>0?_value6:null);_node7.attr(internalName,null);}else{_value6=_node7.attr(name);if(name==='style'){_value6=dom.serializeStyle(dom.parseStyle(_value6),_node7.name);}else if(urlConverter){_value6=urlConverter.call(urlConverterScope,_value6,name,_node7.name);}_node7.attr(name,_value6.length>0?_value6:null);}}});htmlParser.addAttributeFilter('class',function(nodes){var i=nodes.length;while(i--){var _node8=nodes[i];var _value7=_node8.attr('class');if(_value7){_value7=_node8.attr('class').replace(/(?:^|\s)mce-item-\w+(?!\S)/g,'');_node8.attr('class',_value7.length>0?_value7:null);}}});htmlParser.addAttributeFilter('data-mce-type',function(nodes,name,args){var i=nodes.length;while(i--){var _node9=nodes[i];if(_node9.attr('data-mce-type')==='bookmark'&&!args.cleanup){var hasChildren=Optional.from(_node9.firstChild).exists(function(firstChild){return!isZwsp(firstChild.value);});if(hasChildren){_node9.unwrap();}else{_node9.remove();}}}});htmlParser.addNodeFilter('noscript',function(nodes){var i=nodes.length;while(i--){var _node10=nodes[i].firstChild;if(_node10){_node10.value=Entities.decode(_node10.value);}}});htmlParser.addNodeFilter('script,style',function(nodes,name){var trim=function trim(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,'\n').replace(/^[\r\n]*|[\r\n]*$/g,'').replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,'').replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,'');};var i=nodes.length;while(i--){var _node11=nodes[i];var _value8=_node11.firstChild?_node11.firstChild.value:'';if(name==='script'){var _type=_node11.attr('type');if(_type){_node11.attr('type',_type==='mce-no/type'?null:_type.replace(/^mce\-/,''));}if(settings.element_format==='xhtml'&&_value8.length>0){_node11.firstChild.value='// <![CDATA[\n'+trim(_value8)+'\n// ]]>';}}else{if(settings.element_format==='xhtml'&&_value8.length>0){_node11.firstChild.value='<!--\n'+trim(_value8)+'\n-->';}}}});htmlParser.addNodeFilter('#comment',function(nodes){var i=nodes.length;while(i--){var _node12=nodes[i];if(settings.preserve_cdata&&_node12.value.indexOf('[CDATA[')===0){_node12.name='#cdata';_node12.type=4;_node12.value=dom.decode(_node12.value.replace(/^\[CDATA\[|\]\]$/g,''));}else if(_node12.value.indexOf('mce:protected ')===0){_node12.name='#text';_node12.type=3;_node12.raw=true;_node12.value=unescape(_node12.value).substr(14);}}});htmlParser.addNodeFilter('xml:namespace,input',function(nodes,name){var i=nodes.length;while(i--){var _node13=nodes[i];if(_node13.type===7){_node13.remove();}else if(_node13.type===1){if(name==='input'&&!_node13.attr('type')){_node13.attr('type','text');}}}});htmlParser.addAttributeFilter('data-mce-type',function(nodes){each$f(nodes,function(node){if(node.attr('data-mce-type')==='format-caret'){if(node.isEmpty(htmlParser.schema.getNonEmptyElements())){node.remove();}else{node.unwrap();}}});});htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,'+'data-mce-selected,data-mce-expando,'+'data-mce-type,data-mce-resize,data-mce-placeholder',function(nodes,name){var i=nodes.length;while(i--){nodes[i].attr(name,null);}});};var trimTrailingBr=function trimTrailingBr(rootNode){var isBr=function isBr(node){return node&&node.name==='br';};var brNode1=rootNode.lastChild;if(isBr(brNode1)){var brNode2=brNode1.prev;if(isBr(brNode2)){brNode1.remove();brNode2.remove();}}};var preProcess$1=function preProcess$1(editor,node,args){var oldDoc;var dom=editor.dom;var clonedNode=node.cloneNode(true);var impl=document.implementation;if(impl.createHTMLDocument){var doc=impl.createHTMLDocument('');Tools.each(clonedNode.nodeName==='BODY'?clonedNode.childNodes:[clonedNode],function(node){doc.body.appendChild(doc.importNode(node,true));});if(clonedNode.nodeName!=='BODY'){clonedNode=doc.body.firstChild;}else{clonedNode=doc.body;}oldDoc=dom.doc;dom.doc=doc;}firePreProcess(editor,_objectSpread({},args,{node:clonedNode}));if(oldDoc){dom.doc=oldDoc;}return clonedNode;};var shouldFireEvent=function shouldFireEvent(editor,args){return editor&&editor.hasEventListeners('PreProcess')&&!args.no_events;};var process$1=function process$1(editor,node,args){return shouldFireEvent(editor,args)?preProcess$1(editor,node,args):node;};var addTempAttr=function addTempAttr(htmlParser,tempAttrs,name){if(Tools.inArray(tempAttrs,name)===-1){htmlParser.addAttributeFilter(name,function(nodes,name){var i=nodes.length;while(i--){nodes[i].attr(name,null);}});tempAttrs.push(name);}};var postProcess=function postProcess(editor,args,content){if(!args.no_events&&editor){var outArgs=firePostProcess(editor,_objectSpread({},args,{content:content}));return outArgs.content;}else{return content;}};var getHtmlFromNode=function getHtmlFromNode(dom,node,args){var html=trim$1(args.getInner?node.innerHTML:dom.getOuterHTML(node));return args.selection||isWsPreserveElement(SugarElement.fromDom(node))?html:Tools.trim(html);};var parseHtml=function parseHtml(htmlParser,html,args){var parserArgs=args.selection?_objectSpread({forced_root_block:false},args):args;var rootNode=htmlParser.parse(html,parserArgs);trimTrailingBr(rootNode);return rootNode;};var serializeNode=function serializeNode(settings,schema,node){var htmlSerializer=HtmlSerializer(settings,schema);return htmlSerializer.serialize(node);};var toHtml=function toHtml(editor,settings,schema,rootNode,args){var content=serializeNode(settings,schema,rootNode);return postProcess(editor,args,content);};var DomSerializerImpl=function DomSerializerImpl(settings,editor){var tempAttrs=['data-mce-selected'];var dom=editor&&editor.dom?editor.dom:DOMUtils.DOM;var schema=editor&&editor.schema?editor.schema:Schema(settings);settings.entity_encoding=settings.entity_encoding||'named';settings.remove_trailing_brs='remove_trailing_brs'in settings?settings.remove_trailing_brs:true;var htmlParser=DomParser(settings,schema);register$3(htmlParser,settings,dom);var serialize=function serialize(node){var parserArgs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var args=_objectSpread({format:'html'},parserArgs);var targetNode=process$1(editor,node,args);var html=getHtmlFromNode(dom,targetNode,args);var rootNode=parseHtml(htmlParser,html,args);return args.format==='tree'?rootNode:toHtml(editor,settings,schema,rootNode,args);};return{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:serialize,addRules:schema.addValidElements,setRules:schema.setValidElements,addTempAttr:curry(addTempAttr,htmlParser,tempAttrs),getTempAttrs:constant(tempAttrs),getNodeFilters:htmlParser.getNodeFilters,getAttributeFilters:htmlParser.getAttributeFilters,removeNodeFilter:htmlParser.removeNodeFilter,removeAttributeFilter:htmlParser.removeAttributeFilter};};var DomSerializer=function DomSerializer(settings,editor){var domSerializer=DomSerializerImpl(settings,editor);return{schema:domSerializer.schema,addNodeFilter:domSerializer.addNodeFilter,addAttributeFilter:domSerializer.addAttributeFilter,serialize:domSerializer.serialize,addRules:domSerializer.addRules,setRules:domSerializer.setRules,addTempAttr:domSerializer.addTempAttr,getTempAttrs:domSerializer.getTempAttrs,getNodeFilters:domSerializer.getNodeFilters,getAttributeFilters:domSerializer.getAttributeFilters,removeNodeFilter:domSerializer.removeNodeFilter,removeAttributeFilter:domSerializer.removeAttributeFilter};};var defaultFormat$1='html';var setupArgs$1=function setupArgs$1(args,format){return _objectSpread({},args,{format:format,get:true,getInner:true});};var _getContent=function getContent(editor){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var format=args.format?args.format:defaultFormat$1;var defaultedArgs=setupArgs$1(args,format);return preProcessGetContent(editor,defaultedArgs).fold(identity,function(updatedArgs){var content=getContent$2(editor,updatedArgs);return postProcessGetContent(editor,content,updatedArgs);});};var defaultFormat='html';var setupArgs=function setupArgs(args,content){return _objectSpread({format:defaultFormat},args,{set:true,content:content});};var _setContent=function setContent(editor,content){var args=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var defaultedArgs=setupArgs(args,content);return preProcessSetContent(editor,defaultedArgs).map(function(updatedArgs){var result=setContent$2(editor,updatedArgs.content,updatedArgs);postProcessSetContent(editor,result.html,updatedArgs);return result.content;}).getOr(content);};var removedOptions=('autoresize_on_init,content_editable_state,padd_empty_with_br,block_elements,'+'boolean_attributes,editor_deselector,editor_selector,elements,file_browser_callback_types,filepicker_validator_handler,'+'force_hex_style_colors,force_p_newlines,gecko_spellcheck,images_dataimg_filter,media_scripts,mode,move_caret_before_on_enter_elements,'+'non_empty_elements,self_closing_elements,short_ended_elements,special,spellchecker_select_languages,spellchecker_whitelist,'+'tab_focus,tabfocus_elements,table_responsive_width,text_block_elements,text_inline_elements,toolbar_drawer,types,validate,whitespace_elements,'+'paste_enable_default_filters,paste_filter_drop,paste_word_valid_elements,paste_retain_style_properties,paste_convert_word_fake_lists').split(',');var removedPlugins='bbcode,colorpicker,contextmenu,fullpage,legacyoutput,spellchecker,textcolor'.split(',');var getRemovedOptions=function getRemovedOptions(options){var settingNames=filter$6(removedOptions,function(setting){return has$2(options,setting);});var forcedRootBlock=options.forced_root_block;if(forcedRootBlock===false||forcedRootBlock===''){settingNames.push('forced_root_block (false only)');}return sort(settingNames);};var getRemovedPlugins=function getRemovedPlugins(options){var plugins=Tools.makeMap(options.plugins,' ');var hasPlugin=function hasPlugin(plugin){return has$2(plugins,plugin);};var pluginNames=filter$6(removedPlugins,hasPlugin);return sort(pluginNames);};var logRemovedWarnings=function logRemovedWarnings(rawOptions,normalizedOptions){var removedOptions=getRemovedOptions(rawOptions);var removedPlugins=getRemovedPlugins(normalizedOptions);var hasRemovedPlugins=removedPlugins.length>0;var hasRemovedOptions=removedOptions.length>0;var isLegacyMobileTheme=normalizedOptions.theme==='mobile';if(hasRemovedPlugins||hasRemovedOptions||isLegacyMobileTheme){var listJoiner='\n- ';var themesMessage=isLegacyMobileTheme?"\n\nThemes:".concat(listJoiner,"mobile"):'';var pluginsMessage=hasRemovedPlugins?"\n\nPlugins:".concat(listJoiner).concat(removedPlugins.join(listJoiner)):'';var optionsMessage=hasRemovedOptions?"\n\nOptions:".concat(listJoiner).concat(removedOptions.join(listJoiner)):'';console.warn('The following deprecated features are currently enabled and have been removed in TinyMCE 6.0. These features will no longer work and should be removed from the TinyMCE configuration. '+'See https://www.tiny.cloud/docs/tinymce/6/migration-from-5x/ for more information.'+themesMessage+pluginsMessage+optionsMessage);}};var logWarnings=function logWarnings(rawOptions,normalizedOptions){logRemovedWarnings(rawOptions,normalizedOptions);};var DOM$8=DOMUtils.DOM;var restoreOriginalStyles=function restoreOriginalStyles(editor){DOM$8.setStyle(editor.id,'display',editor.orgDisplay);};var safeDestroy=function safeDestroy(x){return Optional.from(x).each(function(x){return x.destroy();});};var clearDomReferences=function clearDomReferences(editor){editor.contentAreaContainer=editor.formElement=editor.container=editor.editorContainer=null;editor.bodyElement=editor.contentDocument=editor.contentWindow=null;editor.iframeElement=editor.targetElm=null;if(editor.selection){editor.selection=editor.selection.win=editor.selection.dom=editor.selection.dom.doc=null;}};var restoreForm=function restoreForm(editor){var form=editor.formElement;if(form){if(form._mceOldSubmit){form.submit=form._mceOldSubmit;form._mceOldSubmit=null;}DOM$8.unbind(form,'submit reset',editor.formEventDelegate);}};var remove$1=function remove$1(editor){if(!editor.removed){var _selectionOverrides=editor._selectionOverrides,editorUpload=editor.editorUpload;var body=editor.getBody();var element=editor.getElement();if(body){editor.save({is_removing:true});}editor.removed=true;editor.unbindAllNativeEvents();if(editor.hasHiddenInput&&element){DOM$8.remove(element.nextSibling);}fireRemove(editor);editor.editorManager.remove(editor);if(!editor.inline&&body){restoreOriginalStyles(editor);}fireDetach(editor);DOM$8.remove(editor.getContainer());safeDestroy(_selectionOverrides);safeDestroy(editorUpload);editor.destroy();}};var _destroy=function destroy(editor,automatic){var selection=editor.selection,dom=editor.dom;if(editor.destroyed){return;}if(!automatic&&!editor.removed){editor.remove();return;}if(!automatic){editor.editorManager.off('beforeunload',editor._beforeUnload);if(editor.theme&&editor.theme.destroy){editor.theme.destroy();}safeDestroy(selection);safeDestroy(dom);}restoreForm(editor);clearDomReferences(editor);editor.destroyed=true;};var CreateIconManager=function CreateIconManager(){var lookup={};var add=function add(id,iconPack){lookup[id]=iconPack;};var get=function get(id){if(lookup[id]){return lookup[id];}return{icons:{}};};var has=function has(id){return has$2(lookup,id);};return{add:add,get:get,has:has};};var IconManager=CreateIconManager();var ModelManager=AddOnManager.ModelManager;var getProp=function getProp(propName,elm){var rawElm=elm.dom;return rawElm[propName];};var getComputedSizeProp=function getComputedSizeProp(propName,elm){return parseInt(get$7(elm,propName),10);};var getClientWidth=curry(getProp,'clientWidth');var getClientHeight=curry(getProp,'clientHeight');var getMarginTop=curry(getComputedSizeProp,'margin-top');var getMarginLeft=curry(getComputedSizeProp,'margin-left');var getBoundingClientRect=function getBoundingClientRect(elm){return elm.dom.getBoundingClientRect();};var isInsideElementContentArea=function isInsideElementContentArea(bodyElm,clientX,clientY){var clientWidth=getClientWidth(bodyElm);var clientHeight=getClientHeight(bodyElm);return clientX>=0&&clientY>=0&&clientX<=clientWidth&&clientY<=clientHeight;};var transpose=function transpose(inline,elm,clientX,clientY){var clientRect=getBoundingClientRect(elm);var deltaX=inline?clientRect.left+elm.dom.clientLeft+getMarginLeft(elm):0;var deltaY=inline?clientRect.top+elm.dom.clientTop+getMarginTop(elm):0;var x=clientX-deltaX;var y=clientY-deltaY;return{x:x,y:y};};var isXYInContentArea=function isXYInContentArea(editor,clientX,clientY){var bodyElm=SugarElement.fromDom(editor.getBody());var targetElm=editor.inline?bodyElm:documentElement(bodyElm);var transposedPoint=transpose(editor.inline,targetElm,clientX,clientY);return isInsideElementContentArea(targetElm,transposedPoint.x,transposedPoint.y);};var fromDomSafe=function fromDomSafe(node){return Optional.from(node).map(SugarElement.fromDom);};var isEditorAttachedToDom=function isEditorAttachedToDom(editor){var rawContainer=editor.inline?editor.getBody():editor.getContentAreaContainer();return fromDomSafe(rawContainer).map(inBody).getOr(false);};var NotificationManagerImpl=function NotificationManagerImpl(){var unimplemented=function unimplemented(){throw new Error('Theme did not provide a NotificationManager implementation.');};return{open:unimplemented,close:unimplemented,getArgs:unimplemented};};var NotificationManager=function NotificationManager(editor){var notifications=[];var getImplementation=function getImplementation(){var theme=editor.theme;return theme&&theme.getNotificationManagerImpl?theme.getNotificationManagerImpl():NotificationManagerImpl();};var getTopNotification=function getTopNotification(){return Optional.from(notifications[0]);};var isEqual=function isEqual(a,b){return a.type===b.type&&a.text===b.text&&!a.progressBar&&!a.timeout&&!b.progressBar&&!b.timeout;};var reposition=function reposition(){each$f(notifications,function(notification){notification.reposition();});};var addNotification=function addNotification(notification){notifications.push(notification);};var closeNotification=function closeNotification(notification){findIndex$2(notifications,function(otherNotification){return otherNotification===notification;}).each(function(index){notifications.splice(index,1);});};var open=function open(spec){var fireEvent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(editor.removed||!isEditorAttachedToDom(editor)){return;}if(fireEvent){editor.dispatch('BeforeOpenNotification',{notification:spec});}return find$2(notifications,function(notification){return isEqual(getImplementation().getArgs(notification),spec);}).getOrThunk(function(){editor.editorManager.setActive(editor);var notification=getImplementation().open(spec,function(){closeNotification(notification);reposition();getTopNotification().fold(function(){return editor.focus();},function(top){return focus$1(SugarElement.fromDom(top.getEl()));});});addNotification(notification);reposition();editor.dispatch('OpenNotification',{notification:_objectSpread({},notification)});return notification;});};var close=function close(){getTopNotification().each(function(notification){getImplementation().close(notification);closeNotification(notification);reposition();});};var getNotifications=constant(notifications);var registerEvents=function registerEvents(editor){editor.on('SkinLoaded',function(){var serviceMessage=getServiceMessage(editor);if(serviceMessage){open({text:serviceMessage,type:'warning',timeout:0},false);}reposition();});editor.on('show ResizeEditor ResizeWindow NodeChange',function(){requestAnimationFrame(reposition);});editor.on('remove',function(){each$f(notifications.slice(),function(notification){getImplementation().close(notification);});});};registerEvents(editor);return{open:open,close:close,getNotifications:getNotifications};};var PluginManager=AddOnManager.PluginManager;var ThemeManager=AddOnManager.ThemeManager;var WindowManagerImpl=function WindowManagerImpl(){var unimplemented=function unimplemented(){throw new Error('Theme did not provide a WindowManager implementation.');};return{open:unimplemented,openUrl:unimplemented,alert:unimplemented,confirm:unimplemented,close:unimplemented,getParams:unimplemented,setParams:unimplemented};};var WindowManager=function WindowManager(editor){var dialogs=[];var getImplementation=function getImplementation(){var theme=editor.theme;return theme&&theme.getWindowManagerImpl?theme.getWindowManagerImpl():WindowManagerImpl();};var funcBind=function funcBind(scope,f){return function(){for(var _len13=arguments.length,args=new Array(_len13),_key13=0;_key13<_len13;_key13++){args[_key13]=arguments[_key13];}return f?f.apply(scope,args):undefined;};};var fireOpenEvent=function fireOpenEvent(dialog){editor.dispatch('OpenWindow',{dialog:dialog});};var fireCloseEvent=function fireCloseEvent(dialog){editor.dispatch('CloseWindow',{dialog:dialog});};var addDialog=function addDialog(dialog){dialogs.push(dialog);fireOpenEvent(dialog);};var closeDialog=function closeDialog(dialog){fireCloseEvent(dialog);dialogs=filter$6(dialogs,function(otherDialog){return otherDialog!==dialog;});if(dialogs.length===0){editor.focus();}};var getTopDialog=function getTopDialog(){return Optional.from(dialogs[dialogs.length-1]);};var storeSelectionAndOpenDialog=function storeSelectionAndOpenDialog(openDialog){editor.editorManager.setActive(editor);store(editor);editor.ui.show();var dialog=openDialog();addDialog(dialog);return dialog;};var open=function open(args,params){return storeSelectionAndOpenDialog(function(){return getImplementation().open(args,params,closeDialog);});};var openUrl=function openUrl(args){return storeSelectionAndOpenDialog(function(){return getImplementation().openUrl(args,closeDialog);});};var alert=function alert(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.alert(message,funcBind(scope?scope:windowManagerImpl,callback));};var confirm=function confirm(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.confirm(message,funcBind(scope?scope:windowManagerImpl,callback));};var close=function close(){getTopDialog().each(function(dialog){getImplementation().close(dialog);closeDialog(dialog);});};editor.on('remove',function(){each$f(dialogs,function(dialog){getImplementation().close(dialog);});});return{open:open,openUrl:openUrl,alert:alert,confirm:confirm,close:close};};var displayNotification=function displayNotification(editor,message){editor.notificationManager.open({type:'error',text:message});};var displayError=function displayError(editor,message){if(editor._skinLoaded){displayNotification(editor,message);}else{editor.on('SkinLoaded',function(){displayNotification(editor,message);});}};var uploadError=function uploadError(editor,message){displayError(editor,I18n.translate(['Failed to upload image: {0}',message]));};var logError=function logError(editor,errorType,msg){fireError(editor,errorType,{message:msg});console.error(msg);};var createLoadError=function createLoadError(type,url,name){return name?"Failed to load ".concat(type,": ").concat(name," from url ").concat(url):"Failed to load ".concat(type," url: ").concat(url);};var pluginLoadError=function pluginLoadError(editor,url,name){logError(editor,'PluginLoadError',createLoadError('plugin',url,name));};var iconsLoadError=function iconsLoadError(editor,url,name){logError(editor,'IconsLoadError',createLoadError('icons',url,name));};var languageLoadError=function languageLoadError(editor,url,name){logError(editor,'LanguageLoadError',createLoadError('language',url,name));};var themeLoadError=function themeLoadError(editor,url,name){logError(editor,'ThemeLoadError',createLoadError('theme',url,name));};var modelLoadError=function modelLoadError(editor,url,name){logError(editor,'ModelLoadError',createLoadError('model',url,name));};var pluginInitError=function pluginInitError(editor,name,err){var message=I18n.translate(['Failed to initialize plugin: {0}',name]);fireError(editor,'PluginLoadError',{message:message});initError(message,err);displayError(editor,message);};var initError=function initError(message){var console=window.console;if(console){for(var _len14=arguments.length,x=new Array(_len14>1?_len14-1:0),_key14=1;_key14<_len14;_key14++){x[_key14-1]=arguments[_key14];}if(console.error){console.error.apply(console,[message].concat(x));}else{console.log.apply(console,[message].concat(x));}}};var isContentCssSkinName=function isContentCssSkinName(url){return /^[a-z0-9\-]+$/i.test(url);};var getContentCssUrls=function getContentCssUrls(editor){return transformToUrls(editor,getContentCss(editor));};var getFontCssUrls=function getFontCssUrls(editor){return transformToUrls(editor,getFontCss(editor));};var transformToUrls=function transformToUrls(editor,cssLinks){var skinUrl=editor.editorManager.baseURL+'/skins/content';var suffix=editor.editorManager.suffix;var contentCssFile="content".concat(suffix,".css");var inline=editor.inline===true;return map$3(cssLinks,function(url){if(isContentCssSkinName(url)&&!inline){return"".concat(skinUrl,"/").concat(url,"/").concat(contentCssFile);}else{return editor.documentBaseURI.toAbsolute(url);}});};var appendContentCssFromSettings=function appendContentCssFromSettings(editor){editor.contentCSS=editor.contentCSS.concat(getContentCssUrls(editor),getFontCssUrls(editor));};var filter$1=always;var bind$1=function bind$1(element,event,handler){return bind$2(element,event,filter$1,handler);};var getAllImages=function getAllImages(elm){return elm?from(elm.getElementsByTagName('img')):[];};var ImageScanner=function ImageScanner(uploadStatus,blobCache){var cachedPromises={};var findAll=function findAll(elm){var predicate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:always;var images=filter$6(getAllImages(elm),function(img){var src=img.src;if(img.hasAttribute('data-mce-bogus')){return false;}if(img.hasAttribute('data-mce-placeholder')){return false;}if(!src||src===Env.transparentSrc){return false;}if(startsWith(src,'blob:')){return!uploadStatus.isUploaded(src)&&predicate(img);}if(startsWith(src,'data:')){return predicate(img);}return false;});var promises=map$3(images,function(img){var imageSrc=img.src;if(has$2(cachedPromises,imageSrc)){return cachedPromises[imageSrc].then(function(imageInfo){if(isString(imageInfo)){return imageInfo;}else{return{image:img,blobInfo:imageInfo.blobInfo};}});}else{var newPromise=imageToBlobInfo(blobCache,imageSrc).then(function(blobInfo){delete cachedPromises[imageSrc];return{image:img,blobInfo:blobInfo};})["catch"](function(error){delete cachedPromises[imageSrc];return error;});cachedPromises[imageSrc]=newPromise;return newPromise;}});return Promise.all(promises);};return{findAll:findAll};};var UploadStatus=function UploadStatus(){var PENDING=1,UPLOADED=2;var blobUriStatuses={};var createStatus=function createStatus(status,resultUri){return{status:status,resultUri:resultUri};};var hasBlobUri=function hasBlobUri(blobUri){return blobUri in blobUriStatuses;};var getResultUri=function getResultUri(blobUri){var result=blobUriStatuses[blobUri];return result?result.resultUri:null;};var isPending=function isPending(blobUri){return hasBlobUri(blobUri)?blobUriStatuses[blobUri].status===PENDING:false;};var isUploaded=function isUploaded(blobUri){return hasBlobUri(blobUri)?blobUriStatuses[blobUri].status===UPLOADED:false;};var markPending=function markPending(blobUri){blobUriStatuses[blobUri]=createStatus(PENDING,null);};var markUploaded=function markUploaded(blobUri,resultUri){blobUriStatuses[blobUri]=createStatus(UPLOADED,resultUri);};var removeFailed=function removeFailed(blobUri){delete blobUriStatuses[blobUri];};var destroy=function destroy(){blobUriStatuses={};};return{hasBlobUri:hasBlobUri,getResultUri:getResultUri,isPending:isPending,isUploaded:isUploaded,markPending:markPending,markUploaded:markUploaded,removeFailed:removeFailed,destroy:destroy};};var count=0;var seed=function seed(){var rnd=function rnd(){return Math.round(Math.random()*4294967295).toString(36);};var now=new Date().getTime();return's'+now.toString(36)+rnd()+rnd()+rnd();};var uuid=function uuid(prefix){return prefix+count++ +seed();};var BlobCache=function BlobCache(){var cache=[];var mimeToExt=function mimeToExt(mime){var mimes={'image/jpeg':'jpg','image/jpg':'jpg','image/gif':'gif','image/png':'png','image/apng':'apng','image/avif':'avif','image/svg+xml':'svg','image/webp':'webp','image/bmp':'bmp','image/tiff':'tiff'};return mimes[mime.toLowerCase()]||'dat';};var create=function create(o,blob,base64,name,filename){if(isString(o)){var id=o;return toBlobInfo({id:id,name:name,filename:filename,blob:blob,base64:base64});}else if(isObject(o)){return toBlobInfo(o);}else{throw new Error('Unknown input type');}};var toBlobInfo=function toBlobInfo(o){if(!o.blob||!o.base64){throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');}var id=o.id||uuid('blobid');var name=o.name||id;var blob=o.blob;return{id:constant(id),name:constant(name),filename:constant(o.filename||name+'.'+mimeToExt(blob.type)),blob:constant(blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(blob)),uri:constant(o.uri)};};var add=function add(blobInfo){if(!get(blobInfo.id())){cache.push(blobInfo);}};var findFirst=function findFirst(predicate){return find$2(cache,predicate).getOrUndefined();};var get=function get(id){return findFirst(function(cachedBlobInfo){return cachedBlobInfo.id()===id;});};var getByUri=function getByUri(blobUri){return findFirst(function(blobInfo){return blobInfo.blobUri()===blobUri;});};var getByData=function getByData(base64,type){return findFirst(function(blobInfo){return blobInfo.base64()===base64&&blobInfo.blob().type===type;});};var removeByUri=function removeByUri(blobUri){cache=filter$6(cache,function(blobInfo){if(blobInfo.blobUri()===blobUri){URL.revokeObjectURL(blobInfo.blobUri());return false;}return true;});};var destroy=function destroy(){each$f(cache,function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri());});cache=[];};return{create:create,add:add,get:get,getByUri:getByUri,getByData:getByData,findFirst:findFirst,removeByUri:removeByUri,destroy:destroy};};var Uploader=function Uploader(uploadStatus,settings){var pendingPromises={};var pathJoin=function pathJoin(path1,path2){if(path1){return path1.replace(/\/$/,'')+'/'+path2.replace(/^\//,'');}return path2;};var defaultHandler=function defaultHandler(blobInfo,progress){return new Promise(function(success,failure){var xhr=new XMLHttpRequest();xhr.open('POST',settings.url);xhr.withCredentials=settings.credentials;xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100);};xhr.onerror=function(){failure('Image upload failed due to a XHR Transport error. Code: '+xhr.status);};xhr.onload=function(){if(xhr.status<200||xhr.status>=300){failure('HTTP Error: '+xhr.status);return;}var json=JSON.parse(xhr.responseText);if(!json||!isString(json.location)){failure('Invalid JSON: '+xhr.responseText);return;}success(pathJoin(settings.basePath,json.location));};var formData=new FormData();formData.append('file',blobInfo.blob(),blobInfo.filename());xhr.send(formData);});};var noUpload=function noUpload(){return new Promise(function(resolve){resolve([]);});};var handlerSuccess=function handlerSuccess(blobInfo,url){return{url:url,blobInfo:blobInfo,status:true};};var handlerFailure=function handlerFailure(blobInfo,error){return{url:'',blobInfo:blobInfo,status:false,error:error};};var resolvePending=function resolvePending(blobUri,result){Tools.each(pendingPromises[blobUri],function(resolve){resolve(result);});delete pendingPromises[blobUri];};var uploadBlobInfo=function uploadBlobInfo(blobInfo,handler,openNotification){uploadStatus.markPending(blobInfo.blobUri());return new Promise(function(resolve){var notification;var progress;try{var closeNotification=function closeNotification(){if(notification){notification.close();progress=noop;}};var success=function success(url){closeNotification();uploadStatus.markUploaded(blobInfo.blobUri(),url);resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url));resolve(handlerSuccess(blobInfo,url));};var failure=function failure(error){closeNotification();uploadStatus.removeFailed(blobInfo.blobUri());resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error));resolve(handlerFailure(blobInfo,error));};progress=function progress(percent){if(percent<0||percent>100){return;}Optional.from(notification).orThunk(function(){return Optional.from(openNotification).map(apply$1);}).each(function(n){notification=n;n.progressBar.value(percent);});};handler(blobInfo,progress).then(success,function(err){failure(isString(err)?{message:err}:err);});}catch(ex){resolve(handlerFailure(blobInfo,ex));}});};var isDefaultHandler=function isDefaultHandler(handler){return handler===defaultHandler;};var pendingUploadBlobInfo=function pendingUploadBlobInfo(blobInfo){var blobUri=blobInfo.blobUri();return new Promise(function(resolve){pendingPromises[blobUri]=pendingPromises[blobUri]||[];pendingPromises[blobUri].push(resolve);});};var uploadBlobs=function uploadBlobs(blobInfos,openNotification){blobInfos=Tools.grep(blobInfos,function(blobInfo){return!uploadStatus.isUploaded(blobInfo.blobUri());});return Promise.all(Tools.map(blobInfos,function(blobInfo){return uploadStatus.isPending(blobInfo.blobUri())?pendingUploadBlobInfo(blobInfo):uploadBlobInfo(blobInfo,settings.handler,openNotification);}));};var upload=function upload(blobInfos,openNotification){return!settings.url&&isDefaultHandler(settings.handler)?noUpload():uploadBlobs(blobInfos,openNotification);};if(isFunction(settings.handler)===false){settings.handler=defaultHandler;}return{upload:upload};};var openNotification=function openNotification(editor){return function(){return editor.notificationManager.open({text:editor.translate('Image uploading...'),type:'info',timeout:-1,progressBar:true});};};var createUploader=function createUploader(editor,uploadStatus){return Uploader(uploadStatus,{url:getImageUploadUrl(editor),basePath:getImageUploadBasePath(editor),credentials:getImagesUploadCredentials(editor),handler:getImagesUploadHandler(editor)});};var ImageUploader=function ImageUploader(editor){var uploadStatus=UploadStatus();var uploader=createUploader(editor,uploadStatus);return{upload:function upload(blobInfos){var showNotification=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return uploader.upload(blobInfos,showNotification?openNotification(editor):undefined);}};};var EditorUpload=function EditorUpload(editor){var blobCache=BlobCache();var uploader,imageScanner;var uploadStatus=UploadStatus();var urlFilters=[];var aliveGuard=function aliveGuard(callback){return function(result){if(editor.selection){return callback(result);}return[];};};var cacheInvalidator=function cacheInvalidator(url){return url+(url.indexOf('?')===-1?'?':'&')+new Date().getTime();};var replaceString=function replaceString(content,search,replace){var index=0;do{index=content.indexOf(search,index);if(index!==-1){content=content.substring(0,index)+replace+content.substr(index+search.length);index+=replace.length-search.length+1;}}while(index!==-1);return content;};var replaceImageUrl=function replaceImageUrl(content,targetUrl,replacementUrl){var replacementString="src=\"".concat(replacementUrl,"\"").concat(replacementUrl===Env.transparentSrc?' data-mce-placeholder="1"':'');content=replaceString(content,"src=\"".concat(targetUrl,"\""),replacementString);content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"');return content;};var replaceUrlInUndoStack=function replaceUrlInUndoStack(targetUrl,replacementUrl){each$f(editor.undoManager.data,function(level){if(level.type==='fragmented'){level.fragments=map$3(level.fragments,function(fragment){return replaceImageUrl(fragment,targetUrl,replacementUrl);});}else{level.content=replaceImageUrl(level.content,targetUrl,replacementUrl);}});};var replaceImageUriInView=function replaceImageUriInView(image,resultUri){var src=editor.convertURL(resultUri,'src');replaceUrlInUndoStack(image.src,resultUri);setAll$1(SugarElement.fromDom(image),{'src':shouldReuseFileName(editor)?cacheInvalidator(resultUri):resultUri,'data-mce-src':src});};var uploadImages=function uploadImages(){if(!uploader){uploader=createUploader(editor,uploadStatus);}return scanForImages().then(aliveGuard(function(imageInfos){var blobInfos=map$3(imageInfos,function(imageInfo){return imageInfo.blobInfo;});return uploader.upload(blobInfos,openNotification(editor)).then(aliveGuard(function(result){var imagesToRemove=[];var shouldDispatchChange=false;var filteredResult=map$3(result,function(uploadInfo,index){var blobInfo=imageInfos[index].blobInfo;var image=imageInfos[index].image;var removed=false;if(uploadInfo.status&&shouldReplaceBlobUris(editor)){if(uploadInfo.url&&!contains$1(image.src,uploadInfo.url)){shouldDispatchChange=true;}blobCache.removeByUri(image.src);if(isRtc(editor));else{replaceImageUriInView(image,uploadInfo.url);}}else if(uploadInfo.error){if(uploadInfo.error.remove){replaceUrlInUndoStack(image.getAttribute('src'),Env.transparentSrc);imagesToRemove.push(image);removed=true;}uploadError(editor,uploadInfo.error.message);}return{element:image,status:uploadInfo.status,uploadUri:uploadInfo.url,blobInfo:blobInfo,removed:removed};});if(imagesToRemove.length>0&&!isRtc(editor)){editor.undoManager.transact(function(){each$f(imagesToRemove,function(element){editor.dom.remove(element);blobCache.removeByUri(element.src);});});}else if(shouldDispatchChange){editor.undoManager.dispatchChange();}return filteredResult;}));}));};var uploadImagesAuto=function uploadImagesAuto(){return isAutomaticUploadsEnabled(editor)?uploadImages():Promise.resolve([]);};var isValidDataUriImage=function isValidDataUriImage(imgElm){return forall(urlFilters,function(filter){return filter(imgElm);});};var addFilter=function addFilter(filter){urlFilters.push(filter);};var scanForImages=function scanForImages(){if(!imageScanner){imageScanner=ImageScanner(uploadStatus,blobCache);}return imageScanner.findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard(function(result){var filteredResult=filter$6(result,function(resultItem){if(isString(resultItem)){displayError(editor,resultItem);return false;}else{return true;}});if(isRtc(editor));else{each$f(filteredResult,function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri());resultItem.image.src=resultItem.blobInfo.blobUri();resultItem.image.removeAttribute('data-mce-src');});}return filteredResult;}));};var destroy=function destroy(){blobCache.destroy();uploadStatus.destroy();imageScanner=uploader=null;};var replaceBlobUris=function replaceBlobUris(content){return content.replace(/src="(blob:[^"]+)"/g,function(match,blobUri){var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri){return'src="'+resultUri+'"';}var blobInfo=blobCache.getByUri(blobUri);if(!blobInfo){blobInfo=foldl(editor.editorManager.get(),function(result,editor){return result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri);},null);}if(blobInfo){var blob=blobInfo.blob();return'src="data:'+blob.type+';base64,'+blobInfo.base64()+'"';}return match;});};editor.on('SetContent',function(){if(isAutomaticUploadsEnabled(editor)){uploadImagesAuto();}else{scanForImages();}});editor.on('RawSaveContent',function(e){e.content=replaceBlobUris(e.content);});editor.on('GetContent',function(e){if(e.source_view||e.format==='raw'||e.format==='tree'){return;}e.content=replaceBlobUris(e.content);});editor.on('PostRender',function(){editor.parser.addNodeFilter('img',function(images){each$f(images,function(img){var src=img.attr('src');if(blobCache.getByUri(src)){return;}var resultUri=uploadStatus.getResultUri(src);if(resultUri){img.attr('src',resultUri);}});});});return{blobCache:blobCache,addFilter:addFilter,uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:destroy};};var get$1=function get$1(editor){var dom=editor.dom;var schemaType=editor.schema.type;var formats={valigntop:[{selector:'td,th',styles:{verticalAlign:'top'}}],valignmiddle:[{selector:'td,th',styles:{verticalAlign:'middle'}}],valignbottom:[{selector:'td,th',styles:{verticalAlign:'bottom'}}],alignleft:[{selector:'figure.image',collapsed:false,classes:'align-left',ceFalseOverride:true,preview:'font-family font-size'},{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre',styles:{textAlign:'left'},inherit:false,preview:false},{selector:'img,audio,video',collapsed:false,styles:{"float":'left'},preview:'font-family font-size'},{selector:'table',collapsed:false,styles:{marginLeft:'0px',marginRight:'auto'},onformat:function onformat(table){dom.setStyle(table,'float',null);},preview:'font-family font-size'}],aligncenter:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre',styles:{textAlign:'center'},inherit:false,preview:'font-family font-size'},{selector:'figure.image',collapsed:false,classes:'align-center',ceFalseOverride:true,preview:'font-family font-size'},{selector:'img,audio,video',collapsed:false,styles:{display:'block',marginLeft:'auto',marginRight:'auto'},preview:false},{selector:'table',collapsed:false,styles:{marginLeft:'auto',marginRight:'auto'},preview:'font-family font-size'}],alignright:[{selector:'figure.image',collapsed:false,classes:'align-right',ceFalseOverride:true,preview:'font-family font-size'},{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre',styles:{textAlign:'right'},inherit:false,preview:'font-family font-size'},{selector:'img,audio,video',collapsed:false,styles:{"float":'right'},preview:'font-family font-size'},{selector:'table',collapsed:false,styles:{marginRight:'0px',marginLeft:'auto'},onformat:function onformat(table){dom.setStyle(table,'float',null);},preview:'font-family font-size'}],alignjustify:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre',styles:{textAlign:'justify'},inherit:false,preview:'font-family font-size'}],bold:[{inline:'strong',remove:'all',preserve_attributes:['class','style']},{inline:'span',styles:{fontWeight:'bold'}},{inline:'b',remove:'all',preserve_attributes:['class','style']}],italic:[{inline:'em',remove:'all',preserve_attributes:['class','style']},{inline:'span',styles:{fontStyle:'italic'}},{inline:'i',remove:'all',preserve_attributes:['class','style']}],underline:[{inline:'span',styles:{textDecoration:'underline'},exact:true},{inline:'u',remove:'all',preserve_attributes:['class','style']}],strikethrough:function(){var span={inline:'span',styles:{textDecoration:'line-through'},exact:true};var strike={inline:'strike',remove:'all',preserve_attributes:['class','style']};var s={inline:'s',remove:'all',preserve_attributes:['class','style']};return schemaType!=='html4'?[s,span,strike]:[span,s,strike];}(),forecolor:{inline:'span',styles:{color:'%value'},links:true,remove_similar:true,clear_child_styles:true},hilitecolor:{inline:'span',styles:{backgroundColor:'%value'},links:true,remove_similar:true,clear_child_styles:true},fontname:{inline:'span',toggle:false,styles:{fontFamily:'%value'},clear_child_styles:true},fontsize:{inline:'span',toggle:false,styles:{fontSize:'%value'},clear_child_styles:true},lineheight:{selector:'h1,h2,h3,h4,h5,h6,p,li,td,th,div',styles:{lineHeight:'%value'}},fontsize_class:{inline:'span',attributes:{"class":'%value'}},blockquote:{block:'blockquote',wrapper:true,remove:'all'},subscript:{inline:'sub'},superscript:{inline:'sup'},code:{inline:'code'},link:{inline:'a',selector:'a',remove:'all',split:true,deep:true,onmatch:function onmatch(node,_fmt,_itemName){return isElement$6(node)&&node.hasAttribute('href');},onformat:function onformat(elm,_fmt,vars){Tools.each(vars,function(value,key){dom.setAttrib(elm,key,value);});}},lang:{inline:'span',clear_child_styles:true,remove_similar:true,attributes:{'lang':'%value','data-mce-lang':function dataMceLang(vars){var _a;return(_a=vars===null||vars===void 0?void 0:vars.customValue)!==null&&_a!==void 0?_a:null;}}},removeformat:[{selector:'b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins,small',remove:'all',split:true,expand:false,block_expand:true,deep:true},{selector:'span',attributes:['style','class'],remove:'empty',split:true,expand:false,deep:true},{selector:'*',attributes:['style','class'],split:false,expand:false,deep:true}]};Tools.each('p h1 h2 h3 h4 h5 h6 div address pre dt dd samp'.split(/\s/),function(name){formats[name]={block:name,remove:'all'};});return formats;};var genericBase={remove_similar:true,inherit:false};var cellBase=_objectSpread({selector:'td,th'},genericBase);var cellFormats={tablecellbackgroundcolor:_objectSpread({styles:{backgroundColor:'%value'}},cellBase),tablecellverticalalign:_objectSpread({styles:{'vertical-align':'%value'}},cellBase),tablecellbordercolor:_objectSpread({styles:{borderColor:'%value'}},cellBase),tablecellclass:_objectSpread({classes:['%value']},cellBase),tableclass:_objectSpread({selector:'table',classes:['%value']},genericBase),tablecellborderstyle:_objectSpread({styles:{borderStyle:'%value'}},cellBase),tablecellborderwidth:_objectSpread({styles:{borderWidth:'%value'}},cellBase)};var get=constant(cellFormats);var FormatRegistry=function FormatRegistry(editor){var formats={};var get$2=function get$2(name){return isNonNullable(name)?formats[name]:formats;};var has=function has(name){return has$2(formats,name);};var register=function register(name,format){if(name){if(!isString(name)){each$e(name,function(format,name){register(name,format);});}else{if(!isArray$1(format)){format=[format];}each$f(format,function(format){if(isUndefined(format.deep)){format.deep=!isSelectorFormat(format);}if(isUndefined(format.split)){format.split=!isSelectorFormat(format)||isInlineFormat(format);}if(isUndefined(format.remove)&&isSelectorFormat(format)&&!isInlineFormat(format)){format.remove='none';}if(isSelectorFormat(format)&&isInlineFormat(format)){format.mixed=true;format.block_expand=true;}if(isString(format.classes)){format.classes=format.classes.split(/\s+/);}});formats[name]=format;}}};var unregister=function unregister(name){if(name&&formats[name]){delete formats[name];}return formats;};register(get$1(editor));register(get());register(getFormats(editor));return{get:get$2,has:has,register:register,unregister:unregister};};var each$3=Tools.each;var dom=DOMUtils.DOM;var parsedSelectorToHtml=function parsedSelectorToHtml(ancestry,editor){var elm,item,fragment;var schema=editor&&editor.schema||Schema({});var decorate=function decorate(elm,item){if(item.classes.length){dom.addClass(elm,item.classes.join(' '));}dom.setAttribs(elm,item.attrs);};var createElement=function createElement(sItem){item=typeof sItem==='string'?{name:sItem,classes:[],attrs:{}}:sItem;var elm=dom.create(item.name);decorate(elm,item);return elm;};var getRequiredParent=function getRequiredParent(elm,candidate){var name=typeof elm!=='string'?elm.nodeName.toLowerCase():elm;var elmRule=schema.getElementRule(name);var parentsRequired=elmRule&&elmRule.parentsRequired;if(parentsRequired&&parentsRequired.length){return candidate&&Tools.inArray(parentsRequired,candidate)!==-1?candidate:parentsRequired[0];}else{return false;}};var wrapInHtml=function wrapInHtml(elm,ancestry,siblings){var parent,parentCandidate;var ancestor=ancestry.length>0&&ancestry[0];var ancestorName=ancestor&&ancestor.name;var parentRequired=getRequiredParent(elm,ancestorName);if(parentRequired){if(ancestorName===parentRequired){parentCandidate=ancestry[0];ancestry=ancestry.slice(1);}else{parentCandidate=parentRequired;}}else if(ancestor){parentCandidate=ancestry[0];ancestry=ancestry.slice(1);}else if(!siblings){return elm;}if(parentCandidate){parent=createElement(parentCandidate);parent.appendChild(elm);}if(siblings){if(!parent){parent=dom.create('div');parent.appendChild(elm);}Tools.each(siblings,function(sibling){var siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm);});}return wrapInHtml(parent,ancestry,parentCandidate&&parentCandidate.siblings);};if(ancestry&&ancestry.length){item=ancestry[0];elm=createElement(item);fragment=dom.create('div');fragment.appendChild(wrapInHtml(elm,ancestry.slice(1),item.siblings));return fragment;}else{return'';}};var parseSelectorItem=function parseSelectorItem(item){var tagName;var obj={classes:[],attrs:{}};item=obj.selector=Tools.trim(item);if(item!=='*'){tagName=item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,function($0,$1,$2,$3,$4){switch($1){case'#':obj.attrs.id=$2;break;case'.':obj.classes.push($2);break;case':':if(Tools.inArray('checked disabled enabled read-only required'.split(' '),$2)!==-1){obj.attrs[$2]=$2;}break;}if($3==='['){var m=$4.match(/([\w\-]+)(?:\=\"([^\"]+))?/);if(m){obj.attrs[m[1]]=m[2];}}return'';});}obj.name=tagName||'div';return obj;};var parseSelector=function parseSelector(selector){if(!selector||typeof selector!=='string'){return[];}selector=selector.split(/\s*,\s*/)[0];selector=selector.replace(/\s*(~\+|~|\+|>)\s*/g,'$1');return Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/),function(item){var siblings=Tools.map(item.split(/(?:~\+|~|\+)/),parseSelectorItem);var obj=siblings.pop();if(siblings.length){obj.siblings=siblings;}return obj;}).reverse();};var getCssText=function getCssText(editor,format){var name,previewFrag;var previewCss='',parentFontSize;var previewStyles=getPreviewStyles(editor);if(previewStyles===''){return'';}var removeVars=function removeVars(val){return val.replace(/%(\w+)/g,'');};if(typeof format==='string'){format=editor.formatter.get(format);if(!format){return;}format=format[0];}if('preview'in format){var previewOpt=get$a(format,'preview');if(is$2(previewOpt,false)){return'';}else{previewStyles=previewOpt.getOr(previewStyles);}}name=format.block||format.inline||'span';var items=parseSelector(format.selector);if(items.length){if(!items[0].name){items[0].name=name;}name=format.selector;previewFrag=parsedSelectorToHtml(items,editor);}else{previewFrag=parsedSelectorToHtml([name],editor);}var previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild;each$3(format.styles,function(value,name){var newValue=removeVars(value);if(newValue){dom.setStyle(previewElm,name,newValue);}});each$3(format.attributes,function(value,name){var newValue=removeVars(value);if(newValue){dom.setAttrib(previewElm,name,newValue);}});each$3(format.classes,function(value){var newValue=removeVars(value);if(!dom.hasClass(previewElm,newValue)){dom.addClass(previewElm,newValue);}});editor.dispatch('PreviewFormats');dom.setStyles(previewFrag,{position:'absolute',left:-65535});editor.getBody().appendChild(previewFrag);parentFontSize=dom.getStyle(editor.getBody(),'fontSize',true);parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0;each$3(previewStyles.split(' '),function(name){var value=dom.getStyle(previewElm,name,true);if(name==='background-color'&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)){value=dom.getStyle(editor.getBody(),name,true);if(rgbaToHexString(value).toLowerCase()==='#ffffff'){return;}}if(name==='color'){if(rgbaToHexString(value).toLowerCase()==='#000000'){return;}}if(name==='font-size'){if(/em|%$/.test(value)){if(parentFontSize===0){return;}var numValue=parseFloat(value)/(/%$/.test(value)?100:1);value=numValue*parentFontSize+'px';}}if(name==='border'&&value){previewCss+='padding:0 2px;';}previewCss+=name+':'+value+';';});editor.dispatch('AfterPreviewFormats');dom.remove(previewFrag);return previewCss;};var setup$r=function setup$r(editor){editor.addShortcut('meta+b','','Bold');editor.addShortcut('meta+i','','Italic');editor.addShortcut('meta+u','','Underline');for(var i=1;i<=6;i++){editor.addShortcut('access+'+i,'',['FormatBlock',false,'h'+i]);}editor.addShortcut('access+7','',['FormatBlock',false,'p']);editor.addShortcut('access+8','',['FormatBlock',false,'div']);editor.addShortcut('access+9','',['FormatBlock',false,'address']);};var Formatter=function Formatter(editor){var formats=FormatRegistry(editor);var formatChangeState=Cell(null);setup$r(editor);setup$u(editor);return{get:formats.get,has:formats.has,register:formats.register,unregister:formats.unregister,apply:function apply(name,vars,node){applyFormat(editor,name,vars,node);},remove:function remove(name,vars,node,similar){removeFormat(editor,name,vars,node,similar);},toggle:function toggle(name,vars,node){toggleFormat(editor,name,vars,node);},match:function match(name,vars,node,similar){return matchFormat(editor,name,vars,node,similar);},closest:function closest(names){return closestFormat(editor,names);},matchAll:function matchAll(names,vars){return matchAllFormats(editor,names,vars);},matchNode:function matchNode(node,name,vars,similar){return matchNodeFormat(editor,node,name,vars,similar);},canApply:function canApply(name){return canApplyFormat(editor,name);},formatChanged:function formatChanged(formats,callback,similar,vars){return _formatChanged(editor,formatChangeState,formats,callback,similar,vars);},getCssText:curry(getCssText,editor)};};var shouldIgnoreCommand=function shouldIgnoreCommand(cmd){switch(cmd.toLowerCase()){case'undo':case'redo':case'mcefocus':return true;default:return false;}};var registerEvents=function registerEvents(editor,undoManager,locks){var isFirstTypedCharacter=Cell(false);var addNonTypingUndoLevel=function addNonTypingUndoLevel(e){setTyping(undoManager,false,locks);undoManager.add({},e);};editor.on('init',function(){undoManager.add();});editor.on('BeforeExecCommand',function(e){var cmd=e.command;if(!shouldIgnoreCommand(cmd)){endTyping(undoManager,locks);undoManager.beforeChange();}});editor.on('ExecCommand',function(e){var cmd=e.command;if(!shouldIgnoreCommand(cmd)){addNonTypingUndoLevel(e);}});editor.on('ObjectResizeStart cut',function(){undoManager.beforeChange();});editor.on('SaveContent ObjectResized blur',addNonTypingUndoLevel);editor.on('dragend',addNonTypingUndoLevel);editor.on('keyup',function(e){var keyCode=e.keyCode;if(e.isDefaultPrevented()){return;}if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||keyCode===45||e.ctrlKey){addNonTypingUndoLevel();editor.nodeChanged();}if(keyCode===46||keyCode===8){editor.nodeChanged();}if(isFirstTypedCharacter.get()&&undoManager.typing&&isEq$1(createFromEditor(editor),undoManager.data[0])===false){if(editor.isDirty()===false){editor.setDirty(true);}editor.dispatch('TypingUndo');isFirstTypedCharacter.set(false);editor.nodeChanged();}});editor.on('keydown',function(e){var keyCode=e.keyCode;if(e.isDefaultPrevented()){return;}if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||keyCode===45){if(undoManager.typing){addNonTypingUndoLevel(e);}return;}var modKey=e.ctrlKey&&!e.altKey||e.metaKey;if((keyCode<16||keyCode>20)&&keyCode!==224&&keyCode!==91&&!undoManager.typing&&!modKey){undoManager.beforeChange();setTyping(undoManager,true,locks);undoManager.add({},e);isFirstTypedCharacter.set(true);}});editor.on('mousedown',function(e){if(undoManager.typing){addNonTypingUndoLevel(e);}});var isInsertReplacementText=function isInsertReplacementText(event){return event.inputType==='insertReplacementText';};var isInsertTextDataNull=function isInsertTextDataNull(event){return event.inputType==='insertText'&&event.data===null;};var isInsertFromPasteOrDrop=function isInsertFromPasteOrDrop(event){return event.inputType==='insertFromPaste'||event.inputType==='insertFromDrop';};editor.on('input',function(e){if(e.inputType&&(isInsertReplacementText(e)||isInsertTextDataNull(e)||isInsertFromPasteOrDrop(e))){addNonTypingUndoLevel(e);}});editor.on('AddUndo Undo Redo ClearUndos',function(e){if(!e.isDefaultPrevented()){editor.nodeChanged();}});};var addKeyboardShortcuts=function addKeyboardShortcuts(editor){editor.addShortcut('meta+z','','Undo');editor.addShortcut('meta+y,meta+shift+z','','Redo');};var UndoManager=function UndoManager(editor){var beforeBookmark=value$2();var locks=Cell(0);var index=Cell(0);var undoManager={data:[],typing:false,beforeChange:function beforeChange(){_beforeChange(editor,locks,beforeBookmark);},add:function add(level,event){return addUndoLevel(editor,undoManager,index,locks,beforeBookmark,level,event);},dispatchChange:function dispatchChange(){editor.setDirty(true);editor.dispatch('change',{level:createFromEditor(editor),lastLevel:get$b(undoManager.data,index.get()).getOrUndefined()});},undo:function undo(){return _undo(editor,undoManager,locks,index);},redo:function redo(){return _redo(editor,index,undoManager.data);},clear:function clear(){_clear(editor,undoManager,index);},reset:function reset(){_reset(editor,undoManager);},hasUndo:function hasUndo(){return _hasUndo(editor,undoManager,index);},hasRedo:function hasRedo(){return _hasRedo(editor,undoManager,index);},transact:function transact(callback){return _transact(editor,undoManager,locks,callback);},ignore:function ignore(callback){_ignore(editor,locks,callback);},extra:function extra(callback1,callback2){_extra(editor,undoManager,index,callback1,callback2);}};if(!isRtc(editor)){registerEvents(editor,undoManager,locks);}addKeyboardShortcuts(editor);return undoManager;};var nonTypingKeycodes=[9,27,VK.HOME,VK.END,19,20,44,144,145,33,34,45,16,17,18,91,92,93,VK.DOWN,VK.UP,VK.LEFT,VK.RIGHT].concat(Env.browser.isFirefox()?[224]:[]);var placeholderAttr='data-mce-placeholder';var isKeyboardEvent=function isKeyboardEvent(e){return e.type==='keydown'||e.type==='keyup';};var isDeleteEvent=function isDeleteEvent(e){var keyCode=e.keyCode;return keyCode===VK.BACKSPACE||keyCode===VK.DELETE;};var isNonTypingKeyboardEvent=function isNonTypingKeyboardEvent(e){if(isKeyboardEvent(e)){var keyCode=e.keyCode;return!isDeleteEvent(e)&&(VK.metaKeyPressed(e)||e.altKey||keyCode>=112&&keyCode<=123||contains$2(nonTypingKeycodes,keyCode));}else{return false;}};var isTypingKeyboardEvent=function isTypingKeyboardEvent(e){return isKeyboardEvent(e)&&!(isDeleteEvent(e)||e.type==='keyup'&&e.keyCode===229);};var isVisuallyEmpty=function isVisuallyEmpty(dom,rootElm,forcedRootBlock){if(isEmpty$2(SugarElement.fromDom(rootElm),false)){var _firstElement=rootElm.firstElementChild;if(!_firstElement){return true;}else if(dom.getStyle(rootElm.firstElementChild,'padding-left')||dom.getStyle(rootElm.firstElementChild,'padding-right')){return false;}else{return forcedRootBlock===_firstElement.nodeName.toLowerCase();}}else{return false;}};var setup$q=function setup$q(editor){var dom=editor.dom;var rootBlock=getForcedRootBlock(editor);var placeholder=getPlaceholder(editor);var updatePlaceholder=function updatePlaceholder(e,initial){if(isNonTypingKeyboardEvent(e)){return;}var body=editor.getBody();var showPlaceholder=isTypingKeyboardEvent(e)?false:isVisuallyEmpty(dom,body,rootBlock);var isPlaceholderShown=dom.getAttrib(body,placeholderAttr)!=='';if(isPlaceholderShown!==showPlaceholder||initial){dom.setAttrib(body,placeholderAttr,showPlaceholder?placeholder:null);dom.setAttrib(body,'aria-placeholder',showPlaceholder?placeholder:null);firePlaceholderToggle(editor,showPlaceholder);editor.on(showPlaceholder?'keydown':'keyup',updatePlaceholder);editor.off(showPlaceholder?'keyup':'keydown',updatePlaceholder);}};if(placeholder){editor.on('init',function(e){updatePlaceholder(e,true);editor.on('change SetContent ExecCommand',updatePlaceholder);editor.on('paste',function(e){return Delay.setEditorTimeout(editor,function(){return updatePlaceholder(e);});});});}};var blockPosition=function blockPosition(block,position){return{block:block,position:position};};var blockBoundary=function blockBoundary(from,to){return{from:from,to:to};};var getBlockPosition=function getBlockPosition(rootNode,pos){var rootElm=SugarElement.fromDom(rootNode);var containerElm=SugarElement.fromDom(pos.container());return getParentBlock$2(rootElm,containerElm).map(function(block){return blockPosition(block,pos);});};var isDifferentBlocks=function isDifferentBlocks(blockBoundary){return eq(blockBoundary.from.block,blockBoundary.to.block)===false;};var hasSameParent=function hasSameParent(blockBoundary){return parent(blockBoundary.from.block).bind(function(parent1){return parent(blockBoundary.to.block).filter(function(parent2){return eq(parent1,parent2);});}).isSome();};var isEditable$2=function isEditable$2(blockBoundary){return isContentEditableFalse$b(blockBoundary.from.block.dom)===false&&isContentEditableFalse$b(blockBoundary.to.block.dom)===false;};var skipLastBr=function skipLastBr(rootNode,forward,blockPosition){if(isBr$6(blockPosition.position.getNode())&&isEmpty$2(blockPosition.block)===false){return positionIn(false,blockPosition.block.dom).bind(function(lastPositionInBlock){if(lastPositionInBlock.isEqual(blockPosition.position)){return fromPosition(forward,rootNode,lastPositionInBlock).bind(function(to){return getBlockPosition(rootNode,to);});}else{return Optional.some(blockPosition);}}).getOr(blockPosition);}else{return blockPosition;}};var readFromRange=function readFromRange(rootNode,forward,rng){var fromBlockPos=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng));var toBlockPos=fromBlockPos.bind(function(blockPos){return fromPosition(forward,rootNode,blockPos.position).bind(function(to){return getBlockPosition(rootNode,to).map(function(blockPos){return skipLastBr(rootNode,forward,blockPos);});});});return lift2(fromBlockPos,toBlockPos,blockBoundary).filter(function(blockBoundary){return isDifferentBlocks(blockBoundary)&&hasSameParent(blockBoundary)&&isEditable$2(blockBoundary);});};var read$1=function read$1(rootNode,forward,rng){return rng.collapsed?readFromRange(rootNode,forward,rng):Optional.none();};var getChildrenUntilBlockBoundary=function getChildrenUntilBlockBoundary(block){var children$1=children(block);return findIndex$2(children$1,isBlock$2).fold(constant(children$1),function(index){return children$1.slice(0,index);});};var extractChildren=function extractChildren(block){var children=getChildrenUntilBlockBoundary(block);each$f(children,remove$6);return children;};var removeEmptyRoot=function removeEmptyRoot(rootNode,block){var parents=parentsAndSelf(block,rootNode);return find$2(parents.reverse(),function(element){return isEmpty$2(element);}).each(remove$6);};var isEmptyBefore=function isEmptyBefore(el){return filter$6(prevSiblings(el),function(el){return!isEmpty$2(el);}).length===0;};var nestedBlockMerge=function nestedBlockMerge(rootNode,fromBlock,toBlock,insertionPoint){if(isEmpty$2(toBlock)){fillWithPaddingBr(toBlock);return firstPositionIn(toBlock.dom);}if(isEmptyBefore(insertionPoint)&&isEmpty$2(fromBlock)){before$3(insertionPoint,SugarElement.fromTag('br'));}var position=prevPosition(toBlock.dom,CaretPosition.before(insertionPoint.dom));each$f(extractChildren(fromBlock),function(child){before$3(insertionPoint,child);});removeEmptyRoot(rootNode,fromBlock);return position;};var sidelongBlockMerge=function sidelongBlockMerge(rootNode,fromBlock,toBlock){if(isEmpty$2(toBlock)){remove$6(toBlock);if(isEmpty$2(fromBlock)){fillWithPaddingBr(fromBlock);}return firstPositionIn(fromBlock.dom);}var position=lastPositionIn(toBlock.dom);each$f(extractChildren(fromBlock),function(child){append$1(toBlock,child);});removeEmptyRoot(rootNode,fromBlock);return position;};var findInsertionPoint=function findInsertionPoint(toBlock,block){var parentsAndSelf$1=parentsAndSelf(block,toBlock);return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length-1]);};var getInsertionPoint=function getInsertionPoint(fromBlock,toBlock){return contains(toBlock,fromBlock)?findInsertionPoint(toBlock,fromBlock):Optional.none();};var trimBr=function trimBr(first,block){positionIn(first,block.dom).map(function(position){return position.getNode();}).map(SugarElement.fromDom).filter(isBr$5).each(remove$6);};var mergeBlockInto=function mergeBlockInto(rootNode,fromBlock,toBlock){trimBr(true,fromBlock);trimBr(false,toBlock);return getInsertionPoint(fromBlock,toBlock).fold(curry(sidelongBlockMerge,rootNode,fromBlock,toBlock),curry(nestedBlockMerge,rootNode,fromBlock,toBlock));};var mergeBlocks=function mergeBlocks(rootNode,forward,block1,block2){return forward?mergeBlockInto(rootNode,block2,block1):mergeBlockInto(rootNode,block1,block2);};var backspaceDelete$8=function backspaceDelete$8(editor,forward){var rootNode=SugarElement.fromDom(editor.getBody());var position=read$1(rootNode.dom,forward,editor.selection.getRng()).map(function(blockBoundary){return function(){mergeBlocks(rootNode,forward,blockBoundary.from.block,blockBoundary.to.block).each(function(pos){editor.selection.setRng(pos.toRange());});};});return position;};var deleteRangeMergeBlocks=function deleteRangeMergeBlocks(rootNode,selection){var rng=selection.getRng();return lift2(getParentBlock$2(rootNode,SugarElement.fromDom(rng.startContainer)),getParentBlock$2(rootNode,SugarElement.fromDom(rng.endContainer)),function(block1,block2){if(eq(block1,block2)===false){return Optional.some(function(){rng.deleteContents();mergeBlocks(rootNode,true,block1,block2).each(function(pos){selection.setRng(pos.toRange());});});}else{return Optional.none();}}).getOr(Optional.none());};var isRawNodeInTable=function isRawNodeInTable(root,rawNode){var node=SugarElement.fromDom(rawNode);var isRoot=curry(eq,root);return ancestor$3(node,isTableCell$4,isRoot).isSome();};var isSelectionInTable=function isSelectionInTable(root,rng){return isRawNodeInTable(root,rng.startContainer)||isRawNodeInTable(root,rng.endContainer);};var isEverythingSelected=function isEverythingSelected(root,rng){var noPrevious=prevPosition(root.dom,CaretPosition.fromRangeStart(rng)).isNone();var noNext=nextPosition(root.dom,CaretPosition.fromRangeEnd(rng)).isNone();return!isSelectionInTable(root,rng)&&noPrevious&&noNext;};var emptyEditor=function emptyEditor(editor){return Optional.some(function(){editor.setContent('');editor.selection.setCursorLocation();});};var deleteRange$1=function deleteRange$1(editor){var rootNode=SugarElement.fromDom(editor.getBody());var rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)?emptyEditor(editor):deleteRangeMergeBlocks(rootNode,editor.selection);};var backspaceDelete$7=function backspaceDelete$7(editor,_forward){return editor.selection.isCollapsed()?Optional.none():deleteRange$1(editor);};var isContentEditableTrue$2=isContentEditableTrue$5;var isContentEditableFalse$5=isContentEditableFalse$b;var showCaret=function showCaret(direction,editor,node,before,scrollIntoView){return Optional.from(editor._selectionOverrides.showCaret(direction,node,before,scrollIntoView));};var getNodeRange=function getNodeRange(node){var rng=node.ownerDocument.createRange();rng.selectNode(node);return rng;};var selectNode=function selectNode(editor,node){var e=editor.dispatch('BeforeObjectSelected',{target:node});if(e.isDefaultPrevented()){return Optional.none();}return Optional.some(getNodeRange(node));};var renderCaretAtRange=function renderCaretAtRange(editor,range,scrollIntoView){var normalizedRange=normalizeRange(1,editor.getBody(),range);var caretPosition=CaretPosition.fromRangeStart(normalizedRange);var caretPositionNode=caretPosition.getNode();if(isInlineFakeCaretTarget(caretPositionNode)){return showCaret(1,editor,caretPositionNode,!caretPosition.isAtEnd(),false);}var caretPositionBeforeNode=caretPosition.getNode(true);if(isInlineFakeCaretTarget(caretPositionBeforeNode)){return showCaret(1,editor,caretPositionBeforeNode,false,false);}var ceRoot=editor.dom.getParent(caretPosition.getNode(),function(node){return isContentEditableFalse$5(node)||isContentEditableTrue$2(node);});if(isInlineFakeCaretTarget(ceRoot)){return showCaret(1,editor,ceRoot,false,scrollIntoView);}return Optional.none();};var renderRangeCaret=function renderRangeCaret(editor,range,scrollIntoView){return range.collapsed?renderCaretAtRange(editor,range,scrollIntoView).getOr(range):range;};var isBeforeBoundary=function isBeforeBoundary(pos){return isBeforeContentEditableFalse(pos)||isBeforeMedia(pos);};var isAfterBoundary=function isAfterBoundary(pos){return isAfterContentEditableFalse(pos)||isAfterMedia(pos);};var trimEmptyTextNode=function trimEmptyTextNode(dom,node){if(isText$9(node)&&node.data.length===0){dom.remove(node);}};var deleteContentAndShowCaret=function deleteContentAndShowCaret(editor,range,node,direction,forward,peekCaretPosition){showCaret(direction,editor,peekCaretPosition.getNode(!forward),forward,true).each(function(caretRange){if(range.collapsed){var _deleteRange=range.cloneRange();if(forward){_deleteRange.setEnd(caretRange.startContainer,caretRange.startOffset);}else{_deleteRange.setStart(caretRange.endContainer,caretRange.endOffset);}_deleteRange.deleteContents();}else{range.deleteContents();}editor.selection.setRng(caretRange);});trimEmptyTextNode(editor.dom,node);};var deleteBoundaryText=function deleteBoundaryText(editor,forward){var range=editor.selection.getRng();if(!isText$9(range.commonAncestorContainer)){return Optional.none();}var direction=forward?HDirection.Forwards:HDirection.Backwards;var caretWalker=CaretWalker(editor.getBody());var getNextPosFn=curry(getVisualCaretPosition,forward?caretWalker.next:caretWalker.prev);var isBeforeFn=forward?isBeforeBoundary:isAfterBoundary;var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);var nextCaretPosition=normalizePosition(forward,getNextPosFn(caretPosition));if(!nextCaretPosition||!isMoveInsideSameBlock(caretPosition,nextCaretPosition)){return Optional.none();}else if(isBeforeFn(nextCaretPosition)){return Optional.some(function(){return deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,nextCaretPosition);});}var peekCaretPosition=getNextPosFn(nextCaretPosition);if(peekCaretPosition&&isBeforeFn(peekCaretPosition)){if(isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition)){return Optional.some(function(){return deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,peekCaretPosition);});}}return Optional.none();};var backspaceDelete$6=function backspaceDelete$6(editor,forward){return deleteBoundaryText(editor,forward);};var getEdgeCefPosition=function getEdgeCefPosition(editor,atStart){var root=editor.getBody();return atStart?firstPositionIn(root).filter(isBeforeContentEditableFalse):lastPositionIn(root).filter(isAfterContentEditableFalse);};var isCefAtEdgeSelected=function isCefAtEdgeSelected(editor){var rng=editor.selection.getRng();return!rng.collapsed&&(getEdgeCefPosition(editor,true).exists(function(pos){return pos.isEqual(CaretPosition.fromRangeStart(rng));})||getEdgeCefPosition(editor,false).exists(function(pos){return pos.isEqual(CaretPosition.fromRangeEnd(rng));}));};var isCompoundElement=function isCompoundElement(node){return isTableCell$4(SugarElement.fromDom(node))||isListItem(SugarElement.fromDom(node));};var DeleteAction=Adt.generate([{remove:['element']},{moveToElement:['element']},{moveToPosition:['position']}]);var isAtContentEditableBlockCaret=function isAtContentEditableBlockCaret(forward,from){var elm=from.getNode(forward===false);var caretLocation=forward?'after':'before';return isElement$6(elm)&&elm.getAttribute('data-mce-caret')===caretLocation;};var isDeleteFromCefDifferentBlocks=function isDeleteFromCefDifferentBlocks(root,forward,from,to){var inSameBlock=function inSameBlock(elm){return isInline$1(SugarElement.fromDom(elm))&&!isInSameBlock(from,to,root);};return getRelativeCefElm(!forward,from).fold(function(){return getRelativeCefElm(forward,to).fold(never,inSameBlock);},inSameBlock);};var deleteEmptyBlockOrMoveToCef=function deleteEmptyBlockOrMoveToCef(root,forward,from,to){var toCefElm=to.getNode(forward===false);return getParentBlock$2(SugarElement.fromDom(root),SugarElement.fromDom(from.getNode())).map(function(blockElm){return isEmpty$2(blockElm)?DeleteAction.remove(blockElm.dom):DeleteAction.moveToElement(toCefElm);}).orThunk(function(){return Optional.some(DeleteAction.moveToElement(toCefElm));});};var findCefPosition=function findCefPosition(root,forward,from){return fromPosition(forward,root,from).bind(function(to){if(isCompoundElement(to.getNode())){return Optional.none();}else if(isDeleteFromCefDifferentBlocks(root,forward,from,to)){return Optional.none();}else if(forward&&isContentEditableFalse$b(to.getNode())){return deleteEmptyBlockOrMoveToCef(root,forward,from,to);}else if(forward===false&&isContentEditableFalse$b(to.getNode(true))){return deleteEmptyBlockOrMoveToCef(root,forward,from,to);}else if(forward&&isAfterContentEditableFalse(from)){return Optional.some(DeleteAction.moveToPosition(to));}else if(forward===false&&isBeforeContentEditableFalse(from)){return Optional.some(DeleteAction.moveToPosition(to));}else{return Optional.none();}});};var getContentEditableBlockAction=function getContentEditableBlockAction(forward,elm){if(forward&&isContentEditableFalse$b(elm.nextSibling)){return Optional.some(DeleteAction.moveToElement(elm.nextSibling));}else if(forward===false&&isContentEditableFalse$b(elm.previousSibling)){return Optional.some(DeleteAction.moveToElement(elm.previousSibling));}else{return Optional.none();}};var skipMoveToActionFromInlineCefToContent=function skipMoveToActionFromInlineCefToContent(root,from,deleteAction){return deleteAction.fold(function(elm){return Optional.some(DeleteAction.remove(elm));},function(elm){return Optional.some(DeleteAction.moveToElement(elm));},function(to){if(isInSameBlock(from,to,root)){return Optional.none();}else{return Optional.some(DeleteAction.moveToPosition(to));}});};var getContentEditableAction=function getContentEditableAction(root,forward,from){if(isAtContentEditableBlockCaret(forward,from)){return getContentEditableBlockAction(forward,from.getNode(forward===false)).fold(function(){return findCefPosition(root,forward,from);},Optional.some);}else{return findCefPosition(root,forward,from).bind(function(deleteAction){return skipMoveToActionFromInlineCefToContent(root,from,deleteAction);});}};var read=function read(root,forward,rng){var normalizedRange=normalizeRange(forward?1:-1,root,rng);var from=CaretPosition.fromRangeStart(normalizedRange);var rootElement=SugarElement.fromDom(root);if(forward===false&&isAfterContentEditableFalse(from)){return Optional.some(DeleteAction.remove(from.getNode(true)));}else if(forward&&isBeforeContentEditableFalse(from)){return Optional.some(DeleteAction.remove(from.getNode()));}else if(forward===false&&isBeforeContentEditableFalse(from)&&isAfterBr(rootElement,from)){return findPreviousBr(rootElement,from).map(function(br){return DeleteAction.remove(br.getNode());});}else if(forward&&isAfterContentEditableFalse(from)&&isBeforeBr$1(rootElement,from)){return findNextBr(rootElement,from).map(function(br){return DeleteAction.remove(br.getNode());});}else{return getContentEditableAction(root,forward,from);}};var deleteElement$1=function deleteElement$1(editor,forward){return function(element){editor._selectionOverrides.hideFakeCaret();deleteElement$2(editor,forward,SugarElement.fromDom(element));return true;};};var moveToElement=function moveToElement(editor,forward){return function(element){var pos=forward?CaretPosition.before(element):CaretPosition.after(element);editor.selection.setRng(pos.toRange());return true;};};var moveToPosition=function moveToPosition(editor){return function(pos){editor.selection.setRng(pos.toRange());return true;};};var getAncestorCe=function getAncestorCe(editor,node){return Optional.from(getContentEditableRoot$1(editor.getBody(),node));};var backspaceDeleteCaret=function backspaceDeleteCaret(editor,forward){var selectedNode=editor.selection.getNode();return getAncestorCe(editor,selectedNode).filter(isContentEditableFalse$b).fold(function(){return read(editor.getBody(),forward,editor.selection.getRng()).map(function(deleteAction){return function(){return deleteAction.fold(deleteElement$1(editor,forward),moveToElement(editor,forward),moveToPosition(editor));};});},function(){return Optional.some(noop);});};var deleteOffscreenSelection=function deleteOffscreenSelection(rootElement){each$f(descendants(rootElement,'.mce-offscreen-selection'),remove$6);};var backspaceDeleteRange=function backspaceDeleteRange(editor,forward){var selectedNode=editor.selection.getNode();if(isContentEditableFalse$b(selectedNode)&&!isTableCell$5(selectedNode)){var hasCefAncestor=getAncestorCe(editor,selectedNode.parentNode).filter(isContentEditableFalse$b);return hasCefAncestor.fold(function(){return Optional.some(function(){deleteOffscreenSelection(SugarElement.fromDom(editor.getBody()));deleteElement$2(editor,forward,SugarElement.fromDom(editor.selection.getNode()));paddEmptyBody(editor);});},function(){return Optional.some(noop);});}if(isCefAtEdgeSelected(editor)){return Optional.some(function(){deleteRangeContents(editor,editor.selection.getRng(),SugarElement.fromDom(editor.getBody()));});}return Optional.none();};var paddEmptyElement=function paddEmptyElement(editor){var dom=editor.dom,selection=editor.selection;var ceRoot=getContentEditableRoot$1(editor.getBody(),selection.getNode());if(isContentEditableTrue$5(ceRoot)&&dom.isBlock(ceRoot)&&dom.isEmpty(ceRoot)){var br=dom.create('br',{'data-mce-bogus':'1'});dom.setHTML(ceRoot,'');ceRoot.appendChild(br);selection.setRng(CaretPosition.before(br).toRange());}return true;};var backspaceDelete$5=function backspaceDelete$5(editor,forward){if(editor.selection.isCollapsed()){return backspaceDeleteCaret(editor,forward);}else{return backspaceDeleteRange(editor,forward);}};var deleteCaret$2=function deleteCaret$2(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return fromPosition(forward,editor.getBody(),fromPos).filter(function(pos){return forward?isBeforeImageBlock(pos):isAfterImageBlock(pos);}).bind(function(pos){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,pos));}).map(function(elm){return function(){return editor.selection.select(elm);};});};var backspaceDelete$4=function backspaceDelete$4(editor,forward){return editor.selection.isCollapsed()?deleteCaret$2(editor,forward):Optional.none();};var isText$2=isText$9;var startsWithCaretContainer=function startsWithCaretContainer(node){return isText$2(node)&&node.data[0]===ZWSP$1;};var endsWithCaretContainer=function endsWithCaretContainer(node){return isText$2(node)&&node.data[node.data.length-1]===ZWSP$1;};var createZwsp=function createZwsp(node){return node.ownerDocument.createTextNode(ZWSP$1);};var insertBefore=function insertBefore(node){if(isText$2(node.previousSibling)){if(endsWithCaretContainer(node.previousSibling)){return node.previousSibling;}else{node.previousSibling.appendData(ZWSP$1);return node.previousSibling;}}else if(isText$2(node)){if(startsWithCaretContainer(node)){return node;}else{node.insertData(0,ZWSP$1);return node;}}else{var newNode=createZwsp(node);node.parentNode.insertBefore(newNode,node);return newNode;}};var insertAfter=function insertAfter(node){if(isText$2(node.nextSibling)){if(startsWithCaretContainer(node.nextSibling)){return node.nextSibling;}else{node.nextSibling.insertData(0,ZWSP$1);return node.nextSibling;}}else if(isText$2(node)){if(endsWithCaretContainer(node)){return node;}else{node.appendData(ZWSP$1);return node;}}else{var newNode=createZwsp(node);if(node.nextSibling){node.parentNode.insertBefore(newNode,node.nextSibling);}else{node.parentNode.appendChild(newNode);}return newNode;}};var insertInline=function insertInline(before,node){return before?insertBefore(node):insertAfter(node);};var insertInlineBefore=curry(insertInline,true);var insertInlineAfter=curry(insertInline,false);var insertInlinePos=function insertInlinePos(pos,before){if(isText$9(pos.container())){return insertInline(before,pos.container());}else{return insertInline(before,pos.getNode());}};var isPosCaretContainer=function isPosCaretContainer(pos,caret){var caretNode=caret.get();return caretNode&&pos.container()===caretNode&&isCaretContainerInline(caretNode);};var renderCaret=function renderCaret(caret,location){return location.fold(function(element){remove$4(caret.get());var text=insertInlineBefore(element);caret.set(text);return Optional.some(CaretPosition(text,text.length-1));},function(element){return firstPositionIn(element).map(function(pos){if(!isPosCaretContainer(pos,caret)){remove$4(caret.get());var _text5=insertInlinePos(pos,true);caret.set(_text5);return CaretPosition(_text5,1);}else{return CaretPosition(caret.get(),1);}});},function(element){return lastPositionIn(element).map(function(pos){if(!isPosCaretContainer(pos,caret)){remove$4(caret.get());var _text6=insertInlinePos(pos,false);caret.set(_text6);return CaretPosition(_text6,_text6.length-1);}else{return CaretPosition(caret.get(),caret.get().length-1);}});},function(element){remove$4(caret.get());var text=insertInlineAfter(element);caret.set(text);return Optional.some(CaretPosition(text,1));});};var evaluateUntil=function evaluateUntil(fns,args){for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome()){return result;}}return Optional.none();};var Location=Adt.generate([{before:['element']},{start:['element']},{end:['element']},{after:['element']}]);var rescope$1=function rescope$1(rootNode,node){var parentBlock=getParentBlock$3(node,rootNode);return parentBlock?parentBlock:rootNode;};var before=function before(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos);var scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold(function(){return nextPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map(function(inline){return Location.before(inline);});},Optional.none);};var isNotInsideFormatCaretContainer=function isNotInsideFormatCaretContainer(rootNode,elm){return getParentCaretContainer(rootNode,elm)===null;};var findInsideRootInline=function findInsideRootInline(isInlineTarget,rootNode,pos){return findRootInline(isInlineTarget,rootNode,pos).filter(curry(isNotInsideFormatCaretContainer,rootNode));};var start$1=function start$1(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){var prevPos=prevPosition(inline,nPos);return prevPos.isNone()?Optional.some(Location.start(inline)):Optional.none();});};var end=function end(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){var nextPos=nextPosition(inline,nPos);return nextPos.isNone()?Optional.some(Location.end(inline)):Optional.none();});};var after=function after(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos);var scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold(function(){return prevPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map(function(inline){return Location.after(inline);});},Optional.none);};var isValidLocation=function isValidLocation(location){return isRtl(getElement(location))===false;};var readLocation=function readLocation(isInlineTarget,rootNode,pos){var location=evaluateUntil([before,start$1,end,after],[isInlineTarget,rootNode,pos]);return location.filter(isValidLocation);};var getElement=function getElement(location){return location.fold(identity,identity,identity,identity);};var getName=function getName(location){return location.fold(constant('before'),constant('start'),constant('end'),constant('after'));};var outside=function outside(location){return location.fold(Location.before,Location.before,Location.after,Location.after);};var inside=function inside(location){return location.fold(Location.start,Location.start,Location.end,Location.end);};var isEq=function isEq(location1,location2){return getName(location1)===getName(location2)&&getElement(location1)===getElement(location2);};var betweenInlines=function betweenInlines(forward,isInlineTarget,rootNode,from,to,location){return lift2(findRootInline(isInlineTarget,rootNode,from),findRootInline(isInlineTarget,rootNode,to),function(fromInline,toInline){if(fromInline!==toInline&&hasSameParentBlock(rootNode,fromInline,toInline)){return Location.after(forward?fromInline:toInline);}else{return location;}}).getOr(location);};var skipNoMovement=function skipNoMovement(fromLocation,toLocation){return fromLocation.fold(always,function(fromLocation){return!isEq(fromLocation,toLocation);});};var findLocationTraverse=function findLocationTraverse(forward,isInlineTarget,rootNode,fromLocation,pos){var from=normalizePosition(forward,pos);var to=fromPosition(forward,rootNode,from).map(curry(normalizePosition,forward));var location=to.fold(function(){return fromLocation.map(outside);},function(to){return readLocation(isInlineTarget,rootNode,to).map(curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(curry(skipNoMovement,fromLocation));});return location.filter(isValidLocation);};var findLocationSimple=function findLocationSimple(forward,location){if(forward){return location.fold(compose(Optional.some,Location.start),Optional.none,compose(Optional.some,Location.after),Optional.none);}else{return location.fold(Optional.none,compose(Optional.some,Location.before),Optional.none,compose(Optional.some,Location.end));}};var findLocation$1=function findLocation$1(forward,isInlineTarget,rootNode,pos){var from=normalizePosition(forward,pos);var fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(curry(findLocationSimple,forward)).orThunk(function(){return findLocationTraverse(forward,isInlineTarget,rootNode,fromLocation,pos);});};var hasSelectionModifyApi=function hasSelectionModifyApi(editor){return isFunction(editor.selection.getSel().modify);};var moveRel=function moveRel(forward,selection,pos){var delta=forward?1:-1;selection.setRng(CaretPosition(pos.container(),pos.offset()+delta).toRange());selection.getSel().modify('move',forward?'forward':'backward','word');return true;};var moveByWord=function moveByWord(forward,editor){var rng=editor.selection.getRng();var pos=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);if(!hasSelectionModifyApi(editor)){return false;}else if(forward&&isBeforeInline(pos)){return moveRel(true,editor.selection,pos);}else if(!forward&&isAfterInline(pos)){return moveRel(false,editor.selection,pos);}else{return false;}};var BreakType;(function(BreakType){BreakType[BreakType['Br']=0]='Br';BreakType[BreakType['Block']=1]='Block';BreakType[BreakType['Wrap']=2]='Wrap';BreakType[BreakType['Eol']=3]='Eol';})(BreakType||(BreakType={}));var flip=function flip(direction,positions){return direction===HDirection.Backwards?reverse(positions):positions;};var walk$1=function walk$1(direction,caretWalker,pos){return direction===HDirection.Forwards?caretWalker.next(pos):caretWalker.prev(pos);};var getBreakType=function getBreakType(scope,direction,currentPos,nextPos){if(isBr$6(nextPos.getNode(direction===HDirection.Forwards))){return BreakType.Br;}else if(isInSameBlock(currentPos,nextPos)===false){return BreakType.Block;}else{return BreakType.Wrap;}};var getPositionsUntil=function getPositionsUntil(predicate,direction,scope,start){var caretWalker=CaretWalker(scope);var currentPos=start;var positions=[];while(currentPos){var nextPos=walk$1(direction,caretWalker,currentPos);if(!nextPos){break;}if(isBr$6(nextPos.getNode(false))){if(direction===HDirection.Forwards){return{positions:flip(direction,positions).concat([nextPos]),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};}else{return{positions:flip(direction,positions),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};}}if(!nextPos.isVisible()){currentPos=nextPos;continue;}if(predicate(currentPos,nextPos)){var breakType=getBreakType(scope,direction,currentPos,nextPos);return{positions:flip(direction,positions),breakType:breakType,breakAt:Optional.some(nextPos)};}positions.push(nextPos);currentPos=nextPos;}return{positions:flip(direction,positions),breakType:BreakType.Eol,breakAt:Optional.none()};};var getAdjacentLinePositions=function getAdjacentLinePositions(direction,getPositionsUntilBreak,scope,start){return getPositionsUntilBreak(scope,start).breakAt.map(function(pos){var positions=getPositionsUntilBreak(scope,pos).positions;return direction===HDirection.Backwards?positions.concat(pos):[pos].concat(positions);}).getOr([]);};var findClosestHorizontalPositionFromPoint=function findClosestHorizontalPositionFromPoint(positions,x){return foldl(positions,function(acc,newPos){return acc.fold(function(){return Optional.some(newPos);},function(lastPos){return lift2(head(lastPos.getClientRects()),head(newPos.getClientRects()),function(lastRect,newRect){var lastDist=Math.abs(x-lastRect.left);var newDist=Math.abs(x-newRect.left);return newDist<=lastDist?newPos:lastPos;}).or(acc);});},Optional.none());};var findClosestHorizontalPosition=function findClosestHorizontalPosition(positions,pos){return head(pos.getClientRects()).bind(function(targetRect){return findClosestHorizontalPositionFromPoint(positions,targetRect.left);});};var getPositionsUntilPreviousLine=curry(getPositionsUntil,CaretPosition.isAbove,-1);var getPositionsUntilNextLine=curry(getPositionsUntil,CaretPosition.isBelow,1);var getPositionsAbove=curry(getAdjacentLinePositions,-1,getPositionsUntilPreviousLine);var getPositionsBelow=curry(getAdjacentLinePositions,1,getPositionsUntilNextLine);var isAtFirstLine=function isAtFirstLine(scope,pos){return getPositionsUntilPreviousLine(scope,pos).breakAt.isNone();};var isAtLastLine=function isAtLastLine(scope,pos){return getPositionsUntilNextLine(scope,pos).breakAt.isNone();};var getFirstLinePositions=function getFirstLinePositions(scope){return firstPositionIn(scope).map(function(pos){return[pos].concat(getPositionsUntilNextLine(scope,pos).positions);}).getOr([]);};var getLastLinePositions=function getLastLinePositions(scope){return lastPositionIn(scope).map(function(pos){return getPositionsUntilPreviousLine(scope,pos).positions.concat(pos);}).getOr([]);};var getClosestPositionAbove=function getClosestPositionAbove(scope,pos){return findClosestHorizontalPosition(getPositionsAbove(scope,pos),pos);};var getClosestPositionBelow=function getClosestPositionBelow(scope,pos){return findClosestHorizontalPosition(getPositionsBelow(scope,pos),pos);};var isContentEditableFalse$4=isContentEditableFalse$b;var distanceToRectLeft$1=function distanceToRectLeft$1(clientRect,clientX){return Math.abs(clientRect.left-clientX);};var distanceToRectRight$1=function distanceToRectRight$1(clientRect,clientX){return Math.abs(clientRect.right-clientX);};var isNodeClientRect=function isNodeClientRect(rect){return hasNonNullableKey(rect,'node');};var findClosestClientRect=function findClosestClientRect(clientRects,clientX){return reduce(clientRects,function(oldClientRect,clientRect){var oldDistance=Math.min(distanceToRectLeft$1(oldClientRect,clientX),distanceToRectRight$1(oldClientRect,clientX));var newDistance=Math.min(distanceToRectLeft$1(clientRect,clientX),distanceToRectRight$1(clientRect,clientX));if(newDistance===oldDistance&&isNodeClientRect(clientRect)&&isContentEditableFalse$4(clientRect.node)){return clientRect;}if(newDistance<oldDistance){return clientRect;}return oldClientRect;});};var getNodeClientRects=function getNodeClientRects(node){var toArrayWithNode=function toArrayWithNode(clientRects){return map$3(clientRects,function(rect){var clientRect=clone$1(rect);clientRect.node=node;return clientRect;});};if(isElement$6(node)){return toArrayWithNode(node.getClientRects());}else if(isText$9(node)){var rng=node.ownerDocument.createRange();rng.setStart(node,0);rng.setEnd(node,node.data.length);return toArrayWithNode(rng.getClientRects());}else{return[];}};var getClientRects=function getClientRects(nodes){return bind$3(nodes,getNodeClientRects);};var VDirection;(function(VDirection){VDirection[VDirection['Up']=-1]='Up';VDirection[VDirection['Down']=1]='Down';})(VDirection||(VDirection={}));var findUntil=function findUntil(direction,root,predicateFn,node){while(node=findNode(node,direction,isEditableCaretCandidate$1,root)){if(predicateFn(node)){return;}}};var walkUntil=function walkUntil(direction,isAboveFn,isBeflowFn,root,predicateFn,caretPosition){var line=0;var result=[];var add=function add(node){var clientRects=getClientRects([node]);if(direction===-1){clientRects=clientRects.reverse();}for(var i=0;i<clientRects.length;i++){var clientRect=clientRects[i];if(isBeflowFn(clientRect,targetClientRect)){continue;}if(result.length>0&&isAboveFn(clientRect,last$2(result))){line++;}clientRect.line=line;if(predicateFn(clientRect)){return true;}result.push(clientRect);}};var targetClientRect=last$2(caretPosition.getClientRects());if(!targetClientRect){return result;}var node=caretPosition.getNode();add(node);findUntil(direction,root,add,node);return result;};var aboveLineNumber=function aboveLineNumber(lineNumber,clientRect){return clientRect.line>lineNumber;};var isLineNumber=function isLineNumber(lineNumber,clientRect){return clientRect.line===lineNumber;};var upUntil=curry(walkUntil,VDirection.Up,isAbove$1,isBelow$1);var downUntil=curry(walkUntil,VDirection.Down,isBelow$1,isAbove$1);var positionsUntil=function positionsUntil(direction,root,predicateFn,node){var caretWalker=CaretWalker(root);var walkFn;var isBelowFn;var isAboveFn;var caretPosition;var result=[];var line=0;var getClientRect=function getClientRect(caretPosition){if(direction===1){return last$2(caretPosition.getClientRects());}return last$2(caretPosition.getClientRects());};if(direction===1){walkFn=caretWalker.next;isBelowFn=isBelow$1;isAboveFn=isAbove$1;caretPosition=CaretPosition.after(node);}else{walkFn=caretWalker.prev;isBelowFn=isAbove$1;isAboveFn=isBelow$1;caretPosition=CaretPosition.before(node);}var targetClientRect=getClientRect(caretPosition);do{if(!caretPosition.isVisible()){continue;}var rect=getClientRect(caretPosition);if(isAboveFn(rect,targetClientRect)){continue;}if(result.length>0&&isBelowFn(rect,last$2(result))){line++;}var clientRect=clone$1(rect);clientRect.position=caretPosition;clientRect.line=line;if(predicateFn(clientRect)){return result;}result.push(clientRect);}while(caretPosition=walkFn(caretPosition));return result;};var isAboveLine=function isAboveLine(lineNumber){return function(clientRect){return aboveLineNumber(lineNumber,clientRect);};};var isLine=function isLine(lineNumber){return function(clientRect){return isLineNumber(lineNumber,clientRect);};};var moveToRange=function moveToRange(editor,rng){editor.selection.setRng(rng);scrollRangeIntoView(editor,editor.selection.getRng());};var renderRangeCaretOpt=function renderRangeCaretOpt(editor,range,scrollIntoView){return Optional.some(renderRangeCaret(editor,range,scrollIntoView));};var moveHorizontally=function moveHorizontally(editor,direction,range,isBefore,isAfter,isElement){var forwards=direction===HDirection.Forwards;var caretWalker=CaretWalker(editor.getBody());var getNextPosFn=curry(getVisualCaretPosition,forwards?caretWalker.next:caretWalker.prev);var isBeforeFn=forwards?isBefore:isAfter;if(!range.collapsed){var _node14=getSelectedNode(range);if(isElement(_node14)){return showCaret(direction,editor,_node14,direction===HDirection.Backwards,false);}else if(isCefAtEdgeSelected(editor)){var newRange=range.cloneRange();newRange.collapse(direction===HDirection.Backwards);return Optional.from(newRange);}}var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);if(isBeforeFn(caretPosition)){return selectNode(editor,caretPosition.getNode(!forwards));}var nextCaretPosition=normalizePosition(forwards,getNextPosFn(caretPosition));var rangeIsInContainerBlock=isRangeInCaretContainerBlock(range);if(!nextCaretPosition){return rangeIsInContainerBlock?Optional.some(range):Optional.none();}if(isBeforeFn(nextCaretPosition)){return showCaret(direction,editor,nextCaretPosition.getNode(!forwards),forwards,false);}var peekCaretPosition=getNextPosFn(nextCaretPosition);if(peekCaretPosition&&isBeforeFn(peekCaretPosition)){if(isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition)){return showCaret(direction,editor,peekCaretPosition.getNode(!forwards),forwards,false);}}if(rangeIsInContainerBlock){return renderRangeCaretOpt(editor,nextCaretPosition.toRange(),false);}return Optional.none();};var moveVertically=function moveVertically(editor,direction,range,isBefore,isAfter,isElement){var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);var caretClientRect=last$2(caretPosition.getClientRects());var forwards=direction===VDirection.Down;var root=editor.getBody();if(!caretClientRect){return Optional.none();}if(isCefAtEdgeSelected(editor)){var _caretPosition=forwards?CaretPosition.fromRangeEnd(range):CaretPosition.fromRangeStart(range);var getClosestFn=!forwards?getClosestPositionAbove:getClosestPositionBelow;return getClosestFn(root,_caretPosition).orThunk(function(){return Optional.from(_caretPosition);}).map(function(pos){return pos.toRange();});}var walkerFn=forwards?downUntil:upUntil;var linePositions=walkerFn(root,isAboveLine(1),caretPosition);var nextLinePositions=filter$6(linePositions,isLine(1));var clientX=caretClientRect.left;var nextLineRect=findClosestClientRect(nextLinePositions,clientX);if(nextLineRect&&isElement(nextLineRect.node)){var dist1=Math.abs(clientX-nextLineRect.left);var dist2=Math.abs(clientX-nextLineRect.right);return showCaret(direction,editor,nextLineRect.node,dist1<dist2,false);}var currentNode;if(isBefore(caretPosition)){currentNode=caretPosition.getNode();}else if(isAfter(caretPosition)){currentNode=caretPosition.getNode(true);}else{currentNode=getSelectedNode(range);}if(currentNode){var caretPositions=positionsUntil(direction,root,isAboveLine(1),currentNode);var closestNextLineRect=findClosestClientRect(filter$6(caretPositions,isLine(1)),clientX);if(closestNextLineRect){return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),false);}closestNextLineRect=last$2(filter$6(caretPositions,isLine(0)));if(closestNextLineRect){return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),false);}}if(nextLinePositions.length===0){return getLineEndPoint(editor,forwards).filter(forwards?isAfter:isBefore).map(function(pos){return renderRangeCaret(editor,pos.toRange(),false);});}return Optional.none();};var getLineEndPoint=function getLineEndPoint(editor,forward){var rng=editor.selection.getRng();var from=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);var host=getEditingHost(from.container(),editor.getBody());if(forward){var lineInfo=getPositionsUntilNextLine(host,from);return last$3(lineInfo.positions);}else{var _lineInfo=getPositionsUntilPreviousLine(host,from);return head(_lineInfo.positions);}};var moveToLineEndPoint$3=function moveToLineEndPoint$3(editor,forward,isElementPosition){return getLineEndPoint(editor,forward).filter(isElementPosition).exists(function(pos){editor.selection.setRng(pos.toRange());return true;});};var setCaretPosition=function setCaretPosition(editor,pos){var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset());rng.setEnd(pos.container(),pos.offset());editor.selection.setRng(rng);};var setSelected=function setSelected(state,elm){if(state){elm.setAttribute('data-mce-selected','inline-boundary');}else{elm.removeAttribute('data-mce-selected');}};var renderCaretLocation=function renderCaretLocation(editor,caret,location){return renderCaret(caret,location).map(function(pos){setCaretPosition(editor,pos);return location;});};var getPositionFromRange=function getPositionFromRange(range,root,forward){var start=CaretPosition.fromRangeStart(range);if(range.collapsed){return start;}else{var _end3=CaretPosition.fromRangeEnd(range);return forward?prevPosition(root,_end3).getOr(_end3):nextPosition(root,start).getOr(start);}};var findLocation=function findLocation(editor,caret,forward){var rootNode=editor.getBody();var from=getPositionFromRange(editor.selection.getRng(),rootNode,forward);var isInlineTarget$1=curry(isInlineTarget,editor);var location=findLocation$1(forward,isInlineTarget$1,rootNode,from);return location.bind(function(location){return renderCaretLocation(editor,caret,location);});};var toggleInlines=function toggleInlines(isInlineTarget,dom,elms){var inlineBoundaries=map$3(descendants(SugarElement.fromDom(dom.getRoot()),'*[data-mce-selected="inline-boundary"]'),function(e){return e.dom;});var selectedInlines=filter$6(inlineBoundaries,isInlineTarget);var targetInlines=filter$6(elms,isInlineTarget);each$f(difference(selectedInlines,targetInlines),curry(setSelected,false));each$f(difference(targetInlines,selectedInlines),curry(setSelected,true));};var safeRemoveCaretContainer=function safeRemoveCaretContainer(editor,caret){if(editor.selection.isCollapsed()&&editor.composing!==true&&caret.get()){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());if(CaretPosition.isTextPosition(pos)&&isAtZwsp(pos)===false){setCaretPosition(editor,removeAndReposition(caret.get(),pos));caret.set(null);}}};var renderInsideInlineCaret=function renderInsideInlineCaret(isInlineTarget,editor,caret,elms){if(editor.selection.isCollapsed()){var inlines=filter$6(elms,isInlineTarget);each$f(inlines,function(_inline){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());readLocation(isInlineTarget,editor.getBody(),pos).bind(function(location){return renderCaretLocation(editor,caret,location);});});}};var move$2=function move$2(editor,caret,forward){return isInlineBoundariesEnabled(editor)?findLocation(editor,caret,forward).isSome():false;};var moveWord=function moveWord(forward,editor,_caret){return isInlineBoundariesEnabled(editor)?moveByWord(forward,editor):false;};var setupSelectedState=function setupSelectedState(editor){var caret=Cell(null);var isInlineTarget$1=curry(isInlineTarget,editor);editor.on('NodeChange',function(e){if(isInlineBoundariesEnabled(editor)){toggleInlines(isInlineTarget$1,editor.dom,e.parents);safeRemoveCaretContainer(editor,caret);renderInsideInlineCaret(isInlineTarget$1,editor,caret,e.parents);}});return caret;};var moveNextWord=curry(moveWord,true);var movePrevWord=curry(moveWord,false);var moveToLineEndPoint$2=function moveToLineEndPoint$2(editor,forward,caret){if(isInlineBoundariesEnabled(editor)){var linePoint=getLineEndPoint(editor,forward).getOrThunk(function(){var rng=editor.selection.getRng();return forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);});return readLocation(curry(isInlineTarget,editor),editor.getBody(),linePoint).exists(function(loc){var outsideLoc=outside(loc);return renderCaret(caret,outsideLoc).exists(function(pos){setCaretPosition(editor,pos);return true;});});}else{return false;}};var rangeFromPositions=function rangeFromPositions(from,to){var range=document.createRange();range.setStart(from.container(),from.offset());range.setEnd(to.container(),to.offset());return range;};var hasOnlyTwoOrLessPositionsLeft=function hasOnlyTwoOrLessPositionsLeft(elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(true,firstPos);var normalizedLastPos=normalizePosition(false,lastPos);return nextPosition(elm,normalizedFirstPos).forall(function(pos){return pos.isEqual(normalizedLastPos);});}).getOr(true);};var setCaretLocation=function setCaretLocation(editor,caret){return function(location){return renderCaret(caret,location).map(function(pos){return function(){return setCaretPosition(editor,pos);};});};};var deleteFromTo=function deleteFromTo(editor,caret,from,to){var rootNode=editor.getBody();var isInlineTarget$1=curry(isInlineTarget,editor);editor.undoManager.ignore(function(){editor.selection.setRng(rangeFromPositions(from,to));execDeleteCommand(editor);readLocation(isInlineTarget$1,rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(inside).bind(setCaretLocation(editor,caret)).each(call);});editor.nodeChanged();};var rescope=function rescope(rootNode,node){var parentBlock=getParentBlock$3(node,rootNode);return parentBlock?parentBlock:rootNode;};var backspaceDeleteCollapsed=function backspaceDeleteCollapsed(editor,caret,forward,from){var rootNode=rescope(editor.getBody(),from.container());var isInlineTarget$1=curry(isInlineTarget,editor);var fromLocation=readLocation(isInlineTarget$1,rootNode,from);var location=fromLocation.bind(function(location){if(forward){return location.fold(constant(Optional.some(inside(location))),Optional.none,constant(Optional.some(outside(location))),Optional.none);}else{return location.fold(Optional.none,constant(Optional.some(outside(location))),Optional.none,constant(Optional.some(inside(location))));}});return location.map(setCaretLocation(editor,caret)).getOrThunk(function(){var toPosition=navigate(forward,rootNode,from);var toLocation=toPosition.bind(function(pos){return readLocation(isInlineTarget$1,rootNode,pos);});return lift2(fromLocation,toLocation,function(){return findRootInline(isInlineTarget$1,rootNode,from).bind(function(elm){if(hasOnlyTwoOrLessPositionsLeft(elm)){return Optional.some(function(){deleteElement$2(editor,forward,SugarElement.fromDom(elm));});}else{return Optional.none();}});}).getOrThunk(function(){return toLocation.bind(function(){return toPosition.map(function(to){return function(){if(forward){deleteFromTo(editor,caret,from,to);}else{deleteFromTo(editor,caret,to,from);}};});});});});};var backspaceDelete$3=function backspaceDelete$3(editor,caret,forward){if(editor.selection.isCollapsed()&&isInlineBoundariesEnabled(editor)){var _from=CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,_from);}return Optional.none();};var getParentInlines=function getParentInlines(rootElm,startElm){var parents=parentsAndSelf(startElm,rootElm);return findIndex$2(parents,isBlock$2).fold(constant(parents),function(index){return parents.slice(0,index);});};var hasOnlyOneChild=function hasOnlyOneChild(elm){return childNodesCount(elm)===1;};var deleteLastPosition=function deleteLastPosition(forward,editor,target,parentInlines){var isFormatElement$1=curry(isFormatElement,editor);var formatNodes=map$3(filter$6(parentInlines,isFormatElement$1),function(elm){return elm.dom;});if(formatNodes.length===0){deleteElement$2(editor,forward,target);}else{var pos=replaceWithCaretFormat(target.dom,formatNodes);editor.selection.setRng(pos.toRange());}};var deleteCaret$1=function deleteCaret$1(editor,forward){var rootElm=SugarElement.fromDom(editor.getBody());var startElm=SugarElement.fromDom(editor.selection.getStart());var parentInlines=filter$6(getParentInlines(rootElm,startElm),hasOnlyOneChild);return last$3(parentInlines).bind(function(target){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());if(willDeleteLastPositionInElement(forward,fromPos,target.dom)&&!isEmptyCaretFormatElement(target)){return Optional.some(function(){return deleteLastPosition(forward,editor,target,parentInlines);});}else{return Optional.none();}});};var backspaceDelete$2=function backspaceDelete$2(editor,forward){return editor.selection.isCollapsed()?deleteCaret$1(editor,forward):Optional.none();};var deleteElement=function deleteElement(editor,forward,element){return Optional.some(function(){editor._selectionOverrides.hideFakeCaret();deleteElement$2(editor,forward,SugarElement.fromDom(element));});};var deleteCaret=function deleteCaret(editor,forward){var isNearMedia=forward?isBeforeMedia:isAfterMedia;var direction=forward?HDirection.Forwards:HDirection.Backwards;var fromPos=getNormalizedRangeEndPoint(direction,editor.getBody(),editor.selection.getRng());if(isNearMedia(fromPos)){return deleteElement(editor,forward,fromPos.getNode(!forward));}else{return Optional.from(normalizePosition(forward,fromPos)).filter(function(pos){return isNearMedia(pos)&&isMoveInsideSameBlock(fromPos,pos);}).map(function(pos){return function(){return deleteElement(editor,forward,pos.getNode(!forward));};});}};var deleteRange=function deleteRange(editor,forward){var selectedNode=editor.selection.getNode();return isMedia$2(selectedNode)?deleteElement(editor,forward,selectedNode):Optional.none();};var backspaceDelete$1=function backspaceDelete$1(editor,forward){return editor.selection.isCollapsed()?deleteCaret(editor,forward):deleteRange(editor,forward);};var isEditable$1=function isEditable$1(target){return closest$4(target,function(elm){return isContentEditableTrue$5(elm.dom)||isContentEditableFalse$b(elm.dom);}).exists(function(elm){return isContentEditableTrue$5(elm.dom);});};var parseIndentValue=function parseIndentValue(value){var number=parseInt(value,10);return isNaN(number)?0:number;};var getIndentStyleName=function getIndentStyleName(useMargin,element){var indentStyleName=useMargin||isTable$2(element)?'margin':'padding';var suffix=get$7(element,'direction')==='rtl'?'-right':'-left';return indentStyleName+suffix;};var indentElement=function indentElement(dom,command,useMargin,value,unit,element){var indentStyleName=getIndentStyleName(useMargin,SugarElement.fromDom(element));if(command==='outdent'){var styleValue=Math.max(0,parseIndentValue(element.style[indentStyleName])-value);dom.setStyle(element,indentStyleName,styleValue?styleValue+unit:'');}else{var _styleValue=parseIndentValue(element.style[indentStyleName])+value+unit;dom.setStyle(element,indentStyleName,_styleValue);}};var validateBlocks=function validateBlocks(editor,blocks){return forall(blocks,function(block){var indentStyleName=getIndentStyleName(shouldIndentUseMargin(editor),block);var intentValue=getRaw$1(block,indentStyleName).map(parseIndentValue).getOr(0);var contentEditable=editor.dom.getContentEditable(block.dom);return contentEditable!=='false'&&intentValue>0;});};var canOutdent=function canOutdent(editor){var blocks=getBlocksToIndent(editor);return!editor.mode.isReadOnly()&&(blocks.length>1||validateBlocks(editor,blocks));};var isListComponent=function isListComponent(el){return isList(el)||isListItem(el);};var parentIsListComponent=function parentIsListComponent(el){return parent(el).exists(isListComponent);};var getBlocksToIndent=function getBlocksToIndent(editor){return filter$6(fromDom$1(editor.selection.getSelectedBlocks()),function(el){return!isListComponent(el)&&!parentIsListComponent(el)&&isEditable$1(el);});};var handle=function handle(editor,command){var dom=editor.dom;var indentation=getIndentation(editor);var indentUnit=/[a-z%]+$/i.exec(indentation)[0];var indentValue=parseInt(indentation,10);var useMargin=shouldIndentUseMargin(editor);each$f(getBlocksToIndent(editor),function(block){indentElement(dom,command,useMargin,indentValue,indentUnit,block.dom);});};var indent=function indent(editor){return handle(editor,'indent');};var outdent=function outdent(editor){return handle(editor,'outdent');};var backspaceDelete=function backspaceDelete(editor){if(editor.selection.isCollapsed()&&canOutdent(editor)){var _dom=editor.dom;var rng=editor.selection.getRng();var pos=CaretPosition.fromRangeStart(rng);var block=_dom.getParent(rng.startContainer,_dom.isBlock);if(block!==null&&isAtStartOfBlock(SugarElement.fromDom(block),pos)){return Optional.some(function(){return outdent(editor);});}}return Optional.none();};var findAction=function findAction(editor,caret,forward){return findMap([backspaceDelete,backspaceDelete$5,backspaceDelete$6,function(editor,forward){return backspaceDelete$3(editor,caret,forward);},backspaceDelete$8,backspaceDelete$9,backspaceDelete$4,backspaceDelete$1,backspaceDelete$7,backspaceDelete$2],function(item){return item(editor,forward);});};var deleteCommand=function deleteCommand(editor,caret){var result=findAction(editor,caret,false);result.fold(function(){execDeleteCommand(editor);paddEmptyBody(editor);},call);};var forwardDeleteCommand=function forwardDeleteCommand(editor,caret){var result=findAction(editor,caret,true);result.fold(function(){return execForwardDeleteCommand(editor);},call);};var setup$p=function setup$p(editor,caret){editor.addCommand('delete',function(){deleteCommand(editor,caret);});editor.addCommand('forwardDelete',function(){forwardDeleteCommand(editor,caret);});};var SIGNIFICANT_MOVE=5;var LONGPRESS_DELAY=400;var getTouch=function getTouch(event){if(event.touches===undefined||event.touches.length!==1){return Optional.none();}return Optional.some(event.touches[0]);};var isFarEnough=function isFarEnough(touch,data){var distX=Math.abs(touch.clientX-data.x);var distY=Math.abs(touch.clientY-data.y);return distX>SIGNIFICANT_MOVE||distY>SIGNIFICANT_MOVE;};var setup$o=function setup$o(editor){var startData=value$2();var longpressFired=Cell(false);var debounceLongpress=last$1(function(e){editor.dispatch('longpress',_objectSpread({},e,{type:'longpress'}));longpressFired.set(true);},LONGPRESS_DELAY);editor.on('touchstart',function(e){getTouch(e).each(function(touch){debounceLongpress.cancel();var data={x:touch.clientX,y:touch.clientY,target:e.target};debounceLongpress.throttle(e);longpressFired.set(false);startData.set(data);});},true);editor.on('touchmove',function(e){debounceLongpress.cancel();getTouch(e).each(function(touch){startData.on(function(data){if(isFarEnough(touch,data)){startData.clear();longpressFired.set(false);editor.dispatch('longpresscancel');}});});},true);editor.on('touchend touchcancel',function(e){debounceLongpress.cancel();if(e.type==='touchcancel'){return;}startData.get().filter(function(data){return data.target.isEqualNode(e.target);}).each(function(){if(longpressFired.get()){e.preventDefault();}else{editor.dispatch('tap',_objectSpread({},e,{type:'tap'}));}});},true);};var isBlockElement=function isBlockElement(blockElements,node){return has$2(blockElements,node.nodeName);};var isValidTarget=function isValidTarget(blockElements,node){if(isText$9(node)){return true;}else if(isElement$6(node)){return!isBlockElement(blockElements,node)&&!isBookmarkNode$1(node);}else{return false;}};var hasBlockParent=function hasBlockParent(blockElements,root,node){return exists(parents(SugarElement.fromDom(node),SugarElement.fromDom(root)),function(elm){return isBlockElement(blockElements,elm.dom);});};var shouldRemoveTextNode=function shouldRemoveTextNode(blockElements,node){if(isText$9(node)){if(node.nodeValue.length===0){return true;}else if(/^\s+$/.test(node.nodeValue)&&(!node.nextSibling||isBlockElement(blockElements,node.nextSibling))){return true;}}return false;};var createRootBlock=function createRootBlock(editor){return editor.dom.create(getForcedRootBlock(editor),getForcedRootBlockAttrs(editor));};var addRootBlocks=function addRootBlocks(editor){var dom=editor.dom,selection=editor.selection;var schema=editor.schema,blockElements=schema.getBlockElements();var node=selection.getStart();var rootNode=editor.getBody();var rootBlockNode,tempNode,wrapped;var forcedRootBlock=getForcedRootBlock(editor);if(!node||!isElement$6(node)){return;}var rootNodeName=rootNode.nodeName.toLowerCase();if(!schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())||hasBlockParent(blockElements,rootNode,node)){return;}var rng=selection.getRng();var startContainer=rng.startContainer;var startOffset=rng.startOffset;var endContainer=rng.endContainer;var endOffset=rng.endOffset;var restoreSelection=_hasFocus(editor);node=rootNode.firstChild;while(node){if(isValidTarget(blockElements,node)){if(shouldRemoveTextNode(blockElements,node)){tempNode=node;node=node.nextSibling;dom.remove(tempNode);continue;}if(!rootBlockNode){rootBlockNode=createRootBlock(editor);node.parentNode.insertBefore(rootBlockNode,node);wrapped=true;}tempNode=node;node=node.nextSibling;rootBlockNode.appendChild(tempNode);}else{rootBlockNode=null;node=node.nextSibling;}}if(wrapped&&restoreSelection){rng.setStart(startContainer,startOffset);rng.setEnd(endContainer,endOffset);selection.setRng(rng);editor.nodeChanged();}};var insertEmptyLine=function insertEmptyLine(editor,root,insertBlock){var block=SugarElement.fromDom(createRootBlock(editor));var br=createPaddingBr();append$1(block,br);insertBlock(root,block);var rng=document.createRange();rng.setStartBefore(br.dom);rng.setEndBefore(br.dom);return rng;};var setup$n=function setup$n(editor){editor.on('NodeChange',curry(addRootBlocks,editor));};var hasClass=function hasClass(checkClassName){return function(node){return(' '+node.attr('class')+' ').indexOf(checkClassName)!==-1;};};var replaceMatchWithSpan=function replaceMatchWithSpan(editor,content,cls){return function(match){var args=arguments,index=args[args.length-2];var prevChar=index>0?content.charAt(index-1):'';if(prevChar==='"'){return match;}if(prevChar==='>'){var findStartTagIndex=content.lastIndexOf('<',index);if(findStartTagIndex!==-1){var tagHtml=content.substring(findStartTagIndex,index);if(tagHtml.indexOf('contenteditable="false"')!==-1){return match;}}}return'<span class="'+cls+'" data-mce-content="'+editor.dom.encode(args[0])+'">'+editor.dom.encode(typeof args[1]==='string'?args[1]:args[0])+'</span>';};};var convertRegExpsToNonEditable=function convertRegExpsToNonEditable(editor,nonEditableRegExps,e){var i=nonEditableRegExps.length,content=e.content;if(e.format==='raw'){return;}while(i--){content=content.replace(nonEditableRegExps[i],replaceMatchWithSpan(editor,content,getNonEditableClass(editor)));}e.content=content;};var setup$m=function setup$m(editor){var contentEditableAttrName='contenteditable';var editClass=' '+Tools.trim(getEditableClass(editor))+' ';var nonEditClass=' '+Tools.trim(getNonEditableClass(editor))+' ';var hasEditClass=hasClass(editClass);var hasNonEditClass=hasClass(nonEditClass);var nonEditableRegExps=getNonEditableRegExps(editor);if(nonEditableRegExps.length>0){editor.on('BeforeSetContent',function(e){convertRegExpsToNonEditable(editor,nonEditableRegExps,e);});}editor.parser.addAttributeFilter('class',function(nodes){var i=nodes.length;while(i--){var _node15=nodes[i];if(hasEditClass(_node15)){_node15.attr(contentEditableAttrName,'true');}else if(hasNonEditClass(_node15)){_node15.attr(contentEditableAttrName,'false');}}});editor.serializer.addAttributeFilter(contentEditableAttrName,function(nodes){var i=nodes.length;while(i--){var _node16=nodes[i];if(!hasEditClass(_node16)&&!hasNonEditClass(_node16)){continue;}if(nonEditableRegExps.length>0&&_node16.attr('data-mce-content')){_node16.name='#text';_node16.type=3;_node16.raw=true;_node16.value=_node16.attr('data-mce-content');}else{_node16.attr(contentEditableAttrName,null);}}});};var findBlockCaretContainer=function findBlockCaretContainer(editor){return descendant(SugarElement.fromDom(editor.getBody()),'*[data-mce-caret]').map(function(elm){return elm.dom;}).getOrNull();};var showBlockCaretContainer=function showBlockCaretContainer(editor,blockCaretContainer){if(blockCaretContainer.hasAttribute('data-mce-caret')){showCaretContainerBlock(blockCaretContainer);editor.selection.setRng(editor.selection.getRng());editor.selection.scrollIntoView(blockCaretContainer);}};var handleBlockContainer=function handleBlockContainer(editor,e){var blockCaretContainer=findBlockCaretContainer(editor);if(!blockCaretContainer){return;}if(e.type==='compositionstart'){e.preventDefault();e.stopPropagation();showBlockCaretContainer(editor,blockCaretContainer);return;}if(hasContent(blockCaretContainer)){showBlockCaretContainer(editor,blockCaretContainer);editor.undoManager.add();}};var setup$l=function setup$l(editor){editor.on('keyup compositionstart',curry(handleBlockContainer,editor));};var isContentEditableFalse$3=isContentEditableFalse$b;var moveToCeFalseHorizontally=function moveToCeFalseHorizontally(direction,editor,range){return moveHorizontally(editor,direction,range,isBeforeContentEditableFalse,isAfterContentEditableFalse,isContentEditableFalse$3);};var moveToCeFalseVertically=function moveToCeFalseVertically(direction,editor,range){var isBefore=function isBefore(caretPosition){return isBeforeContentEditableFalse(caretPosition)||isBeforeTable(caretPosition);};var isAfter=function isAfter(caretPosition){return isAfterContentEditableFalse(caretPosition)||isAfterTable(caretPosition);};return moveVertically(editor,direction,range,isBefore,isAfter,isContentEditableFalse$3);};var createTextBlock=function createTextBlock(editor){var textBlock=editor.dom.create(getForcedRootBlock(editor));textBlock.innerHTML='<br data-mce-bogus="1">';return textBlock;};var exitPreBlock=function exitPreBlock(editor,direction,range){var caretWalker=CaretWalker(editor.getBody());var getVisualCaretPosition$1=curry(getVisualCaretPosition,direction===1?caretWalker.next:caretWalker.prev);if(range.collapsed){var pre=editor.dom.getParent(range.startContainer,'PRE');if(!pre){return;}var caretPos=getVisualCaretPosition$1(CaretPosition.fromRangeStart(range));if(!caretPos){var newBlock=SugarElement.fromDom(createTextBlock(editor));if(direction===1){after$4(SugarElement.fromDom(pre),newBlock);}else{before$3(SugarElement.fromDom(pre),newBlock);}editor.selection.select(newBlock.dom,true);editor.selection.collapse();}}};var getHorizontalRange=function getHorizontalRange(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards;var range=editor.selection.getRng();return moveToCeFalseHorizontally(direction,editor,range).orThunk(function(){exitPreBlock(editor,direction,range);return Optional.none();});};var getVerticalRange=function getVerticalRange(editor,down){var direction=down?1:-1;var range=editor.selection.getRng();return moveToCeFalseVertically(direction,editor,range).orThunk(function(){exitPreBlock(editor,direction,range);return Optional.none();});};var moveH$2=function moveH$2(editor,forward){return getHorizontalRange(editor,forward).exists(function(newRange){moveToRange(editor,newRange);return true;});};var moveV$3=function moveV$3(editor,down){return getVerticalRange(editor,down).exists(function(newRange){moveToRange(editor,newRange);return true;});};var moveToLineEndPoint$1=function moveToLineEndPoint$1(editor,forward){var isCefPosition=forward?isAfterContentEditableFalse:isBeforeContentEditableFalse;return moveToLineEndPoint$3(editor,forward,isCefPosition);};var selectToEndPoint=function selectToEndPoint(editor,forward){return getEdgeCefPosition(editor,!forward).map(function(pos){var rng=pos.toRange();var curRng=editor.selection.getRng();if(forward){rng.setStart(curRng.startContainer,curRng.startOffset);}else{rng.setEnd(curRng.endContainer,curRng.endOffset);}return rng;}).exists(function(rng){moveToRange(editor,rng);return true;});};var isTarget=function isTarget(node){return contains$2(['figcaption'],name(node));};var getClosestTargetBlock=function getClosestTargetBlock(pos,root){var isRoot=curry(eq,root);return closest$4(SugarElement.fromDom(pos.container()),isBlock$2,isRoot).filter(isTarget);};var isAtFirstOrLastLine=function isAtFirstOrLastLine(root,forward,pos){return forward?isAtLastLine(root.dom,pos):isAtFirstLine(root.dom,pos);};var moveCaretToNewEmptyLine=function moveCaretToNewEmptyLine(editor,forward){var root=SugarElement.fromDom(editor.getBody());var pos=CaretPosition.fromRangeStart(editor.selection.getRng());return getClosestTargetBlock(pos,root).exists(function(){if(isAtFirstOrLastLine(root,forward,pos)){var insertFn=forward?append$1:prepend;var rng=insertEmptyLine(editor,root,insertFn);editor.selection.setRng(rng);return true;}else{return false;}});};var moveV$2=function moveV$2(editor,forward){if(editor.selection.isCollapsed()){return moveCaretToNewEmptyLine(editor,forward);}else{return false;}};var baseKeyPattern={shiftKey:false,altKey:false,ctrlKey:false,metaKey:false,keyCode:0};var defaultPatterns=function defaultPatterns(patterns){return map$3(patterns,function(pattern){return _objectSpread({},baseKeyPattern,{action:noop},pattern);});};var defaultDelayedPatterns=function defaultDelayedPatterns(patterns){return map$3(patterns,function(pattern){return _objectSpread({},baseKeyPattern,{action:function action(){return Optional.none();}},pattern);});};var matchesEvent=function matchesEvent(pattern,evt){return evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey;};var match$1=function match$1(patterns,evt){return bind$3(defaultPatterns(patterns),function(pattern){return matchesEvent(pattern,evt)?[pattern]:[];});};var matchDelayed=function matchDelayed(patterns,evt){return bind$3(defaultDelayedPatterns(patterns),function(pattern){return matchesEvent(pattern,evt)?[pattern]:[];});};var action=function action(f){for(var _len15=arguments.length,x=new Array(_len15>1?_len15-1:0),_key15=1;_key15<_len15;_key15++){x[_key15-1]=arguments[_key15];}return function(){return f.apply(null,x);};};var execute=function execute(patterns,evt){return find$2(match$1(patterns,evt),function(pattern){return pattern.action();});};var executeWithDelayedAction=function executeWithDelayedAction(patterns,evt){return findMap(matchDelayed(patterns,evt),function(pattern){return pattern.action();});};var moveH$1=function moveH$1(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards;var range=editor.selection.getRng();return moveHorizontally(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists(function(newRange){moveToRange(editor,newRange);return true;});};var moveV$1=function moveV$1(editor,down){var direction=down?1:-1;var range=editor.selection.getRng();return moveVertically(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists(function(newRange){moveToRange(editor,newRange);return true;});};var moveToLineEndPoint=function moveToLineEndPoint(editor,forward){var isNearMedia=forward?isAfterMedia:isBeforeMedia;return moveToLineEndPoint$3(editor,forward,isNearMedia);};var adt=Adt.generate([{none:['current']},{first:['current']},{middle:['current','target']},{last:['current']}]);var none=function none(current){return adt.none(current);};var CellLocation=_objectSpread({},adt,{none:none});var firstLayer=function firstLayer(scope,selector){return filterFirstLayer(scope,selector,always);};var filterFirstLayer=function filterFirstLayer(scope,selector,predicate){return bind$3(children(scope),function(x){if(is$1(x,selector)){return predicate(x)?[x]:[];}else{return filterFirstLayer(x,selector,predicate);}});};var lookup$1=function lookup$1(tags,element){var isRoot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:never;if(isRoot(element)){return Optional.none();}if(contains$2(tags,name(element))){return Optional.some(element);}var isRootOrUpperTable=function isRootOrUpperTable(elm){return is$1(elm,'table')||isRoot(elm);};return ancestor$2(element,tags.join(','),isRootOrUpperTable);};var cell=function cell(element,isRoot){return lookup$1(['td','th'],element,isRoot);};var cells=function cells(ancestor){return firstLayer(ancestor,'th,td');};var table=function table(element,isRoot){return closest$3(element,'table',isRoot);};var walk=function walk(all,current,index,direction){var isEligible=arguments.length>4&&arguments[4]!==undefined?arguments[4]:always;var forwards=direction===1;if(!forwards&&index<=0){return CellLocation.first(all[0]);}else if(forwards&&index>=all.length-1){return CellLocation.last(all[all.length-1]);}else{var newIndex=index+direction;var elem=all[newIndex];return isEligible(elem)?CellLocation.middle(current,elem):walk(all,current,newIndex,direction,isEligible);}};var detect=function detect(current,isRoot){return table(current,isRoot).bind(function(table){var all=cells(table);var index=findIndex$2(all,function(x){return eq(current,x);});return index.map(function(index){return{index:index,all:all};});});};var next=function next(current,isEligible,isRoot){var detection=detect(current,isRoot);return detection.fold(function(){return CellLocation.none(current);},function(info){return walk(info.all,current,info.index,1,isEligible);});};var prev=function prev(current,isEligible,isRoot){var detection=detect(current,isRoot);return detection.fold(function(){return CellLocation.none();},function(info){return walk(info.all,current,info.index,-1,isEligible);});};var closest=function closest(target){return closest$3(target,'[contenteditable]');};var isEditable=function isEditable(element){var assumeEditable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(inBody(element)){return element.dom.isContentEditable;}else{return closest(element).fold(constant(assumeEditable),function(editable){return getRaw(editable)==='true';});}};var getRaw=function getRaw(element){return element.dom.contentEditable;};var deflate=function deflate(rect,delta){return{left:rect.left-delta,top:rect.top-delta,right:rect.right+delta*2,bottom:rect.bottom+delta*2,width:rect.width+delta,height:rect.height+delta};};var getCorners=function getCorners(getYAxisValue,tds){return bind$3(tds,function(td){var rect=deflate(clone$1(td.getBoundingClientRect()),-1);return[{x:rect.left,y:getYAxisValue(rect),cell:td},{x:rect.right,y:getYAxisValue(rect),cell:td}];});};var findClosestCorner=function findClosestCorner(corners,x,y){return foldl(corners,function(acc,newCorner){return acc.fold(function(){return Optional.some(newCorner);},function(oldCorner){var oldDist=Math.sqrt(Math.abs(oldCorner.x-x)+Math.abs(oldCorner.y-y));var newDist=Math.sqrt(Math.abs(newCorner.x-x)+Math.abs(newCorner.y-y));return Optional.some(newDist<oldDist?newCorner:oldCorner);});},Optional.none());};var getClosestCell=function getClosestCell(getYAxisValue,isTargetCorner,table,x,y){var cells=descendants(SugarElement.fromDom(table),'td,th,caption').map(function(e){return e.dom;});var corners=filter$6(getCorners(getYAxisValue,cells),function(corner){return isTargetCorner(corner,y);});return findClosestCorner(corners,x,y).map(function(corner){return corner.cell;});};var getBottomValue=function getBottomValue(rect){return rect.bottom;};var getTopValue=function getTopValue(rect){return rect.top;};var isAbove=function isAbove(corner,y){return corner.y<y;};var isBelow=function isBelow(corner,y){return corner.y>y;};var getClosestCellAbove=curry(getClosestCell,getBottomValue,isAbove);var getClosestCellBelow=curry(getClosestCell,getTopValue,isBelow);var findClosestPositionInAboveCell=function findClosestPositionInAboveCell(table,pos){return head(pos.getClientRects()).bind(function(rect){return getClosestCellAbove(table,rect.left,rect.top);}).bind(function(cell){return findClosestHorizontalPosition(getLastLinePositions(cell),pos);});};var findClosestPositionInBelowCell=function findClosestPositionInBelowCell(table,pos){return last$3(pos.getClientRects()).bind(function(rect){return getClosestCellBelow(table,rect.left,rect.top);}).bind(function(cell){return findClosestHorizontalPosition(getFirstLinePositions(cell),pos);});};var hasNextBreak=function hasNextBreak(getPositionsUntil,scope,lineInfo){return lineInfo.breakAt.exists(function(breakPos){return getPositionsUntil(scope,breakPos).breakAt.isSome();});};var startsWithWrapBreak=function startsWithWrapBreak(lineInfo){return lineInfo.breakType===BreakType.Wrap&&lineInfo.positions.length===0;};var startsWithBrBreak=function startsWithBrBreak(lineInfo){return lineInfo.breakType===BreakType.Br&&lineInfo.positions.length===1;};var isAtTableCellLine=function isAtTableCellLine(getPositionsUntil,scope,pos){var lineInfo=getPositionsUntil(scope,pos);if(startsWithWrapBreak(lineInfo)||!isBr$6(pos.getNode())&&startsWithBrBreak(lineInfo)){return!hasNextBreak(getPositionsUntil,scope,lineInfo);}else{return lineInfo.breakAt.isNone();}};var isAtFirstTableCellLine=curry(isAtTableCellLine,getPositionsUntilPreviousLine);var isAtLastTableCellLine=curry(isAtTableCellLine,getPositionsUntilNextLine);var isCaretAtStartOrEndOfTable=function isCaretAtStartOrEndOfTable(forward,rng,table){var caretPos=CaretPosition.fromRangeStart(rng);return positionIn(!forward,table).exists(function(pos){return pos.isEqual(caretPos);});};var navigateHorizontally=function navigateHorizontally(editor,forward,table,_td){var rng=editor.selection.getRng();var direction=forward?1:-1;if(isFakeCaretTableBrowser()&&isCaretAtStartOrEndOfTable(forward,rng,table)){showCaret(direction,editor,table,!forward,false).each(function(newRng){moveToRange(editor,newRng);});return true;}return false;};var getClosestAbovePosition=function getClosestAbovePosition(root,table,start){return findClosestPositionInAboveCell(table,start).orThunk(function(){return head(start.getClientRects()).bind(function(rect){return findClosestHorizontalPositionFromPoint(getPositionsAbove(root,CaretPosition.before(table)),rect.left);});}).getOr(CaretPosition.before(table));};var getClosestBelowPosition=function getClosestBelowPosition(root,table,start){return findClosestPositionInBelowCell(table,start).orThunk(function(){return head(start.getClientRects()).bind(function(rect){return findClosestHorizontalPositionFromPoint(getPositionsBelow(root,CaretPosition.after(table)),rect.left);});}).getOr(CaretPosition.after(table));};var getTable=function getTable(previous,pos){var node=pos.getNode(previous);return isTable$3(node)?Optional.some(node):Optional.none();};var renderBlock=function renderBlock(down,editor,table){editor.undoManager.transact(function(){var insertFn=down?after$4:before$3;var rng=insertEmptyLine(editor,SugarElement.fromDom(table),insertFn);moveToRange(editor,rng);});};var moveCaret=function moveCaret(editor,down,pos){var table=down?getTable(true,pos):getTable(false,pos);var last=down===false;table.fold(function(){return moveToRange(editor,pos.toRange());},function(table){return positionIn(last,editor.getBody()).filter(function(lastPos){return lastPos.isEqual(pos);}).fold(function(){return moveToRange(editor,pos.toRange());},function(_){return renderBlock(down,editor,table);});});};var navigateVertically=function navigateVertically(editor,down,table,td){var rng=editor.selection.getRng();var pos=CaretPosition.fromRangeStart(rng);var root=editor.getBody();if(!down&&isAtFirstTableCellLine(td,pos)){var newPos=getClosestAbovePosition(root,table,pos);moveCaret(editor,down,newPos);return true;}else if(down&&isAtLastTableCellLine(td,pos)){var _newPos=getClosestBelowPosition(root,table,pos);moveCaret(editor,down,_newPos);return true;}else{return false;}};var move$1=function move$1(editor,forward,mover){return Optional.from(editor.dom.getParent(editor.selection.getNode(),'td,th')).bind(function(td){return Optional.from(editor.dom.getParent(td,'table')).map(function(table){return mover(editor,forward,table,td);});}).getOr(false);};var moveH=function moveH(editor,forward){return move$1(editor,forward,navigateHorizontally);};var moveV=function moveV(editor,forward){return move$1(editor,forward,navigateVertically);};var getCellFirstCursorPosition=function getCellFirstCursorPosition(cell){var selection=SimSelection.exact(cell,0,cell,0);return toNative(selection);};var tabGo=function tabGo(editor,isRoot,cell){return cell.fold(Optional.none,Optional.none,function(_current,next){return first(next).map(function(cell){return getCellFirstCursorPosition(cell);});},function(current){editor.execCommand('mceTableInsertRowAfter');return tabForward(editor,isRoot,current);});};var tabForward=function tabForward(editor,isRoot,cell){return tabGo(editor,isRoot,next(cell,isEditable));};var tabBackward=function tabBackward(editor,isRoot,cell){return tabGo(editor,isRoot,prev(cell,isEditable));};var handleTab=function handleTab(editor,forward){var rootElements=['table','li','dl'];var body=SugarElement.fromDom(editor.getBody());var isRoot=function isRoot(element){var name$1=name(element);return eq(element,body)||contains$2(rootElements,name$1);};var rng=editor.selection.getRng();var container=SugarElement.fromDom(!forward?rng.startContainer:rng.endContainer);return cell(container,isRoot).map(function(cell){table(cell,isRoot).each(function(table){editor.model.table.clearSelectedCells(table.dom);});editor.selection.collapse(!forward);var navigation=!forward?tabBackward:tabForward;var rng=navigation(editor,isRoot,cell);rng.each(function(range){editor.selection.setRng(range);});return true;}).getOr(false);};var executeKeydownOverride$4=function executeKeydownOverride$4(editor,caret,evt){var isMac=Env.os.isMacOS()||Env.os.isiOS();execute([{keyCode:VK.RIGHT,action:action(moveH$2,editor,true)},{keyCode:VK.LEFT,action:action(moveH$2,editor,false)},{keyCode:VK.UP,action:action(moveV$3,editor,false)},{keyCode:VK.DOWN,action:action(moveV$3,editor,true)}].concat(_toConsumableArray2(isMac?[{keyCode:VK.UP,action:action(selectToEndPoint,editor,false),metaKey:true,shiftKey:true},{keyCode:VK.DOWN,action:action(selectToEndPoint,editor,true),metaKey:true,shiftKey:true}]:[]),[{keyCode:VK.RIGHT,action:action(moveH,editor,true)},{keyCode:VK.LEFT,action:action(moveH,editor,false)},{keyCode:VK.UP,action:action(moveV,editor,false)},{keyCode:VK.DOWN,action:action(moveV,editor,true)},{keyCode:VK.RIGHT,action:action(moveH$1,editor,true)},{keyCode:VK.LEFT,action:action(moveH$1,editor,false)},{keyCode:VK.UP,action:action(moveV$1,editor,false)},{keyCode:VK.DOWN,action:action(moveV$1,editor,true)},{keyCode:VK.RIGHT,action:action(move$2,editor,caret,true)},{keyCode:VK.LEFT,action:action(move$2,editor,caret,false)},{keyCode:VK.RIGHT,ctrlKey:!isMac,altKey:isMac,action:action(moveNextWord,editor,caret)},{keyCode:VK.LEFT,ctrlKey:!isMac,altKey:isMac,action:action(movePrevWord,editor,caret)},{keyCode:VK.UP,action:action(moveV$2,editor,false)},{keyCode:VK.DOWN,action:action(moveV$2,editor,true)}]),evt).each(function(_){evt.preventDefault();});};var setup$k=function setup$k(editor,caret){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride$4(editor,caret,evt);}});};var point=function point(container,offset){return{container:container,offset:offset};};var DOM$7=DOMUtils.DOM;var alwaysNext=function alwaysNext(startNode){return function(node){return startNode===node?-1:0;};};var isBoundary=function isBoundary(dom){return function(node){return dom.isBlock(node)||contains$2(['BR','IMG','HR','INPUT'],node.nodeName)||dom.getContentEditable(node)==='false';};};var textBefore=function textBefore(node,offset,rootNode){if(isText$9(node)&&offset>=0){return Optional.some(point(node,offset));}else{var textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.backwards(node,offset,alwaysNext(node),rootNode)).map(function(prev){return point(prev.container,prev.container.data.length);});}};var textAfter=function textAfter(node,offset,rootNode){if(isText$9(node)&&offset>=node.length){return Optional.some(point(node,offset));}else{var textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.forwards(node,offset,alwaysNext(node),rootNode)).map(function(prev){return point(prev.container,0);});}};var scanLeft=function scanLeft(node,offset,rootNode){if(!isText$9(node)){return Optional.none();}var text=node.textContent;if(offset>=0&&offset<=text.length){return Optional.some(point(node,offset));}else{var textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.backwards(node,offset,alwaysNext(node),rootNode)).bind(function(prev){var prevText=prev.container.data;return scanLeft(prev.container,offset+prevText.length,rootNode);});}};var scanRight=function scanRight(node,offset,rootNode){if(!isText$9(node)){return Optional.none();}var text=node.textContent;if(offset<=text.length){return Optional.some(point(node,offset));}else{var textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.forwards(node,offset,alwaysNext(node),rootNode)).bind(function(next){return scanRight(next.container,offset-text.length,rootNode);});}};var repeatLeft=function repeatLeft(dom,node,offset,process,rootNode){var search=TextSeeker(dom,isBoundary(dom));return Optional.from(search.backwards(node,offset,process,rootNode));};var isValidTextRange=function isValidTextRange(rng){return rng.collapsed&&rng.startContainer.nodeType===3;};var getText=function getText(rng){return rng.toString().replace(/\u00A0/g,' ').replace(/\uFEFF/g,'');};var isWhitespace=function isWhitespace(chr){return chr!==''&&' \xA0\f\n\r\t\x0B'.indexOf(chr)!==-1;};var stripTriggerChar=function stripTriggerChar(text,triggerCh){return text.substring(triggerCh.length);};var findChar=function findChar(text,index,ch){var i;for(i=index-1;i>=0;i--){var _char2=text.charAt(i);if(isWhitespace(_char2)){return Optional.none();}if(_char2===ch){break;}}return Optional.some(i);};var findStart=function findStart(dom,initRange,ch){var minChars=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;if(!isValidTextRange(initRange)){return Optional.none();}var findTriggerChIndex=function findTriggerChIndex(element,offset,text){return findChar(text,offset,ch).getOr(offset);};var root=dom.getParent(initRange.startContainer,dom.isBlock)||dom.getRoot();return repeatLeft(dom,initRange.startContainer,initRange.startOffset,findTriggerChIndex,root).bind(function(spot){var range=initRange.cloneRange();range.setStart(spot.container,spot.offset);range.setEnd(initRange.endContainer,initRange.endOffset);if(range.collapsed){return Optional.none();}var text=getText(range);var triggerCharIndex=text.lastIndexOf(ch);if(triggerCharIndex!==0||stripTriggerChar(text,ch).length<minChars){return Optional.none();}else{return Optional.some({text:stripTriggerChar(text,ch),range:range,triggerChar:ch});}});};var getContext=function getContext(dom,initRange,ch){var minChars=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;return detect$1(SugarElement.fromDom(initRange.startContainer)).fold(function(){return findStart(dom,initRange,ch,minChars);},function(elm){var range=dom.createRng();range.selectNode(elm.dom);var text=getText(range);return Optional.some({range:range,text:stripTriggerChar(text,ch),triggerChar:ch});});};var isText$1=function isText$1(node){return node.nodeType===TEXT;};var isElement=function isElement(node){return node.nodeType===ELEMENT;};var toLast=function toLast(node){if(isText$1(node)){return point(node,node.data.length);}else{var _children2=node.childNodes;return _children2.length>0?toLast(_children2[_children2.length-1]):point(node,_children2.length);}};var toLeaf=function toLeaf(node,offset){var children=node.childNodes;if(children.length>0&&offset<children.length){return toLeaf(children[offset],0);}else if(children.length>0&&isElement(node)&&children.length===offset){return toLast(children[children.length-1]);}else{return point(node,offset);}};var isPreviousCharContent=function isPreviousCharContent(dom,leaf){var root=dom.getParent(leaf.container,dom.isBlock);return repeatLeft(dom,leaf.container,leaf.offset,function(_element,offset){return offset===0?-1:offset;},root).filter(function(spot){var _char3=spot.container.data.charAt(spot.offset-1);return!isWhitespace(_char3);}).isSome();};var isStartOfWord=function isStartOfWord(dom){return function(rng){var leaf=toLeaf(rng.startContainer,rng.startOffset);return!isPreviousCharContent(dom,leaf);};};var getTriggerContext=function getTriggerContext(dom,initRange,database){return findMap(database.triggerChars,function(ch){return getContext(dom,initRange,ch);});};var lookup=function lookup(editor,getDatabase){var database=getDatabase();var rng=editor.selection.getRng();return getTriggerContext(editor.dom,rng,database).bind(function(context){return lookupWithContext(editor,getDatabase,context);});};var lookupWithContext=function lookupWithContext(editor,getDatabase,context){var fetchOptions=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var database=getDatabase();var rng=editor.selection.getRng();var startText=rng.startContainer.nodeValue;var autocompleters=filter$6(database.lookupByChar(context.triggerChar),function(autocompleter){return context.text.length>=autocompleter.minChars&&autocompleter.matches.getOrThunk(function(){return isStartOfWord(editor.dom);})(context.range,startText,context.text);});if(autocompleters.length===0){return Optional.none();}var lookupData=Promise.all(map$3(autocompleters,function(ac){var fetchResult=ac.fetch(context.text,ac.maxResults,fetchOptions);return fetchResult.then(function(results){return{matchText:context.text,items:results,columns:ac.columns,onAction:ac.onAction,highlightOn:ac.highlightOn};});}));return Optional.some({lookupData:lookupData,context:context});};var SimpleResultType;(function(SimpleResultType){SimpleResultType[SimpleResultType['Error']=0]='Error';SimpleResultType[SimpleResultType['Value']=1]='Value';})(SimpleResultType||(SimpleResultType={}));var fold$1=function fold$1(res,onError,onValue){return res.stype===SimpleResultType.Error?onError(res.serror):onValue(res.svalue);};var partition=function partition(results){var values=[];var errors=[];each$f(results,function(obj){fold$1(obj,function(err){return errors.push(err);},function(val){return values.push(val);});});return{values:values,errors:errors};};var mapError=function mapError(res,f){if(res.stype===SimpleResultType.Error){return{stype:SimpleResultType.Error,serror:f(res.serror)};}else{return res;}};var map=function map(res,f){if(res.stype===SimpleResultType.Value){return{stype:SimpleResultType.Value,svalue:f(res.svalue)};}else{return res;}};var bind=function bind(res,f){if(res.stype===SimpleResultType.Value){return f(res.svalue);}else{return res;}};var bindError=function bindError(res,f){if(res.stype===SimpleResultType.Error){return f(res.serror);}else{return res;}};var svalue=function svalue(v){return{stype:SimpleResultType.Value,svalue:v};};var serror=function serror(e){return{stype:SimpleResultType.Error,serror:e};};var toResult=function toResult(res){return fold$1(res,Result.error,Result.value);};var fromResult=function fromResult(res){return res.fold(serror,svalue);};var SimpleResult={fromResult:fromResult,toResult:toResult,svalue:svalue,partition:partition,serror:serror,bind:bind,bindError:bindError,map:map,mapError:mapError,fold:fold$1};var formatObj=function formatObj(input){return isObject(input)&&keys(input).length>100?' removed due to size':JSON.stringify(input,null,2);};var formatErrors=function formatErrors(errors){var es=errors.length>10?errors.slice(0,10).concat([{path:[],getErrorInfo:constant('... (only showing first ten failures)')}]):errors;return map$3(es,function(e){return'Failed path: ('+e.path.join(' > ')+')\n'+e.getErrorInfo();});};var nu=function nu(path,getErrorInfo){return SimpleResult.serror([{path:path,getErrorInfo:getErrorInfo}]);};var missingRequired=function missingRequired(path,key,obj){return nu(path,function(){return'Could not find valid *required* value for "'+key+'" in '+formatObj(obj);});};var missingKey=function missingKey(path,key){return nu(path,function(){return'Choice schema did not contain choice key: "'+key+'"';});};var missingBranch=function missingBranch(path,branches,branch){return nu(path,function(){return'The chosen schema: "'+branch+'" did not exist in branches: '+formatObj(branches);});};var custom=function custom(path,err){return nu(path,constant(err));};var chooseFrom=function chooseFrom(path,input,branches,ch){var fields=get$a(branches,ch);return fields.fold(function(){return missingBranch(path,branches,ch);},function(vp){return vp.extract(path.concat(['branch: '+ch]),input);});};var choose$1=function choose$1(key,branches){var extract=function extract(path,input){var choice=get$a(input,key);return choice.fold(function(){return missingKey(path,key);},function(chosen){return chooseFrom(path,input,branches,chosen);});};var toString=function toString(){return'chooseOn('+key+'). Possible values: '+keys(branches);};return{extract:extract,toString:toString};};var shallow=function shallow(old,nu){return nu;};var deep=function deep(old,nu){var bothObjects=isPlainObject(old)&&isPlainObject(nu);return bothObjects?deepMerge(old,nu):nu;};var baseMerge=function baseMerge(merger){return function(){if(arguments.length===0){throw new Error("Can't merge zero objects");}var ret={};for(var j=0;j<arguments.length;j++){var curObject=j<0||arguments.length<=j?undefined:arguments[j];for(var key in curObject){if(has$2(curObject,key)){ret[key]=merger(ret[key],curObject[key]);}}}return ret;};};var deepMerge=baseMerge(deep);var merge=baseMerge(shallow);var required=function required(){return{tag:'required',process:{}};};var defaultedThunk=function defaultedThunk(fallbackThunk){return{tag:'defaultedThunk',process:fallbackThunk};};var defaulted$1=function defaulted$1(fallback){return defaultedThunk(constant(fallback));};var asOption=function asOption(){return{tag:'option',process:{}};};var mergeValues=function mergeValues(values,base){return values.length>0?SimpleResult.svalue(deepMerge(base,merge.apply(undefined,values))):SimpleResult.svalue(base);};var mergeErrors=function mergeErrors(errors){return compose(SimpleResult.serror,flatten)(errors);};var consolidateObj=function consolidateObj(objects,base){var partition=SimpleResult.partition(objects);return partition.errors.length>0?mergeErrors(partition.errors):mergeValues(partition.values,base);};var consolidateArr=function consolidateArr(objects){var partitions=SimpleResult.partition(objects);return partitions.errors.length>0?mergeErrors(partitions.errors):SimpleResult.svalue(partitions.values);};var ResultCombine={consolidateObj:consolidateObj,consolidateArr:consolidateArr};var field$1=function field$1(key,newKey,presence,prop){return{tag:'field',key:key,newKey:newKey,presence:presence,prop:prop};};var customField$1=function customField$1(newKey,instantiator){return{tag:'custom',newKey:newKey,instantiator:instantiator};};var fold=function fold(value,ifField,ifCustom){switch(value.tag){case'field':return ifField(value.key,value.newKey,value.presence,value.prop);case'custom':return ifCustom(value.newKey,value.instantiator);}};var value=function value(validator){var extract=function extract(path,val){return SimpleResult.bindError(validator(val),function(err){return custom(path,err);});};var toString=constant('val');return{extract:extract,toString:toString};};var anyValue$1=value(SimpleResult.svalue);var requiredAccess=function requiredAccess(path,obj,key,bundle){return get$a(obj,key).fold(function(){return missingRequired(path,key,obj);},bundle);};var fallbackAccess=function fallbackAccess(obj,key,fallback,bundle){var v=get$a(obj,key).getOrThunk(function(){return fallback(obj);});return bundle(v);};var optionAccess=function optionAccess(obj,key,bundle){return bundle(get$a(obj,key));};var optionDefaultedAccess=function optionDefaultedAccess(obj,key,fallback,bundle){var opt=get$a(obj,key).map(function(val){return val===true?fallback(obj):val;});return bundle(opt);};var extractField=function extractField(field,path,obj,key,prop){var bundle=function bundle(av){return prop.extract(path.concat([key]),av);};var bundleAsOption=function bundleAsOption(optValue){return optValue.fold(function(){return SimpleResult.svalue(Optional.none());},function(ov){var result=prop.extract(path.concat([key]),ov);return SimpleResult.map(result,Optional.some);});};switch(field.tag){case'required':return requiredAccess(path,obj,key,bundle);case'defaultedThunk':return fallbackAccess(obj,key,field.process,bundle);case'option':return optionAccess(obj,key,bundleAsOption);case'defaultedOptionThunk':return optionDefaultedAccess(obj,key,field.process,bundleAsOption);case'mergeWithThunk':{return fallbackAccess(obj,key,constant({}),function(v){var result=deepMerge(field.process(obj),v);return bundle(result);});}}};var extractFields=function extractFields(path,obj,fields){var success={};var errors=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=fields[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _field=_step3.value;fold(_field,function(key,newKey,presence,prop){var result=extractField(presence,path,obj,key,prop);SimpleResult.fold(result,function(err){errors.push.apply(errors,_toConsumableArray2(err));},function(res){success[newKey]=res;});},function(newKey,instantiator){success[newKey]=instantiator(obj);});}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]!=null){_iterator3["return"]();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}return errors.length>0?SimpleResult.serror(errors):SimpleResult.svalue(success);};var objOf=function objOf(values){var extract=function extract(path,o){return extractFields(path,o,values);};var toString=function toString(){var fieldStrings=map$3(values,function(value){return fold(value,function(key,_okey,_presence,prop){return key+' -> '+prop.toString();},function(newKey,_instantiator){return'state('+newKey+')';});});return'obj{\n'+fieldStrings.join('\n')+'}';};return{extract:extract,toString:toString};};var arrOf=function arrOf(prop){var extract=function extract(path,array){var results=map$3(array,function(a,i){return prop.extract(path.concat(['['+i+']']),a);});return ResultCombine.consolidateArr(results);};var toString=function toString(){return'array('+prop.toString()+')';};return{extract:extract,toString:toString};};var valueOf=function valueOf(validator){return value(function(v){return validator(v).fold(SimpleResult.serror,SimpleResult.svalue);});};var extractValue=function extractValue(label,prop,obj){var res=prop.extract([label],obj);return SimpleResult.mapError(res,function(errs){return{input:obj,errors:errs};});};var asRaw=function asRaw(label,prop,obj){return SimpleResult.toResult(extractValue(label,prop,obj));};var formatError=function formatError(errInfo){return'Errors: \n'+formatErrors(errInfo.errors).join('\n')+'\n\nInput object: '+formatObj(errInfo.input);};var choose=function choose(key,branches){return choose$1(key,map$2(branches,objOf));};var anyValue=constant(anyValue$1);var typedValue=function typedValue(validator,expectedType){return value(function(a){var actualType=_typeof2(a);return validator(a)?SimpleResult.svalue(a):SimpleResult.serror("Expected type: ".concat(expectedType," but got: ").concat(actualType));});};var number=typedValue(isNumber,'number');var string=typedValue(isString,'string');var _boolean=typedValue(isBoolean,'boolean');var functionProcessor=typedValue(isFunction,'function');var field=field$1;var customField=customField$1;var validateEnum=function validateEnum(values){return valueOf(function(value){return contains$2(values,value)?Result.value(value):Result.error("Unsupported value: \"".concat(value,"\", choose one of \"").concat(values.join(', '),"\"."));});};var requiredOf=function requiredOf(key,schema){return field(key,key,required(),schema);};var requiredString=function requiredString(key){return requiredOf(key,string);};var requiredFunction=function requiredFunction(key){return requiredOf(key,functionProcessor);};var requiredArrayOf=function requiredArrayOf(key,schema){return field(key,key,required(),arrOf(schema));};var optionOf=function optionOf(key,schema){return field(key,key,asOption(),schema);};var optionString=function optionString(key){return optionOf(key,string);};var optionFunction=function optionFunction(key){return optionOf(key,functionProcessor);};var defaulted=function defaulted(key,fallback){return field(key,key,defaulted$1(fallback),anyValue());};var defaultedOf=function defaultedOf(key,fallback,schema){return field(key,key,defaulted$1(fallback),schema);};var defaultedNumber=function defaultedNumber(key,fallback){return defaultedOf(key,fallback,number);};var defaultedString=function defaultedString(key,fallback){return defaultedOf(key,fallback,string);};var defaultedStringEnum=function defaultedStringEnum(key,fallback,values){return defaultedOf(key,fallback,validateEnum(values));};var defaultedBoolean=function defaultedBoolean(key,fallback){return defaultedOf(key,fallback,_boolean);};var defaultedFunction=function defaultedFunction(key,fallback){return defaultedOf(key,fallback,functionProcessor);};var defaultedArrayOf=function defaultedArrayOf(key,fallback,schema){return defaultedOf(key,fallback,arrOf(schema));};var type=requiredString('type');var fetch$1=requiredFunction('fetch');var onAction=requiredFunction('onAction');var onSetup=defaultedFunction('onSetup',function(){return noop;});var optionalText=optionString('text');var optionalIcon=optionString('icon');var optionalTooltip=optionString('tooltip');var optionalLabel=optionString('label');var active=defaultedBoolean('active',false);var enabled=defaultedBoolean('enabled',true);var primary=defaultedBoolean('primary',false);var defaultedColumns=function defaultedColumns(num){return defaulted('columns',num);};var defaultedType=function defaultedType(type){return defaultedString('type',type);};var autocompleterSchema=objOf([type,requiredString('ch'),defaultedNumber('minChars',1),defaultedColumns(1),defaultedNumber('maxResults',10),optionFunction('matches'),fetch$1,onAction,defaultedArrayOf('highlightOn',[],string)]);var createAutocompleter=function createAutocompleter(spec){return asRaw('Autocompleter',autocompleterSchema,spec);};var baseToolbarButtonFields=[enabled,optionalTooltip,optionalIcon,optionalText,onSetup];var baseToolbarToggleButtonFields=[active].concat(baseToolbarButtonFields);var contextBarFields=[defaultedFunction('predicate',never),defaultedStringEnum('scope','node',['node','editor']),defaultedStringEnum('position','selection',['node','selection','line'])];var contextButtonFields=baseToolbarButtonFields.concat([defaultedType('contextformbutton'),primary,onAction,customField('original',identity)]);var contextToggleButtonFields=baseToolbarToggleButtonFields.concat([defaultedType('contextformbutton'),primary,onAction,customField('original',identity)]);var launchButtonFields=baseToolbarButtonFields.concat([defaultedType('contextformbutton')]);var launchToggleButtonFields=baseToolbarToggleButtonFields.concat([defaultedType('contextformtogglebutton')]);var toggleOrNormal=choose('type',{contextformbutton:contextButtonFields,contextformtogglebutton:contextToggleButtonFields});objOf([defaultedType('contextform'),defaultedFunction('initValue',constant('')),optionalLabel,requiredArrayOf('commands',toggleOrNormal),optionOf('launch',choose('type',{contextformbutton:launchButtonFields,contextformtogglebutton:launchToggleButtonFields}))].concat(contextBarFields));var register$2=function register$2(editor){var popups=editor.ui.registry.getAll().popups;var dataset=map$2(popups,function(popup){return createAutocompleter(popup).fold(function(err){throw new Error(formatError(err));},identity);});var triggerChars=stringArray(mapToArray(dataset,function(v){return v.ch;}));var datasetValues=values(dataset);var lookupByChar=function lookupByChar(ch){return filter$6(datasetValues,function(dv){return dv.ch===ch;});};return{dataset:dataset,triggerChars:triggerChars,lookupByChar:lookupByChar};};var setupEditorInput=function setupEditorInput(editor,api){var update=last$1(api.load,50);editor.on('keypress compositionend',function(e){if(e.which===27){return;}update.throttle();});editor.on('keydown',function(e){var keyCode=e.which;if(keyCode===8){update.throttle();}else if(keyCode===27){api.cancelIfNecessary();}});editor.on('remove',update.cancel);};var setup$j=function setup$j(editor){var activeAutocompleter=value$2();var uiActive=Cell(false);var isActive=activeAutocompleter.isSet;var cancelIfNecessary=function cancelIfNecessary(){if(isActive()){removeAutocompleterDecoration(editor);fireAutocompleterEnd(editor);uiActive.set(false);activeAutocompleter.clear();}};var commenceIfNecessary=function commenceIfNecessary(context){if(!isActive()){addAutocompleterDecoration(editor,context.range);activeAutocompleter.set({triggerChar:context.triggerChar,matchLength:context.text.length});}};var getAutocompleters=cached(function(){return register$2(editor);});var doLookup=function doLookup(fetchOptions){return activeAutocompleter.get().map(function(ac){return getContext(editor.dom,editor.selection.getRng(),ac.triggerChar).bind(function(newContext){return lookupWithContext(editor,getAutocompleters,newContext,fetchOptions);});}).getOrThunk(function(){return lookup(editor,getAutocompleters);});};var load=function load(fetchOptions){doLookup(fetchOptions).fold(cancelIfNecessary,function(lookupInfo){commenceIfNecessary(lookupInfo.context);lookupInfo.lookupData.then(function(lookupData){activeAutocompleter.get().map(function(ac){var context=lookupInfo.context;if(ac.triggerChar===context.triggerChar){if(context.text.length-ac.matchLength>=10){cancelIfNecessary();}else{activeAutocompleter.set(_objectSpread({},ac,{matchLength:context.text.length}));if(uiActive.get()){fireAutocompleterUpdate(editor,{lookupData:lookupData});}else{uiActive.set(true);fireAutocompleterStart(editor,{lookupData:lookupData});}}}});});});};editor.addCommand('mceAutocompleterReload',function(_ui,value){var fetchOptions=isObject(value)?value.fetchOptions:{};load(fetchOptions);});editor.addCommand('mceAutocompleterClose',cancelIfNecessary);setupEditorInput(editor,{cancelIfNecessary:cancelIfNecessary,load:load});};var createAndFireInputEvent=function createAndFireInputEvent(eventType){return function(editor,inputType){var specifics=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var target=editor.getBody();var overrides={bubbles:true,composed:true,data:null,isComposing:false,detail:0,view:null,target:target,currentTarget:target,eventPhase:Event.AT_TARGET,originalTarget:target,explicitOriginalTarget:target,isTrusted:false,srcElement:target,cancelable:false,preventDefault:noop,inputType:inputType};var input=clone$3(new InputEvent(eventType));return editor.dispatch(eventType,_objectSpread({},input,{},overrides,{},specifics));};};var fireFakeInputEvent=createAndFireInputEvent('input');var fireFakeBeforeInputEvent=createAndFireInputEvent('beforeinput');var executeKeydownOverride$3=function executeKeydownOverride$3(editor,caret,evt){var inputType=evt.keyCode===VK.BACKSPACE?'deleteContentBackward':'deleteContentForward';executeWithDelayedAction([{keyCode:VK.BACKSPACE,action:action(backspaceDelete,editor)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$5,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$5,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$6,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$6,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$3,editor,caret,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$3,editor,caret,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$9,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$9,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$4,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$4,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$1,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$1,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$7,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$7,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$8,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$8,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$2,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$2,editor,true)}],evt).each(function(applyAction){evt.preventDefault();var beforeInput=fireFakeBeforeInputEvent(editor,inputType);if(!beforeInput.isDefaultPrevented()){applyAction();fireFakeInputEvent(editor,inputType);}});};var executeKeyupOverride=function executeKeyupOverride(editor,evt){execute([{keyCode:VK.BACKSPACE,action:action(paddEmptyElement,editor)},{keyCode:VK.DELETE,action:action(paddEmptyElement,editor)}],evt);};var setup$i=function setup$i(editor,caret){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride$3(editor,caret,evt);}});editor.on('keyup',function(evt){if(evt.isDefaultPrevented()===false){executeKeyupOverride(editor,evt);}});};var firstNonWhiteSpaceNodeSibling=function firstNonWhiteSpaceNodeSibling(node){while(node){if(node.nodeType===1||node.nodeType===3&&node.data&&/[\r\n\s]/.test(node.data)){return node;}node=node.nextSibling;}};var moveToCaretPosition=function moveToCaretPosition(editor,root){var node,lastNode=root;var dom=editor.dom;var moveCaretBeforeOnEnterElementsMap=editor.schema.getMoveCaretBeforeOnEnterElements();if(!root){return;}if(/^(LI|DT|DD)$/.test(root.nodeName)){var _firstChild=firstNonWhiteSpaceNodeSibling(root.firstChild);if(_firstChild&&/^(UL|OL|DL)$/.test(_firstChild.nodeName)){root.insertBefore(dom.doc.createTextNode(nbsp),root.firstChild);}}var rng=dom.createRng();root.normalize();if(root.hasChildNodes()){var walker=new DomTreeWalker(root,root);while(node=walker.current()){if(isText$9(node)){rng.setStart(node,0);rng.setEnd(node,0);break;}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node);rng.setEndBefore(node);break;}lastNode=node;node=walker.next();}if(!node){rng.setStart(lastNode,0);rng.setEnd(lastNode,0);}}else{if(isBr$6(root)){if(root.nextSibling&&dom.isBlock(root.nextSibling)){rng.setStartBefore(root);rng.setEndBefore(root);}else{rng.setStartAfter(root);rng.setEndAfter(root);}}else{rng.setStart(root,0);rng.setEnd(root,0);}}editor.selection.setRng(rng);scrollRangeIntoView(editor,rng);};var getEditableRoot$1=function getEditableRoot$1(dom,node){var root=dom.getRoot();var parent,editableRoot;parent=node;while(parent!==root&&dom.getContentEditable(parent)!=='false'){if(dom.getContentEditable(parent)==='true'){editableRoot=parent;}parent=parent.parentNode;}return parent!==root?editableRoot:root;};var getParentBlock$1=function getParentBlock$1(editor){return Optional.from(editor.dom.getParent(editor.selection.getStart(true),editor.dom.isBlock));};var getParentBlockName=function getParentBlockName(editor){return getParentBlock$1(editor).fold(constant(''),function(parentBlock){return parentBlock.nodeName.toUpperCase();});};var isListItemParentBlock=function isListItemParentBlock(editor){return getParentBlock$1(editor).filter(function(elm){return isListItem(SugarElement.fromDom(elm));}).isSome();};var hasFirstChild=function hasFirstChild(elm,name){return elm.firstChild&&elm.firstChild.nodeName===name;};var isFirstChild=function isFirstChild(elm){var _a;return((_a=elm.parentNode)===null||_a===void 0?void 0:_a.firstChild)===elm;};var hasParent=function hasParent(elm,parentName){return elm&&elm.parentNode&&elm.parentNode.nodeName===parentName;};var isListBlock=function isListBlock(elm){return elm&&/^(OL|UL|LI)$/.test(elm.nodeName);};var isNestedList=function isNestedList(elm){return isListBlock(elm)&&isListBlock(elm.parentNode);};var getContainerBlock=function getContainerBlock(containerBlock){var containerBlockParent=containerBlock.parentNode;if(/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)){return containerBlockParent;}return containerBlock;};var isFirstOrLastLi=function isFirstOrLastLi(containerBlock,parentBlock,first){var node=containerBlock[first?'firstChild':'lastChild'];while(node){if(isElement$6(node)){break;}node=node[first?'nextSibling':'previousSibling'];}return node===parentBlock;};var insert$3=function insert$3(editor,createNewBlock,containerBlock,parentBlock,newBlockName){var dom=editor.dom;var rng=editor.selection.getRng();if(containerBlock===editor.getBody()){return;}if(isNestedList(containerBlock)){newBlockName='LI';}var newBlock=createNewBlock(newBlockName);if(isFirstOrLastLi(containerBlock,parentBlock,true)&&isFirstOrLastLi(containerBlock,parentBlock,false)){if(hasParent(containerBlock,'LI')){var containerBlockParent=getContainerBlock(containerBlock);dom.insertAfter(newBlock,containerBlockParent);if(isFirstChild(containerBlock)){dom.remove(containerBlockParent);}else{dom.remove(containerBlock);}}else{dom.replace(newBlock,containerBlock);}}else if(isFirstOrLastLi(containerBlock,parentBlock,true)){if(hasParent(containerBlock,'LI')){dom.insertAfter(newBlock,getContainerBlock(containerBlock));newBlock.appendChild(dom.doc.createTextNode(' '));newBlock.appendChild(containerBlock);}else{containerBlock.parentNode.insertBefore(newBlock,containerBlock);}dom.remove(parentBlock);}else if(isFirstOrLastLi(containerBlock,parentBlock,false)){dom.insertAfter(newBlock,getContainerBlock(containerBlock));dom.remove(parentBlock);}else{containerBlock=getContainerBlock(containerBlock);var tmpRng=rng.cloneRange();tmpRng.setStartAfter(parentBlock);tmpRng.setEndAfter(containerBlock);var fragment=tmpRng.extractContents();if(newBlockName==='LI'&&hasFirstChild(fragment,'LI')){newBlock=fragment.firstChild;dom.insertAfter(fragment,containerBlock);}else{dom.insertAfter(fragment,containerBlock);dom.insertAfter(newBlock,containerBlock);}dom.remove(parentBlock);}moveToCaretPosition(editor,newBlock);};var trimZwsp=function trimZwsp(fragment){each$f(descendants$1(SugarElement.fromDom(fragment),isText$a),function(text){var rawNode=text.dom;rawNode.nodeValue=trim$1(rawNode.nodeValue);});};var isEmptyAnchor=function isEmptyAnchor(dom,elm){return elm&&elm.nodeName==='A'&&dom.isEmpty(elm);};var isTableCell=function isTableCell(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName);};var emptyBlock=function emptyBlock(elm){elm.innerHTML='<br data-mce-bogus="1">';};var containerAndSiblingName=function containerAndSiblingName(container,nodeName){return container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName;};var canSplitBlock=function canSplitBlock(dom,node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&dom.getContentEditable(node)!=='true';};var trimInlineElementsOnLeftSideOfBlock=function trimInlineElementsOnLeftSideOfBlock(dom,nonEmptyElementsMap,block){var node=block;var firstChilds=[];var i;if(!node){return;}while(node=node.firstChild){if(dom.isBlock(node)){return;}if(isElement$6(node)&&!nonEmptyElementsMap[node.nodeName.toLowerCase()]){firstChilds.push(node);}}i=firstChilds.length;while(i--){node=firstChilds[i];if(!node.hasChildNodes()||node.firstChild===node.lastChild&&node.firstChild.nodeValue===''){dom.remove(node);}else{if(isEmptyAnchor(dom,node)){dom.remove(node);}}}};var normalizeZwspOffset=function normalizeZwspOffset(start,container,offset){if(isText$9(container)===false){return offset;}else if(start){return offset===1&&container.data.charAt(offset-1)===ZWSP$1?0:offset;}else{return offset===container.data.length-1&&container.data.charAt(offset)===ZWSP$1?container.data.length:offset;}};var includeZwspInRange=function includeZwspInRange(rng){var newRng=rng.cloneRange();newRng.setStart(rng.startContainer,normalizeZwspOffset(true,rng.startContainer,rng.startOffset));newRng.setEnd(rng.endContainer,normalizeZwspOffset(false,rng.endContainer,rng.endOffset));return newRng;};var trimLeadingLineBreaks=function trimLeadingLineBreaks(node){do{if(isText$9(node)){node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,'');}node=node.firstChild;}while(node);};var getEditableRoot=function getEditableRoot(dom,node){var root=dom.getRoot();var parent,editableRoot;parent=node;while(parent!==root&&dom.getContentEditable(parent)!=='false'){if(dom.getContentEditable(parent)==='true'){editableRoot=parent;}parent=parent.parentNode;}return parent!==root?editableRoot:root;};var applyAttributes=function applyAttributes(editor,node,forcedRootBlockAttrs){var dom=editor.dom;Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each(function(attrStyles){var currentStyles=getAllRaw(SugarElement.fromDom(node));var newStyles=_objectSpread({},currentStyles,{},attrStyles);dom.setStyles(node,newStyles);});var attrClassesOpt=Optional.from(forcedRootBlockAttrs["class"]).map(function(attrClasses){return attrClasses.split(/\s+/);});var currentClassesOpt=Optional.from(node.className).map(function(currentClasses){return filter$6(currentClasses.split(/\s+/),function(clazz){return clazz!=='';});});lift2(attrClassesOpt,currentClassesOpt,function(attrClasses,currentClasses){var filteredClasses=filter$6(currentClasses,function(clazz){return!contains$2(attrClasses,clazz);});var newClasses=[].concat(_toConsumableArray2(attrClasses),_toConsumableArray2(filteredClasses));dom.setAttrib(node,'class',newClasses.join(' '));});var appliedAttrs=['style','class'];var remainingAttrs=filter$5(forcedRootBlockAttrs,function(_,attrs){return!contains$2(appliedAttrs,attrs);});dom.setAttribs(node,remainingAttrs);};var setForcedBlockAttrs=function setForcedBlockAttrs(editor,node){var forcedRootBlockName=getForcedRootBlock(editor);if(forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()){var forcedRootBlockAttrs=getForcedRootBlockAttrs(editor);applyAttributes(editor,node,forcedRootBlockAttrs);}};var wrapSelfAndSiblingsInDefaultBlock=function wrapSelfAndSiblingsInDefaultBlock(editor,newBlockName,rng,container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName;var dom=editor.dom,editableRoot=getEditableRoot(dom,container);parentBlock=dom.getParent(container,dom.isBlock);if(!parentBlock||!canSplitBlock(dom,parentBlock)){parentBlock=parentBlock||editableRoot;if(parentBlock===editor.getBody()||isTableCell(parentBlock)){rootBlockName=parentBlock.nodeName.toLowerCase();}else{rootBlockName=parentBlock.parentNode.nodeName.toLowerCase();}if(!parentBlock.hasChildNodes()){newBlock=dom.create(newBlockName);setForcedBlockAttrs(editor,newBlock);parentBlock.appendChild(newBlock);rng.setStart(newBlock,0);rng.setEnd(newBlock,0);return newBlock;}node=container;while(node.parentNode!==parentBlock){node=node.parentNode;}while(node&&!dom.isBlock(node)){startNode=node;node=node.previousSibling;}if(startNode&&editor.schema.isValidChild(rootBlockName,newBlockName.toLowerCase())){newBlock=dom.create(newBlockName);setForcedBlockAttrs(editor,newBlock);startNode.parentNode.insertBefore(newBlock,startNode);node=startNode;while(node&&!dom.isBlock(node)){next=node.nextSibling;newBlock.appendChild(node);node=next;}rng.setStart(container,offset);rng.setEnd(container,offset);}}return container;};var addBrToBlockIfNeeded=function addBrToBlockIfNeeded(dom,block){block.normalize();var lastChild=block.lastChild;if(!lastChild||/^(left|right)$/gi.test(dom.getStyle(lastChild,'float',true))){dom.add(block,'br');}};var shouldEndContainer=function shouldEndContainer(editor,container){var optionValue=shouldEndContainerOnEmptyBlock(editor);if(isNullable(container)){return false;}else if(isString(optionValue)){return contains$2(Tools.explode(optionValue),container.nodeName.toLowerCase());}else{return optionValue;}};var insert$2=function insert$2(editor,evt){var tmpRng,container,offset,parentBlock;var newBlock,fragment,containerBlock,parentBlockName,isAfterLastNodeInContainer;var dom=editor.dom;var schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements();var rng=editor.selection.getRng();var newBlockName=getForcedRootBlock(editor);var createNewBlock=function createNewBlock(name){var node=container,block,clonedNode,caretNode;var textInlineElements=schema.getTextInlineElements();if(name||parentBlockName==='TABLE'||parentBlockName==='HR'){block=dom.create(name||newBlockName);}else{block=parentBlock.cloneNode(false);}caretNode=block;if(shouldKeepStyles(editor)===false){dom.setAttrib(block,'style',null);dom.setAttrib(block,'class',null);}else{do{if(textInlineElements[node.nodeName]){if(isCaretNode(node)||isBookmarkNode$1(node)){continue;}clonedNode=node.cloneNode(false);dom.setAttrib(clonedNode,'id','');if(block.hasChildNodes()){clonedNode.appendChild(block.firstChild);block.appendChild(clonedNode);}else{caretNode=clonedNode;block.appendChild(clonedNode);}}}while((node=node.parentNode)&&node!==editableRoot);}setForcedBlockAttrs(editor,block);emptyBlock(caretNode);return block;};var isCaretAtStartOrEndOfBlock=function isCaretAtStartOrEndOfBlock(start){var node,name;var normalizedOffset=normalizeZwspOffset(start,container,offset);if(isText$9(container)&&(start?normalizedOffset>0:normalizedOffset<container.nodeValue.length)){return false;}if(container.parentNode===parentBlock&&isAfterLastNodeInContainer&&!start){return true;}if(start&&isElement$6(container)&&container===parentBlock.firstChild){return true;}if(containerAndSiblingName(container,'TABLE')||containerAndSiblingName(container,'HR')){return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;}var walker=new DomTreeWalker(container,parentBlock);if(isText$9(container)){if(start&&normalizedOffset===0){walker.prev();}else if(!start&&normalizedOffset===container.nodeValue.length){walker.next();}}while(node=walker.current()){if(isElement$6(node)){if(!node.getAttribute('data-mce-bogus')){name=node.nodeName.toLowerCase();if(nonEmptyElementsMap[name]&&name!=='br'){return false;}}}else if(isText$9(node)&&!isWhitespaceText(node.nodeValue)){return false;}if(start){walker.prev();}else{walker.next();}}return true;};var insertNewBlockAfter=function insertNewBlockAfter(){if(/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&containerBlockName!=='HGROUP'){newBlock=createNewBlock(newBlockName);}else{newBlock=createNewBlock();}if(shouldEndContainer(editor,containerBlock)&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock)){newBlock=dom.split(containerBlock,parentBlock);}else{dom.insertAfter(newBlock,parentBlock);}moveToCaretPosition(editor,newBlock);};normalize$2(dom,rng).each(function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset);rng.setEnd(normRng.endContainer,normRng.endOffset);});container=rng.startContainer;offset=rng.startOffset;var shiftKey=!!(evt&&evt.shiftKey);var ctrlKey=!!(evt&&evt.ctrlKey);if(isElement$6(container)&&container.hasChildNodes()){isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer&&isText$9(container)){offset=container.nodeValue.length;}else{offset=0;}}var editableRoot=getEditableRoot(dom,container);if(!editableRoot){return;}if(!shiftKey){container=wrapSelfAndSiblingsInDefaultBlock(editor,newBlockName,rng,container,offset);}parentBlock=dom.getParent(container,dom.isBlock);containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null;parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():'';var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():'';if(containerBlockName==='LI'&&!ctrlKey){parentBlock=containerBlock;containerBlock=containerBlock.parentNode;parentBlockName=containerBlockName;}if(/^(LI|DT|DD)$/.test(parentBlockName)){if(dom.isEmpty(parentBlock)){insert$3(editor,createNewBlock,containerBlock,parentBlock,newBlockName);return;}}if(parentBlock===editor.getBody()){return;}if(isCaretContainerBlock$1(parentBlock)){newBlock=showCaretContainerBlock(parentBlock);if(dom.isEmpty(parentBlock)){emptyBlock(parentBlock);}setForcedBlockAttrs(editor,newBlock);moveToCaretPosition(editor,newBlock);}else if(isCaretAtStartOrEndOfBlock()){insertNewBlockAfter();}else if(isCaretAtStartOrEndOfBlock(true)){newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock);moveToCaretPosition(editor,containerAndSiblingName(parentBlock,'HR')?newBlock:parentBlock);}else{tmpRng=includeZwspInRange(rng).cloneRange();tmpRng.setEndAfter(parentBlock);fragment=tmpRng.extractContents();trimZwsp(fragment);trimLeadingLineBreaks(fragment);newBlock=fragment.firstChild;dom.insertAfter(fragment,parentBlock);trimInlineElementsOnLeftSideOfBlock(dom,nonEmptyElementsMap,newBlock);addBrToBlockIfNeeded(dom,parentBlock);if(dom.isEmpty(parentBlock)){emptyBlock(parentBlock);}newBlock.normalize();if(dom.isEmpty(newBlock)){dom.remove(newBlock);insertNewBlockAfter();}else{setForcedBlockAttrs(editor,newBlock);moveToCaretPosition(editor,newBlock);}}dom.setAttrib(newBlock,'id','');editor.dispatch('NewBlock',{newBlock:newBlock});};var fakeEventName$1='insertParagraph';var blockbreak={insert:insert$2,fakeEventName:fakeEventName$1};var hasRightSideContent=function hasRightSideContent(schema,container,parentBlock){var walker=new DomTreeWalker(container,parentBlock);var node;var nonEmptyElementsMap=schema.getNonEmptyElements();while(node=walker.next()){if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0){return true;}}};var moveSelectionToBr=function moveSelectionToBr(editor,brElm,extraBr){var rng=editor.dom.createRng();if(!extraBr){rng.setStartAfter(brElm);rng.setEndAfter(brElm);}else{rng.setStartBefore(brElm);rng.setEndBefore(brElm);}editor.selection.setRng(rng);scrollRangeIntoView(editor,rng);};var insertBrAtCaret=function insertBrAtCaret(editor,evt){var selection=editor.selection;var dom=editor.dom;var rng=selection.getRng();var brElm;var extraBr;normalize$2(dom,rng).each(function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset);rng.setEnd(normRng.endContainer,normRng.endOffset);});var offset=rng.startOffset;var container=rng.startContainer;if(container.nodeType===1&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer&&container.nodeType===3){offset=container.nodeValue.length;}else{offset=0;}}var parentBlock=dom.getParent(container,dom.isBlock);var containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null;var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():'';var isControlKey=!!(evt&&evt.ctrlKey);if(containerBlockName==='LI'&&!isControlKey){parentBlock=containerBlock;}if(container&&container.nodeType===3&&offset>=container.nodeValue.length){if(!hasRightSideContent(editor.schema,container,parentBlock)){brElm=dom.create('br');rng.insertNode(brElm);rng.setStartAfter(brElm);rng.setEndAfter(brElm);extraBr=true;}}brElm=dom.create('br');rangeInsertNode(dom,rng,brElm);moveSelectionToBr(editor,brElm,extraBr);editor.undoManager.add();};var insertBrBefore=function insertBrBefore(editor,inline){var br=SugarElement.fromTag('br');before$3(SugarElement.fromDom(inline),br);editor.undoManager.add();};var insertBrAfter=function insertBrAfter(editor,inline){if(!hasBrAfter(editor.getBody(),inline)){after$4(SugarElement.fromDom(inline),SugarElement.fromTag('br'));}var br=SugarElement.fromTag('br');after$4(SugarElement.fromDom(inline),br);moveSelectionToBr(editor,br.dom,false);editor.undoManager.add();};var isBeforeBr=function isBeforeBr(pos){return isBr$6(pos.getNode());};var hasBrAfter=function hasBrAfter(rootNode,startNode){if(isBeforeBr(CaretPosition.after(startNode))){return true;}else{return nextPosition(rootNode,CaretPosition.after(startNode)).map(function(pos){return isBr$6(pos.getNode());}).getOr(false);}};var isAnchorLink=function isAnchorLink(elm){return elm&&elm.nodeName==='A'&&'href'in elm;};var isInsideAnchor=function isInsideAnchor(location){return location.fold(never,isAnchorLink,isAnchorLink,never);};var readInlineAnchorLocation=function readInlineAnchorLocation(editor){var isInlineTarget$1=curry(isInlineTarget,editor);var position=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),position).filter(isInsideAnchor);};var insertBrOutsideAnchor=function insertBrOutsideAnchor(editor,location){location.fold(noop,curry(insertBrBefore,editor),curry(insertBrAfter,editor),noop);};var insert$1=function insert$1(editor,evt){var anchorLocation=readInlineAnchorLocation(editor);if(anchorLocation.isSome()){anchorLocation.each(curry(insertBrOutsideAnchor,editor));}else{insertBrAtCaret(editor,evt);}};var fakeEventName='insertLineBreak';var linebreak={insert:insert$1,fakeEventName:fakeEventName};var matchesSelector=function matchesSelector(editor,selector){return getParentBlock$1(editor).filter(function(parentBlock){return selector.length>0&&is$1(SugarElement.fromDom(parentBlock),selector);}).isSome();};var shouldInsertBr=function shouldInsertBr(editor){return matchesSelector(editor,getBrNewLineSelector(editor));};var shouldBlockNewLine$1=function shouldBlockNewLine$1(editor){return matchesSelector(editor,getNoNewLineSelector(editor));};var newLineAction=Adt.generate([{br:[]},{block:[]},{none:[]}]);var shouldBlockNewLine=function shouldBlockNewLine(editor,_shiftKey){return shouldBlockNewLine$1(editor);};var inListBlock=function inListBlock(requiredState){return function(editor,_shiftKey){return isListItemParentBlock(editor)===requiredState;};};var inBlock=function inBlock(blockName,requiredState){return function(editor,_shiftKey){var state=getParentBlockName(editor)===blockName.toUpperCase();return state===requiredState;};};var inPreBlock=function inPreBlock(requiredState){return inBlock('pre',requiredState);};var inSummaryBlock=function inSummaryBlock(){return inBlock('summary',true);};var shouldPutBrInPre=function shouldPutBrInPre(requiredState){return function(editor,_shiftKey){return shouldPutBrInPre$1(editor)===requiredState;};};var inBrContext=function inBrContext(editor,_shiftKey){return shouldInsertBr(editor);};var hasShiftKey=function hasShiftKey(_editor,shiftKey){return shiftKey;};var canInsertIntoEditableRoot=function canInsertIntoEditableRoot(editor){var forcedRootBlock=getForcedRootBlock(editor);var rootEditable=getEditableRoot$1(editor.dom,editor.selection.getStart());return rootEditable&&editor.schema.isValidChild(rootEditable.nodeName,forcedRootBlock);};var match=function match(predicates,action){return function(editor,shiftKey){var isMatch=foldl(predicates,function(res,p){return res&&p(editor,shiftKey);},true);return isMatch?Optional.some(action):Optional.none();};};var getAction=function getAction(editor,evt){return evaluateUntil([match([shouldBlockNewLine],newLineAction.none()),match([inSummaryBlock()],newLineAction.br()),match([inPreBlock(true),shouldPutBrInPre(false),hasShiftKey],newLineAction.br()),match([inPreBlock(true),shouldPutBrInPre(false)],newLineAction.block()),match([inPreBlock(true),shouldPutBrInPre(true),hasShiftKey],newLineAction.block()),match([inPreBlock(true),shouldPutBrInPre(true)],newLineAction.br()),match([inListBlock(true),hasShiftKey],newLineAction.br()),match([inListBlock(true)],newLineAction.block()),match([inBrContext],newLineAction.br()),match([hasShiftKey],newLineAction.br()),match([canInsertIntoEditableRoot],newLineAction.block())],[editor,!!(evt&&evt.shiftKey)]).getOr(newLineAction.none());};var insertBreak=function insertBreak(breakType,editor,evt){if(!editor.selection.isCollapsed()){execDeleteCommand(editor);}if(isNonNullable(evt)){var event=fireFakeBeforeInputEvent(editor,breakType.fakeEventName);if(event.isDefaultPrevented()){return;}}breakType.insert(editor,evt);if(isNonNullable(evt)){fireFakeInputEvent(editor,breakType.fakeEventName);}};var insert=function insert(editor,evt){var br=function br(){return insertBreak(linebreak,editor,evt);};var block=function block(){return insertBreak(blockbreak,editor,evt);};var logicalAction=getAction(editor,evt);switch(getNewlineBehavior(editor)){case'linebreak':logicalAction.fold(br,br,noop);break;case'block':logicalAction.fold(block,block,noop);break;case'invert':logicalAction.fold(block,br,noop);break;default:logicalAction.fold(br,block,noop);break;}};var handleEnterKeyEvent=function handleEnterKeyEvent(editor,event){if(event.isDefaultPrevented()){return;}event.preventDefault();endTypingLevelIgnoreLocks(editor.undoManager);editor.undoManager.transact(function(){insert(editor,event);});};var setup$h=function setup$h(editor){editor.on('keydown',function(event){if(event.keyCode===VK.ENTER){handleEnterKeyEvent(editor,event);}});};var executeKeydownOverride$2=function executeKeydownOverride$2(editor,caret,evt){var isMac=Env.os.isMacOS()||Env.os.isiOS();execute([{keyCode:VK.END,action:action(moveToLineEndPoint$1,editor,true)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$1,editor,false)}].concat(_toConsumableArray2(!isMac?[{keyCode:VK.HOME,action:action(selectToEndPoint,editor,false),ctrlKey:true,shiftKey:true},{keyCode:VK.END,action:action(selectToEndPoint,editor,true),ctrlKey:true,shiftKey:true}]:[]),[{keyCode:VK.END,action:action(moveToLineEndPoint,editor,true)},{keyCode:VK.HOME,action:action(moveToLineEndPoint,editor,false)},{keyCode:VK.END,action:action(moveToLineEndPoint$2,editor,true,caret)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$2,editor,false,caret)}]),evt).each(function(_){evt.preventDefault();});};var setup$g=function setup$g(editor,caret){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride$2(editor,caret,evt);}});};var setup$f=function setup$f(editor){editor.on('input',function(e){if(e.isComposing===false){normalizeNbspsInEditor(editor);}});};var platform=detect$2();var executeKeyupAction=function executeKeyupAction(editor,caret,evt){execute([{keyCode:VK.PAGE_UP,action:action(moveToLineEndPoint$2,editor,false,caret)},{keyCode:VK.PAGE_DOWN,action:action(moveToLineEndPoint$2,editor,true,caret)}],evt);};var stopImmediatePropagation=function stopImmediatePropagation(e){return e.stopImmediatePropagation();};var isPageUpDown=function isPageUpDown(evt){return evt.keyCode===VK.PAGE_UP||evt.keyCode===VK.PAGE_DOWN;};var setNodeChangeBlocker=function setNodeChangeBlocker(blocked,editor,block){if(block&&!blocked.get()){editor.on('NodeChange',stopImmediatePropagation,true);}else if(!block&&blocked.get()){editor.off('NodeChange',stopImmediatePropagation);}blocked.set(block);};var setup$e=function setup$e(editor,caret){if(platform.os.isMacOS()){return;}var blocked=Cell(false);editor.on('keydown',function(evt){if(isPageUpDown(evt)){setNodeChangeBlocker(blocked,editor,true);}});editor.on('keyup',function(evt){if(evt.isDefaultPrevented()===false){executeKeyupAction(editor,caret,evt);}if(isPageUpDown(evt)&&blocked.get()){setNodeChangeBlocker(blocked,editor,false);editor.nodeChanged();}});};var insertTextAtPosition=function insertTextAtPosition(text,pos){var container=pos.container();var offset=pos.offset();if(isText$9(container)){container.insertData(offset,text);return Optional.some(CaretPosition(container,offset+text.length));}else{return getElementFromPosition(pos).map(function(elm){var textNode=SugarElement.fromText(text);if(pos.isAtEnd()){after$4(elm,textNode);}else{before$3(elm,textNode);}return CaretPosition(textNode.dom,text.length);});}};var insertNbspAtPosition=curry(insertTextAtPosition,nbsp);var insertSpaceAtPosition=curry(insertTextAtPosition,' ');var locationToCaretPosition=function locationToCaretPosition(root){return function(location){return location.fold(function(element){return prevPosition(root.dom,CaretPosition.before(element));},function(element){return firstPositionIn(element);},function(element){return lastPositionIn(element);},function(element){return nextPosition(root.dom,CaretPosition.after(element));});};};var insertInlineBoundarySpaceOrNbsp=function insertInlineBoundarySpaceOrNbsp(root,pos){return function(checkPos){return needsToHaveNbsp(root,checkPos)?insertNbspAtPosition(pos):insertSpaceAtPosition(pos);};};var setSelection=function setSelection(editor){return function(pos){editor.selection.setRng(pos.toRange());editor.nodeChanged();return true;};};var insertSpaceOrNbspAtSelection=function insertSpaceOrNbspAtSelection(editor){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());var root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){var isInlineTarget$1=curry(isInlineTarget,editor);var caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),caretPosition).bind(locationToCaretPosition(root)).map(function(checkPos){return function(){return insertInlineBoundarySpaceOrNbsp(root,pos)(checkPos).each(setSelection(editor));};});}else{return Optional.none();}};var executeKeydownOverride$1=function executeKeydownOverride$1(editor,evt){executeWithDelayedAction([{keyCode:VK.SPACEBAR,action:action(insertSpaceOrNbspAtSelection,editor)}],evt).each(function(applyAction){evt.preventDefault();var event=fireFakeBeforeInputEvent(editor,'insertText',{data:' '});if(!event.isDefaultPrevented()){applyAction();fireFakeInputEvent(editor,'insertText',{data:' '});}});};var setup$d=function setup$d(editor){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride$1(editor,evt);}});};var tableTabNavigation=function tableTabNavigation(editor){if(hasTableTabNavigation(editor)){return[{keyCode:VK.TAB,action:action(handleTab,editor,true)},{keyCode:VK.TAB,shiftKey:true,action:action(handleTab,editor,false)}];}else{return[];}};var executeKeydownOverride=function executeKeydownOverride(editor,evt){execute(_toConsumableArray2(tableTabNavigation(editor)),evt).each(function(_){evt.preventDefault();});};var setup$c=function setup$c(editor){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride(editor,evt);}});};var setup$b=function setup$b(editor){editor.addShortcut('Meta+P','','mcePrint');setup$j(editor);if(isRtc(editor)){return Cell(null);}else{var caret=setupSelectedState(editor);setup$l(editor);setup$k(editor,caret);setup$i(editor,caret);setup$h(editor);setup$d(editor);setup$f(editor);setup$c(editor);setup$g(editor,caret);setup$e(editor,caret);return caret;}};var NodeChange=/*#__PURE__*/function(){function NodeChange(editor){_classCallCheck(this,NodeChange);this.lastPath=[];this.editor=editor;var lastRng;var self=this;if(!('onselectionchange'in editor.getDoc())){editor.on('NodeChange click mouseup keyup focus',function(e){var nativeRng=editor.selection.getRng();var fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};if(e.type==='nodechange'||!isEq$4(fakeRng,lastRng)){editor.dispatch('SelectionChange');}lastRng=fakeRng;});}editor.on('contextmenu',function(){editor.dispatch('SelectionChange');});editor.on('SelectionChange',function(){var startElm=editor.selection.getStart(true);if(!startElm){return;}if(hasAnyRanges(editor)&&!self.isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())){editor.nodeChanged({selectionChange:true});}});editor.on('mouseup',function(e){if(!e.isDefaultPrevented()&&hasAnyRanges(editor)){if(editor.selection.getNode().nodeName==='IMG'){Delay.setEditorTimeout(editor,function(){editor.nodeChanged();});}else{editor.nodeChanged();}}});}_createClass(NodeChange,[{key:"nodeChanged",value:function nodeChanged(args){var selection=this.editor.selection;var node,parents,root;if(this.editor.initialized&&selection&&!shouldDisableNodeChange(this.editor)&&!this.editor.mode.isReadOnly()){root=this.editor.getBody();node=selection.getStart(true)||root;if(node.ownerDocument!==this.editor.getDoc()||!this.editor.dom.isChildOf(node,root)){node=root;}parents=[];this.editor.dom.getParent(node,function(node){if(node===root){return true;}parents.push(node);});args=args||{};args.element=node;args.parents=parents;this.editor.dispatch('NodeChange',args);}}},{key:"isSameElementPath",value:function isSameElementPath(startElm){var i;var editor=this.editor;var currentPath=reverse(editor.dom.getParents(startElm,always,editor.getBody()));if(currentPath.length===this.lastPath.length){for(i=currentPath.length;i>=0;i--){if(currentPath[i]!==this.lastPath[i]){break;}}if(i===-1){this.lastPath=currentPath;return true;}}this.lastPath=currentPath;return false;}}]);return NodeChange;}();var internalMimeType='x-tinymce/html';var internalHtmlMime=constant(internalMimeType);var internalMark='<!-- '+internalMimeType+' -->';var mark=function mark(html){return internalMark+html;};var unmark=function unmark(html){return html.replace(internalMark,'');};var isMarked=function isMarked(html){return html.indexOf(internalMark)!==-1;};var isPlainText=function isPlainText(text){return!/<(?:\/?(?!(?:div|p|br|span)>)\w+|(?:(?!(?:span style="white-space:\s?pre;?">)|br\s?\/>))\w+\s[^>]+)>/i.test(text);};var openContainer=function openContainer(rootTag,rootAttrs){var tag='<'+rootTag;var attrs=mapToArray(rootAttrs,function(value,key){return key+'="'+Entities.encodeAllRaw(value)+'"';});if(attrs.length){tag+=' '+attrs.join(' ');}return tag+'>';};var toBlockElements=function toBlockElements(text,rootTag,rootAttrs){var blocks=text.split(/\n\n/);var tagOpen=openContainer(rootTag,rootAttrs);var tagClose='</'+rootTag+'>';var paragraphs=map$3(blocks,function(p){return p.split(/\n/).join('<br />');});var stitch=function stitch(p){return tagOpen+p+tagClose;};return paragraphs.length===1?paragraphs[0]:map$3(paragraphs,stitch).join('');};var pasteBinDefaultContent='%MCEPASTEBIN%';var create$6=function create$6(editor,lastRngCell){var dom=editor.dom,selection=editor.selection;var body=editor.getBody();lastRngCell.set(selection.getRng());var pasteBinElm=dom.add(editor.getBody(),'div',{'id':'mcepastebin','class':'mce-pastebin','contentEditable':true,'data-mce-bogus':'all','style':'position: fixed; top: 50%; width: 10px; height: 10px; overflow: hidden; opacity: 0'},pasteBinDefaultContent);if(Env.browser.isFirefox()){dom.setStyle(pasteBinElm,'left',dom.getStyle(body,'direction',true)==='rtl'?65535:-65535);}dom.bind(pasteBinElm,'beforedeactivate focusin focusout',function(e){e.stopPropagation();});pasteBinElm.focus();selection.select(pasteBinElm,true);};var _remove=function remove(editor,lastRngCell){var dom=editor.dom;if(_getEl(editor)){var pasteBinClone;var lastRng=lastRngCell.get();while(pasteBinClone=_getEl(editor)){dom.remove(pasteBinClone);dom.unbind(pasteBinClone);}if(lastRng){editor.selection.setRng(lastRng);}}lastRngCell.set(null);};var _getEl=function getEl(editor){return editor.dom.get('mcepastebin');};var isPasteBin=function isPasteBin(elm){return elm&&elm.id==='mcepastebin';};var _getHtml=function getHtml(editor){var dom=editor.dom;var copyAndRemove=function copyAndRemove(toElm,fromElm){toElm.appendChild(fromElm);dom.remove(fromElm,true);};var _filter$=filter$6(editor.getBody().childNodes,isPasteBin),_filter$2=_toArray(_filter$),pasteBinElm=_filter$2[0],pasteBinClones=_filter$2.slice(1);each$f(pasteBinClones,function(pasteBinClone){copyAndRemove(pasteBinElm,pasteBinClone);});var dirtyWrappers=dom.select('div[id=mcepastebin]',pasteBinElm);for(var i=dirtyWrappers.length-1;i>=0;i--){var cleanWrapper=dom.create('div');pasteBinElm.insertBefore(cleanWrapper,dirtyWrappers[i]);copyAndRemove(cleanWrapper,dirtyWrappers[i]);}return pasteBinElm?pasteBinElm.innerHTML:'';};var isDefaultPasteBinContent=function isDefaultPasteBinContent(content){return content===pasteBinDefaultContent;};var PasteBin=function PasteBin(editor){var lastRng=Cell(null);return{create:function create(){return create$6(editor,lastRng);},remove:function remove(){return _remove(editor,lastRng);},getEl:function getEl(){return _getEl(editor);},getHtml:function getHtml(){return _getHtml(editor);},getLastRng:lastRng.get};};var filter=function filter(content,items){Tools.each(items,function(v){if(is$4(v,RegExp)){content=content.replace(v,'');}else{content=content.replace(v[0],v[1]);}});return content;};var innerText=function innerText(html){var schema=Schema();var domParser=DomParser({},schema);var text='';var voidElements=schema.getVoidElements();var ignoreElements=Tools.makeMap('script noscript style textarea video audio iframe object',' ');var blockElements=schema.getBlockElements();var walk=function walk(node){var name=node.name,currentNode=node;if(name==='br'){text+='\n';return;}if(name==='wbr'){return;}if(voidElements[name]){text+=' ';}if(ignoreElements[name]){text+=' ';return;}if(node.type===3){text+=node.value;}if(!(node.name in schema.getVoidElements())){if(node=node.firstChild){do{walk(node);}while(node=node.next);}}if(blockElements[name]&&currentNode.next){text+='\n';if(name==='p'){text+='\n';}}};html=filter(html,[/<!\[[^\]]+\]>/g]);walk(domParser.parse(html));return text;};var trimHtml=function trimHtml(html){var trimSpaces=function trimSpaces(all,s1,s2){if(!s1&&!s2){return' ';}return nbsp;};html=filter(html,[/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/ig,/<!--StartFragment-->|<!--EndFragment-->/g,[/( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,trimSpaces],/<br class="Apple-interchange-newline">/g,/<br>$/i]);return html;};var createIdGenerator=function createIdGenerator(prefix){var count=0;return function(){return prefix+count++;};};var getImageMimeType=function getImageMimeType(ext){var lowerExt=ext.toLowerCase();var mimeOverrides={jpg:'jpeg',jpe:'jpeg',jfi:'jpeg',jif:'jpeg',jfif:'jpeg',pjpeg:'jpeg',pjp:'jpeg',svg:'svg+xml'};return Tools.hasOwn(mimeOverrides,lowerExt)?'image/'+mimeOverrides[lowerExt]:'image/'+lowerExt;};var preProcess=function preProcess(editor,html){var parser=DomParser({},editor.schema);parser.addNodeFilter('meta',function(nodes){Tools.each(nodes,function(node){node.remove();});});var fragment=parser.parse(html,{forced_root_block:false,isRootContent:true});return HtmlSerializer({validate:true},editor.schema).serialize(fragment);};var processResult=function processResult(content,cancelled){return{content:content,cancelled:cancelled};};var postProcessFilter=function postProcessFilter(editor,html,internal){var tempBody=editor.dom.create('div',{style:'display:none'},html);var postProcessArgs=firePastePostProcess(editor,tempBody,internal);return processResult(postProcessArgs.node.innerHTML,postProcessArgs.isDefaultPrevented());};var filterContent=function filterContent(editor,content,internal){var preProcessArgs=firePastePreProcess(editor,content,internal);var filteredContent=preProcess(editor,preProcessArgs.content);if(editor.hasEventListeners('PastePostProcess')&&!preProcessArgs.isDefaultPrevented()){return postProcessFilter(editor,filteredContent,internal);}else{return processResult(filteredContent,preProcessArgs.isDefaultPrevented());}};var process=function process(editor,html,internal){return filterContent(editor,html,internal);};var pasteHtml$1=function pasteHtml$1(editor,html){editor.insertContent(html,{merge:shouldPasteMergeFormats(editor),paste:true});return true;};var isAbsoluteUrl=function isAbsoluteUrl(url){return /^https?:\/\/[\w\-\/+=.,!;:&%@^~(){}?#]+$/i.test(url);};var isImageUrl=function isImageUrl(editor,url){return isAbsoluteUrl(url)&&exists(getAllowedImageFileTypes(editor),function(type){return endsWith(url.toLowerCase(),".".concat(type.toLowerCase()));});};var createImage=function createImage(editor,url,pasteHtmlFn){editor.undoManager.extra(function(){pasteHtmlFn(editor,url);},function(){editor.insertContent('<img src="'+url+'">');});return true;};var createLink=function createLink(editor,url,pasteHtmlFn){editor.undoManager.extra(function(){pasteHtmlFn(editor,url);},function(){editor.execCommand('mceInsertLink',false,url);});return true;};var linkSelection=function linkSelection(editor,html,pasteHtmlFn){return!editor.selection.isCollapsed()&&isAbsoluteUrl(html)?createLink(editor,html,pasteHtmlFn):false;};var insertImage=function insertImage(editor,html,pasteHtmlFn){return isImageUrl(editor,html)?createImage(editor,html,pasteHtmlFn):false;};var smartInsertContent=function smartInsertContent(editor,html){Tools.each([linkSelection,insertImage,pasteHtml$1],function(action){return action(editor,html,pasteHtml$1)!==true;});};var insertContent=function insertContent(editor,html,pasteAsText){if(pasteAsText||!isSmartPasteEnabled(editor)){pasteHtml$1(editor,html);}else{smartInsertContent(editor,html);}};var uniqueId=createIdGenerator('mceclip');var doPaste=function doPaste(editor,content,internal,pasteAsText){var args=process(editor,content,internal);if(args.cancelled===false){insertContent(editor,args.content,pasteAsText);}};var pasteHtml=function pasteHtml(editor,html,internalFlag){var internal=internalFlag?internalFlag:isMarked(html);doPaste(editor,unmark(html),internal,false);};var pasteText=function pasteText(editor,text){var encodedText=editor.dom.encode(text).replace(/\r\n/g,'\n');var normalizedText=normalize$4(encodedText,getPasteTabSpaces(editor));var html=toBlockElements(normalizedText,getForcedRootBlock(editor),getForcedRootBlockAttrs(editor));doPaste(editor,html,false,true);};var getDataTransferItems=function getDataTransferItems(dataTransfer){var items={};if(dataTransfer&&dataTransfer.types){for(var i=0;i<dataTransfer.types.length;i++){var contentType=dataTransfer.types[i];try{items[contentType]=dataTransfer.getData(contentType);}catch(ex){items[contentType]='';}}}return items;};var hasContentType=function hasContentType(clipboardContent,mimeType){return mimeType in clipboardContent&&clipboardContent[mimeType].length>0;};var hasHtmlOrText=function hasHtmlOrText(content){return hasContentType(content,'text/html')||hasContentType(content,'text/plain');};var extractFilename=function extractFilename(editor,str){var m=str.match(/([\s\S]+?)(?:\.[a-z0-9.]+)$/i);return isNonNullable(m)?editor.dom.encode(m[1]):null;};var createBlobInfo=function createBlobInfo(editor,blobCache,file,base64){var id=uniqueId();var useFileName=shouldReuseFileName(editor)&&isNonNullable(file.name);var name=useFileName?extractFilename(editor,file.name):id;var filename=useFileName?file.name:undefined;var blobInfo=blobCache.create(id,file,base64,name,filename);blobCache.add(blobInfo);return blobInfo;};var pasteImage=function pasteImage(editor,imageItem){parseDataUri(imageItem.uri).each(function(_ref13){var data=_ref13.data,type=_ref13.type,base64Encoded=_ref13.base64Encoded;var base64=base64Encoded?data:btoa(data);var file=imageItem.file;var blobCache=editor.editorUpload.blobCache;var existingBlobInfo=blobCache.getByData(base64,type);var blobInfo=existingBlobInfo!==null&&existingBlobInfo!==void 0?existingBlobInfo:createBlobInfo(editor,blobCache,file,base64);pasteHtml(editor,"<img src=\"".concat(blobInfo.blobUri(),"\">"),false);});};var isClipboardEvent=function isClipboardEvent(event){return event.type==='paste';};var readFilesAsDataUris=function readFilesAsDataUris(items){return Promise.all(map$3(items,function(file){return blobToDataUri(file).then(function(uri){return{file:file,uri:uri};});}));};var isImage=function isImage(editor){var allowedExtensions=getAllowedImageFileTypes(editor);return function(file){return startsWith(file.type,'image/')&&exists(allowedExtensions,function(extension){return getImageMimeType(extension)===file.type;});};};var getImagesFromDataTransfer=function getImagesFromDataTransfer(editor,dataTransfer){var items=dataTransfer.items?bind$3(from(dataTransfer.items),function(item){return item.kind==='file'?[item.getAsFile()]:[];}):[];var files=dataTransfer.files?from(dataTransfer.files):[];return filter$6(items.length>0?items:files,isImage(editor));};var pasteImageData=function pasteImageData(editor,e,rng){var dataTransfer=isClipboardEvent(e)?e.clipboardData:e.dataTransfer;if(shouldPasteDataImages(editor)&&dataTransfer){var images=getImagesFromDataTransfer(editor,dataTransfer);if(images.length>0){e.preventDefault();readFilesAsDataUris(images).then(function(fileResults){if(rng){editor.selection.setRng(rng);}each$f(fileResults,function(result){pasteImage(editor,result);});});return true;}}return false;};var isBrokenAndroidClipboardEvent=function isBrokenAndroidClipboardEvent(e){var _a,_b;return Env.os.isAndroid()&&((_b=(_a=e.clipboardData)===null||_a===void 0?void 0:_a.items)===null||_b===void 0?void 0:_b.length)===0;};var isKeyboardPasteEvent=function isKeyboardPasteEvent(e){return VK.metaKeyPressed(e)&&e.keyCode===86||e.shiftKey&&e.keyCode===45;};var insertClipboardContent=function insertClipboardContent(editor,clipboardContent,html,plainTextMode){var content=trimHtml(html);var isInternal=hasContentType(clipboardContent,internalHtmlMime())||isMarked(html);var isPlainTextHtml=!isInternal&&isPlainText(content);var isAbsoluteUrl$1=isAbsoluteUrl(content);if(isDefaultPasteBinContent(content)||!content.length||isPlainTextHtml&&!isAbsoluteUrl$1){plainTextMode=true;}if(plainTextMode||isAbsoluteUrl$1){if(hasContentType(clipboardContent,'text/plain')&&isPlainTextHtml){content=clipboardContent['text/plain'];}else{content=innerText(content);}}if(isDefaultPasteBinContent(content)){return;}if(plainTextMode){pasteText(editor,content);}else{pasteHtml(editor,content,isInternal);}};var registerEventHandlers=function registerEventHandlers(editor,pasteBin,pasteFormat){var keyboardPastePlainTextState;var getLastRng=function getLastRng(){return pasteBin.getLastRng()||editor.selection.getRng();};editor.on('keydown',function(e){if(isKeyboardPasteEvent(e)&&!e.isDefaultPrevented()){keyboardPastePlainTextState=e.shiftKey&&e.keyCode===86;}});editor.on('paste',function(e){if(e.isDefaultPrevented()||isBrokenAndroidClipboardEvent(e)){return;}var plainTextMode=pasteFormat.get()==='text'||keyboardPastePlainTextState;keyboardPastePlainTextState=false;var clipboardContent=getDataTransferItems(e.clipboardData);if(!hasHtmlOrText(clipboardContent)&&pasteImageData(editor,e,getLastRng())){return;}if(hasContentType(clipboardContent,'text/html')){e.preventDefault();insertClipboardContent(editor,clipboardContent,clipboardContent['text/html'],plainTextMode);}else{pasteBin.create();Delay.setEditorTimeout(editor,function(){var html=pasteBin.getHtml();pasteBin.remove();insertClipboardContent(editor,clipboardContent,html,plainTextMode);},0);}});};var registerDataImageFilter=function registerDataImageFilter(editor){var isWebKitFakeUrl=function isWebKitFakeUrl(src){return startsWith(src,'webkit-fake-url');};var isDataUri=function isDataUri(src){return startsWith(src,'data:');};var isPasteInsert=function isPasteInsert(args){var _a;return((_a=args.data)===null||_a===void 0?void 0:_a.paste)===true;};editor.parser.addNodeFilter('img',function(nodes,name,args){if(!shouldPasteDataImages(editor)&&isPasteInsert(args)){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=nodes[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var _node17=_step4.value;var src=_node17.attr('src');if(isString(src)&&!_node17.attr('data-mce-object')&&src!==Env.transparentSrc){if(isWebKitFakeUrl(src)){_node17.remove();}else if(!shouldAllowHtmlDataUrls(editor)&&isDataUri(src)){_node17.remove();}}}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]!=null){_iterator4["return"]();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}}});};var registerEventsAndFilters=function registerEventsAndFilters(editor,pasteBin,pasteFormat){registerEventHandlers(editor,pasteBin,pasteFormat);registerDataImageFilter(editor);};var togglePlainTextPaste=function togglePlainTextPaste(editor,pasteFormat){if(pasteFormat.get()==='text'){pasteFormat.set('html');firePastePlainTextToggle(editor,false);}else{pasteFormat.set('text');firePastePlainTextToggle(editor,true);}editor.focus();};var register$1=function register$1(editor,pasteFormat){editor.addCommand('mceTogglePlainTextPaste',function(){togglePlainTextPaste(editor,pasteFormat);});editor.addCommand('mceInsertClipboardContent',function(ui,value){if(value.html){pasteHtml(editor,value.html,value.internal);}if(value.text){pasteText(editor,value.text);}});};var setHtml5Clipboard=function setHtml5Clipboard(clipboardData,html,text){try{clipboardData.clearData();clipboardData.setData('text/html',html);clipboardData.setData('text/plain',text);clipboardData.setData(internalHtmlMime(),html);return true;}catch(e){return false;}};var setClipboardData=function setClipboardData(evt,data,fallback,done){if(setHtml5Clipboard(evt.clipboardData,data.html,data.text)){evt.preventDefault();done();}else{fallback(data.html,done);}};var fallback=function fallback(editor){return function(html,done){var dom=editor.dom,selection=editor.selection;var outer=dom.create('div',{'contenteditable':'false','data-mce-bogus':'all'});var inner=dom.create('div',{contenteditable:'true'},html);dom.setStyles(outer,{position:'fixed',top:'0',left:'-3000px',width:'1000px',overflow:'hidden'});outer.appendChild(inner);dom.add(editor.getBody(),outer);var range=selection.getRng();inner.focus();var offscreenRange=dom.createRng();offscreenRange.selectNodeContents(inner);selection.setRng(offscreenRange);Delay.setEditorTimeout(editor,function(){selection.setRng(range);dom.remove(outer);done();},0);};};var getData=function getData(editor){return{html:mark(editor.selection.getContent({contextual:true})),text:editor.selection.getContent({format:'text'})};};var isTableSelection=function isTableSelection(editor){return!!editor.dom.getParent(editor.selection.getStart(),'td[data-mce-selected],th[data-mce-selected]',editor.getBody());};var hasSelectedContent=function hasSelectedContent(editor){return!editor.selection.isCollapsed()||isTableSelection(editor);};var cut=function cut(editor){return function(evt){if(!evt.isDefaultPrevented()&&hasSelectedContent(editor)){setClipboardData(evt,getData(editor),fallback(editor),function(){if(Env.browser.isChromium()||Env.browser.isFirefox()){var rng=editor.selection.getRng();Delay.setEditorTimeout(editor,function(){editor.selection.setRng(rng);editor.execCommand('Delete');},0);}else{editor.execCommand('Delete');}});}};};var copy=function copy(editor){return function(evt){if(!evt.isDefaultPrevented()&&hasSelectedContent(editor)){setClipboardData(evt,getData(editor),fallback(editor),noop);}};};var register=function register(editor){editor.on('cut',cut(editor));editor.on('copy',copy(editor));};var getCaretRangeFromEvent=function getCaretRangeFromEvent(editor,e){var _a,_b;return RangeUtils.getCaretRangeFromPoint((_a=e.clientX)!==null&&_a!==void 0?_a:0,(_b=e.clientY)!==null&&_b!==void 0?_b:0,editor.getDoc());};var isPlainTextFileUrl=function isPlainTextFileUrl(content){var plainTextContent=content['text/plain'];return plainTextContent?plainTextContent.indexOf('file://')===0:false;};var setFocusedRange=function setFocusedRange(editor,rng){editor.focus();if(rng){editor.selection.setRng(rng);}};var hasImage=function hasImage(dataTransfer){return exists(dataTransfer.files,function(file){return /^image\//.test(file.type);});};var setup$a=function setup$a(editor,draggingInternallyState){if(shouldPasteBlockDrop(editor)){editor.on('dragend dragover draggesture dragdrop drop drag',function(e){e.preventDefault();e.stopPropagation();});}if(!shouldPasteDataImages(editor)){editor.on('drop',function(e){var dataTransfer=e.dataTransfer;if(dataTransfer&&hasImage(dataTransfer)){e.preventDefault();}});}editor.on('drop',function(e){if(e.isDefaultPrevented()||draggingInternallyState.get()){return;}var rng=getCaretRangeFromEvent(editor,e);if(isNullable(rng)){return;}var dropContent=getDataTransferItems(e.dataTransfer);var internal=hasContentType(dropContent,internalHtmlMime());if((!hasHtmlOrText(dropContent)||isPlainTextFileUrl(dropContent))&&pasteImageData(editor,e,rng)){return;}var internalContent=dropContent[internalHtmlMime()];var content=internalContent||dropContent['text/html']||dropContent['text/plain'];if(content){e.preventDefault();Delay.setEditorTimeout(editor,function(){editor.undoManager.transact(function(){if(internalContent){editor.execCommand('Delete');}setFocusedRange(editor,rng);var trimmedContent=trimHtml(content);if(dropContent['text/html']){pasteHtml(editor,trimmedContent,internal);}else{pasteText(editor,trimmedContent);}});});}});editor.on('dragstart',function(_e){draggingInternallyState.set(true);});editor.on('dragover dragend',function(e){if(shouldPasteDataImages(editor)&&draggingInternallyState.get()===false){e.preventDefault();setFocusedRange(editor,getCaretRangeFromEvent(editor,e));}if(e.type==='dragend'){draggingInternallyState.set(false);}});};var setup$9=function setup$9(editor){var processEvent=function processEvent(f){return function(e){f(editor,e);};};var preProcess=getPastePreProcess(editor);if(isFunction(preProcess)){editor.on('PastePreProcess',processEvent(preProcess));}var postProcess=getPastePostProcess(editor);if(isFunction(postProcess)){editor.on('PastePostProcess',processEvent(postProcess));}};var addPreProcessFilter=function addPreProcessFilter(editor,filterFunc){editor.on('PastePreProcess',function(e){e.content=filterFunc(editor,e.content,e.internal);});};var rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi;var rgbToHex=function rgbToHex(value){return Tools.trim(value).replace(rgbRegExp,rgbaToHexString).toLowerCase();};var removeWebKitStyles=function removeWebKitStyles(editor,content,internal){var webKitStylesOption=getPasteWebkitStyles(editor);if(internal||webKitStylesOption==='all'||!shouldPasteRemoveWebKitStyles(editor)){return content;}var webKitStyles=webKitStylesOption?webKitStylesOption.split(/[, ]/):[];if(webKitStyles&&webKitStylesOption!=='none'){var _dom2=editor.dom,_node18=editor.selection.getNode();content=content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,function(all,before,value,after){var inputStyles=_dom2.parseStyle(_dom2.decode(value));var outputStyles={};for(var i=0;i<webKitStyles.length;i++){var inputValue=inputStyles[webKitStyles[i]];var compareInput=inputValue;var currentValue=_dom2.getStyle(_node18,webKitStyles[i],true);if(/color/.test(webKitStyles[i])){compareInput=rgbToHex(compareInput);currentValue=rgbToHex(currentValue);}if(currentValue!==compareInput){outputStyles[webKitStyles[i]]=inputValue;}}var outputStyle=_dom2.serializeStyle(outputStyles,'span');if(outputStyle){return before+' style="'+outputStyle+'"'+after;}return before+after;});}else{content=content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,'$1$3');}content=content.replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi,function(all,before,value,after){return before+' style="'+value+'"'+after;});return content;};var setup$8=function setup$8(editor){if(Env.browser.isChromium()||Env.browser.isSafari()){addPreProcessFilter(editor,removeWebKitStyles);}};var setup$7=function setup$7(editor){var draggingInternallyState=Cell(false);var pasteFormat=Cell(isPasteAsTextEnabled(editor)?'text':'html');var pasteBin=PasteBin(editor);setup$8(editor);register$1(editor,pasteFormat);setup$9(editor);editor.on('PreInit',function(){register(editor);setup$a(editor,draggingInternallyState);registerEventsAndFilters(editor,pasteBin,pasteFormat);});};var preventSummaryToggle=function preventSummaryToggle(editor){editor.on('click',function(e){if(editor.dom.getParent(e.target,'details')){e.preventDefault();}});};var filterDetails=function filterDetails(editor){editor.parser.addNodeFilter('details',function(elms){each$f(elms,function(details){details.attr('data-mce-open',details.attr('open'));details.attr('open','open');});});editor.serializer.addNodeFilter('details',function(elms){each$f(elms,function(details){var open=details.attr('data-mce-open');details.attr('open',isString(open)?open:null);details.attr('data-mce-open',null);});});};var setup$6=function setup$6(editor){preventSummaryToggle(editor);filterDetails(editor);};var isBr=isBr$6;var isText=isText$9;var isContentEditableFalse$2=function isContentEditableFalse$2(elm){return isContentEditableFalse$b(elm.dom);};var isContentEditableTrue$1=function isContentEditableTrue$1(elm){return isContentEditableTrue$5(elm.dom);};var isRoot=function isRoot(rootNode){return function(elm){return eq(SugarElement.fromDom(rootNode),elm);};};var getClosestScope=function getClosestScope(node,rootNode){return closest$4(SugarElement.fromDom(node),function(elm){return isContentEditableTrue$1(elm)||isBlock$2(elm);},isRoot(rootNode)).getOr(SugarElement.fromDom(rootNode)).dom;};var getClosestCef=function getClosestCef(node,rootNode){return closest$4(SugarElement.fromDom(node),isContentEditableFalse$2,isRoot(rootNode));};var findEdgeCaretCandidate=function findEdgeCaretCandidate(startNode,scope,forward){var walker=new DomTreeWalker(startNode,scope);var next=forward?walker.next.bind(walker):walker.prev.bind(walker);var result=startNode;for(var current=forward?startNode:next();current&&!isBr(current);current=next()){if(isCaretCandidate$3(current)){result=current;}}return result;};var findClosestBlockRange=function findClosestBlockRange(startRng,rootNode){var startPos=CaretPosition.fromRangeStart(startRng);var clickNode=startPos.getNode();var scope=getClosestScope(clickNode,rootNode);var startNode=findEdgeCaretCandidate(clickNode,scope,false);var endNode=findEdgeCaretCandidate(clickNode,scope,true);var rng=document.createRange();getClosestCef(startNode,scope).fold(function(){if(isText(startNode)){rng.setStart(startNode,0);}else{rng.setStartBefore(startNode);}},function(cef){return rng.setStartBefore(cef.dom);});getClosestCef(endNode,scope).fold(function(){if(isText(endNode)){rng.setEnd(endNode,endNode.data.length);}else{rng.setEndAfter(endNode);}},function(cef){return rng.setEndAfter(cef.dom);});return rng;};var onTripleClickSelect=function onTripleClickSelect(editor){var rng=findClosestBlockRange(editor.selection.getRng(),editor.getBody());editor.selection.setRng(normalize(rng));};var setup$5=function setup$5(editor){editor.on('mousedown',function(e){if(e.detail>=3){e.preventDefault();onTripleClickSelect(editor);}});};var FakeCaretPosition;(function(FakeCaretPosition){FakeCaretPosition['Before']='before';FakeCaretPosition['After']='after';})(FakeCaretPosition||(FakeCaretPosition={}));var distanceToRectLeft=function distanceToRectLeft(clientRect,clientX){return Math.abs(clientRect.left-clientX);};var distanceToRectRight=function distanceToRectRight(clientRect,clientX){return Math.abs(clientRect.right-clientX);};var isInsideY=function isInsideY(clientY,clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom;};var collidesY=function collidesY(r1,r2){return r1.top<r2.bottom&&r1.bottom>r2.top;};var isOverlapping=function isOverlapping(r1,r2){var overlap=overlapY(r1,r2)/Math.min(r1.height,r2.height);return collidesY(r1,r2)&&overlap>0.5;};var splitRectsPerAxis=function splitRectsPerAxis(rects,y){var intersectingRects=filter$6(rects,function(rect){return isInsideY(y,rect);});return boundingClientRectFromRects(intersectingRects).fold(function(){return[[],rects];},function(boundingRect){var _partition$2=partition$2(rects,function(rect){return isOverlapping(rect,boundingRect);}),horizontal=_partition$2.pass,vertical=_partition$2.fail;return[horizontal,vertical];});};var clientInfo=function clientInfo(rect,clientX){return{node:rect.node,position:distanceToRectLeft(rect,clientX)<distanceToRectRight(rect,clientX)?FakeCaretPosition.Before:FakeCaretPosition.After};};var horizontalDistance=function horizontalDistance(rect,x,_y){return x>rect.left&&x<rect.right?0:Math.min(Math.abs(rect.left-x),Math.abs(rect.right-x));};var closestChildCaretCandidateNodeRect=function closestChildCaretCandidateNodeRect(children,clientX,clientY){var caretCandidateRect=function caretCandidateRect(rect){if(isCaretCandidate$3(rect.node)){return Optional.some(rect);}else if(isElement$6(rect.node)){return closestChildCaretCandidateNodeRect(from(rect.node.childNodes),clientX,clientY);}else{return Optional.none();}};var getClosestTextNode=function getClosestTextNode(rects,distance){if(rects.length>=2){var r1=caretCandidateRect(rects[0]).getOr(rects[0]);var r2=caretCandidateRect(rects[1]).getOr(rects[1]);var deltaDistance=Math.abs(distance(r1,clientX,clientY)-distance(r2,clientX,clientY));if(deltaDistance<2){if(isText$9(r1.node)){return Optional.some(r1);}else if(isText$9(r2.node)){return Optional.some(r2);}}}return Optional.none();};var findClosestCaretCandidateNodeRect=function findClosestCaretCandidateNodeRect(rects,distance){var sortedRects=sort(rects,function(r1,r2){return distance(r1,clientX,clientY)-distance(r2,clientX,clientY);});return getClosestTextNode(sortedRects,distance).orThunk(function(){return findMap(sortedRects,caretCandidateRect);});};var _splitRectsPerAxis=splitRectsPerAxis(getClientRects(children),clientY),_splitRectsPerAxis2=_slicedToArray(_splitRectsPerAxis,2),horizontalRects=_splitRectsPerAxis2[0],verticalRects=_splitRectsPerAxis2[1];var _partition$3=partition$2(verticalRects,function(rect){return rect.top<clientY;}),above=_partition$3.pass,below=_partition$3.fail;return findClosestCaretCandidateNodeRect(horizontalRects,horizontalDistance).orThunk(function(){return findClosestCaretCandidateNodeRect(below,distanceToRectEdgeFromXY);}).orThunk(function(){return findClosestCaretCandidateNodeRect(above,distanceToRectEdgeFromXY);});};var traverseUp=function traverseUp(rootElm,scope,clientX,clientY){var helper=function helper(scope,prevScope){return prevScope.fold(function(){return closestChildCaretCandidateNodeRect(from(scope.dom.childNodes),clientX,clientY);},function(prevScope){var uncheckedChildren=filter$6(from(scope.dom.childNodes),function(node){return node!==prevScope.dom;});return closestChildCaretCandidateNodeRect(uncheckedChildren,clientX,clientY);}).orThunk(function(){var parent=eq(scope,rootElm)?Optional.none():parentElement(scope);return parent.bind(function(newScope){return helper(newScope,Optional.some(scope));});});};return helper(scope,Optional.none());};var closestCaretCandidateNodeRect=function closestCaretCandidateNodeRect(root,clientX,clientY){var rootElm=SugarElement.fromDom(root);var ownerDoc=documentOrOwner(rootElm);var elementAtPoint=SugarElement.fromPoint(ownerDoc,clientX,clientY).filter(function(elm){return contains(rootElm,elm);});var element=elementAtPoint.getOr(rootElm);return traverseUp(rootElm,element,clientX,clientY);};var closestFakeCaretCandidate=function closestFakeCaretCandidate(root,clientX,clientY){return closestCaretCandidateNodeRect(root,clientX,clientY).filter(function(rect){return isFakeCaretTarget(rect.node);}).map(function(rect){return clientInfo(rect,clientX);});};var getAbsolutePosition=function getAbsolutePosition(elm){var clientRect=elm.getBoundingClientRect();var doc=elm.ownerDocument;var docElem=doc.documentElement;var win=doc.defaultView;return{top:clientRect.top+win.pageYOffset-docElem.clientTop,left:clientRect.left+win.pageXOffset-docElem.clientLeft};};var getBodyPosition=function getBodyPosition(editor){return editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0};};var getScrollPosition=function getScrollPosition(editor){var body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0};};var getBodyScroll=function getBodyScroll(editor){var body=editor.getBody(),docElm=editor.getDoc().documentElement;var inlineScroll={left:body.scrollLeft,top:body.scrollTop};var iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:iframeScroll;};var getMousePosition=function getMousePosition(editor,event){if(event.target.ownerDocument!==editor.getDoc()){var iframePosition=getAbsolutePosition(editor.getContentAreaContainer());var scrollPosition=getBodyScroll(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top};}return{left:event.pageX,top:event.pageY};};var calculatePosition=function calculatePosition(bodyPosition,scrollPosition,mousePosition){return{pageX:mousePosition.left-bodyPosition.left+scrollPosition.left,pageY:mousePosition.top-bodyPosition.top+scrollPosition.top};};var calc=function calc(editor,event){return calculatePosition(getBodyPosition(editor),getScrollPosition(editor),getMousePosition(editor,event));};var isContentEditableFalse$1=isContentEditableFalse$b,isContentEditableTrue=isContentEditableTrue$5;var isDraggable=function isDraggable(rootElm,elm){return isContentEditableFalse$1(elm)&&elm!==rootElm;};var isValidDropTarget=function isValidDropTarget(editor,targetElement,dragElement){if(targetElement===dragElement||editor.dom.isChildOf(targetElement,dragElement)){return false;}return!isContentEditableFalse$1(targetElement);};var cloneElement=function cloneElement(elm){var cloneElm=elm.cloneNode(true);cloneElm.removeAttribute('data-mce-selected');return cloneElm;};var createGhost=function createGhost(editor,elm,width,height){var dom=editor.dom;var clonedElm=elm.cloneNode(true);dom.setStyles(clonedElm,{width:width,height:height});dom.setAttrib(clonedElm,'data-mce-selected',null);var ghostElm=dom.create('div',{'class':'mce-drag-container','data-mce-bogus':'all','unselectable':'on','contenteditable':'false'});dom.setStyles(ghostElm,{position:'absolute',opacity:0.5,overflow:'hidden',border:0,padding:0,margin:0,width:width,height:height});dom.setStyles(clonedElm,{margin:0,boxSizing:'border-box'});ghostElm.appendChild(clonedElm);return ghostElm;};var appendGhostToBody=function appendGhostToBody(ghostElm,bodyElm){if(ghostElm.parentNode!==bodyElm){bodyElm.appendChild(ghostElm);}};var moveGhost=function moveGhost(ghostElm,position,width,height,maxX,maxY){var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+'px';ghostElm.style.top=position.pageY+'px';if(position.pageX+width>maxX){overflowX=position.pageX+width-maxX;}if(position.pageY+height>maxY){overflowY=position.pageY+height-maxY;}ghostElm.style.width=width-overflowX+'px';ghostElm.style.height=height-overflowY+'px';};var removeElement=function removeElement(elm){if(elm&&elm.parentNode){elm.parentNode.removeChild(elm);}};var isLeftMouseButtonPressed=function isLeftMouseButtonPressed(e){return e.button===0;};var applyRelPos=function applyRelPos(state,position){return{pageX:position.pageX-state.relX,pageY:position.pageY+5};};var start=function start(state,editor){return function(e){if(isLeftMouseButtonPressed(e)){var ceElm=find$2(editor.dom.getParents(e.target),or(isContentEditableFalse$1,isContentEditableTrue)).getOr(null);if(isDraggable(editor.getBody(),ceElm)){var elmPos=editor.dom.getPos(ceElm);var bodyElm=editor.getBody();var docElm=editor.getDoc().documentElement;state.set({element:ceElm,dragging:false,screenX:e.screenX,screenY:e.screenY,maxX:(editor.inline?bodyElm.scrollWidth:docElm.offsetWidth)-2,maxY:(editor.inline?bodyElm.scrollHeight:docElm.offsetHeight)-2,relX:e.pageX-elmPos.x,relY:e.pageY-elmPos.y,width:ceElm.offsetWidth,height:ceElm.offsetHeight,ghost:createGhost(editor,ceElm,ceElm.offsetWidth,ceElm.offsetHeight)});}}};};var move=function move(state,editor){var throttledPlaceCaretAt=first$1(function(clientX,clientY){editor._selectionOverrides.hideFakeCaret();editor.selection.placeCaretAt(clientX,clientY);},0);editor.on('remove',throttledPlaceCaretAt.cancel);return function(e){return state.on(function(state){var movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(!state.dragging&&movement>10){var args=editor.dispatch('dragstart',{target:state.element});if(args.isDefaultPrevented()){return;}state.dragging=true;editor.focus();}if(state.dragging){var targetPos=applyRelPos(state,calc(editor,e));appendGhostToBody(state.ghost,editor.getBody());moveGhost(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY);throttledPlaceCaretAt.throttle(e.clientX,e.clientY);}});};};var getRawTarget=function getRawTarget(selection){var rng=selection.getSel().getRangeAt(0);var startContainer=rng.startContainer;return startContainer.nodeType===3?startContainer.parentNode:startContainer;};var drop=function drop(state,editor){return function(e){state.on(function(state){if(state.dragging){if(isValidDropTarget(editor,getRawTarget(editor.selection),state.element)){var targetClone=cloneElement(state.element);var args=editor.dispatch('drop',{clientX:e.clientX,clientY:e.clientY});if(!args.isDefaultPrevented()){editor.undoManager.transact(function(){removeElement(state.element);editor.insertContent(editor.dom.getOuterHTML(targetClone));editor._selectionOverrides.hideFakeCaret();});}}editor.dispatch('dragend');}});removeDragState(state);};};var stop=function stop(state,editor){return function(){state.on(function(state){if(state.dragging){editor.dispatch('dragend');}});removeDragState(state);};};var removeDragState=function removeDragState(state){state.on(function(state){removeElement(state.ghost);});state.clear();};var bindFakeDragEvents=function bindFakeDragEvents(editor){var state=value$2();var pageDom=DOMUtils.DOM;var rootDocument=document;var dragStartHandler=start(state,editor);var dragHandler=move(state,editor);var dropHandler=drop(state,editor);var dragEndHandler=stop(state,editor);editor.on('mousedown',dragStartHandler);editor.on('mousemove',dragHandler);editor.on('mouseup',dropHandler);pageDom.bind(rootDocument,'mousemove',dragHandler);pageDom.bind(rootDocument,'mouseup',dragEndHandler);editor.on('remove',function(){pageDom.unbind(rootDocument,'mousemove',dragHandler);pageDom.unbind(rootDocument,'mouseup',dragEndHandler);});editor.on('keydown',function(e){if(e.keyCode===VK.ESC){dragEndHandler();}});};var blockUnsupportedFileDrop=function blockUnsupportedFileDrop(editor){var preventFileDrop=function preventFileDrop(e){if(!e.isDefaultPrevented()){var dataTransfer=e.dataTransfer;if(dataTransfer&&(contains$2(dataTransfer.types,'Files')||dataTransfer.files.length>0)){e.preventDefault();if(e.type==='drop'){displayError(editor,'Dropped file type is not supported');}}}};var preventFileDropIfUIElement=function preventFileDropIfUIElement(e){if(isUIElement(editor,e.target)){preventFileDrop(e);}};var setup=function setup(){var pageDom=DOMUtils.DOM;var dom=editor.dom;var doc=document;var editorRoot=editor.inline?editor.getBody():editor.getDoc();var eventNames=['drop','dragover'];each$f(eventNames,function(name){pageDom.bind(doc,name,preventFileDropIfUIElement);dom.bind(editorRoot,name,preventFileDrop);});editor.on('remove',function(){each$f(eventNames,function(name){pageDom.unbind(doc,name,preventFileDropIfUIElement);dom.unbind(editorRoot,name,preventFileDrop);});});};editor.on('init',function(){Delay.setEditorTimeout(editor,setup,0);});};var init$2=function init$2(editor){bindFakeDragEvents(editor);if(shouldBlockUnsupportedDrop(editor)){blockUnsupportedFileDrop(editor);}};var setup$4=function setup$4(editor){var renderFocusCaret=first$1(function(){if(!editor.removed&&editor.getBody().contains(document.activeElement)){var rng=editor.selection.getRng();if(rng.collapsed){var caretRange=renderRangeCaret(editor,rng,false);editor.selection.setRng(caretRange);}}},0);editor.on('focus',function(){renderFocusCaret.throttle();});editor.on('blur',function(){renderFocusCaret.cancel();});};var setup$3=function setup$3(editor){editor.on('init',function(){editor.on('focusin',function(e){var target=e.target;if(isMedia$2(target)){var ceRoot=getContentEditableRoot$1(editor.getBody(),target);var _node19=isContentEditableFalse$b(ceRoot)?ceRoot:target;if(editor.selection.getNode()!==_node19){selectNode(editor,_node19).each(function(rng){return editor.selection.setRng(rng);});}}});});};var isContentEditableFalse=isContentEditableFalse$b;var getContentEditableRoot=function getContentEditableRoot(editor,node){return getContentEditableRoot$1(editor.getBody(),node);};var SelectionOverrides=function SelectionOverrides(editor){var selection=editor.selection,dom=editor.dom;var isBlock=dom.isBlock;var rootNode=editor.getBody();var fakeCaret=FakeCaret(editor,rootNode,isBlock,function(){return _hasFocus(editor);});var realSelectionId='sel-'+dom.uniqueId();var elementSelectionAttr='data-mce-selected';var selectedElement;var isFakeSelectionElement=function isFakeSelectionElement(node){return dom.hasClass(node,'mce-offscreen-selection');};var isFakeSelectionTargetElement=function isFakeSelectionTargetElement(node){return node!==rootNode&&(isContentEditableFalse(node)||isMedia$2(node))&&dom.isChildOf(node,rootNode);};var setRange=function setRange(range){if(range){selection.setRng(range);}};var showCaret=function showCaret(direction,node,before){var scrollIntoView=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var e=editor.dispatch('ShowCaret',{target:node,direction:direction,before:before});if(e.isDefaultPrevented()){return null;}if(scrollIntoView){selection.scrollIntoView(node,direction===-1);}return fakeCaret.show(before,node);};var showBlockCaretContainer=function showBlockCaretContainer(blockCaretContainer){if(blockCaretContainer.hasAttribute('data-mce-caret')){showCaretContainerBlock(blockCaretContainer);selection.scrollIntoView(blockCaretContainer);}};var registerEvents=function registerEvents(){editor.on('click',function(e){var contentEditableRoot=getContentEditableRoot(editor,e.target);if(contentEditableRoot){if(isContentEditableFalse(contentEditableRoot)){e.preventDefault();editor.focus();}}});editor.on('blur NewBlock',removeElementSelection);editor.on('ResizeWindow FullscreenStateChanged',fakeCaret.reposition);editor.on('tap',function(e){var targetElm=e.target;var contentEditableRoot=getContentEditableRoot(editor,targetElm);if(isContentEditableFalse(contentEditableRoot)){e.preventDefault();selectNode(editor,contentEditableRoot).each(setElementSelection);}else if(isFakeSelectionTargetElement(targetElm)){selectNode(editor,targetElm).each(setElementSelection);}},true);editor.on('mousedown',function(e){var targetElm=e.target;if(targetElm!==rootNode&&targetElm.nodeName!=='HTML'&&!dom.isChildOf(targetElm,rootNode)){return;}if(isXYInContentArea(editor,e.clientX,e.clientY)===false){return;}removeElementSelection();hideFakeCaret();var closestContentEditable=getContentEditableRoot(editor,targetElm);if(isContentEditableFalse(closestContentEditable)){e.preventDefault();selectNode(editor,closestContentEditable).each(setElementSelection);}else{closestFakeCaretCandidate(rootNode,e.clientX,e.clientY).each(function(caretInfo){e.preventDefault();var range=showCaret(1,caretInfo.node,caretInfo.position===FakeCaretPosition.Before,false);setRange(range);if(isElement$6(closestContentEditable)){closestContentEditable.focus();}else{editor.getBody().focus();}});}});editor.on('keypress',function(e){if(VK.modifierPressed(e)){return;}if(isContentEditableFalse(selection.getNode())){e.preventDefault();}});editor.on('GetSelectionRange',function(e){var rng=e.range;if(selectedElement){if(!selectedElement.parentNode){selectedElement=null;return;}rng=rng.cloneRange();rng.selectNode(selectedElement);e.range=rng;}});editor.on('SetSelectionRange',function(e){e.range=normalizeVoidElementSelection(e.range);var rng=setElementSelection(e.range,e.forward);if(rng){e.range=rng;}});var isPasteBin=function isPasteBin(node){return node.id==='mcepastebin';};editor.on('AfterSetSelectionRange',function(e){var rng=e.range;var parentNode=rng.startContainer.parentNode;if(!isRangeInCaretContainer(rng)&&!isPasteBin(parentNode)){hideFakeCaret();}if(!isFakeSelectionElement(parentNode)){removeElementSelection();}});init$2(editor);setup$4(editor);setup$3(editor);};var isWithinCaretContainer=function isWithinCaretContainer(node){return isCaretContainer$2(node)||startsWithCaretContainer$1(node)||endsWithCaretContainer$1(node);};var isRangeInCaretContainer=function isRangeInCaretContainer(rng){return isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer);};var normalizeVoidElementSelection=function normalizeVoidElementSelection(rng){var voidElements=editor.schema.getVoidElements();var newRng=dom.createRng();var startContainer=rng.startContainer;var startOffset=rng.startOffset;var endContainer=rng.endContainer;var endOffset=rng.endOffset;if(has$2(voidElements,startContainer.nodeName.toLowerCase())){if(startOffset===0){newRng.setStartBefore(startContainer);}else{newRng.setStartAfter(startContainer);}}else{newRng.setStart(startContainer,startOffset);}if(has$2(voidElements,endContainer.nodeName.toLowerCase())){if(endOffset===0){newRng.setEndBefore(endContainer);}else{newRng.setEndAfter(endContainer);}}else{newRng.setEnd(endContainer,endOffset);}return newRng;};var setupOffscreenSelection=function setupOffscreenSelection(node,targetClone){var body=SugarElement.fromDom(editor.getBody());var doc=editor.getDoc();var realSelectionContainer=descendant(body,'#'+realSelectionId).getOrThunk(function(){var newContainer=SugarElement.fromHtml('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>',doc);set$2(newContainer,'id',realSelectionId);append$1(body,newContainer);return newContainer;});var newRange=dom.createRng();empty(realSelectionContainer);append(realSelectionContainer,[SugarElement.fromText(nbsp,doc),SugarElement.fromDom(targetClone),SugarElement.fromText(nbsp,doc)]);newRange.setStart(realSelectionContainer.dom.firstChild,1);newRange.setEnd(realSelectionContainer.dom.lastChild,0);setAll(realSelectionContainer,{top:dom.getPos(node,editor.getBody()).y+'px'});focus$1(realSelectionContainer);var sel=selection.getSel();sel.removeAllRanges();sel.addRange(newRange);return newRange;};var selectElement=function selectElement(elm){var targetClone=elm.cloneNode(true);var e=editor.dispatch('ObjectSelected',{target:elm,targetClone:targetClone});if(e.isDefaultPrevented()){return null;}var range=setupOffscreenSelection(elm,e.targetClone);var nodeElm=SugarElement.fromDom(elm);each$f(descendants(SugarElement.fromDom(editor.getBody()),"*[".concat(elementSelectionAttr,"]")),function(elm){if(!eq(nodeElm,elm)){remove$b(elm,elementSelectionAttr);}});if(!dom.getAttrib(elm,elementSelectionAttr)){elm.setAttribute(elementSelectionAttr,'1');}selectedElement=elm;hideFakeCaret();return range;};var setElementSelection=function setElementSelection(range,forward){if(!range){return null;}if(range.collapsed){if(!isRangeInCaretContainer(range)){var dir=forward?1:-1;var caretPosition=getNormalizedRangeEndPoint(dir,rootNode,range);var beforeNode=caretPosition.getNode(!forward);if(isFakeCaretTarget(beforeNode)){return showCaret(dir,beforeNode,forward?!caretPosition.isAtEnd():false,false);}var afterNode=caretPosition.getNode(forward);if(isFakeCaretTarget(afterNode)){return showCaret(dir,afterNode,forward?false:!caretPosition.isAtEnd(),false);}}return null;}var startContainer=range.startContainer;var startOffset=range.startOffset;var endOffset=range.endOffset;if(startContainer.nodeType===3&&startOffset===0&&isContentEditableFalse(startContainer.parentNode)){startContainer=startContainer.parentNode;startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode;}if(startContainer.nodeType!==1){return null;}if(endOffset===startOffset+1&&startContainer===range.endContainer){var _node20=startContainer.childNodes[startOffset];if(isFakeSelectionTargetElement(_node20)){return selectElement(_node20);}}return null;};var removeElementSelection=function removeElementSelection(){if(selectedElement){selectedElement.removeAttribute(elementSelectionAttr);}descendant(SugarElement.fromDom(editor.getBody()),'#'+realSelectionId).each(remove$6);selectedElement=null;};var destroy=function destroy(){fakeCaret.destroy();selectedElement=null;};var hideFakeCaret=function hideFakeCaret(){fakeCaret.hide();};if(!isRtc(editor)){registerEvents();}return{showCaret:showCaret,showBlockCaretContainer:showBlockCaretContainer,hideFakeCaret:hideFakeCaret,destroy:destroy};};var generatePath=function generatePath(root,node,offset){if(isText$9(node)&&(offset<0||offset>node.data.length)){return[];}var p=[offset];var current=node;while(current!==root&&current.parentNode){var _parent7=current.parentNode;for(var i=0;i<_parent7.childNodes.length;i++){if(_parent7.childNodes[i]===current){p.push(i);break;}}current=_parent7;}return current===root?p.reverse():[];};var generatePathRange=function generatePathRange(root,startNode,startOffset,endNode,endOffset){var start=generatePath(root,startNode,startOffset);var end=generatePath(root,endNode,endOffset);return{start:start,end:end};};var resolvePath=function resolvePath(root,path){var nodePath=path.slice();var offset=nodePath.pop();var resolvedNode=foldl(nodePath,function(optNode,index){return optNode.bind(function(node){return Optional.from(node.childNodes[index]);});},Optional.some(root));return resolvedNode.bind(function(node){if(isText$9(node)&&(offset<0||offset>node.data.length)){return Optional.none();}else{return Optional.some({node:node,offset:offset});}});};var resolvePathRange=function resolvePathRange(root,range){return resolvePath(root,range.start).bind(function(_ref14){var startNode=_ref14.node,startOffset=_ref14.offset;return resolvePath(root,range.end).map(function(_ref15){var endNode=_ref15.node,endOffset=_ref15.offset;var rng=document.createRange();rng.setStart(startNode,startOffset);rng.setEnd(endNode,endOffset);return rng;});});};var generatePathRangeFromRange=function generatePathRangeFromRange(root,range){return generatePathRange(root,range.startContainer,range.startOffset,range.endContainer,range.endOffset);};var cleanEmptyNodes=function cleanEmptyNodes(dom,node,isRoot){if(node&&dom.isEmpty(node)&&!isRoot(node)){var _parent8=node.parentNode;dom.remove(node);cleanEmptyNodes(dom,_parent8,isRoot);}};var deleteRng=function deleteRng(dom,rng,isRoot){var clean=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var startParent=rng.startContainer.parentNode;var endParent=rng.endContainer.parentNode;rng.deleteContents();if(clean&&!isRoot(rng.startContainer)){if(isText$9(rng.startContainer)&&rng.startContainer.data.length===0){dom.remove(rng.startContainer);}if(isText$9(rng.endContainer)&&rng.endContainer.data.length===0){dom.remove(rng.endContainer);}cleanEmptyNodes(dom,startParent,isRoot);if(startParent!==endParent){cleanEmptyNodes(dom,endParent,isRoot);}}};var getParentBlock=function getParentBlock(editor,rng){return Optional.from(editor.dom.getParent(rng.startContainer,editor.dom.isBlock));};var stripPattern=function stripPattern(dom,block,pattern){var firstTextNode=textAfter(block,0,block);firstTextNode.each(function(spot){var node=spot.container;scanRight(node,pattern.start.length,block).each(function(end){var rng=dom.createRng();rng.setStart(node,0);rng.setEnd(end.container,end.offset);deleteRng(dom,rng,function(e){return e===block;});});});};var applyPattern$1=function applyPattern$1(editor,match){var dom=editor.dom;var pattern=match.pattern;var rng=resolvePathRange(dom.getRoot(),match.range).getOrDie('Unable to resolve path range');var isBlockFormatName=function isBlockFormatName(name,formatter){var formatSet=formatter.get(name);return isArray$1(formatSet)&&head(formatSet).exists(function(format){return has$2(format,'block');});};getParentBlock(editor,rng).each(function(block){if(pattern.type==='block-format'){if(isBlockFormatName(pattern.format,editor.formatter)){editor.undoManager.transact(function(){stripPattern(editor.dom,block,pattern);editor.formatter.apply(pattern.format);});}}else if(pattern.type==='block-command'){editor.undoManager.transact(function(){stripPattern(editor.dom,block,pattern);editor.execCommand(pattern.cmd,false,pattern.value);});}});return true;};var findPattern$1=function findPattern$1(patterns,text){var nuText=text.replace(nbsp,' ');return find$2(patterns,function(pattern){return text.indexOf(pattern.start)===0||nuText.indexOf(pattern.start)===0;});};var findPatterns$1=function findPatterns$1(editor,patterns){var dom=editor.dom;var rng=editor.selection.getRng();return getParentBlock(editor,rng).filter(function(block){var forcedRootBlock=getForcedRootBlock(editor);var matchesForcedRootBlock=dom.is(block,forcedRootBlock);return block!==null&&matchesForcedRootBlock;}).bind(function(block){var blockText=block.textContent;var matchedPattern=findPattern$1(patterns,blockText);return matchedPattern.map(function(pattern){if(Tools.trim(blockText).length===pattern.start.length){return[];}return[{pattern:pattern,range:generatePathRange(dom.getRoot(),block,0,block,0)}];});}).getOr([]);};var applyMatches$1=function applyMatches$1(editor,matches){if(matches.length===0){return;}var bookmark=editor.selection.getBookmark();each$f(matches,function(match){return applyPattern$1(editor,match);});editor.selection.moveToBookmark(bookmark);};var newMarker=function newMarker(dom,id){return dom.create('span',{'data-mce-type':'bookmark',id:id});};var rangeFromMarker=function rangeFromMarker(dom,marker){var rng=dom.createRng();rng.setStartAfter(marker.start);rng.setEndBefore(marker.end);return rng;};var createMarker=function createMarker(dom,markerPrefix,pathRange){var rng=resolvePathRange(dom.getRoot(),pathRange).getOrDie('Unable to resolve path range');var startNode=rng.startContainer;var endNode=rng.endContainer;var textEnd=rng.endOffset===0?endNode:endNode.splitText(rng.endOffset);var textStart=rng.startOffset===0?startNode:startNode.splitText(rng.startOffset);return{prefix:markerPrefix,end:textEnd.parentNode.insertBefore(newMarker(dom,markerPrefix+'-end'),textEnd),start:textStart.parentNode.insertBefore(newMarker(dom,markerPrefix+'-start'),textStart)};};var removeMarker=function removeMarker(dom,marker,isRoot){cleanEmptyNodes(dom,dom.get(marker.prefix+'-end'),isRoot);cleanEmptyNodes(dom,dom.get(marker.prefix+'-start'),isRoot);};var isReplacementPattern=function isReplacementPattern(pattern){return pattern.start.length===0;};var matchesPattern=function matchesPattern(patternContent){return function(element,offset){var text=element.data;var searchText=text.substring(0,offset);var startEndIndex=searchText.lastIndexOf(patternContent.charAt(patternContent.length-1));var startIndex=searchText.lastIndexOf(patternContent);if(startIndex!==-1){return startIndex+patternContent.length;}else if(startEndIndex!==-1){return startEndIndex+1;}else{return-1;}};};var findPatternStartFromSpot=function findPatternStartFromSpot(dom,pattern,block,spot){var startPattern=pattern.start;var startSpot=repeatLeft(dom,spot.container,spot.offset,matchesPattern(startPattern),block);return startSpot.bind(function(spot){if(spot.offset>=startPattern.length){var rng=dom.createRng();rng.setStart(spot.container,spot.offset-startPattern.length);rng.setEnd(spot.container,spot.offset);return Optional.some(rng);}else{var offset=spot.offset-startPattern.length;return scanLeft(spot.container,offset,block).map(function(nextSpot){var rng=dom.createRng();rng.setStart(nextSpot.container,nextSpot.offset);rng.setEnd(spot.container,spot.offset);return rng;}).filter(function(rng){return rng.toString()===startPattern;}).orThunk(function(){return findPatternStartFromSpot(dom,pattern,block,point(spot.container,0));});}});};var findPatternStart=function findPatternStart(dom,pattern,node,offset,block){var requireGap=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(pattern.start.length===0&&!requireGap){var rng=dom.createRng();rng.setStart(node,offset);rng.setEnd(node,offset);return Optional.some(rng);}return textBefore(node,offset,block).bind(function(spot){var start=findPatternStartFromSpot(dom,pattern,block,spot);return start.bind(function(startRange){if(requireGap){if(startRange.endContainer===spot.container&&startRange.endOffset===spot.offset){return Optional.none();}else if(spot.offset===0&&startRange.endContainer.textContent.length===startRange.endOffset){return Optional.none();}}return Optional.some(startRange);});});};var findPattern=function findPattern(editor,block,details){var dom=editor.dom;var root=dom.getRoot();var pattern=details.pattern;var endNode=details.position.container;var endOffset=details.position.offset;return scanLeft(endNode,endOffset-details.pattern.end.length,block).bind(function(spot){var endPathRng=generatePathRange(root,spot.container,spot.offset,endNode,endOffset);if(isReplacementPattern(pattern)){return Optional.some({matches:[{pattern:pattern,startRng:endPathRng,endRng:endPathRng}],position:spot});}else{var resultsOpt=findPatternsRec(editor,details.remainingPatterns,spot.container,spot.offset,block);var results=resultsOpt.getOr({matches:[],position:spot});var pos=results.position;var _start2=findPatternStart(dom,pattern,pos.container,pos.offset,block,resultsOpt.isNone());return _start2.map(function(startRng){var startPathRng=generatePathRangeFromRange(root,startRng);return{matches:results.matches.concat([{pattern:pattern,startRng:startPathRng,endRng:endPathRng}]),position:point(startRng.startContainer,startRng.startOffset)};});}});};var findPatternsRec=function findPatternsRec(editor,patterns,node,offset,block){var dom=editor.dom;return textBefore(node,offset,dom.getRoot()).bind(function(endSpot){var rng=dom.createRng();rng.setStart(block,0);rng.setEnd(node,offset);var text=rng.toString();for(var i=0;i<patterns.length;i++){var pattern=patterns[i];if(!endsWith(text,pattern.end)){continue;}var patternsWithoutCurrent=patterns.slice();patternsWithoutCurrent.splice(i,1);var result=findPattern(editor,block,{pattern:pattern,remainingPatterns:patternsWithoutCurrent,position:endSpot});if(result.isSome()){return result;}}return Optional.none();});};var applyPattern=function applyPattern(editor,pattern,patternRange){editor.selection.setRng(patternRange);if(pattern.type==='inline-format'){each$f(pattern.format,function(format){editor.formatter.apply(format);});}else{editor.execCommand(pattern.cmd,false,pattern.value);}};var applyReplacementPattern=function applyReplacementPattern(editor,pattern,marker,isRoot){var markerRange=rangeFromMarker(editor.dom,marker);deleteRng(editor.dom,markerRange,isRoot);applyPattern(editor,pattern,markerRange);};var applyPatternWithContent=function applyPatternWithContent(editor,pattern,startMarker,endMarker,isRoot){var dom=editor.dom;var markerEndRange=rangeFromMarker(dom,endMarker);var markerStartRange=rangeFromMarker(dom,startMarker);deleteRng(dom,markerStartRange,isRoot);deleteRng(dom,markerEndRange,isRoot);var patternMarker={prefix:startMarker.prefix,start:startMarker.end,end:endMarker.start};var patternRange=rangeFromMarker(dom,patternMarker);applyPattern(editor,pattern,patternRange);};var addMarkers=function addMarkers(dom,matches){var markerPrefix=generate$1('mce_textpattern');var matchesWithEnds=foldr(matches,function(acc,match){var endMarker=createMarker(dom,markerPrefix+"_end".concat(acc.length),match.endRng);return acc.concat([_objectSpread({},match,{endMarker:endMarker})]);},[]);return foldr(matchesWithEnds,function(acc,match){var idx=matchesWithEnds.length-acc.length-1;var startMarker=isReplacementPattern(match.pattern)?match.endMarker:createMarker(dom,markerPrefix+"_start".concat(idx),match.startRng);return acc.concat([_objectSpread({},match,{startMarker:startMarker})]);},[]);};var findPatterns=function findPatterns(editor,patterns,space){var rng=editor.selection.getRng();if(rng.collapsed===false){return[];}return getParentBlock(editor,rng).bind(function(block){var offset=Math.max(0,rng.startOffset-(space?1:0));return findPatternsRec(editor,patterns,rng.startContainer,offset,block);}).fold(function(){return[];},function(result){return result.matches;});};var applyMatches=function applyMatches(editor,matches){if(matches.length===0){return;}var dom=editor.dom;var bookmark=editor.selection.getBookmark();var matchesWithMarkers=addMarkers(dom,matches);each$f(matchesWithMarkers,function(match){var block=dom.getParent(match.startMarker.start,dom.isBlock);var isRoot=function isRoot(node){return node===block;};if(isReplacementPattern(match.pattern)){applyReplacementPattern(editor,match.pattern,match.endMarker,isRoot);}else{applyPatternWithContent(editor,match.pattern,match.startMarker,match.endMarker,isRoot);}removeMarker(dom,match.endMarker,isRoot);removeMarker(dom,match.startMarker,isRoot);});editor.selection.moveToBookmark(bookmark);};var hasPatterns=function hasPatterns(patternSet){return patternSet.inlinePatterns.length>0||patternSet.blockPatterns.length>0;};var handleEnter=function handleEnter(editor,patternSet){if(!editor.selection.isCollapsed()||!hasPatterns(patternSet)){return false;}var inlineMatches=findPatterns(editor,patternSet.inlinePatterns,false);var blockMatches=findPatterns$1(editor,patternSet.blockPatterns);if(blockMatches.length>0||inlineMatches.length>0){editor.undoManager.add();editor.undoManager.extra(function(){editor.execCommand('mceInsertNewLine');},function(){editor.insertContent(zeroWidth);applyMatches(editor,inlineMatches);applyMatches$1(editor,blockMatches);var range=editor.selection.getRng();var spot=textBefore(range.startContainer,range.startOffset,editor.dom.getRoot());editor.execCommand('mceInsertNewLine');spot.each(function(s){var node=s.container;if(node.data.charAt(s.offset-1)===zeroWidth){node.deleteData(s.offset-1,1);cleanEmptyNodes(editor.dom,node.parentNode,function(e){return e===editor.dom.getRoot();});}});});return true;}return false;};var handleInlineKey=function handleInlineKey(editor,inlinePatterns){if(inlinePatterns.length>0){var inlineMatches=findPatterns(editor,inlinePatterns,true);if(inlineMatches.length>0){editor.undoManager.transact(function(){applyMatches(editor,inlineMatches);});}}};var checkKeyEvent=function checkKeyEvent(codes,event,predicate){for(var i=0;i<codes.length;i++){if(predicate(codes[i],event)){return true;}}return false;};var checkKeyCode=function checkKeyCode(codes,event){return checkKeyEvent(codes,event,function(code,event){return code===event.keyCode&&VK.modifierPressed(event)===false;});};var checkCharCode=function checkCharCode(chars,event){return checkKeyEvent(chars,event,function(chr,event){return chr.charCodeAt(0)===event.charCode;});};var setup$2=function setup$2(editor){var charCodes=[',','.',';',':','!','?'];var keyCodes=[32];var getPatternSet=function getPatternSet(){return createPatternSet(getTextPatterns(editor));};var getInlinePatterns$1=function getInlinePatterns$1(){return getInlinePatterns(getTextPatterns(editor));};editor.on('keydown',function(e){if(e.keyCode===13&&!VK.modifierPressed(e)){if(handleEnter(editor,getPatternSet())){e.preventDefault();}}},true);editor.on('keyup',function(e){if(checkKeyCode(keyCodes,e)){handleInlineKey(editor,getInlinePatterns$1());}});editor.on('keypress',function(e){if(checkCharCode(charCodes,e)){Delay.setEditorTimeout(editor,function(){handleInlineKey(editor,getInlinePatterns$1());});}});};var setup$1=function setup$1(editor){setup$2(editor);};var Quirks=function Quirks(editor){var each=Tools.each;var BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,parser=editor.parser;var browser=Env.browser;var isGecko=browser.isFirefox();var isWebKit=browser.isChromium()||browser.isSafari();var isiOS=Env.deviceType.isiPhone()||Env.deviceType.isiPad();var isMac=Env.os.isMacOS()||Env.os.isiOS();var setEditorCommandState=function setEditorCommandState(cmd,state){try{editor.getDoc().execCommand(cmd,false,state);}catch(ex){}};var isDefaultPrevented=function isDefaultPrevented(e){return e.isDefaultPrevented();};var emptyEditorWhenDeleting=function emptyEditorWhenDeleting(){var serializeRng=function serializeRng(rng){var body=dom.create('body');var contents=rng.cloneContents();body.appendChild(contents);return selection.serializer.serialize(body,{format:'html'});};var allContentsSelected=function allContentsSelected(rng){var selection=serializeRng(rng);var allRng=dom.createRng();allRng.selectNode(editor.getBody());var allSelection=serializeRng(allRng);return selection===allSelection;};editor.on('keydown',function(e){var keyCode=e.keyCode;var isCollapsed,body;if(!isDefaultPrevented(e)&&(keyCode===DELETE||keyCode===BACKSPACE)){isCollapsed=editor.selection.isCollapsed();body=editor.getBody();if(isCollapsed&&!dom.isEmpty(body)){return;}if(!isCollapsed&&!allContentsSelected(editor.selection.getRng())){return;}e.preventDefault();editor.setContent('');if(body.firstChild&&dom.isBlock(body.firstChild)){editor.selection.setCursorLocation(body.firstChild,0);}else{editor.selection.setCursorLocation(body,0);}editor.nodeChanged();}});};var selectAll=function selectAll(){editor.shortcuts.add('meta+a',null,'SelectAll');};var documentElementEditingFocus=function documentElementEditingFocus(){if(!editor.inline){dom.bind(editor.getDoc(),'mousedown mouseup',function(e){var rng;if(e.target===editor.getDoc().documentElement){rng=selection.getRng();editor.getBody().focus();if(e.type==='mousedown'){if(isCaretContainer$2(rng.startContainer)){return;}selection.placeCaretAt(e.clientX,e.clientY);}else{selection.setRng(rng);}}});}};var removeHrOnBackspace=function removeHrOnBackspace(){editor.on('keydown',function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName('hr').length){return;}if(selection.isCollapsed()&&selection.getRng().startOffset===0){var _node21=selection.getNode();var previousSibling=_node21.previousSibling;if(_node21.nodeName==='HR'){dom.remove(_node21);e.preventDefault();return;}if(previousSibling&&previousSibling.nodeName&&previousSibling.nodeName.toLowerCase()==='hr'){dom.remove(previousSibling);e.preventDefault();}}}});};var focusBody=function focusBody(){if(!Range.prototype.getClientRects){editor.on('mousedown',function(e){if(!isDefaultPrevented(e)&&e.target.nodeName==='HTML'){var body=editor.getBody();body.blur();Delay.setEditorTimeout(editor,function(){body.focus();});}});}};var selectControlElements=function selectControlElements(){var visualAidsAnchorClass=getVisualAidsAnchorClass(editor);editor.on('click',function(e){var target=e.target;if(/^(IMG|HR)$/.test(target.nodeName)&&dom.getContentEditableParent(target)!=='false'){e.preventDefault();editor.selection.select(target);editor.nodeChanged();}if(target.nodeName==='A'&&dom.hasClass(target,visualAidsAnchorClass)&&target.childNodes.length===0){e.preventDefault();selection.select(target);}});};var removeStylesWhenDeletingAcrossBlockElements=function removeStylesWhenDeletingAcrossBlockElements(){var getAttributeApplyFunction=function getAttributeApplyFunction(){var template=dom.getAttribs(selection.getStart().cloneNode(false));return function(){var target=selection.getStart();if(target!==editor.getBody()){dom.setAttrib(target,'style',null);each(template,function(attr){target.setAttributeNode(attr.cloneNode(true));});}};};var isSelectionAcrossElements=function isSelectionAcrossElements(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!==dom.getParent(selection.getEnd(),dom.isBlock);};editor.on('keypress',function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(e.keyCode===8||e.keyCode===46)&&isSelectionAcrossElements()){applyAttributes=getAttributeApplyFunction();editor.getDoc().execCommand('delete',false,null);applyAttributes();e.preventDefault();return false;}});dom.bind(editor.getDoc(),'cut',function(e){var applyAttributes;if(!isDefaultPrevented(e)&&isSelectionAcrossElements()){applyAttributes=getAttributeApplyFunction();Delay.setEditorTimeout(editor,function(){applyAttributes();});}});};var disableBackspaceIntoATable=function disableBackspaceIntoATable(){editor.on('keydown',function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(selection.isCollapsed()&&selection.getRng().startOffset===0){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&previousSibling.nodeName.toLowerCase()==='table'){e.preventDefault();return false;}}}});};var removeBlockQuoteOnBackSpace=function removeBlockQuoteOnBackSpace(){editor.on('keydown',function(e){var rng,parent;if(isDefaultPrevented(e)||e.keyCode!==VK.BACKSPACE){return;}rng=selection.getRng();var container=rng.startContainer;var offset=rng.startOffset;var root=dom.getRoot();parent=container;if(!rng.collapsed||offset!==0){return;}while(parent&&parent.parentNode&&parent.parentNode.firstChild===parent&&parent.parentNode!==root){parent=parent.parentNode;}if(parent.tagName==='BLOCKQUOTE'){editor.formatter.toggle('blockquote',null,parent);rng=dom.createRng();rng.setStart(container,0);rng.setEnd(container,0);selection.setRng(rng);}});};var setGeckoEditingOptions=function setGeckoEditingOptions(){var setOpts=function setOpts(){setEditorCommandState('StyleWithCSS',false);setEditorCommandState('enableInlineTableEditing',false);if(!getObjectResizing(editor)){setEditorCommandState('enableObjectResizing',false);}};if(!isReadOnly$1(editor)){editor.on('BeforeExecCommand mousedown',setOpts);}};var addBrAfterLastLinks=function addBrAfterLastLinks(){var fixLinks=function fixLinks(){each(dom.select('a'),function(node){var parentNode=node.parentNode;var root=dom.getRoot();if(parentNode.lastChild===node){while(parentNode&&!dom.isBlock(parentNode)){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root){return;}parentNode=parentNode.parentNode;}dom.add(parentNode,'br',{'data-mce-bogus':1});}});};editor.on('SetContent ExecCommand',function(e){if(e.type==='setcontent'||e.command==='mceInsertLink'){fixLinks();}});};var setDefaultBlockType=function setDefaultBlockType(){editor.on('init',function(){setEditorCommandState('DefaultParagraphSeparator',getForcedRootBlock(editor));});};var isAllContentSelected=function isAllContentSelected(editor){var body=editor.getBody();var rng=editor.selection.getRng();return rng.startContainer===rng.endContainer&&rng.startContainer===body&&rng.startOffset===0&&rng.endOffset===body.childNodes.length;};var normalizeSelection=function normalizeSelection(){editor.on('keyup focusin mouseup',function(e){if(!VK.modifierPressed(e)&&!isAllContentSelected(editor)){selection.normalize();}},true);};var showBrokenImageIcon=function showBrokenImageIcon(){editor.contentStyles.push('img:-moz-broken {'+'-moz-force-broken-image-icon:1;'+'min-width:24px;'+'min-height:24px'+'}');};var restoreFocusOnKeyDown=function restoreFocusOnKeyDown(){if(!editor.inline){editor.on('keydown',function(){if(document.activeElement===document.body){editor.getWin().focus();}});}};var bodyHeight=function bodyHeight(){if(!editor.inline){editor.contentStyles.push('body {min-height: 150px}');editor.on('click',function(e){var rng;if(e.target.nodeName==='HTML'){rng=editor.selection.getRng();editor.getBody().focus();editor.selection.setRng(rng);editor.selection.normalize();editor.nodeChanged();}});}};var blockCmdArrowNavigation=function blockCmdArrowNavigation(){if(isMac){editor.on('keydown',function(e){if(VK.metaKeyPressed(e)&&!e.shiftKey&&(e.keyCode===37||e.keyCode===39)){e.preventDefault();var _selection=editor.selection.getSel();_selection.modify('move',e.keyCode===37?'backward':'forward','lineboundary');}});}};var tapLinksAndImages=function tapLinksAndImages(){editor.on('click',function(e){var elm=e.target;do{if(elm.tagName==='A'){e.preventDefault();return;}}while(elm=elm.parentNode);});editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');};var blockFormSubmitInsideEditor=function blockFormSubmitInsideEditor(){editor.on('init',function(){editor.dom.bind(editor.getBody(),'submit',function(e){e.preventDefault();});});};var removeAppleInterchangeBrs=function removeAppleInterchangeBrs(){parser.addNodeFilter('br',function(nodes){var i=nodes.length;while(i--){if(nodes[i].attr('class')==='Apple-interchange-newline'){nodes[i].remove();}}});};var refreshContentEditable=noop;var isHidden=function isHidden(){if(!isGecko||editor.removed){return false;}var sel=editor.selection.getSel();return!sel||!sel.rangeCount||sel.rangeCount===0;};var setupRtc=function setupRtc(){if(isWebKit){documentElementEditingFocus();selectControlElements();blockFormSubmitInsideEditor();selectAll();if(isiOS){restoreFocusOnKeyDown();bodyHeight();tapLinksAndImages();}}if(isGecko){focusBody();setGeckoEditingOptions();showBrokenImageIcon();blockCmdArrowNavigation();}};var setup=function setup(){removeBlockQuoteOnBackSpace();emptyEditorWhenDeleting();if(!Env.windowsPhone){normalizeSelection();}if(isWebKit){documentElementEditingFocus();selectControlElements();setDefaultBlockType();blockFormSubmitInsideEditor();disableBackspaceIntoATable();removeAppleInterchangeBrs();if(isiOS){restoreFocusOnKeyDown();bodyHeight();tapLinksAndImages();}else{selectAll();}}if(isGecko){removeHrOnBackspace();focusBody();removeStylesWhenDeletingAcrossBlockElements();setGeckoEditingOptions();addBrAfterLastLinks();showBrokenImageIcon();blockCmdArrowNavigation();disableBackspaceIntoATable();}};if(isRtc(editor)){setupRtc();}else{setup();}return{refreshContentEditable:refreshContentEditable,isHidden:isHidden};};var DOM$6=DOMUtils.DOM;var appendStyle=function appendStyle(editor,text){var body=SugarElement.fromDom(editor.getBody());var container=getStyleContainer(getRootNode(body));var style=SugarElement.fromTag('style');set$2(style,'type','text/css');append$1(style,SugarElement.fromText(text));append$1(container,style);editor.on('remove',function(){remove$6(style);});};var getRootName=function getRootName(editor){return editor.inline?editor.getElement().nodeName.toLowerCase():undefined;};var removeUndefined=function removeUndefined(obj){return filter$5(obj,function(v){return isUndefined(v)===false;});};var mkParserSettings=function mkParserSettings(editor){var getOption=editor.options.get;var blobCache=editor.editorUpload.blobCache;return removeUndefined({allow_conditional_comments:getOption('allow_conditional_comments'),allow_html_data_urls:getOption('allow_html_data_urls'),allow_svg_data_urls:getOption('allow_svg_data_urls'),allow_html_in_named_anchor:getOption('allow_html_in_named_anchor'),allow_script_urls:getOption('allow_script_urls'),allow_unsafe_link_target:getOption('allow_unsafe_link_target'),convert_fonts_to_spans:getOption('convert_fonts_to_spans'),fix_list_elements:getOption('fix_list_elements'),font_size_legacy_values:getOption('font_size_legacy_values'),forced_root_block:getOption('forced_root_block'),forced_root_block_attrs:getOption('forced_root_block_attrs'),preserve_cdata:getOption('preserve_cdata'),remove_trailing_brs:getOption('remove_trailing_brs'),inline_styles:getOption('inline_styles'),root_name:getRootName(editor),validate:true,blob_cache:blobCache,document:editor.getDoc()});};var mkSchemaSettings=function mkSchemaSettings(editor){var getOption=editor.options.get;return removeUndefined({custom_elements:getOption('custom_elements'),extended_valid_elements:getOption('extended_valid_elements'),invalid_elements:getOption('invalid_elements'),invalid_styles:getOption('invalid_styles'),schema:getOption('schema'),valid_children:getOption('valid_children'),valid_classes:getOption('valid_classes'),valid_elements:getOption('valid_elements'),valid_styles:getOption('valid_styles'),verify_html:getOption('verify_html'),padd_empty_block_inline_children:getOption('format_empty_lines')});};var mkSerializerSettings=function mkSerializerSettings(editor){var getOption=editor.options.get;return _objectSpread({},mkParserSettings(editor),{},mkSchemaSettings(editor),{},removeUndefined({url_converter:getOption('url_converter'),url_converter_scope:getOption('url_converter_scope'),element_format:getOption('element_format'),entities:getOption('entities'),entity_encoding:getOption('entity_encoding'),indent:getOption('indent'),indent_after:getOption('indent_after'),indent_before:getOption('indent_before')}));};var createParser=function createParser(editor){var parser=DomParser(mkParserSettings(editor),editor.schema);parser.addAttributeFilter('src,href,style,tabindex',function(nodes,name){var i=nodes.length,node,value;var dom=editor.dom;var internalName='data-mce-'+name;while(i--){node=nodes[i];value=node.attr(name);if(value&&!node.attr(internalName)){if(value.indexOf('data:')===0||value.indexOf('blob:')===0){continue;}if(name==='style'){value=dom.serializeStyle(dom.parseStyle(value),node.name);if(!value.length){value=null;}node.attr(internalName,value);node.attr(name,value);}else if(name==='tabindex'){node.attr(internalName,value);node.attr(name,null);}else{node.attr(internalName,editor.convertURL(value,name,node.name));}}}});parser.addNodeFilter('script',function(nodes){var i=nodes.length;while(i--){var _node22=nodes[i];var _type2=_node22.attr('type')||'no/type';if(_type2.indexOf('mce-')!==0){_node22.attr('type','mce-'+_type2);}}});if(editor.options.get('preserve_cdata')){parser.addNodeFilter('#cdata',function(nodes){var i=nodes.length;while(i--){var _node23=nodes[i];_node23.type=8;_node23.name='#comment';_node23.value='[CDATA['+editor.dom.encode(_node23.value)+']]';}});}parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div',function(nodes){var i=nodes.length;var nonEmptyElements=editor.schema.getNonEmptyElements();while(i--){var _node24=nodes[i];if(_node24.isEmpty(nonEmptyElements)&&_node24.getAll('br').length===0){_node24.append(new AstNode('br',1));}}});return parser;};var autoFocus=function autoFocus(editor){var autoFocus=getAutoFocus(editor);if(autoFocus){Delay.setEditorTimeout(editor,function(){var focusEditor;if(autoFocus===true){focusEditor=editor;}else{focusEditor=editor.editorManager.get(autoFocus);}if(!focusEditor.destroyed){focusEditor.focus();}},100);}};var moveSelectionToFirstCaretPosition=function moveSelectionToFirstCaretPosition(editor){var root=editor.dom.getRoot();if(!editor.inline&&(!hasAnyRanges(editor)||editor.selection.getStart(true)===root)){firstPositionIn(root).each(function(pos){var node=pos.getNode();var caretPos=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange());});}};var initEditor=function initEditor(editor){editor.bindPendingEventDelegates();editor.initialized=true;fireInit(editor);editor.focus(true);moveSelectionToFirstCaretPosition(editor);editor.nodeChanged({initial:true});var initInstanceCallback=getInitInstanceCallback(editor);if(isFunction(initInstanceCallback)){initInstanceCallback.call(editor,editor);}autoFocus(editor);};var getStyleSheetLoader$1=function getStyleSheetLoader$1(editor){return editor.inline?editor.ui.styleSheetLoader:editor.dom.styleSheetLoader;};var makeStylesheetLoadingPromises=function makeStylesheetLoadingPromises(editor,css,framedFonts){var promises=[getStyleSheetLoader$1(editor).loadAll(css)];if(editor.inline){return promises;}else{return promises.concat([editor.ui.styleSheetLoader.loadAll(framedFonts)]);}};var loadContentCss=function loadContentCss(editor){var styleSheetLoader=getStyleSheetLoader$1(editor);var fontCss=getFontCss(editor);var css=editor.contentCSS;var removeCss=function removeCss(){styleSheetLoader.unloadAll(css);if(!editor.inline){editor.ui.styleSheetLoader.unloadAll(fontCss);}};var loaded=function loaded(){if(editor.removed){removeCss();}else{editor.on('remove',removeCss);}};if(editor.contentStyles.length>0){var contentCssText='';Tools.each(editor.contentStyles,function(style){contentCssText+=style+'\r\n';});editor.dom.addStyle(contentCssText);}var allStylesheets=Promise.all(makeStylesheetLoadingPromises(editor,css,fontCss)).then(loaded)["catch"](loaded);var contentStyle=getContentStyle(editor);if(contentStyle){appendStyle(editor,contentStyle);}return allStylesheets;};var preInit=function preInit(editor){var doc=editor.getDoc(),body=editor.getBody();firePreInit(editor);if(!shouldBrowserSpellcheck(editor)){doc.body.spellcheck=false;DOM$6.setAttrib(body,'spellcheck','false');}editor.quirks=Quirks(editor);firePostRender(editor);var directionality=getDirectionality(editor);if(directionality!==undefined){body.dir=directionality;}var protect=getProtect(editor);if(protect){editor.on('BeforeSetContent',function(e){Tools.each(protect,function(pattern){e.content=e.content.replace(pattern,function(str){return'<!--mce:protected '+escape(str)+'-->';});});});}editor.on('SetContent',function(){editor.addVisual(editor.getBody());});editor.on('compositionstart compositionend',function(e){editor.composing=e.type==='compositionstart';});};var loadInitialContent=function loadInitialContent(editor){if(!isRtc(editor)){editor.load({initial:true,format:'html'});}editor.startContent=editor.getContent({format:'raw'});};var initEditorWithInitialContent=function initEditorWithInitialContent(editor){if(editor.removed!==true){loadInitialContent(editor);initEditor(editor);}};var contentBodyLoaded=function contentBodyLoaded(editor){var targetElm=editor.getElement();var doc=editor.getDoc();if(editor.inline){DOM$6.addClass(targetElm,'mce-content-body');editor.contentDocument=doc=document;editor.contentWindow=window;editor.bodyElement=targetElm;editor.contentAreaContainer=targetElm;}var body=editor.getBody();body.disabled=true;editor.readonly=isReadOnly$1(editor);if(!editor.readonly){if(editor.inline&&DOM$6.getStyle(body,'position',true)==='static'){body.style.position='relative';}body.contentEditable='true';}body.disabled=false;editor.editorUpload=EditorUpload(editor);editor.schema=Schema(mkSchemaSettings(editor));editor.dom=DOMUtils(doc,{keep_values:true,url_converter:editor.convertURL,url_converter_scope:editor,update_styles:true,root_element:editor.inline?editor.getBody():null,collect:function collect(){return editor.inline;},schema:editor.schema,contentCssCors:shouldUseContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor),onSetAttrib:function onSetAttrib(e){editor.dispatch('SetAttrib',e);}});editor.parser=createParser(editor);editor.serializer=DomSerializer(mkSerializerSettings(editor),editor);editor.selection=EditorSelection(editor.dom,editor.getWin(),editor.serializer,editor);editor.annotator=Annotator(editor);editor.formatter=Formatter(editor);editor.undoManager=UndoManager(editor);editor._nodeChangeDispatcher=new NodeChange(editor);editor._selectionOverrides=SelectionOverrides(editor);setup$o(editor);setup$6(editor);setup$m(editor);if(!isRtc(editor)){setup$5(editor);setup$1(editor);}var caret=setup$b(editor);setup$p(editor,caret);setup$n(editor);setup$q(editor);setup$7(editor);var setupRtcThunk=setup$s(editor);preInit(editor);setupRtcThunk.fold(function(){loadContentCss(editor).then(function(){return initEditorWithInitialContent(editor);});},function(setupRtc){editor.setProgressState(true);loadContentCss(editor).then(function(){setupRtc().then(function(_rtcMode){editor.setProgressState(false);initEditorWithInitialContent(editor);bindEvents(editor);},function(err){editor.notificationManager.open({type:'error',text:String(err)});initEditorWithInitialContent(editor);bindEvents(editor);});});});};var initContentBody=function initContentBody(editor,skipWrite){if(!editor.inline){editor.getElement().style.visibility=editor.orgVisibility;}if(!skipWrite&&!editor.inline){var iframe=editor.iframeElement;var _binder=bind$1(SugarElement.fromDom(iframe),'load',function(){_binder.unbind();editor.contentDocument=iframe.contentDocument;contentBodyLoaded(editor);});if(Env.browser.isFirefox()){var doc=editor.getDoc();doc.open();doc.write(editor.iframeHTML);doc.close();}else{iframe.srcdoc=editor.iframeHTML;}}else{contentBodyLoaded(editor);}};var DOM$5=DOMUtils.DOM;var createIframeElement=function createIframeElement(id,title,customAttrs,tabindex){var iframe=SugarElement.fromTag('iframe');tabindex.each(function(t){return set$2(iframe,'tabindex',t);});setAll$1(iframe,customAttrs);setAll$1(iframe,{id:id+'_ifr',frameBorder:'0',allowTransparency:'true',title:title});add$2(iframe,'tox-edit-area__iframe');return iframe;};var getIframeHtml=function getIframeHtml(editor){var iframeHTML=getDocType(editor)+'<html><head>';if(getDocumentBaseUrl(editor)!==editor.documentBaseUrl){iframeHTML+='<base href="'+editor.documentBaseURI.getURI()+'" />';}iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';var bodyId=getBodyId(editor);var bodyClass=getBodyClass(editor);var translatedAriaText=editor.translate(getIframeAriaText(editor));if(getContentSecurityPolicy(editor)){iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+getContentSecurityPolicy(editor)+'" />';}iframeHTML+='</head>'+"<body id=\"".concat(bodyId,"\" class=\"mce-content-body ").concat(bodyClass,"\" data-id=\"").concat(editor.id,"\" aria-label=\"").concat(translatedAriaText,"\">")+'<br>'+'</body></html>';return iframeHTML;};var createIframe=function createIframe(editor,boxInfo){var iframeTitle=editor.translate('Rich Text Area');var tabindex=getOpt(SugarElement.fromDom(editor.getElement()),'tabindex').bind(toInt);var ifr=createIframeElement(editor.id,iframeTitle,getIframeAttrs(editor),tabindex).dom;ifr.onload=function(){ifr.onload=null;editor.dispatch('load');};editor.contentAreaContainer=boxInfo.iframeContainer;editor.iframeElement=ifr;editor.iframeHTML=getIframeHtml(editor);DOM$5.add(boxInfo.iframeContainer,ifr);};var init$1=function init$1(editor,boxInfo){createIframe(editor,boxInfo);if(boxInfo.editorContainer){DOM$5.get(boxInfo.editorContainer).style.display=editor.orgDisplay;editor.hidden=DOM$5.isHidden(boxInfo.editorContainer);}editor.getElement().style.display='none';DOM$5.setAttrib(editor.id,'aria-hidden','true');initContentBody(editor);};var DOM$4=DOMUtils.DOM;var initPlugin=function initPlugin(editor,initializedPlugins,plugin){var Plugin=PluginManager.get(plugin);var pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\/$/,'');plugin=Tools.trim(plugin);if(Plugin&&Tools.inArray(initializedPlugins,plugin)===-1){if(editor.plugins[plugin]){return;}try{var pluginInstance=Plugin(editor,pluginUrl)||{};editor.plugins[plugin]=pluginInstance;if(isFunction(pluginInstance.init)){pluginInstance.init(editor,pluginUrl);initializedPlugins.push(plugin);}}catch(e){pluginInitError(editor,plugin,e);}}};var trimLegacyPrefix=function trimLegacyPrefix(name){return name.replace(/^\-/,'');};var initPlugins=function initPlugins(editor){var initializedPlugins=[];each$f(getPlugins(editor),function(name){initPlugin(editor,initializedPlugins,trimLegacyPrefix(name));});};var initIcons=function initIcons(editor){var iconPackName=Tools.trim(getIconPackName(editor));var currentIcons=editor.ui.registry.getAll().icons;var loadIcons=_objectSpread({},IconManager.get('default').icons,{},IconManager.get(iconPackName).icons);each$e(loadIcons,function(svgData,icon){if(!has$2(currentIcons,icon)){editor.ui.registry.addIcon(icon,svgData);}});};var initTheme=function initTheme(editor){var theme=getTheme(editor);if(isString(theme)){var Theme=ThemeManager.get(theme);editor.theme=Theme(editor,ThemeManager.urls[theme])||{};if(isFunction(editor.theme.init)){editor.theme.init(editor,ThemeManager.urls[theme]||editor.documentBaseUrl.replace(/\/$/,''));}}else{editor.theme={};}};var initModel=function initModel(editor){var model=getModel(editor);var Model=ModelManager.get(model);editor.model=Model(editor,ModelManager.urls[model]);};var renderFromLoadedTheme=function renderFromLoadedTheme(editor){return editor.theme.renderUI();};var renderFromThemeFunc=function renderFromThemeFunc(editor){var elm=editor.getElement();var theme=getTheme(editor);var info=theme(editor,elm);if(info.editorContainer.nodeType){info.editorContainer.id=info.editorContainer.id||editor.id+'_parent';}if(info.iframeContainer&&info.iframeContainer.nodeType){info.iframeContainer.id=info.iframeContainer.id||editor.id+'_iframecontainer';}info.height=info.iframeHeight?info.iframeHeight:elm.offsetHeight;return info;};var createThemeFalseResult=function createThemeFalseResult(element){return{editorContainer:element,iframeContainer:element,api:{}};};var renderThemeFalseIframe=function renderThemeFalseIframe(targetElement){var iframeContainer=DOM$4.create('div');DOM$4.insertAfter(iframeContainer,targetElement);return createThemeFalseResult(iframeContainer);};var renderThemeFalse=function renderThemeFalse(editor){var targetElement=editor.getElement();return editor.inline?createThemeFalseResult(null):renderThemeFalseIframe(targetElement);};var renderThemeUi=function renderThemeUi(editor){var elm=editor.getElement();editor.orgDisplay=elm.style.display;if(isString(getTheme(editor))){return renderFromLoadedTheme(editor);}else if(isFunction(getTheme(editor))){return renderFromThemeFunc(editor);}else{return renderThemeFalse(editor);}};var augmentEditorUiApi=function augmentEditorUiApi(editor,api){var uiApiFacade={show:Optional.from(api.show).getOr(noop),hide:Optional.from(api.hide).getOr(noop),isEnabled:Optional.from(api.isEnabled).getOr(always),setEnabled:function setEnabled(state){if(!editor.mode.isReadOnly()){Optional.from(api.setEnabled).each(function(f){return f(state);});}}};editor.ui=_objectSpread({},editor.ui,{},uiApiFacade);};var init=function init(editor){editor.dispatch('ScriptsLoaded');initIcons(editor);initTheme(editor);initModel(editor);initPlugins(editor);var renderInfo=renderThemeUi(editor);augmentEditorUiApi(editor,Optional.from(renderInfo.api).getOr({}));var boxInfo={editorContainer:renderInfo.editorContainer,iframeContainer:renderInfo.iframeContainer};editor.editorContainer=boxInfo.editorContainer?boxInfo.editorContainer:null;appendContentCssFromSettings(editor);if(editor.inline){return initContentBody(editor);}else{return init$1(editor,boxInfo);}};var DOM$3=DOMUtils.DOM;var hasSkipLoadPrefix=function hasSkipLoadPrefix(name){return name.charAt(0)==='-';};var loadLanguage=function loadLanguage(scriptLoader,editor){var languageCode=getLanguageCode(editor);var languageUrl=getLanguageUrl(editor);if(I18n.hasCode(languageCode)===false&&languageCode!=='en'){var url=isNotEmpty(languageUrl)?languageUrl:"".concat(editor.editorManager.baseURL,"/langs/").concat(languageCode,".js");scriptLoader.add(url)["catch"](function(){languageLoadError(editor,url,languageCode);});}};var loadTheme=function loadTheme(editor,suffix){var theme=getTheme(editor);if(isString(theme)&&!hasSkipLoadPrefix(theme)&&!has$2(ThemeManager.urls,theme)){var themeUrl=getThemeUrl(editor);var url=themeUrl?editor.documentBaseURI.toAbsolute(themeUrl):"themes/".concat(theme,"/theme").concat(suffix,".js");ThemeManager.load(theme,url)["catch"](function(){themeLoadError(editor,url,theme);});}};var loadModel=function loadModel(editor,suffix){var model=getModel(editor);if(model!=='plugin'&&!has$2(ModelManager.urls,model)){var modelUrl=getModelUrl(editor);var url=isString(modelUrl)?editor.documentBaseURI.toAbsolute(modelUrl):"models/".concat(model,"/model").concat(suffix,".js");ModelManager.load(model,url)["catch"](function(){modelLoadError(editor,url,model);});}};var getIconsUrlMetaFromUrl=function getIconsUrlMetaFromUrl(editor){return Optional.from(getIconsUrl(editor)).filter(isNotEmpty).map(function(url){return{url:url,name:Optional.none()};});};var getIconsUrlMetaFromName=function getIconsUrlMetaFromName(editor,name,suffix){return Optional.from(name).filter(function(name){return isNotEmpty(name)&&!IconManager.has(name);}).map(function(name){return{url:"".concat(editor.editorManager.baseURL,"/icons/").concat(name,"/icons").concat(suffix,".js"),name:Optional.some(name)};});};var loadIcons=function loadIcons(scriptLoader,editor,suffix){var defaultIconsUrl=getIconsUrlMetaFromName(editor,'default',suffix);var customIconsUrl=getIconsUrlMetaFromUrl(editor).orThunk(function(){return getIconsUrlMetaFromName(editor,getIconPackName(editor),'');});each$f(cat([defaultIconsUrl,customIconsUrl]),function(urlMeta){scriptLoader.add(urlMeta.url)["catch"](function(){iconsLoadError(editor,urlMeta.url,urlMeta.name.getOrUndefined());});});};var loadPlugins=function loadPlugins(editor,suffix){var loadPlugin=function loadPlugin(name,url){PluginManager.load(name,url)["catch"](function(){pluginLoadError(editor,url,name);});};each$e(getExternalPlugins$1(editor),function(url,name){loadPlugin(name,url);editor.options.set('plugins',getPlugins(editor).concat(name));});each$f(getPlugins(editor),function(plugin){plugin=Tools.trim(plugin);if(plugin&&!PluginManager.urls[plugin]&&!hasSkipLoadPrefix(plugin)){loadPlugin(plugin,"plugins/".concat(plugin,"/plugin").concat(suffix,".js"));}});};var isThemeLoaded=function isThemeLoaded(editor){var theme=getTheme(editor);return!isString(theme)||isNonNullable(ThemeManager.get(theme));};var isModelLoaded=function isModelLoaded(editor){var model=getModel(editor);return isNonNullable(ModelManager.get(model));};var loadScripts=function loadScripts(editor,suffix){var scriptLoader=ScriptLoader.ScriptLoader;var initEditor=function initEditor(){if(!editor.removed&&isThemeLoaded(editor)&&isModelLoaded(editor)){init(editor);}};loadTheme(editor,suffix);loadModel(editor,suffix);loadLanguage(scriptLoader,editor);loadIcons(scriptLoader,editor,suffix);loadPlugins(editor,suffix);scriptLoader.loadQueue().then(initEditor,initEditor);};var getStyleSheetLoader=function getStyleSheetLoader(element,editor){return instance.forElement(element,{contentCssCors:hasContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor)});};var _render=function render(editor){var id=editor.id;I18n.setCode(getLanguageCode(editor));var readyHandler=function readyHandler(){DOM$3.unbind(window,'ready',readyHandler);editor.render();};if(!EventUtils.Event.domLoaded){DOM$3.bind(window,'ready',readyHandler);return;}if(!editor.getElement()){return;}var element=SugarElement.fromDom(editor.getElement());var snapshot=clone$4(element);editor.on('remove',function(){eachr(element.dom.attributes,function(attr){return remove$b(element,attr.name);});setAll$1(element,snapshot);});editor.ui.styleSheetLoader=getStyleSheetLoader(element,editor);if(!isInline(editor)){editor.orgVisibility=editor.getElement().style.visibility;editor.getElement().style.visibility='hidden';}else{editor.inline=true;}var form=editor.getElement().form||DOM$3.getParent(id,'form');if(form){editor.formElement=form;if(hasHiddenInput(editor)&&!isTextareaOrInput(editor.getElement())){DOM$3.insertAfter(DOM$3.create('input',{type:'hidden',name:id}),id);editor.hasHiddenInput=true;}editor.formEventDelegate=function(e){editor.dispatch(e.type,e);};DOM$3.bind(form,'submit reset',editor.formEventDelegate);editor.on('reset',function(){editor.resetContent();});if(shouldPatchSubmit(editor)&&!form.submit.nodeType&&!form.submit.length&&!form._mceOldSubmit){form._mceOldSubmit=form.submit;form.submit=function(){editor.editorManager.triggerSave();editor.setDirty(false);return form._mceOldSubmit(form);};}}editor.windowManager=WindowManager(editor);editor.notificationManager=NotificationManager(editor);if(isEncodingXml(editor)){editor.on('GetContent',function(e){if(e.save){e.content=DOM$3.encode(e.content);}});}if(shouldAddFormSubmitTrigger(editor)){editor.on('submit',function(){if(editor.initialized){editor.save();}});}if(shouldAddUnloadTrigger(editor)){editor._beforeUnload=function(){if(editor.initialized&&!editor.destroyed&&!editor.isHidden()){editor.save({format:'raw',no_events:true,set_dirty:false});}};editor.editorManager.on('BeforeUnload',editor._beforeUnload);}editor.editorManager.add(editor);loadScripts(editor,editor.suffix);};var sectionResult=function sectionResult(sections,settings){return{sections:constant(sections),options:constant(settings)};};var deviceDetection=detect$2().deviceType;var isPhone=deviceDetection.isPhone();var isTablet=deviceDetection.isTablet();var normalizePlugins=function normalizePlugins(plugins){if(isNullable(plugins)){return[];}else{var pluginNames=isArray$1(plugins)?plugins:plugins.split(/[ ,]/);var trimmedPlugins=map$3(pluginNames,trim$3);return filter$6(trimmedPlugins,isNotEmpty);}};var extractSections=function extractSections(keys,options){var result=bifilter(options,function(value,key){return contains$2(keys,key);});return sectionResult(result.t,result.f);};var getSection=function getSection(sectionResult,name){var defaults=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var sections=sectionResult.sections();var sectionOptions=get$a(sections,name).getOr({});return Tools.extend({},defaults,sectionOptions);};var hasSection=function hasSection(sectionResult,name){return has$2(sectionResult.sections(),name);};var getSectionConfig=function getSectionConfig(sectionResult,name){return hasSection(sectionResult,name)?sectionResult.sections()[name]:{};};var getMobileOverrideOptions=function getMobileOverrideOptions(mobileOptions,isPhone){var defaultMobileOptions={table_grid:false,object_resizing:false,resize:false,toolbar_mode:get$a(mobileOptions,'toolbar_mode').getOr('scrolling'),toolbar_sticky:false};var defaultPhoneOptions={menubar:false};return _objectSpread({},defaultMobileOptions,{},isPhone?defaultPhoneOptions:{});};var getExternalPlugins=function getExternalPlugins(overrideOptions,options){var _a;var userDefinedExternalPlugins=(_a=options.external_plugins)!==null&&_a!==void 0?_a:{};if(overrideOptions&&overrideOptions.external_plugins){return Tools.extend({},overrideOptions.external_plugins,userDefinedExternalPlugins);}else{return userDefinedExternalPlugins;}};var combinePlugins=function combinePlugins(forcedPlugins,plugins){return[].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));};var getPlatformPlugins=function getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins){if(isMobileDevice&&hasSection(sectionResult,'mobile')){return mobilePlugins;}else{return desktopPlugins;}};var processPlugins=function processPlugins(isMobileDevice,sectionResult,defaultOverrideOptions,options){var forcedPlugins=normalizePlugins(defaultOverrideOptions.forced_plugins);var desktopPlugins=normalizePlugins(options.plugins);var mobileConfig=getSectionConfig(sectionResult,'mobile');var mobilePlugins=mobileConfig.plugins?normalizePlugins(mobileConfig.plugins):desktopPlugins;var platformPlugins=getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins);var combinedPlugins=combinePlugins(forcedPlugins,platformPlugins);return Tools.extend(options,{forced_plugins:forcedPlugins,plugins:combinedPlugins});};var isOnMobile=function isOnMobile(isMobileDevice,sectionResult){return isMobileDevice&&hasSection(sectionResult,'mobile');};var combineOptions=function combineOptions(isMobileDevice,isPhone,defaultOptions,defaultOverrideOptions,options){var _a;var deviceOverrideOptions=isMobileDevice?{mobile:getMobileOverrideOptions((_a=options.mobile)!==null&&_a!==void 0?_a:{},isPhone)}:{};var sectionResult=extractSections(['mobile'],deepMerge(deviceOverrideOptions,options));var extendedOptions=Tools.extend(defaultOptions,defaultOverrideOptions,sectionResult.options(),isOnMobile(isMobileDevice,sectionResult)?getSection(sectionResult,'mobile'):{},{external_plugins:getExternalPlugins(defaultOverrideOptions,sectionResult.options())});return processPlugins(isMobileDevice,sectionResult,defaultOverrideOptions,extendedOptions);};var normalizeOptions=function normalizeOptions(defaultOverrideOptions,options){return combineOptions(isPhone||isTablet,isPhone,options,defaultOverrideOptions,options);};var _addVisual=function addVisual(editor,elm){return addVisual$1(editor,elm);};var registerExecCommands$3=function registerExecCommands$3(editor){var toggleFormat=function toggleFormat(name,value){editor.formatter.toggle(name,value);editor.nodeChanged();};var toggleAlign=function toggleAlign(align){return function(){each$f('left,center,right,justify'.split(','),function(name){if(align!==name){editor.formatter.remove('align'+name);}});if(align!=='none'){toggleFormat('align'+align);}};};editor.editorCommands.addCommands({JustifyLeft:toggleAlign('left'),JustifyCenter:toggleAlign('center'),JustifyRight:toggleAlign('right'),JustifyFull:toggleAlign('justify'),JustifyNone:toggleAlign('none')});};var registerQueryStateCommands$1=function registerQueryStateCommands$1(editor){var alignStates=function alignStates(name){return function(){var selection=editor.selection;var nodes=selection.isCollapsed()?[editor.dom.getParent(selection.getNode(),editor.dom.isBlock)]:selection.getSelectedBlocks();return exists(nodes,function(node){return isNonNullable(editor.formatter.matchNode(node,name));});};};editor.editorCommands.addCommands({JustifyLeft:alignStates('alignleft'),JustifyCenter:alignStates('aligncenter'),JustifyRight:alignStates('alignright'),JustifyFull:alignStates('alignjustify')},'state');};var registerCommands$a=function registerCommands$a(editor){registerExecCommands$3(editor);registerQueryStateCommands$1(editor);};var registerCommands$9=function registerCommands$9(editor){editor.editorCommands.addCommands({'Cut,Copy,Paste':function CutCopyPaste(command){var doc=editor.getDoc();var failed;try{doc.execCommand(command);}catch(ex){failed=true;}if(command==='paste'&&!doc.queryCommandEnabled(command)){failed=true;}if(failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. "+'Please use the Ctrl+X/C/V keyboard shortcuts instead.');if(Env.os.isMacOS()||Env.os.isiOS()){msg=msg.replace(/Ctrl\+/g,"\u2318+");}editor.notificationManager.open({text:msg,type:'error'});}}});};var trimOrPadLeftRight=function trimOrPadLeftRight(dom,rng,html){var root=SugarElement.fromDom(dom.getRoot());if(needsToBeNbspLeft(root,CaretPosition.fromRangeStart(rng))){html=html.replace(/^ /,'&nbsp;');}else{html=html.replace(/^&nbsp;/,' ');}if(needsToBeNbspRight(root,CaretPosition.fromRangeEnd(rng))){html=html.replace(/(&nbsp;| )(<br( \/)>)?$/,'&nbsp;');}else{html=html.replace(/&nbsp;(<br( \/)?>)?$/,' ');}return html;};var processValue$1=function processValue$1(value){if(typeof value!=='string'){var details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value);return{content:value.content,details:details};}return{content:value,details:{}};};var trimOrPad=function trimOrPad(editor,value){var selection=editor.selection;var dom=editor.dom;if(/^ | $/.test(value)){return trimOrPadLeftRight(dom,selection.getRng(),value);}else{return value;}};var insertAtCaret=function insertAtCaret(editor,value){var _processValue$=processValue$1(value),content=_processValue$.content,details=_processValue$.details;preProcessSetContent(editor,{content:trimOrPad(editor,content),format:'html',set:false,selection:true,paste:details.paste}).each(function(args){var insertedContent=insertContent$1(editor,args.content,details);postProcessSetContent(editor,insertedContent,args);editor.addVisual();});};var registerCommands$8=function registerCommands$8(editor){editor.editorCommands.addCommands({mceCleanup:function mceCleanup(){var bm=editor.selection.getBookmark();editor.setContent(editor.getContent());editor.selection.moveToBookmark(bm);},insertImage:function insertImage(_command,_ui,value){insertAtCaret(editor,editor.dom.createHTML('img',{src:value}));},insertHorizontalRule:function insertHorizontalRule(){editor.execCommand('mceInsertContent',false,'<hr>');},insertText:function insertText(_command,_ui,value){insertAtCaret(editor,editor.dom.encode(value));},insertHTML:function insertHTML(_command,_ui,value){insertAtCaret(editor,value);},mceInsertContent:function mceInsertContent(_command,_ui,value){insertAtCaret(editor,value);},mceSetContent:function mceSetContent(_command,_ui,value){editor.setContent(value);},mceReplaceContent:function mceReplaceContent(_command,_ui,value){editor.execCommand('mceInsertContent',false,value.replace(/\{\$selection\}/g,editor.selection.getContent({format:'text'})));},mceNewDocument:function mceNewDocument(){editor.setContent('');}});};var legacyPropNames={'font-size':'size','font-family':'face'};var getSpecifiedFontProp=function getSpecifiedFontProp(propName,rootElm,elm){var getProperty=function getProperty(elm){return getRaw$1(elm,propName).orThunk(function(){if(name(elm)==='font'){return get$a(legacyPropNames,propName).bind(function(legacyPropName){return getOpt(elm,legacyPropName);});}else{return Optional.none();}});};var isRoot=function isRoot(elm){return eq(SugarElement.fromDom(rootElm),elm);};return closest$2(SugarElement.fromDom(elm),function(elm){return getProperty(elm);},isRoot);};var normalizeFontFamily=function normalizeFontFamily(fontFamily){return fontFamily.replace(/[\'\"\\]/g,'').replace(/,\s+/g,',');};var getComputedFontProp=function getComputedFontProp(propName,elm){return Optional.from(DOMUtils.DOM.getStyle(elm,propName,true));};var getFontProp=function getFontProp(propName){return function(rootElm,elm){return Optional.from(elm).map(SugarElement.fromDom).filter(isElement$7).bind(function(element){return getSpecifiedFontProp(propName,rootElm,element.dom).or(getComputedFontProp(propName,element.dom));}).getOr('');};};var getFontSize=getFontProp('font-size');var getFontFamily=compose(normalizeFontFamily,getFontProp('font-family'));var findFirstCaretElement=function findFirstCaretElement(editor){return firstPositionIn(editor.getBody()).map(function(caret){var container=caret.container();return isText$9(container)?container.parentNode:container;});};var getCaretElement=function getCaretElement(editor){return Optional.from(editor.selection.getRng()).bind(function(rng){var root=editor.getBody();var atStartOfNode=rng.startContainer===root&&rng.startOffset===0;return atStartOfNode?Optional.none():Optional.from(editor.selection.getStart(true));});};var bindRange=function bindRange(editor,binder){return getCaretElement(editor).orThunk(curry(findFirstCaretElement,editor)).map(SugarElement.fromDom).filter(isElement$7).bind(binder);};var mapRange=function mapRange(editor,mapper){return bindRange(editor,compose1(Optional.some,mapper));};var fromFontSizeNumber=function fromFontSizeNumber(editor,value){if(/^[0-9.]+$/.test(value)){var fontSizeNumber=parseInt(value,10);if(fontSizeNumber>=1&&fontSizeNumber<=7){var fontSizes=getFontStyleValues(editor);var fontClasses=getFontSizeClasses(editor);if(fontClasses){return fontClasses[fontSizeNumber-1]||value;}else{return fontSizes[fontSizeNumber-1]||value;}}else{return value;}}else{return value;}};var normalizeFontNames=function normalizeFontNames(font){var fonts=font.split(/\s*,\s*/);return map$3(fonts,function(font){if(font.indexOf(' ')!==-1&&!(startsWith(font,'"')||startsWith(font,"'"))){return"'".concat(font,"'");}else{return font;}}).join(',');};var fontNameAction=function fontNameAction(editor,value){var font=fromFontSizeNumber(editor,value);editor.formatter.toggle('fontname',{value:normalizeFontNames(font)});editor.nodeChanged();};var fontNameQuery=function fontNameQuery(editor){return mapRange(editor,function(elm){return getFontFamily(editor.getBody(),elm.dom);}).getOr('');};var fontSizeAction=function fontSizeAction(editor,value){editor.formatter.toggle('fontsize',{value:fromFontSizeNumber(editor,value)});editor.nodeChanged();};var fontSizeQuery=function fontSizeQuery(editor){return mapRange(editor,function(elm){return getFontSize(editor.getBody(),elm.dom);}).getOr('');};var lineHeightQuery=function lineHeightQuery(editor){return mapRange(editor,function(elm){var root=SugarElement.fromDom(editor.getBody());var specifiedStyle=closest$2(elm,function(elm){return getRaw$1(elm,'line-height');},curry(eq,root));var computedStyle=function computedStyle(){var lineHeight=parseFloat(get$7(elm,'line-height'));var fontSize=parseFloat(get$7(elm,'font-size'));return String(lineHeight/fontSize);};return specifiedStyle.getOrThunk(computedStyle);}).getOr('');};var lineHeightAction=function lineHeightAction(editor,lineHeight){editor.formatter.toggle('lineheight',{value:String(lineHeight)});editor.nodeChanged();};var registerExecCommands$2=function registerExecCommands$2(editor){var toggleFormat=function toggleFormat(name,value){editor.formatter.toggle(name,value);editor.nodeChanged();};editor.editorCommands.addCommands({'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':function BoldItalicUnderlineStrikethroughSuperscriptSubscript(command){toggleFormat(command);},'ForeColor,HiliteColor':function ForeColorHiliteColor(command,_ui,value){toggleFormat(command,{value:value});},'BackColor':function BackColor(_command,_ui,value){toggleFormat('hilitecolor',{value:value});},'FontName':function FontName(_command,_ui,value){fontNameAction(editor,value);},'FontSize':function FontSize(_command,_ui,value){fontSizeAction(editor,value);},'LineHeight':function LineHeight(_command,_ui,value){lineHeightAction(editor,value);},'Lang':function Lang(command,_ui,lang){toggleFormat(command,{value:lang.code,customValue:lang.customCode});},'RemoveFormat':function RemoveFormat(command){editor.formatter.remove(command);},'mceBlockQuote':function mceBlockQuote(){toggleFormat('blockquote');},'FormatBlock':function FormatBlock(_command,_ui,value){toggleFormat(isString(value)?value:'p');},'mceToggleFormat':function mceToggleFormat(_command,_ui,value){toggleFormat(value);}});};var registerQueryValueCommands=function registerQueryValueCommands(editor){var isFormatMatch=function isFormatMatch(name){return editor.formatter.match(name);};editor.editorCommands.addCommands({'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':function BoldItalicUnderlineStrikethroughSuperscriptSubscript(command){return isFormatMatch(command);},'mceBlockQuote':function mceBlockQuote(){return isFormatMatch('blockquote');}},'state');editor.editorCommands.addQueryValueHandler('FontName',function(){return fontNameQuery(editor);});editor.editorCommands.addQueryValueHandler('FontSize',function(){return fontSizeQuery(editor);});editor.editorCommands.addQueryValueHandler('LineHeight',function(){return lineHeightQuery(editor);});};var registerCommands$7=function registerCommands$7(editor){registerExecCommands$2(editor);registerQueryValueCommands(editor);};var registerCommands$6=function registerCommands$6(editor){editor.editorCommands.addCommands({mceAddUndoLevel:function mceAddUndoLevel(){editor.undoManager.add();},mceEndUndoLevel:function mceEndUndoLevel(){editor.undoManager.add();},Undo:function Undo(){editor.undoManager.undo();},Redo:function Redo(){editor.undoManager.redo();}});};var registerCommands$5=function registerCommands$5(editor){editor.editorCommands.addCommands({Indent:function Indent(){indent(editor);},Outdent:function Outdent(){outdent(editor);}});editor.editorCommands.addCommands({Outdent:function Outdent(){return canOutdent(editor);}},'state');};var registerCommands$4=function registerCommands$4(editor){var applyLinkToSelection=function applyLinkToSelection(_command,_ui,value){var linkDetails=isString(value)?{href:value}:value;var anchor=editor.dom.getParent(editor.selection.getNode(),'a');if(isObject(linkDetails)&&isString(linkDetails.href)){linkDetails.href=linkDetails.href.replace(/ /g,'%20');if(!anchor||!linkDetails.href){editor.formatter.remove('link');}if(linkDetails.href){editor.formatter.apply('link',linkDetails,anchor);}}};editor.editorCommands.addCommands({unlink:function unlink(){if(editor.selection.isCollapsed()){var elm=editor.dom.getParent(editor.selection.getStart(),'a');if(elm){editor.dom.remove(elm,true);}return;}editor.formatter.remove('link');},mceInsertLink:applyLinkToSelection,createLink:applyLinkToSelection});};var registerExecCommands$1=function registerExecCommands$1(editor){editor.editorCommands.addCommands({'InsertUnorderedList,InsertOrderedList':function InsertUnorderedListInsertOrderedList(command){editor.getDoc().execCommand(command);var listElm=editor.dom.getParent(editor.selection.getNode(),'ol,ul');if(listElm){var listParent=listElm.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)){var bm=editor.selection.getBookmark();editor.dom.split(listParent,listElm);editor.selection.moveToBookmark(bm);}}}});};var registerQueryStateCommands=function registerQueryStateCommands(editor){editor.editorCommands.addCommands({'InsertUnorderedList,InsertOrderedList':function InsertUnorderedListInsertOrderedList(command){var list=editor.dom.getParent(editor.selection.getNode(),'ul,ol');return list&&(command==='insertunorderedlist'&&list.tagName==='UL'||command==='insertorderedlist'&&list.tagName==='OL');}},'state');};var registerCommands$3=function registerCommands$3(editor){registerExecCommands$1(editor);registerQueryStateCommands(editor);};var registerCommands$2=function registerCommands$2(editor){editor.editorCommands.addCommands({insertParagraph:function insertParagraph(){insertBreak(blockbreak,editor);},mceInsertNewLine:function mceInsertNewLine(_command,_ui,value){insert(editor,value);},InsertLineBreak:function InsertLineBreak(_command,_ui,_value){insertBreak(linebreak,editor);}});};var registerCommands$1=function registerCommands$1(editor){editor.editorCommands.addCommands({mceSelectNodeDepth:function mceSelectNodeDepth(_command,_ui,value){var counter=0;editor.dom.getParent(editor.selection.getNode(),function(node){if(node.nodeType===1&&counter++===value){editor.selection.select(node);return false;}},editor.getBody());},mceSelectNode:function mceSelectNode(_command,_ui,value){editor.selection.select(value);},selectAll:function selectAll(){var editingHost=editor.dom.getParent(editor.selection.getStart(),isContentEditableTrue$5);if(editingHost){var rng=editor.dom.createRng();rng.selectNodeContents(editingHost);editor.selection.setRng(rng);}}});};var registerExecCommands=function registerExecCommands(editor){editor.editorCommands.addCommands({mceRemoveNode:function mceRemoveNode(_command,_ui,value){var node=value!==null&&value!==void 0?value:editor.selection.getNode();if(node!==editor.getBody()){var bm=editor.selection.getBookmark();editor.dom.remove(node,true);editor.selection.moveToBookmark(bm);}},mcePrint:function mcePrint(){editor.getWin().print();},mceFocus:function mceFocus(_command,_ui,value){focus(editor,value);},mceToggleVisualAid:function mceToggleVisualAid(){editor.hasVisual=!editor.hasVisual;editor.addVisual();}});};var registerCommands=function registerCommands(editor){registerCommands$a(editor);registerCommands$9(editor);registerCommands$6(editor);registerCommands$1(editor);registerCommands$8(editor);registerCommands$4(editor);registerCommands$5(editor);registerCommands$2(editor);registerCommands$3(editor);registerCommands$7(editor);registerExecCommands(editor);};var EditorCommands=/*#__PURE__*/function(){function EditorCommands(editor){_classCallCheck(this,EditorCommands);this.commands={state:{},exec:{},value:{}};this.editor=editor;}_createClass(EditorCommands,[{key:"execCommand",value:function execCommand(command,ui,value,args){var editor=this.editor;var lowerCaseCommand=command.toLowerCase();var skipFocus=args===null||args===void 0?void 0:args.skip_focus;if(editor.removed){return false;}if(lowerCaseCommand!=='mcefocus'){if(!/^(mceAddUndoLevel|mceEndUndoLevel)$/i.test(lowerCaseCommand)&&!skipFocus){editor.focus();}else{restore(editor);}}var eventArgs=editor.dispatch('BeforeExecCommand',{command:command,ui:ui,value:value});if(eventArgs.isDefaultPrevented()){return false;}var func=this.commands.exec[lowerCaseCommand];if(isFunction(func)){func(lowerCaseCommand,ui,value);editor.dispatch('ExecCommand',{command:command,ui:ui,value:value});return true;}return false;}},{key:"queryCommandState",value:function queryCommandState(command){if(this.editor.quirks.isHidden()||this.editor.removed){return false;}var lowerCaseCommand=command.toLowerCase();var func=this.commands.state[lowerCaseCommand];if(isFunction(func)){return func(lowerCaseCommand);}return false;}},{key:"queryCommandValue",value:function queryCommandValue(command){if(this.editor.quirks.isHidden()||this.editor.removed){return'';}var lowerCaseCommand=command.toLowerCase();var func=this.commands.value[lowerCaseCommand];if(isFunction(func)){return func(lowerCaseCommand);}return'';}},{key:"addCommands",value:function addCommands(commandList){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'exec';var commands=this.commands;each$e(commandList,function(callback,command){each$f(command.toLowerCase().split(','),function(command){commands[type][command]=callback;});});}},{key:"addCommand",value:function addCommand(command,callback,scope){var _this2=this;var lowerCaseCommand=command.toLowerCase();this.commands.exec[lowerCaseCommand]=function(_command,ui,value){return callback.call(scope!==null&&scope!==void 0?scope:_this2.editor,ui,value);};}},{key:"queryCommandSupported",value:function queryCommandSupported(command){var lowerCaseCommand=command.toLowerCase();if(this.commands.exec[lowerCaseCommand]){return true;}return false;}},{key:"addQueryStateHandler",value:function addQueryStateHandler(command,callback,scope){var _this3=this;this.commands.state[command.toLowerCase()]=function(){return callback.call(scope!==null&&scope!==void 0?scope:_this3.editor);};}},{key:"addQueryValueHandler",value:function addQueryValueHandler(command,callback,scope){var _this4=this;this.commands.value[command.toLowerCase()]=function(){return callback.call(scope!==null&&scope!==void 0?scope:_this4.editor);};}}]);return EditorCommands;}();var internalContentEditableAttr='data-mce-contenteditable';var toggleClass=function toggleClass(elm,cls,state){if(has(elm,cls)&&state===false){remove$8(elm,cls);}else if(state){add$2(elm,cls);}};var setEditorCommandState=function setEditorCommandState(editor,cmd,state){try{editor.getDoc().execCommand(cmd,false,String(state));}catch(ex){}};var setContentEditable=function setContentEditable(elm,state){elm.dom.contentEditable=state?'true':'false';};var switchOffContentEditableTrue=function switchOffContentEditableTrue(elm){each$f(descendants(elm,'*[contenteditable="true"]'),function(elm){set$2(elm,internalContentEditableAttr,'true');setContentEditable(elm,false);});};var switchOnContentEditableTrue=function switchOnContentEditableTrue(elm){each$f(descendants(elm,"*[".concat(internalContentEditableAttr,"=\"true\"]")),function(elm){remove$b(elm,internalContentEditableAttr);setContentEditable(elm,true);});};var removeFakeSelection=function removeFakeSelection(editor){Optional.from(editor.selection.getNode()).each(function(elm){elm.removeAttribute('data-mce-selected');});};var restoreFakeSelection=function restoreFakeSelection(editor){editor.selection.setRng(editor.selection.getRng());};var toggleReadOnly=function toggleReadOnly(editor,state){var body=SugarElement.fromDom(editor.getBody());toggleClass(body,'mce-content-readonly',state);if(state){editor.selection.controlSelection.hideResizeRect();editor._selectionOverrides.hideFakeCaret();removeFakeSelection(editor);editor.readonly=true;setContentEditable(body,false);switchOffContentEditableTrue(body);}else{editor.readonly=false;setContentEditable(body,true);switchOnContentEditableTrue(body);setEditorCommandState(editor,'StyleWithCSS',false);setEditorCommandState(editor,'enableInlineTableEditing',false);setEditorCommandState(editor,'enableObjectResizing',false);if(hasEditorOrUiFocus(editor)){editor.focus();}restoreFakeSelection(editor);editor.nodeChanged();}};var _isReadOnly=function isReadOnly(editor){return editor.readonly;};var registerFilters=function registerFilters(editor){editor.parser.addAttributeFilter('contenteditable',function(nodes){if(_isReadOnly(editor)){each$f(nodes,function(node){node.attr(internalContentEditableAttr,node.attr('contenteditable'));node.attr('contenteditable','false');});}});editor.serializer.addAttributeFilter(internalContentEditableAttr,function(nodes){if(_isReadOnly(editor)){each$f(nodes,function(node){node.attr('contenteditable',node.attr(internalContentEditableAttr));});}});editor.serializer.addTempAttr(internalContentEditableAttr);};var registerReadOnlyContentFilters=function registerReadOnlyContentFilters(editor){if(editor.serializer){registerFilters(editor);}else{editor.on('PreInit',function(){registerFilters(editor);});}};var isClickEvent=function isClickEvent(e){return e.type==='click';};var allowedEvents=['copy'];var isReadOnlyAllowedEvent=function isReadOnlyAllowedEvent(e){return contains$2(allowedEvents,e.type);};var getAnchorHrefOpt=function getAnchorHrefOpt(editor,elm){var isRoot=function isRoot(elm){return eq(elm,SugarElement.fromDom(editor.getBody()));};return closest$3(elm,'a',isRoot).bind(function(a){return getOpt(a,'href');});};var processReadonlyEvents=function processReadonlyEvents(editor,e){if(isClickEvent(e)&&!VK.metaKeyPressed(e)){var elm=SugarElement.fromDom(e.target);getAnchorHrefOpt(editor,elm).each(function(href){e.preventDefault();if(/^#/.test(href)){var targetEl=editor.dom.select("".concat(href,",[name=\"").concat(removeLeading(href,'#'),"\"]"));if(targetEl.length){editor.selection.scrollIntoView(targetEl[0],true);}}else{window.open(href,'_blank','rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes');}});}else if(isReadOnlyAllowedEvent(e)){editor.dispatch(e.type,e);}};var registerReadOnlySelectionBlockers=function registerReadOnlySelectionBlockers(editor){editor.on('ShowCaret',function(e){if(_isReadOnly(editor)){e.preventDefault();}});editor.on('ObjectSelected',function(e){if(_isReadOnly(editor)){e.preventDefault();}});};var nativeEvents=Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange '+'mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover '+'draggesture dragdrop drop drag submit '+'compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel',' ');var EventDispatcher=/*#__PURE__*/function(){function EventDispatcher(settings){_classCallCheck(this,EventDispatcher);this.bindings={};this.settings=settings||{};this.scope=this.settings.scope||this;this.toggleEvent=this.settings.toggleEvent||never;}_createClass(EventDispatcher,[{key:"fire",value:function fire(name,args){return this.dispatch(name,args);}},{key:"dispatch",value:function dispatch(name,args){var lcName=name.toLowerCase();var event=normalize$3(lcName,args!==null&&args!==void 0?args:{},this.scope);if(this.settings.beforeFire){this.settings.beforeFire(event);}var handlers=this.bindings[lcName];if(handlers){for(var i=0,l=handlers.length;i<l;i++){var callback=handlers[i];if(callback.removed){continue;}if(callback.once){this.off(lcName,callback.func);}if(event.isImmediatePropagationStopped()){return event;}if(callback.func.call(this.scope,event)===false){event.preventDefault();return event;}}}return event;}},{key:"on",value:function on(name,callback,prepend,extra){if(callback===false){callback=never;}if(callback){var wrappedCallback={func:callback,removed:false};if(extra){Tools.extend(wrappedCallback,extra);}var names=name.toLowerCase().split(' ');var i=names.length;while(i--){var currentName=names[i];var handlers=this.bindings[currentName];if(!handlers){handlers=[];this.toggleEvent(currentName,true);}if(prepend){handlers=[wrappedCallback].concat(_toConsumableArray2(handlers));}else{handlers=[].concat(_toConsumableArray2(handlers),[wrappedCallback]);}this.bindings[currentName]=handlers;}}return this;}},{key:"off",value:function off(name,callback){var _this5=this;if(name){var names=name.toLowerCase().split(' ');var i=names.length;while(i--){var currentName=names[i];var handlers=this.bindings[currentName];if(!currentName){each$e(this.bindings,function(_value,bindingName){_this5.toggleEvent(bindingName,false);delete _this5.bindings[bindingName];});return this;}if(handlers){if(!callback){handlers.length=0;}else{var filteredHandlers=partition$2(handlers,function(handler){return handler.func===callback;});handlers=filteredHandlers.fail;this.bindings[currentName]=handlers;each$f(filteredHandlers.pass,function(handler){handler.removed=true;});}if(!handlers.length){this.toggleEvent(name,false);delete this.bindings[currentName];}}}}else{each$e(this.bindings,function(_value,name){_this5.toggleEvent(name,false);});this.bindings={};}return this;}},{key:"once",value:function once(name,callback,prepend){return this.on(name,callback,prepend,{once:true});}},{key:"has",value:function has(name){name=name.toLowerCase();return!(!this.bindings[name]||this.bindings[name].length===0);}}],[{key:"isNative",value:function isNative(name){return!!nativeEvents[name.toLowerCase()];}}]);return EventDispatcher;}();var getEventDispatcher=function getEventDispatcher(obj){if(!obj._eventDispatcher){obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function toggleEvent(name,state){if(EventDispatcher.isNative(name)&&obj.toggleNativeEvent){obj.toggleNativeEvent(name,state);}}});}return obj._eventDispatcher;};var Observable={fire:function fire(name,args,bubble){return this.dispatch(name,args,bubble);},dispatch:function dispatch(name,args,bubble){var self=this;if(self.removed&&name!=='remove'&&name!=='detach'){return normalize$3(name.toLowerCase(),args!==null&&args!==void 0?args:{},self);}var dispatcherArgs=getEventDispatcher(self).dispatch(name,args);if(bubble!==false&&self.parent){var _parent9=self.parent();while(_parent9&&!dispatcherArgs.isPropagationStopped()){_parent9.dispatch(name,dispatcherArgs,false);_parent9=_parent9.parent();}}return dispatcherArgs;},on:function on(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend);},off:function off(name,callback){return getEventDispatcher(this).off(name,callback);},once:function once(name,callback){return getEventDispatcher(this).once(name,callback);},hasEventListeners:function hasEventListeners(name){return getEventDispatcher(this).has(name);}};var DOM$2=DOMUtils.DOM;var customEventRootDelegates;var getEventTarget=function getEventTarget(editor,eventName){if(eventName==='selectionchange'){return editor.getDoc();}if(!editor.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)){return editor.getDoc().documentElement;}var eventRoot=getEventRoot(editor);if(eventRoot){if(!editor.eventRoot){editor.eventRoot=DOM$2.select(eventRoot)[0];}return editor.eventRoot;}return editor.getBody();};var isListening=function isListening(editor){return!editor.hidden&&!_isReadOnly(editor);};var fireEvent=function fireEvent(editor,eventName,e){if(isListening(editor)){editor.dispatch(eventName,e);}else if(_isReadOnly(editor)){processReadonlyEvents(editor,e);}};var bindEventDelegate=function bindEventDelegate(editor,eventName){var delegate;if(!editor.delegates){editor.delegates={};}if(editor.delegates[eventName]||editor.removed){return;}var eventRootElm=getEventTarget(editor,eventName);if(getEventRoot(editor)){if(!customEventRootDelegates){customEventRootDelegates={};editor.editorManager.on('removeEditor',function(){if(!editor.editorManager.activeEditor){if(customEventRootDelegates){each$e(customEventRootDelegates,function(_value,name){editor.dom.unbind(getEventTarget(editor,name));});customEventRootDelegates=null;}}});}if(customEventRootDelegates[eventName]){return;}delegate=function delegate(e){var target=e.target;var editors=editor.editorManager.get();var i=editors.length;while(i--){var body=editors[i].getBody();if(body===target||DOM$2.isChildOf(target,body)){fireEvent(editors[i],eventName,e);}}};customEventRootDelegates[eventName]=delegate;DOM$2.bind(eventRootElm,eventName,delegate);}else{delegate=function delegate(e){fireEvent(editor,eventName,e);};DOM$2.bind(eventRootElm,eventName,delegate);editor.delegates[eventName]=delegate;}};var EditorObservable=_objectSpread({},Observable,{bindPendingEventDelegates:function bindPendingEventDelegates(){var self=this;Tools.each(self._pendingNativeEvents,function(name){bindEventDelegate(self,name);});},toggleNativeEvent:function toggleNativeEvent(name,state){var self=this;if(name==='focus'||name==='blur'){return;}if(self.removed){return;}if(state){if(self.initialized){bindEventDelegate(self,name);}else{if(!self._pendingNativeEvents){self._pendingNativeEvents=[name];}else{self._pendingNativeEvents.push(name);}}}else if(self.initialized){self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]);delete self.delegates[name];}},unbindAllNativeEvents:function unbindAllNativeEvents(){var self=this;var body=self.getBody();var dom=self.dom;if(self.delegates){each$e(self.delegates,function(value,name){self.dom.unbind(getEventTarget(self,name),name,value);});delete self.delegates;}if(!self.inline&&body&&dom){body.onload=null;dom.unbind(self.getWin());dom.unbind(self.getDoc());}if(dom){dom.unbind(body);dom.unbind(self.getContainer());}}});var stringListProcessor=function stringListProcessor(value){if(isString(value)){return{value:value.split(/[ ,]/),valid:true};}else if(isArrayOf(value,isString)){return{value:value,valid:true};}else{return{valid:false,message:"The value must be a string[] or a comma/space separated string."};}};var getBuiltInProcessor=function getBuiltInProcessor(type){var validator=function(){switch(type){case'array':return isArray$1;case'boolean':return isBoolean;case'function':return isFunction;case'number':return isNumber;case'object':return isObject;case'string':return isString;case'string[]':return stringListProcessor;case'object[]':return function(val){return isArrayOf(val,isObject);};case'regexp':return function(val){return is$4(val,RegExp);};}}();return function(value){return processValue(value,validator,"The value must be a ".concat(type,"."));};};var isBuiltInSpec=function isBuiltInSpec(spec){return isString(spec.processor);};var getErrorMessage=function getErrorMessage(message,result){var additionalText=isEmpty$3(result.message)?'':". ".concat(result.message);return message+additionalText;};var isValidResult=function isValidResult(result){return result.valid;};var processValue=function processValue(value,processor){var message=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var result=processor(value);if(isBoolean(result)){return result?{value:value,valid:true}:{valid:false,message:message};}else{return result;}};var processDefaultValue=function processDefaultValue(name,defaultValue,processor){if(!isUndefined(defaultValue)){var result=processValue(defaultValue,processor);if(isValidResult(result)){return result.value;}else{console.error(getErrorMessage("Invalid default value passed for the \"".concat(name,"\" option"),result));}}return undefined;};var create$5=function create$5(editor,initialOptions){var registry={};var values={};var setValue=function setValue(name,value,processor){var result=processValue(value,processor);if(isValidResult(result)){values[name]=result.value;return true;}else{console.warn(getErrorMessage("Invalid value passed for the ".concat(name," option"),result));return false;}};var register=function register(name,spec){var processor=isBuiltInSpec(spec)?getBuiltInProcessor(spec.processor):spec.processor;var defaultValue=processDefaultValue(name,spec["default"],processor);registry[name]=_objectSpread({},spec,{"default":defaultValue,processor:processor});var initValue=get$a(values,name).orThunk(function(){return get$a(initialOptions,name);});initValue.each(function(value){return setValue(name,value,processor);});};var isRegistered=function isRegistered(name){return has$2(registry,name);};var get=function get(name){return get$a(values,name).orThunk(function(){return get$a(registry,name).map(function(spec){return spec["default"];});}).getOrUndefined();};var set=function set(name,value){if(!isRegistered(name)){console.warn("\"".concat(name,"\" is not a registered option. Ensure the option has been registered before setting a value."));return false;}else{var spec=registry[name];if(spec.immutable){console.error("\"".concat(name,"\" is an immutable option and cannot be updated"));return false;}else{return setValue(name,value,spec.processor);}}};var unset=function unset(name){var registered=isRegistered(name);if(registered){delete values[name];}return registered;};var isSet=function isSet(name){return has$2(values,name);};return{register:register,isRegistered:isRegistered,get:get,set:set,unset:unset,isSet:isSet};};var defaultModes=['design','readonly'];var switchToMode=function switchToMode(editor,activeMode,availableModes,mode){var oldMode=availableModes[activeMode.get()];var newMode=availableModes[mode];try{newMode.activate();}catch(e){console.error("problem while activating editor mode ".concat(mode,":"),e);return;}oldMode.deactivate();if(oldMode.editorReadOnly!==newMode.editorReadOnly){toggleReadOnly(editor,newMode.editorReadOnly);}activeMode.set(mode);fireSwitchMode(editor,mode);};var setMode=function setMode(editor,availableModes,activeMode,mode){if(mode===activeMode.get()){return;}else if(!has$2(availableModes,mode)){throw new Error("Editor mode '".concat(mode,"' is invalid"));}if(editor.initialized){switchToMode(editor,activeMode,availableModes,mode);}else{editor.on('init',function(){return switchToMode(editor,activeMode,availableModes,mode);});}};var registerMode=function registerMode(availableModes,mode,api){if(contains$2(defaultModes,mode)){throw new Error("Cannot override default mode ".concat(mode));}return _objectSpread({},availableModes,_defineProperty({},mode,_objectSpread({},api,{deactivate:function deactivate(){try{api.deactivate();}catch(e){console.error("problem while deactivating editor mode ".concat(mode,":"),e);}}})));};var create$4=function create$4(editor){var activeMode=Cell('design');var availableModes=Cell({design:{activate:noop,deactivate:noop,editorReadOnly:false},readonly:{activate:noop,deactivate:noop,editorReadOnly:true}});registerReadOnlyContentFilters(editor);registerReadOnlySelectionBlockers(editor);return{isReadOnly:function isReadOnly(){return _isReadOnly(editor);},set:function set(mode){return setMode(editor,availableModes.get(),activeMode,mode);},get:function get(){return activeMode.get();},register:function register(mode,api){availableModes.set(registerMode(availableModes.get(),mode,api));}};};var each$2=Tools.each,explode=Tools.explode;var keyCodeLookup={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var modifierNames=Tools.makeMap('alt,ctrl,shift,meta,access');var parseShortcut=function parseShortcut(pattern){var key;var shortcut={};var isMac=Env.os.isMacOS()||Env.os.isiOS();each$2(explode(pattern.toLowerCase(),'+'),function(value){if(value in modifierNames){shortcut[value]=true;}else{if(/^[0-9]{2,}$/.test(value)){shortcut.keyCode=parseInt(value,10);}else{shortcut.charCode=value.charCodeAt(0);shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0);}}});var id=[shortcut.keyCode];for(key in modifierNames){if(shortcut[key]){id.push(key);}else{shortcut[key]=false;}}shortcut.id=id.join(',');if(shortcut.access){shortcut.alt=true;if(isMac){shortcut.ctrl=true;}else{shortcut.shift=true;}}if(shortcut.meta){if(isMac){shortcut.meta=true;}else{shortcut.ctrl=true;shortcut.meta=false;}}return shortcut;};var Shortcuts=/*#__PURE__*/function(){function Shortcuts(editor){_classCallCheck(this,Shortcuts);this.shortcuts={};this.pendingPatterns=[];this.editor=editor;var self=this;editor.on('keyup keypress keydown',function(e){if((self.hasModifier(e)||self.isFunctionKey(e))&&!e.isDefaultPrevented()){each$2(self.shortcuts,function(shortcut){if(self.matchShortcut(e,shortcut)){self.pendingPatterns=shortcut.subpatterns.slice(0);if(e.type==='keydown'){self.executeShortcutAction(shortcut);}return true;}});if(self.matchShortcut(e,self.pendingPatterns[0])){if(self.pendingPatterns.length===1){if(e.type==='keydown'){self.executeShortcutAction(self.pendingPatterns[0]);}}self.pendingPatterns.shift();}}});}_createClass(Shortcuts,[{key:"add",value:function add(pattern,desc,cmdFunc,scope){var self=this;var func=self.normalizeCommandFunc(cmdFunc);each$2(explode(Tools.trim(pattern)),function(pattern){var shortcut=self.createShortcut(pattern,desc,func,scope);self.shortcuts[shortcut.id]=shortcut;});return true;}},{key:"remove",value:function remove(pattern){var shortcut=this.createShortcut(pattern);if(this.shortcuts[shortcut.id]){delete this.shortcuts[shortcut.id];return true;}return false;}},{key:"normalizeCommandFunc",value:function normalizeCommandFunc(cmdFunc){var self=this;var cmd=cmdFunc;if(typeof cmd==='string'){return function(){self.editor.execCommand(cmd,false,null);};}else if(Tools.isArray(cmd)){return function(){self.editor.execCommand(cmd[0],cmd[1],cmd[2]);};}else{return cmd;}}},{key:"createShortcut",value:function createShortcut(pattern,desc,cmdFunc,scope){var shortcuts=Tools.map(explode(pattern,'>'),parseShortcut);shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||this.editor});return Tools.extend(shortcuts[0],{desc:this.editor.translate(desc),subpatterns:shortcuts.slice(1)});}},{key:"hasModifier",value:function hasModifier(e){return e.altKey||e.ctrlKey||e.metaKey;}},{key:"isFunctionKey",value:function isFunctionKey(e){return e.type==='keydown'&&e.keyCode>=112&&e.keyCode<=123;}},{key:"matchShortcut",value:function matchShortcut(e,shortcut){if(!shortcut){return false;}if(shortcut.ctrl!==e.ctrlKey||shortcut.meta!==e.metaKey){return false;}if(shortcut.alt!==e.altKey||shortcut.shift!==e.shiftKey){return false;}if(e.keyCode===shortcut.keyCode||e.charCode&&e.charCode===shortcut.charCode){e.preventDefault();return true;}return false;}},{key:"executeShortcutAction",value:function executeShortcutAction(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null;}}]);return Shortcuts;}();var create$3=function create$3(){var buttons={};var menuItems={};var popups={};var icons={};var contextMenus={};var contextToolbars={};var sidebars={};var add=function add(collection,type){return function(name,spec){return collection[name.toLowerCase()]=_objectSpread({},spec,{type:type});};};var addIcon=function addIcon(name,svgData){return icons[name.toLowerCase()]=svgData;};return{addButton:add(buttons,'button'),addGroupToolbarButton:add(buttons,'grouptoolbarbutton'),addToggleButton:add(buttons,'togglebutton'),addMenuButton:add(buttons,'menubutton'),addSplitButton:add(buttons,'splitbutton'),addMenuItem:add(menuItems,'menuitem'),addNestedMenuItem:add(menuItems,'nestedmenuitem'),addToggleMenuItem:add(menuItems,'togglemenuitem'),addAutocompleter:add(popups,'autocompleter'),addContextMenu:add(contextMenus,'contextmenu'),addContextToolbar:add(contextToolbars,'contexttoolbar'),addContextForm:add(contextToolbars,'contextform'),addSidebar:add(sidebars,'sidebar'),addIcon:addIcon,getAll:function getAll(){return{buttons:buttons,menuItems:menuItems,icons:icons,popups:popups,contextMenus:contextMenus,contextToolbars:contextToolbars,sidebars:sidebars};}};};var registry=function registry(){var bridge=create$3();return{addAutocompleter:bridge.addAutocompleter,addButton:bridge.addButton,addContextForm:bridge.addContextForm,addContextMenu:bridge.addContextMenu,addContextToolbar:bridge.addContextToolbar,addIcon:bridge.addIcon,addMenuButton:bridge.addMenuButton,addMenuItem:bridge.addMenuItem,addNestedMenuItem:bridge.addNestedMenuItem,addSidebar:bridge.addSidebar,addSplitButton:bridge.addSplitButton,addToggleButton:bridge.addToggleButton,addGroupToolbarButton:bridge.addGroupToolbarButton,addToggleMenuItem:bridge.addToggleMenuItem,getAll:bridge.getAll};};var DOM$1=DOMUtils.DOM;var extend=Tools.extend,each$1=Tools.each;var Editor=/*#__PURE__*/function(){function Editor(id,options,editorManager){_classCallCheck(this,Editor);this.plugins={};this.contentCSS=[];this.contentStyles=[];this.loadedCSS={};this.isNotDirty=false;this.editorManager=editorManager;this.documentBaseUrl=editorManager.documentBaseURL;extend(this,EditorObservable);var self=this;this.id=id;this.hidden=false;var normalizedOptions=normalizeOptions(editorManager.defaultOptions,options);this.options=create$5(self,normalizedOptions);register$7(self);var getOption=this.options.get;if(getOption('deprecation_warnings')){logWarnings(options,normalizedOptions);}var suffix=getOption('suffix');if(suffix){editorManager.suffix=suffix;}this.suffix=editorManager.suffix;var baseUrl=getOption('base_url');if(baseUrl){editorManager._setBaseUrl(baseUrl);}this.baseUri=editorManager.baseURI;var referrerPolicy=getReferrerPolicy(self);if(referrerPolicy){ScriptLoader.ScriptLoader._setReferrerPolicy(referrerPolicy);DOMUtils.DOM.styleSheetLoader._setReferrerPolicy(referrerPolicy);}AddOnManager.languageLoad=getOption('language_load');AddOnManager.baseURL=editorManager.baseURL;this.setDirty(false);this.documentBaseURI=new URI(getDocumentBaseUrl(self),{base_uri:this.baseUri});this.baseURI=this.baseUri;this.inline=isInline(self);this.shortcuts=new Shortcuts(this);this.editorCommands=new EditorCommands(this);registerCommands(this);var cacheSuffix=getOption('cache_suffix');if(cacheSuffix){Env.cacheSuffix=cacheSuffix.replace(/^[\?\&]+/,'');}this.ui={registry:registry(),styleSheetLoader:undefined,show:noop,hide:noop,setEnabled:noop,isEnabled:always};this.mode=create$4(self);editorManager.dispatch('SetupEditor',{editor:this});var setupCallback=getSetupCallback(self);if(isFunction(setupCallback)){setupCallback.call(self,self);}}_createClass(Editor,[{key:"render",value:function render(){_render(this);}},{key:"focus",value:function focus(skipFocus){this.execCommand('mceFocus',false,skipFocus);}},{key:"hasFocus",value:function hasFocus(){return _hasFocus(this);}},{key:"translate",value:function translate(text){return I18n.translate(text);}},{key:"getParam",value:function getParam(name,defaultVal,type){var options=this.options;if(!options.isRegistered(name)){if(isNonNullable(type)){options.register(name,{processor:type,"default":defaultVal});}else{options.register(name,{processor:always,"default":defaultVal});}}return!options.isSet(name)&&!isUndefined(defaultVal)?defaultVal:options.get(name);}},{key:"hasPlugin",value:function hasPlugin(name,loaded){var hasPlugin=contains$2(getPlugins(this),name);if(hasPlugin){return loaded?PluginManager.get(name)!==undefined:true;}else{return false;}}},{key:"nodeChanged",value:function nodeChanged(args){this._nodeChangeDispatcher.nodeChanged(args);}},{key:"addCommand",value:function addCommand(name,callback,scope){this.editorCommands.addCommand(name,callback,scope);}},{key:"addQueryStateHandler",value:function addQueryStateHandler(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope);}},{key:"addQueryValueHandler",value:function addQueryValueHandler(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope);}},{key:"addShortcut",value:function addShortcut(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope);}},{key:"execCommand",value:function execCommand(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args);}},{key:"queryCommandState",value:function queryCommandState(cmd){return this.editorCommands.queryCommandState(cmd);}},{key:"queryCommandValue",value:function queryCommandValue(cmd){return this.editorCommands.queryCommandValue(cmd);}},{key:"queryCommandSupported",value:function queryCommandSupported(cmd){return this.editorCommands.queryCommandSupported(cmd);}},{key:"show",value:function show(){var self=this;if(self.hidden){self.hidden=false;if(self.inline){self.getBody().contentEditable='true';}else{DOM$1.show(self.getContainer());DOM$1.hide(self.id);}self.load();self.dispatch('show');}}},{key:"hide",value:function hide(){var self=this;if(!self.hidden){self.save();if(self.inline){self.getBody().contentEditable='false';if(self===self.editorManager.focusedEditor){self.editorManager.focusedEditor=null;}}else{DOM$1.hide(self.getContainer());DOM$1.setStyle(self.id,'display',self.orgDisplay);}self.hidden=true;self.dispatch('hide');}}},{key:"isHidden",value:function isHidden(){return this.hidden;}},{key:"setProgressState",value:function setProgressState(state,time){this.dispatch('ProgressState',{state:state,time:time});}},{key:"load",value:function load(args){var self=this;var elm=self.getElement(),html;if(self.removed){return'';}if(elm){args=args||{};args.load=true;var _value9=isTextareaOrInput(elm)?elm.value:elm.innerHTML;html=self.setContent(_value9,args);args.element=elm;if(!args.no_events){self.dispatch('LoadContent',args);}args.element=elm=null;return html;}}},{key:"save",value:function save(args){var self=this;var elm=self.getElement(),html,form;if(!elm||!self.initialized||self.removed){return;}args=args||{};args.save=true;args.element=elm;html=args.content=self.getContent(args);if(!args.no_events){self.dispatch('SaveContent',args);}if(args.format==='raw'){self.dispatch('RawSaveContent',args);}html=args.content;if(!isTextareaOrInput(elm)){if(args.is_removing||!self.inline){elm.innerHTML=html;}if(form=DOM$1.getParent(self.id,'form')){each$1(form.elements,function(elm){if(elm.name===self.id){elm.value=html;return false;}});}}else{elm.value=html;}args.element=elm=null;if(args.set_dirty!==false){self.setDirty(false);}return html;}},{key:"setContent",value:function setContent(content,args){return _setContent(this,content,args);}},{key:"getContent",value:function getContent(args){return _getContent(this,args);}},{key:"insertContent",value:function insertContent(content,args){if(args){content=extend({content:content},args);}this.execCommand('mceInsertContent',false,content);}},{key:"resetContent",value:function resetContent(initialContent){if(initialContent===undefined){_setContent(this,this.startContent,{format:'raw'});}else{_setContent(this,initialContent);}this.undoManager.reset();this.setDirty(false);this.nodeChanged();}},{key:"isDirty",value:function isDirty(){return!this.isNotDirty;}},{key:"setDirty",value:function setDirty(state){var oldState=!this.isNotDirty;this.isNotDirty=!state;if(state&&state!==oldState){this.dispatch('dirty');}}},{key:"getContainer",value:function getContainer(){var self=this;if(!self.container){self.container=DOM$1.get(self.editorContainer||self.id+'_parent');}return self.container;}},{key:"getContentAreaContainer",value:function getContentAreaContainer(){return this.contentAreaContainer;}},{key:"getElement",value:function getElement(){if(!this.targetElm){this.targetElm=DOM$1.get(this.id);}return this.targetElm;}},{key:"getWin",value:function getWin(){var self=this;var elm;if(!self.contentWindow){elm=self.iframeElement;if(elm){self.contentWindow=elm.contentWindow;}}return self.contentWindow;}},{key:"getDoc",value:function getDoc(){var self=this;var win;if(!self.contentDocument){win=self.getWin();if(win){self.contentDocument=win.document;}}return self.contentDocument;}},{key:"getBody",value:function getBody(){var doc=this.getDoc();return this.bodyElement||(doc?doc.body:null);}},{key:"convertURL",value:function convertURL(url,name,elm){var self=this,getOption=self.options.get;var urlConverterCallback=getUrlConverterCallback(self);if(isFunction(urlConverterCallback)){return urlConverterCallback.call(self,url,elm,true,name);}if(!getOption('convert_urls')||elm&&elm.nodeName==='LINK'||url.indexOf('file:')===0||url.length===0){return url;}if(getOption('relative_urls')){return self.documentBaseURI.toRelative(url);}url=self.documentBaseURI.toAbsolute(url,getOption('remove_script_host'));return url;}},{key:"addVisual",value:function addVisual(elm){_addVisual(this,elm);}},{key:"remove",value:function remove(){remove$1(this);}},{key:"destroy",value:function destroy(automatic){_destroy(this,automatic);}},{key:"uploadImages",value:function uploadImages(){return this.editorUpload.uploadImages();}},{key:"_scanForImages",value:function _scanForImages(){return this.editorUpload.scanForImages();}}]);return Editor;}();var DOM=DOMUtils.DOM;var each=Tools.each;var boundGlobalEvents=false;var beforeUnloadDelegate;var editors=[];var globalEventDelegate=function globalEventDelegate(e){var type=e.type;each(EditorManager.get(),function(editor){switch(type){case'scroll':editor.dispatch('ScrollWindow',e);break;case'resize':editor.dispatch('ResizeWindow',e);break;}});};var toggleGlobalEvents=function toggleGlobalEvents(state){if(state!==boundGlobalEvents){var _DOM=DOMUtils.DOM;if(state){_DOM.bind(window,'resize',globalEventDelegate);_DOM.bind(window,'scroll',globalEventDelegate);}else{_DOM.unbind(window,'resize',globalEventDelegate);_DOM.unbind(window,'scroll',globalEventDelegate);}boundGlobalEvents=state;}};var removeEditorFromList=function removeEditorFromList(targetEditor){var oldEditors=editors;editors=filter$6(editors,function(editor){return targetEditor!==editor;});if(EditorManager.activeEditor===targetEditor){EditorManager.activeEditor=editors.length>0?editors[0]:null;}if(EditorManager.focusedEditor===targetEditor){EditorManager.focusedEditor=null;}return oldEditors.length!==editors.length;};var purgeDestroyedEditor=function purgeDestroyedEditor(editor){if(editor&&editor.initialized&&!(editor.getContainer()||editor.getBody()).parentNode){removeEditorFromList(editor);editor.unbindAllNativeEvents();editor.destroy(true);editor.removed=true;editor=null;}return editor;};var isQuirksMode=document.compatMode!=='CSS1Compat';var EditorManager=_objectSpread({},Observable,{baseURI:null,baseURL:null,defaultOptions:{},documentBaseURL:null,suffix:null,majorVersion:'6',minorVersion:'1.2',releaseDate:'2022-07-29',i18n:I18n,activeEditor:null,focusedEditor:null,setup:function setup(){var self=this;var baseURL,documentBaseURL,suffix='';documentBaseURL=URI.getDocumentBaseUrl(document.location);if(/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)){documentBaseURL=documentBaseURL.replace(/[\?#].*$/,'').replace(/[\/\\][^\/]+$/,'');if(!/[\/\\]$/.test(documentBaseURL)){documentBaseURL+='/';}}var preInit=window.tinymce||window.tinyMCEPreInit;if(preInit){baseURL=preInit.base||preInit.baseURL;suffix=preInit.suffix;}else{var scripts=document.getElementsByTagName('script');for(var i=0;i<scripts.length;i++){var src=scripts[i].src||'';if(src===''){continue;}var srcScript=src.substring(src.lastIndexOf('/'));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){if(srcScript.indexOf('.min')!==-1){suffix='.min';}baseURL=src.substring(0,src.lastIndexOf('/'));break;}}if(!baseURL&&document.currentScript){var _src=document.currentScript.src;if(_src.indexOf('.min')!==-1){suffix='.min';}baseURL=_src.substring(0,_src.lastIndexOf('/'));}}self.baseURL=new URI(documentBaseURL).toAbsolute(baseURL);self.documentBaseURL=documentBaseURL;self.baseURI=new URI(self.baseURL);self.suffix=suffix;setup$v(self);},overrideDefaults:function overrideDefaults(defaultOptions){var baseUrl=defaultOptions.base_url;if(baseUrl){this._setBaseUrl(baseUrl);}var suffix=defaultOptions.suffix;if(defaultOptions.suffix){this.suffix=suffix;}this.defaultOptions=defaultOptions;var pluginBaseUrls=defaultOptions.plugin_base_urls;if(pluginBaseUrls!==undefined){each$e(pluginBaseUrls,function(pluginBaseUrl,pluginName){AddOnManager.PluginManager.urls[pluginName]=pluginBaseUrl;});}},init:function init(options){var self=this;var result;var invalidInlineTargets=Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track '+'colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu',' ');var isInvalidInlineTarget=function isInvalidInlineTarget(options,elm){return options.inline&&elm.tagName.toLowerCase()in invalidInlineTargets;};var createId=function createId(elm){var id=elm.id;if(!id){id=get$a(elm,'name').filter(function(name){return!DOM.get(name);}).getOrThunk(DOM.uniqueId);elm.setAttribute('id',id);}return id;};var execCallback=function execCallback(name){var callback=options[name];if(!callback){return;}return callback.apply(self,[]);};var findTargets=function findTargets(options){if(Env.browser.isIE()||Env.browser.isEdge()){initError('TinyMCE does not support the browser you are using. For a list of supported'+' browsers please see: https://www.tiny.cloud/docs/tinymce/6/support/#supportedwebbrowsers');return[];}else if(isQuirksMode){initError('Failed to initialize the editor as the document is not in standards mode. '+'TinyMCE requires standards mode.');return[];}else if(isString(options.selector)){return DOM.select(options.selector);}else if(isNonNullable(options.target)){return[options.target];}else{return[];}};var provideResults=function provideResults(editors){result=editors;};var initEditors=function initEditors(){var initCount=0;var editors=[];var targets;var createEditor=function createEditor(id,options,targetElm){var editor=new Editor(id,options,self);editors.push(editor);editor.on('init',function(){if(++initCount===targets.length){provideResults(editors);}});editor.targetElm=editor.targetElm||targetElm;editor.render();};DOM.unbind(window,'ready',initEditors);execCallback('onpageload');targets=unique$1(findTargets(options));Tools.each(targets,function(elm){purgeDestroyedEditor(self.get(elm.id));});targets=Tools.grep(targets,function(elm){return!self.get(elm.id);});if(targets.length===0){provideResults([]);}else{each(targets,function(elm){if(isInvalidInlineTarget(options,elm)){initError('Could not initialize inline editor on invalid inline target element',elm);}else{createEditor(createId(elm),options,elm);}});}};DOM.bind(window,'ready',initEditors);return new Promise(function(resolve){if(result){resolve(result);}else{provideResults=function provideResults(editors){resolve(editors);};}});},get:function get(id){if(arguments.length===0){return editors.slice(0);}else if(isString(id)){return find$2(editors,function(editor){return editor.id===id;}).getOr(null);}else if(isNumber(id)){return editors[id]?editors[id]:null;}else{return null;}},add:function add(editor){var self=this;var existingEditor=self.get(editor.id);if(existingEditor===editor){return editor;}if(existingEditor===null){editors.push(editor);}toggleGlobalEvents(true);self.activeEditor=editor;self.dispatch('AddEditor',{editor:editor});if(!beforeUnloadDelegate){beforeUnloadDelegate=function beforeUnloadDelegate(e){var event=self.dispatch('BeforeUnload');if(event.returnValue){e.preventDefault();e.returnValue=event.returnValue;return event.returnValue;}};window.addEventListener('beforeunload',beforeUnloadDelegate);}return editor;},createEditor:function createEditor(id,options){return this.add(new Editor(id,options,this));},remove:function remove(selector){var self=this;var i,editor;if(!selector){for(i=editors.length-1;i>=0;i--){self.remove(editors[i]);}return;}if(isString(selector)){each(DOM.select(selector),function(elm){editor=self.get(elm.id);if(editor){self.remove(editor);}});return;}editor=selector;if(isNull(self.get(editor.id))){return null;}if(removeEditorFromList(editor)){self.dispatch('RemoveEditor',{editor:editor});}if(editors.length===0){window.removeEventListener('beforeunload',beforeUnloadDelegate);}editor.remove();toggleGlobalEvents(editors.length>0);return editor;},execCommand:function execCommand(cmd,ui,value){var _a;var self=this;var editorId=isObject(value)?(_a=value.id)!==null&&_a!==void 0?_a:value.index:value;switch(cmd){case'mceAddEditor':{if(!self.get(editorId)){var editorOptions=value.options;new Editor(editorId,editorOptions,self).render();}return true;}case'mceRemoveEditor':{var editor=self.get(editorId);if(editor){editor.remove();}return true;}case'mceToggleEditor':{var _editor2=self.get(editorId);if(!_editor2){self.execCommand('mceAddEditor',false,value);return true;}if(_editor2.isHidden()){_editor2.show();}else{_editor2.hide();}return true;}}if(self.activeEditor){return self.activeEditor.execCommand(cmd,ui,value);}return false;},triggerSave:function triggerSave(){each(editors,function(editor){editor.save();});},addI18n:function addI18n(code,items){I18n.add(code,items);},translate:function translate(text){return I18n.translate(text);},setActive:function setActive(editor){var activeEditor=this.activeEditor;if(this.activeEditor!==editor){if(activeEditor){activeEditor.dispatch('deactivate',{relatedTarget:editor});}editor.dispatch('activate',{relatedTarget:activeEditor});}this.activeEditor=editor;},_setBaseUrl:function _setBaseUrl(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,''));this.baseURI=new URI(this.baseURL);}});EditorManager.setup();var setup=function setup(){var dataValue=value$2();var FakeClipboardItem=function FakeClipboardItem(items){return{items:items,types:keys(items),getType:function getType(type){return get$a(items,type).getOrUndefined();}};};var write=function write(data){dataValue.set(data);};var read=function read(){return dataValue.get().getOrUndefined();};var clear=dataValue.clear;return{FakeClipboardItem:FakeClipboardItem,write:write,read:read,clear:clear};};var FakeClipboard=setup();var min=Math.min,max=Math.max,round=Math.round;var relativePosition=function relativePosition(rect,targetRect,rel){var x=targetRect.x;var y=targetRect.y;var w=rect.w;var h=rect.h;var targetW=targetRect.w;var targetH=targetRect.h;var relChars=(rel||'').split('');if(relChars[0]==='b'){y+=targetH;}if(relChars[1]==='r'){x+=targetW;}if(relChars[0]==='c'){y+=round(targetH/2);}if(relChars[1]==='c'){x+=round(targetW/2);}if(relChars[3]==='b'){y-=h;}if(relChars[4]==='r'){x-=w;}if(relChars[3]==='c'){y-=round(h/2);}if(relChars[4]==='c'){x-=round(w/2);}return create$2(x,y,w,h);};var findBestRelativePosition=function findBestRelativePosition(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++){pos=relativePosition(rect,targetRect,rels[i]);if(pos.x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y){return rels[i];}}return null;};var inflate=function inflate(rect,w,h){return create$2(rect.x-w,rect.y-h,rect.w+w*2,rect.h+h*2);};var intersect=function intersect(rect,cropRect){var x1=max(rect.x,cropRect.x);var y1=max(rect.y,cropRect.y);var x2=min(rect.x+rect.w,cropRect.x+cropRect.w);var y2=min(rect.y+rect.h,cropRect.y+cropRect.h);if(x2-x1<0||y2-y1<0){return null;}return create$2(x1,y1,x2-x1,y2-y1);};var clamp=function clamp(rect,clampRect,fixedSize){var x1=rect.x;var y1=rect.y;var x2=rect.x+rect.w;var y2=rect.y+rect.h;var cx2=clampRect.x+clampRect.w;var cy2=clampRect.y+clampRect.h;var underflowX1=max(0,clampRect.x-x1);var underflowY1=max(0,clampRect.y-y1);var overflowX2=max(0,x2-cx2);var overflowY2=max(0,y2-cy2);x1+=underflowX1;y1+=underflowY1;if(fixedSize){x2+=underflowX1;y2+=underflowY1;x1-=overflowX2;y1-=overflowY2;}x2-=overflowX2;y2-=overflowY2;return create$2(x1,y1,x2-x1,y2-y1);};var create$2=function create$2(x,y,w,h){return{x:x,y:y,w:w,h:h};};var fromClientRect=function fromClientRect(clientRect){return create$2(clientRect.left,clientRect.top,clientRect.width,clientRect.height);};var Rect={inflate:inflate,relativePosition:relativePosition,findBestRelativePosition:findBestRelativePosition,intersect:intersect,clamp:clamp,create:create$2,fromClientRect:fromClientRect};var awaiter=function awaiter(resolveCb,rejectCb){var timeout=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1000;var done=false;var timer=null;var complete=function complete(completer){return function(){if(!done){done=true;if(timer!==null){clearTimeout(timer);timer=null;}for(var _len16=arguments.length,args=new Array(_len16),_key16=0;_key16<_len16;_key16++){args[_key16]=arguments[_key16];}completer.apply(null,args);}};};var resolve=complete(resolveCb);var reject=complete(rejectCb);var start=function start(){for(var _len17=arguments.length,args=new Array(_len17),_key17=0;_key17<_len17;_key17++){args[_key17]=arguments[_key17];}if(!done&&timer===null){timer=setTimeout(function(){return reject.apply(null,args);},timeout);}};return{start:start,resolve:resolve,reject:reject};};var create$1=function create$1(){var tasks={};var resultFns={};var load=function load(id,url){var loadErrMsg="Script at URL \"".concat(url,"\" failed to load");var runErrMsg="Script at URL \"".concat(url,"\" did not call `tinymce.Resource.add('").concat(id,"', data)` within 1 second");if(tasks[id]!==undefined){return tasks[id];}else{var task=new Promise(function(resolve,reject){var waiter=awaiter(resolve,reject);resultFns[id]=waiter.resolve;ScriptLoader.ScriptLoader.loadScript(url).then(function(){return waiter.start(runErrMsg);},function(){return waiter.reject(loadErrMsg);});});tasks[id]=task;return task;}};var add=function add(id,data){if(resultFns[id]!==undefined){resultFns[id](data);delete resultFns[id];}tasks[id]=Promise.resolve(data);};var unload=function unload(id){delete tasks[id];};return{load:load,add:add,unload:unload};};var Resource=create$1();var create=function create(){return function(){var data={};var keys=[];var storage={getItem:function getItem(key){var item=data[key];return item?item:null;},setItem:function setItem(key,value){keys.push(key);data[key]=String(value);},key:function key(index){return keys[index];},removeItem:function removeItem(key){keys=keys.filter(function(k){return k===key;});delete data[key];},clear:function clear(){keys=[];data={};},length:0};Object.defineProperty(storage,'length',{get:function get(){return keys.length;},configurable:false,enumerable:false});return storage;}();};var localStorage;try{var test='__storage_test__';localStorage=window.localStorage;localStorage.setItem(test,test);localStorage.removeItem(test);}catch(e){localStorage=create();}var LocalStorage=localStorage;var publicApi={geom:{Rect:Rect},util:{Delay:Delay,Tools:Tools,VK:VK,URI:URI,EventDispatcher:EventDispatcher,Observable:Observable,I18n:I18n,LocalStorage:LocalStorage,ImageUploader:ImageUploader},dom:{EventUtils:EventUtils,TreeWalker:DomTreeWalker,TextSeeker:TextSeeker,DOMUtils:DOMUtils,ScriptLoader:ScriptLoader,RangeUtils:RangeUtils,Serializer:DomSerializer,StyleSheetLoader:StyleSheetLoader,ControlSelection:ControlSelection,BookmarkManager:BookmarkManager,Selection:EditorSelection,Event:EventUtils.Event},html:{Styles:Styles,Entities:Entities,Node:AstNode,Schema:Schema,DomParser:DomParser,Writer:Writer,Serializer:HtmlSerializer},Env:Env,AddOnManager:AddOnManager,Annotator:Annotator,Formatter:Formatter,UndoManager:UndoManager,EditorCommands:EditorCommands,WindowManager:WindowManager,NotificationManager:NotificationManager,EditorObservable:EditorObservable,Shortcuts:Shortcuts,Editor:Editor,FocusManager:FocusManager,EditorManager:EditorManager,DOM:DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager:PluginManager,ThemeManager:ThemeManager,ModelManager:ModelManager,IconManager:IconManager,Resource:Resource,FakeClipboard:FakeClipboard,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,walk:Tools.walk,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix};var tinymce=Tools.extend(EditorManager,publicApi);var exportToModuleLoaders=function exportToModuleLoaders(tinymce){if((typeof module==="undefined"?"undefined":_typeof2(module))==='object'){try{module.exports=tinymce;}catch(_){}}};var exportToWindowGlobal=function exportToWindowGlobal(tinymce){window.tinymce=tinymce;window.tinyMCE=tinymce;};exportToWindowGlobal(tinymce);exportToModuleLoaders(tinymce);})();